/*
	The below work is licensed under Creative Commons GNU LGPL License.

	Original work:

	License:     http://creativecommons.org/licenses/LGPL/2.1/
	Author:      Stefan Goessner/2006
	Web:         http://goessner.net/ 

	Modifications made:

	Version:     0.9-p5
	Description: Restructured code, JSLint validated (no strict whitespaces),
	             added handling of empty arrays, empty strings, and int/floats values.
	Author:      Michael Sch√∏ler/2008-01-29
	Web:         http://michael.hinnerup.net/blog/2008/01/26/converting-json-to-xml-and-xml-to-json/
	
	Description: json2xml added support to convert functions as CDATA
	             so it will be easy to write characters that cause some problems when convert
	Author:      Tony Tomov
*/

/*global alert */
var xmlJsonClass={xml2json:function(a,b){if(a.nodeType===9){a=a.documentElement}var c=this.removeWhite(a);var d=this.toObj(c);var e=this.toJson(d,a.nodeName,"\t");return"{\n"+b+(b?e.replace(/\t/g,b):e.replace(/\t|\n/g,""))+"\n}"},json2xml:function(o,f){var g=function(v,a,b){var c="";var i,n;if(v instanceof Array){if(v.length===0){c+=b+"<"+a+">__EMPTY_ARRAY_</"+a+">\n"}else{for(i=0,n=v.length;i<n;i+=1){var d=b+g(v[i],a,b+"\t")+"\n";c+=d}}}else if(typeof(v)==="object"){var e=false;c+=b+"<"+a;var m;for(m in v)if(v.hasOwnProperty(m)){if(m.charAt(0)==="@"){c+=" "+m.substr(1)+"=\""+v[m].toString()+"\""}else{e=true}}c+=e?">":"/>";if(e){for(m in v)if(v.hasOwnProperty(m)){if(m==="#text"){c+=v[m]}else if(m==="#cdata"){c+="<![CDATA["+v[m]+"]]>"}else if(m.charAt(0)!=="@"){c+=g(v[m],m,b+"\t")}}c+=(c.charAt(c.length-1)==="\n"?b:"")+"</"+a+">"}}else if(typeof(v)==="function"){c+=b+"<"+a+">"+"<![CDATA["+v+"]]>"+"</"+a+">"}else{if(v===undefined){v=""}if(v.toString()==="\"\""||v.toString().length===0){c+=b+"<"+a+">__EMPTY_STRING_</"+a+">"}else{c+=b+"<"+a+">"+v.toString()+"</"+a+">"}}return c};var h="";var m;for(m in o)if(o.hasOwnProperty(m)){h+=g(o[m],m,"")}return f?h.replace(/\t/g,f):h.replace(/\t|\n/g,"")},toObj:function(a){var o={};var b=/function/i;if(a.nodeType===1){if(a.attributes.length){var i;for(i=0;i<a.attributes.length;i+=1){o["@"+a.attributes[i].nodeName]=(a.attributes[i].nodeValue||"").toString()}}if(a.firstChild){var c=0,cdataChild=0,hasElementChild=false;var n;for(n=a.firstChild;n;n=n.nextSibling){if(n.nodeType===1){hasElementChild=true}else if(n.nodeType===3&&n.nodeValue.match(/[^ \f\n\r\t\v]/)){c+=1}else if(n.nodeType===4){cdataChild+=1}}if(hasElementChild){if(c<2&&cdataChild<2){this.removeWhite(a);for(n=a.firstChild;n;n=n.nextSibling){if(n.nodeType===3){o["#text"]=this.escape(n.nodeValue)}else if(n.nodeType===4){if(b.test(n.nodeValue)){o[n.nodeName]=[o[n.nodeName],n.nodeValue]}else{o["#cdata"]=this.escape(n.nodeValue)}}else if(o[n.nodeName]){if(o[n.nodeName]instanceof Array){o[n.nodeName][o[n.nodeName].length]=this.toObj(n)}else{o[n.nodeName]=[o[n.nodeName],this.toObj(n)]}}else{o[n.nodeName]=this.toObj(n)}}}else{if(!a.attributes.length){o=this.escape(this.innerXml(a))}else{o["#text"]=this.escape(this.innerXml(a))}}}else if(c){if(!a.attributes.length){o=this.escape(this.innerXml(a));if(o==="__EMPTY_ARRAY_"){o="[]"}else if(o==="__EMPTY_STRING_"){o=""}}else{o["#text"]=this.escape(this.innerXml(a))}}else if(cdataChild){if(cdataChild>1){o=this.escape(this.innerXml(a))}else{for(n=a.firstChild;n;n=n.nextSibling){if(b.test(a.firstChild.nodeValue)){o=a.firstChild.nodeValue;break}else{o["#cdata"]=this.escape(n.nodeValue)}}}}}if(!a.attributes.length&&!a.firstChild){o=null}}else if(a.nodeType===9){o=this.toObj(a.documentElement)}else{alert("unhandled node type: "+a.nodeType)}return o},toJson:function(o,a,b,c){if(c===undefined)c=true;var d=a?("\""+a+"\""):"",tab="\t",newline="\n";if(!c){tab="";newline=""}if(o==="[]"){d+=(a?":[]":"[]")}else if(o instanceof Array){var n,i,ar=[];for(i=0,n=o.length;i<n;i+=1){ar[i]=this.toJson(o[i],"",b+tab,c)}d+=(a?":[":"[")+(ar.length>1?(newline+b+tab+ar.join(","+newline+b+tab)+newline+b):ar.join(""))+"]"}else if(o===null){d+=(a&&":")+"null"}else if(typeof(o)==="object"){var e=[],m;for(m in o){if(o.hasOwnProperty(m)){e[e.length]=this.toJson(o[m],m,b+tab,c)}}d+=(a?":{":"{")+(e.length>1?(newline+b+tab+e.join(","+newline+b+tab)+newline+b):e.join(""))+"}"}else if(typeof(o)==="string"){d+=(a&&":")+"\""+o.replace(/\\/g,'\\\\').replace(/\"/g,'\\"')+"\""}else{d+=(a&&":")+o.toString()}return d},innerXml:function(a){var s="";if("innerHTML"in a){s=a.innerHTML}else{var b=function(n){var s="",i;if(n.nodeType===1){s+="<"+n.nodeName;for(i=0;i<n.attributes.length;i+=1){s+=" "+n.attributes[i].nodeName+"=\""+(n.attributes[i].nodeValue||"").toString()+"\""}if(n.firstChild){s+=">";for(var c=n.firstChild;c;c=c.nextSibling){s+=b(c)}s+="</"+n.nodeName+">"}else{s+="/>"}}else if(n.nodeType===3){s+=n.nodeValue}else if(n.nodeType===4){s+="<![CDATA["+n.nodeValue+"]]>"}return s};for(var c=a.firstChild;c;c=c.nextSibling){s+=b(c)}}return s},escape:function(a){return a.replace(/[\\]/g,"\\\\").replace(/[\"]/g,'\\"').replace(/[\n]/g,'\\n').replace(/[\r]/g,'\\r')},removeWhite:function(e){e.normalize();var n;for(n=e.firstChild;n;){if(n.nodeType===3){if(!n.nodeValue.match(/[^ \f\n\r\t\v]/)){var a=n.nextSibling;e.removeChild(n);n=a}else{n=n.nextSibling}}else if(n.nodeType===1){this.removeWhite(n);n=n.nextSibling}else{n=n.nextSibling}}return e}};