/*
 Transform a table to a jqGrid.
 Peter Romianowski <peter.romianowski@optivo.de> 
 If the first column of the table contains checkboxes or
 radiobuttons then the jqGrid is made selectable.
*/
// Addition - selector can be a class or id
function tableToGrid(p,q){jQuery(p).each(function(){if(this.grid){return}jQuery(this).width("99%");var w=jQuery(this).width();var e=jQuery('tr td:first-child input[type=checkbox]:first',jQuery(this));var f=jQuery('tr td:first-child input[type=radio]:first',jQuery(this));var g=e.length>0;var h=!g&&f.length>0;var i=g||h;var j=[];var k=[];jQuery('th',jQuery(this)).each(function(){if(j.length===0&&i){j.push({name:'__selection__',index:'__selection__',width:0,hidden:true});k.push('__selection__')}else{j.push({name:jQuery(this).attr("id")||jQuery.trim(jQuery.jgrid.stripHtml(jQuery(this).html())).split(' ').join('_'),index:jQuery(this).attr("id")||jQuery.trim(jQuery.jgrid.stripHtml(jQuery(this).html())).split(' ').join('_'),width:jQuery(this).width()||150});k.push(jQuery(this).html())}});var l=[];var m=[];var n=[];jQuery('tbody > tr',jQuery(this)).each(function(){var c={};var d=0;jQuery('td',jQuery(this)).each(function(){if(d===0&&i){var a=jQuery('input',jQuery(this));var b=a.attr("value");m.push(b||l.length);if(a.is(":checked")){n.push(b)}c[j[d].name]=a.attr("value")}else{c[j[d].name]=jQuery(this).html()}d++});if(d>0){l.push(c)}});jQuery(this).empty();jQuery(this).addClass("scroll");jQuery(this).jqGrid(jQuery.extend({datatype:"local",width:w,colNames:k,colModel:j,multiselect:g},q||{}));var a;for(a=0;a<l.length;a++){var o=null;if(m.length>0){o=m[a];if(o&&o.replace){o=encodeURIComponent(o).replace(/[.\-%]/g,"_")}}if(o===null){o=a+1}jQuery(this).jqGrid("addRowData",o,l[a])}for(a=0;a<n.length;a++){jQuery(this).jqGrid("setSelection",n[a])}})};
