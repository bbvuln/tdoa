var _canLog=true;function _log(e,t){if(!_canLog){return}var i=Array.prototype.slice.apply(arguments,[1]);var s=new Date;var a=s.getHours()+":"+s.getMinutes()+":"+s.getSeconds()+"."+s.getMilliseconds();i[0]=a+" - "+i[0];try{switch(e){case"info":window.console.info.apply(window.console,i);break;case"warn":window.console.warn.apply(window.console,i);break;default:window.console.log.apply(window.console,i);break}}catch(e){if(!window.console){_canLog=false}else if(e.number===-2146827850){window.console.log(i.join(", "))}}}function logMsg(e){Array.prototype.unshift.apply(arguments,["debug"]);_log.apply(this,arguments)}var getDynaTreePersistData=null;var DTNodeStatus_Error=-1;var DTNodeStatus_Loading=1;var DTNodeStatus_Ok=0;(function($){var Class={create:function(){return function(){this.initialize.apply(this,arguments)}}};function getDtNodeFromElement(e){alert("getDtNodeFromElement is deprecated");return $.ui.dynatree.getNode(e)}function noop(){}function offsetString(e){return e===0?"":e>0?"+"+e:""+e}function _checkBrowser(){var e,t;function i(e){e=e.toLowerCase();var t=/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[];return{browser:t[1]||"",version:t[2]||"0"}}e=i(navigator.userAgent);t={};if(e.browser){t[e.browser]=true;t.version=e.version}if(t.chrome){t.webkit=true}else if(t.webkit){t.safari=true}return t}function versionCompare(e,t){var i=(""+e).split("."),s=(""+t).split("."),a=Math.min(i.length,s.length),n,r,o;for(o=0;o<a;o++){n=parseInt(i[o],10);r=parseInt(s[o],10);if(isNaN(n)){n=i[o]}if(isNaN(r)){r=s[o]}if(n==r){continue}else if(n>r){return 1}else if(n<r){return-1}return NaN}if(i.length===s.length){return 0}return i.length<s.length?-1:1}var BROWSER=_checkBrowser();var jquerySupports={positionMyOfs:versionCompare($.ui.version,"1.9")>=0};var DynaTreeNode=Class.create();DynaTreeNode.prototype={initialize:function(e,t,i){this.parent=e;this.tree=t;if(typeof i==="string"){i={title:i}}if(i.key==null){i.key="_"+t._nodeCount++}else{i.key=""+i.key}this.data=$.extend({},$.ui.dynatree.nodedatadefaults,i);this.li=null;this.span=null;this.ul=null;this.childList=null;this._isLoading=false;this.hasSubSel=false;this.bExpanded=false;this.bSelected=false},toString:function(){return"DynaTreeNode<"+this.data.key+">: '"+this.data.title+"'"},toDict:function(e,t){var i,s=$.extend({},this.data);s.activate=this.tree.activeNode===this;s.focus=this.tree.focusNode===this;s.expand=this.bExpanded;s.select=this.bSelected;if(t){t(s)}if(e&&this.childList){s.children=[];for(var a=0,n=this.childList.length;a<n;a++){i=this.childList[a];if(!i.isStatusNode()){s.children.push(i.toDict(true,t))}}}else{delete s.children}return s},fromDict:function(e){var t=e.children;if(t===undefined){this.data=$.extend(this.data,e);this.render();return}e=$.extend({},e);e.children=undefined;this.data=$.extend(this.data,e);this.removeChildren();this.addChild(t)},_getInnerHtml:function(){var e=this.tree,t=e.options,i=e.cache,s=this.getLevel(),a=this.data,n="",r;if(s<t.minExpandLevel){if(s>1){n+=i.tagConnector}}else if(this.hasChildren()!==false){n+=i.tagExpander}else{n+=i.tagConnector}if(t.checkbox&&a.hideCheckbox!==true&&!a.isStatusNode){n+=i.tagCheckbox}if(a.icon){if(a.icon.charAt(0)==="/"){r=a.icon}else{r=t.imagePath+a.icon}n+="<img src='"+r+"' alt='' />"}else if(a.icon===false){}else if(a.iconClass){n+="<span class='"+" "+a.iconClass+"'></span>"}else{n+=i.tagNodeIcon}var o="";if(t.onCustomRender){o=t.onCustomRender.call(e,this)||""}if(!o){var l=a.tooltip?' title="'+a.tooltip.replace(/\"/g,"&quot;")+'"':"",d=a.href||"javascipt:;";if(t.noLink||a.noLink){o='<span style="display:inline-block;" class="'+t.classNames.title+'"'+l+">"+a.title+"</span>"}else{o='<a href="'+d+'" onclick="return false" class="'+t.classNames.title+'"'+l+">"+a.title+"</a>"}}n+=o;return n},_fixOrder:function(){var e=this.childList;if(!e||!this.ul){return}var t=this.ul.firstChild;for(var i=0,s=e.length-1;i<s;i++){var a=e[i];var n=t.dtnode;if(a!==n){this.tree.logDebug("_fixOrder: mismatch at index "+i+": "+a+" != "+n);this.ul.insertBefore(a.li,n.li)}else{t=t.nextSibling}}},render:function(e,t){var i=this.tree,s=this.parent,a=this.data,n=i.options,r=n.classNames,o=this.isLastSibling(),l=false;if(!s&&!this.ul){this.li=this.span=null;this.ul=document.createElement("ul");if(n.minExpandLevel>1){this.ul.className=r.container+" "+r.noConnector}else{this.ul.className=r.container}}else if(s){if(!this.li){l=true;this.li=document.createElement("li");this.li.dtnode=this;if(a.key&&n.generateIds){this.li.id=n.idPrefix+a.key}this.span=document.createElement("span");this.span.className=r.title;this.li.appendChild(this.span);if(!s.ul){s.ul=document.createElement("ul");s.ul.style.display="none";s.li.appendChild(s.ul)}s.ul.appendChild(this.li)}this.span.innerHTML=this._getInnerHtml();var d=[];d.push(r.node);if(a.isFolder){d.push(r.folder)}if(this.bExpanded){d.push(r.expanded)}if(this.hasChildren()!==false){d.push(r.hasChildren)}if(a.isLazy&&this.childList===null){d.push(r.lazy)}if(o){d.push(r.lastsib)}if(this.bSelected){d.push(r.selected)}if(this.hasSubSel){d.push(r.partsel)}if(i.activeNode===this){d.push(r.active)}if(a.addClass){d.push(a.addClass)}d.push(r.combinedExpanderPrefix+(this.bExpanded?"e":"c")+(a.isLazy&&this.childList===null?"d":"")+(o?"l":""));d.push(r.combinedIconPrefix+(this.bExpanded?"e":"c")+(a.isFolder?"f":""));this.span.className=d.join(" ");this.li.className=o?r.lastsib:"";if(l&&n.onCreate){n.onCreate.call(i,this,this.span)}if(n.onRender){n.onRender.call(i,this,this.span)}}if((this.bExpanded||t===true)&&this.childList){for(var h=0,c=this.childList.length;h<c;h++){this.childList[h].render(false,t)}this._fixOrder()}if(this.ul){var u=this.ul.style.display==="none";var f=!!this.bExpanded;if(e&&n.fx&&u===f){var p=n.fx.duration||200;$(this.ul).animate(n.fx,p)}else{this.ul.style.display=this.bExpanded||!s?"":"none"}}},getKeyPath:function(e){var t=[],i=this.tree.options.keyPathSeparator;this.visitParents(function(e){if(e.parent){t.unshift(e.data.key)}},!e);return i+t.join(i)},getParent:function(){return this.parent},getChildren:function(){if(this.hasChildren()===undefined){return undefined}return this.childList},hasChildren:function(){if(this.data.isLazy){if(this.childList===null||this.childList===undefined){return undefined}else if(this.childList.length===0){return false}else if(this.childList.length===1&&this.childList[0].isStatusNode()){return undefined}return true}return!!this.childList},isFirstSibling:function(){var e=this.parent;return!e||e.childList[0]===this},isLastSibling:function(){var e=this.parent;return!e||e.childList[e.childList.length-1]===this},isLoading:function(){return!!this._isLoading},getPrevSibling:function(){if(!this.parent){return null}var e=this.parent.childList;for(var t=1,i=e.length;t<i;t++){if(e[t]===this){return e[t-1]}}return null},getNextSibling:function(){if(!this.parent){return null}var e=this.parent.childList;for(var t=0,i=e.length-1;t<i;t++){if(e[t]===this){return e[t+1]}}return null},isStatusNode:function(){return this.data.isStatusNode===true},isChildOf:function(e){return this.parent&&this.parent===e},isDescendantOf:function(e){if(!e){return false}var t=this.parent;while(t){if(t===e){return true}t=t.parent}return false},countChildren:function(){var e=this.childList;if(!e){return 0}var t=e.length;for(var i=0,s=t;i<s;i++){var a=e[i];t+=a.countChildren()}return t},sortChildren:function(e,t){var i=this.childList;if(!i){return}e=e||function(e,t){var i=e.data.title.toLowerCase(),s=t.data.title.toLowerCase();return i===s?0:i>s?1:-1};i.sort(e);if(t){for(var s=0,a=i.length;s<a;s++){if(i[s].childList){i[s].sortChildren(e,"$norender$")}}}if(t!=="$norender$"){this.render()}},_setStatusNode:function(e){var t=this.childList?this.childList[0]:null;if(!e){if(t&&t.isStatusNode()){try{if(this.ul){this.ul.removeChild(t.li);t.li=null}}catch(e){}if(this.childList.length===1){this.childList=[]}else{this.childList.shift()}}}else if(t){e.isStatusNode=true;e.key="_statusNode";t.data=e;t.render()}else{e.isStatusNode=true;e.key="_statusNode";t=this.addChild(e)}},setLazyNodeStatus:function(e,t){var i=t&&t.tooltip?t.tooltip:null,s=t&&t.info?" ("+t.info+")":"";switch(e){case DTNodeStatus_Ok:this._setStatusNode(null);$(this.span).removeClass(this.tree.options.classNames.nodeLoading);this._isLoading=false;if(this.tree.options.autoFocus){if(this===this.tree.tnRoot&&this.childList&&this.childList.length>0){this.childList[0].focus()}else{this.focus()}}break;case DTNodeStatus_Loading:this._isLoading=true;$(this.span).addClass(this.tree.options.classNames.nodeLoading);if(!this.parent){this._setStatusNode({title:this.tree.options.strings.loading+s,tooltip:i,addClass:this.tree.options.classNames.nodeWait})}break;case DTNodeStatus_Error:this._isLoading=false;this._setStatusNode({title:this.tree.options.strings.loadError+s,tooltip:i,addClass:this.tree.options.classNames.nodeError});break;default:throw"Bad LazyNodeStatus: '"+e+"'."}},_parentList:function(e,t){var i=[];var s=t?this:this.parent;while(s){if(e||s.parent){i.unshift(s)}s=s.parent}return i},getLevel:function(){var e=0;var t=this.parent;while(t){e++;t=t.parent}return e},_getTypeForOuterNodeEvent:function(e){var t=this.tree.options.classNames;var i=e.target;if(i.className.indexOf(t.node)<0){return null}var s=e.pageX-i.offsetLeft;var a=e.pageY-i.offsetTop;for(var n=0,r=i.childNodes.length;n<r;n++){var o=i.childNodes[n];var l=o.offsetLeft-i.offsetLeft;var d=o.offsetTop-i.offsetTop;var h=o.clientWidth,c=o.clientHeight;if(s>=l&&s<=l+h&&a>=d&&a<=d+c){if(o.className==t.title){return"title"}else if(o.className==t.expander){return"expander"}else if(o.className==t.checkbox||o.className==t.radio){return"checkbox"}else if(o.className==t.nodeIcon){return"icon"}}}return"prefix"},getEventTargetType:function(e){var t=e&&e.target?e.target.className:"",i=this.tree.options.classNames;if(t.indexOf(i.title)>=0){return"title"}else if(t.indexOf(i.expander)>=0){return"expander"}else if(t.indexOf(i.checkbox)>=0||t.indexOf(i.radio)>=0){return"checkbox"}else if(t.indexOf(i.nodeIcon)>=0){return"icon"}else if(t.indexOf(i.empty)>=0||t.indexOf(i.vline)>=0||t.indexOf(i.connector)>=0){return"prefix"}else if(t.indexOf(i.node)>=0){return this._getTypeForOuterNodeEvent(e)}return null},isVisible:function(){var e=this._parentList(true,false);for(var t=0,i=e.length;t<i;t++){if(!e[t].bExpanded){return false}}return true},makeVisible:function(){var e=this._parentList(true,false);for(var t=0,i=e.length;t<i;t++){e[t]._expand(true)}},focus:function(){this.makeVisible();try{$(this.span).find(">a").focus()}catch(e){}},isFocused:function(){return this.tree.tnFocused===this},_activate:function(e,t){this.tree.logDebug("dtnode._activate(%o, fireEvents=%o) - %o",e,t,this);var i=this.tree.options;if(this.data.isStatusNode){return}if(e){if(t&&i.onQueryActivate&&i.onQueryActivate.call(this.tree,e,this)===false){return}if(this.tree.activeNode){if(this.tree.activeNode===this){return}this.tree.activeNode.deactivate()}if(i.activeVisible){this.makeVisible()}this.tree.activeNode=this;if(i.persist){$.cookie(i.cookieId+"-active",this.data.key,i.cookie)}this.tree.persistence.activeKey=this.data.key;$(this.span).addClass(i.classNames.active);if(t&&i.onActivate){i.onActivate.call(this.tree,this)}}else{if(this.tree.activeNode===this){if(i.onQueryActivate&&i.onQueryActivate.call(this.tree,false,this)===false){return}$(this.span).removeClass(i.classNames.active);if(i.persist){$.cookie(i.cookieId+"-active","",i.cookie)}this.tree.persistence.activeKey=null;this.tree.activeNode=null;if(t&&i.onDeactivate){i.onDeactivate.call(this.tree,this)}}}},activate:function(){this._activate(true,true)},activateSilently:function(){this._activate(true,false)},deactivate:function(){this._activate(false,true)},isActive:function(){return this.tree.activeNode===this},_userActivate:function(){var e=true;var t=false;if(this.data.isFolder){switch(this.tree.options.clickFolderMode){case 2:e=false;t=true;break;case 3:e=t=true;break}}if(this.parent===null){t=false}if(t){this.toggleExpand();this.focus()}if(e){this.activate()}},_setSubSel:function(e){if(e){this.hasSubSel=true;$(this.span).addClass(this.tree.options.classNames.partsel)}else{this.hasSubSel=false;$(this.span).removeClass(this.tree.options.classNames.partsel)}},_updatePartSelectionState:function(){var e;if(!this.hasChildren()){e=this.bSelected&&!this.data.unselectable&&!this.data.isStatusNode;this._setSubSel(false);return e}var t,i,s=this.childList,a=true,n=true;for(t=0,i=s.length;t<i;t++){var r=s[t],o=r._updatePartSelectionState();if(o!==false){n=false}if(o!==true){a=false}}if(a){e=true}else if(n){e=false}else{e=undefined}this._setSubSel(e===undefined);this.bSelected=e===true;return e},_fixSelectionState:function(){var e,t,i;if(this.bSelected){this.visit(function(e){e.parent._setSubSel(true);if(!e.data.unselectable){e._select(true,false,false)}});e=this.parent;while(e){e._setSubSel(true);var s=true;for(t=0,i=e.childList.length;t<i;t++){var a=e.childList[t];if(!a.bSelected&&!a.data.isStatusNode&&!a.data.unselectable){s=false;break}}if(s){e._select(true,false,false)}e=e.parent}}else{this._setSubSel(false);this.visit(function(e){e._setSubSel(false);e._select(false,false,false)});e=this.parent;while(e){e._select(false,false,false);var n=false;for(t=0,i=e.childList.length;t<i;t++){if(e.childList[t].bSelected||e.childList[t].hasSubSel){n=true;break}}e._setSubSel(n);e=e.parent}}},_select:function(e,t,i){var s=this.tree.options;if(this.data.isStatusNode){return}if(this.bSelected===e){return}if(t&&s.onQuerySelect&&s.onQuerySelect.call(this.tree,e,this)===false){return}if(s.selectMode==1&&e){this.tree.visit(function(e){if(e.bSelected){e._select(false,false,false);return false}})}this.bSelected=e;if(e){if(s.persist){this.tree.persistence.addSelect(this.data.key)}$(this.span).addClass(s.classNames.selected);if(i&&s.selectMode===3){this._fixSelectionState()}if(t&&s.onSelect){s.onSelect.call(this.tree,true,this)}}else{if(s.persist){this.tree.persistence.clearSelect(this.data.key)}$(this.span).removeClass(s.classNames.selected);if(i&&s.selectMode===3){this._fixSelectionState()}if(t&&s.onSelect){s.onSelect.call(this.tree,false,this)}}},select:function(e){if(this.data.unselectable){return this.bSelected}return this._select(e!==false,true,true)},toggleSelect:function(){return this.select(!this.bSelected)},isSelected:function(){return this.bSelected},isLazy:function(){return!!this.data.isLazy},_loadContent:function(){try{var e=this.tree.options;this.tree.logDebug("_loadContent: start - %o",this);this.setLazyNodeStatus(DTNodeStatus_Loading);if(true===e.onLazyRead.call(this.tree,this)){this.setLazyNodeStatus(DTNodeStatus_Ok);this.tree.logDebug("_loadContent: succeeded - %o",this)}}catch(e){this.tree.logWarning("_loadContent: failed - %o",e);this.setLazyNodeStatus(DTNodeStatus_Error,{tooltip:""+e})}},_expand:function(e,t){if(this.bExpanded===e){this.tree.logDebug("dtnode._expand(%o) IGNORED - %o",e,this);return}this.tree.logDebug("dtnode._expand(%o) - %o",e,this);var i=this.tree.options;if(!e&&this.getLevel()<i.minExpandLevel){this.tree.logDebug("dtnode._expand(%o) prevented collapse - %o",e,this);return}if(i.onQueryExpand&&i.onQueryExpand.call(this.tree,e,this)===false){return}this.bExpanded=e;if(i.persist){if(e){this.tree.persistence.addExpand(this.data.key)}else{this.tree.persistence.clearExpand(this.data.key)}}var s=!(this.data.isLazy&&this.childList===null)&&!this._isLoading&&!t;this.render(s);if(this.bExpanded&&this.parent&&i.autoCollapse){var a=this._parentList(false,true);for(var n=0,r=a.length;n<r;n++){a[n].collapseSiblings()}}if(i.activeVisible&&this.tree.activeNode&&!this.tree.activeNode.isVisible()){this.tree.activeNode.deactivate()}if(e&&this.data.isLazy&&this.childList===null&&!this._isLoading){this._loadContent();return}if(i.onExpand){i.onExpand.call(this.tree,e,this)}},isExpanded:function(){return this.bExpanded},expand:function(e){e=e!==false;if(!this.childList&&!this.data.isLazy&&e){return}else if(this.parent===null&&!e){return}this._expand(e)},scheduleAction:function(e,t){if(this.tree.timer){clearTimeout(this.tree.timer);this.tree.logDebug("clearTimeout(%o)",this.tree.timer)}var i=this;switch(e){case"cancel":break;case"expand":this.tree.timer=setTimeout(function(){i.tree.logDebug("setTimeout: trigger expand");i.expand(true)},t);break;case"activate":this.tree.timer=setTimeout(function(){i.tree.logDebug("setTimeout: trigger activate");i.activate()},t);break;default:throw"Invalid mode "+e}this.tree.logDebug("setTimeout(%s, %s): %s",e,t,this.tree.timer)},toggleExpand:function(){this.expand(!this.bExpanded)},collapseSiblings:function(){if(this.parent===null){return}var e=this.parent.childList;for(var t=0,i=e.length;t<i;t++){if(e[t]!==this&&e[t].bExpanded){e[t]._expand(false)}}},_onClick:function(e){var t=this.getEventTargetType(e);if(t==="expander"){this.toggleExpand();this.focus()}else if(t==="checkbox"){this.toggleSelect();this.focus()}else{this._userActivate();var i=$(this.span).children("a.dynatree-title");if(i[0]){if(!(BROWSER.msie&&parseInt(BROWSER.version,10)<9)){i[0].focus()}}else{return true}}e.preventDefault()},_onDblClick:function(e){},_onKeydown:function(e){var t=true,i;switch(e.which){case 107:case 187:if(!this.bExpanded){this.toggleExpand()}break;case 109:case 189:if(this.bExpanded){this.toggleExpand()}break;case 32:this._userActivate();break;case 8:if(this.parent){this.parent.focus()}break;case 37:if(this.bExpanded){this.toggleExpand();this.focus()}else if(this.parent&&this.parent.parent){this.parent.focus()}break;case 39:if(!this.bExpanded&&(this.childList||this.data.isLazy)){this.toggleExpand();this.focus()}else if(this.childList){this.childList[0].focus()}break;case 38:i=this.getPrevSibling();while(i&&i.bExpanded&&i.childList){i=i.childList[i.childList.length-1]}if(!i&&this.parent&&this.parent.parent){i=this.parent}if(i){i.focus()}break;case 40:if(this.bExpanded&&this.childList){i=this.childList[0]}else{var s=this._parentList(false,true);for(var a=s.length-1;a>=0;a--){i=s[a].getNextSibling();if(i){break}}}if(i){i.focus()}break;default:t=false}if(t){e.preventDefault()}},_onKeypress:function(e){},_onFocus:function(e){var t=this.tree.options;if(e.type=="blur"||e.type=="focusout"){if(t.onBlur){t.onBlur.call(this.tree,this)}if(this.tree.tnFocused){$(this.tree.tnFocused.span).removeClass(t.classNames.focused)}this.tree.tnFocused=null;if(t.persist){$.cookie(t.cookieId+"-focus","",t.cookie)}}else if(e.type=="focus"||e.type=="focusin"){if(this.tree.tnFocused&&this.tree.tnFocused!==this){this.tree.logDebug("dtnode.onFocus: out of sync: curFocus: %o",this.tree.tnFocused);$(this.tree.tnFocused.span).removeClass(t.classNames.focused)}this.tree.tnFocused=this;if(t.onFocus){t.onFocus.call(this.tree,this)}$(this.tree.tnFocused.span).addClass(t.classNames.focused);if(t.persist){$.cookie(t.cookieId+"-focus",this.data.key,t.cookie)}}},visit:function(e,t){var i=true;if(t===true){i=e(this);if(i===false||i==="skip"){return i}}if(this.childList){for(var s=0,a=this.childList.length;s<a;s++){i=this.childList[s].visit(e,true);if(i===false){break}}}return i},visitParents:function(e,t){if(t&&e(this)===false){return false}var i=this.parent;while(i){if(e(i)===false){return false}i=i.parent}return true},remove:function(){if(this===this.tree.root){throw"Cannot remove system root"}return this.parent.removeChild(this)},removeChild:function(e){var t=this.childList;if(t.length===1){if(e!==t[0]){throw"removeChild: invalid child"}return this.removeChildren()}if(e===this.tree.activeNode){e.deactivate()}if(this.tree.options.persist){if(e.bSelected){this.tree.persistence.clearSelect(e.data.key)}if(e.bExpanded){this.tree.persistence.clearExpand(e.data.key)}}e.removeChildren(true);if(this.ul&&e.li){this.ul.removeChild(e.li)}for(var i=0,s=t.length;i<s;i++){if(t[i]===e){this.childList.splice(i,1);break}}},removeChildren:function(e,t){this.tree.logDebug("%s.removeChildren(%o)",this,e);var i=this.tree;var s=this.childList;if(s){for(var a=0,n=s.length;a<n;a++){var r=s[a];if(r===i.activeNode&&!t){r.deactivate()}if(this.tree.options.persist&&!t){if(r.bSelected){this.tree.persistence.clearSelect(r.data.key)}if(r.bExpanded){this.tree.persistence.clearExpand(r.data.key)}}r.removeChildren(true,t);if(this.ul&&r.li){$("li",$(this.ul)).remove()}}this.childList=null}if(!e){this._isLoading=false;this.render()}},setTitle:function(e){this.fromDict({title:e})},reload:function(e){throw"Use reloadChildren() instead"},reloadChildren:function(e){if(this.parent===null){throw"Use tree.reload() instead"}else if(!this.data.isLazy){throw"node.reloadChildren() requires lazy nodes."}if(e){var t=this;var i="nodeLoaded.dynatree."+this.tree.$tree.attr("id")+"."+this.data.key;this.tree.$tree.bind(i,function(s,a,n){t.tree.$tree.unbind(i);t.tree.logDebug("loaded %o, %o, %o",s,a,n);if(a!==t){throw"got invalid load event"}e.call(t.tree,a,n)})}this.removeChildren();this._loadContent()},_loadKeyPath:function(e,t){var i=this.tree;i.logDebug("%s._loadKeyPath(%s)",this,e);if(e===""){throw"Key path must not be empty"}var s=e.split(i.options.keyPathSeparator);if(s[0]===""){throw"Key path must be relative (don't start with '/')"}var a=s.shift();if(this.childList){for(var n=0,r=this.childList.length;n<r;n++){var o=this.childList[n];if(o.data.key===a){if(s.length===0){t.call(i,o,"ok")}else if(o.data.isLazy&&(o.childList===null||o.childList===undefined)){i.logDebug("%s._loadKeyPath(%s) -> reloading %s...",this,e,o);var l=this;o.reloadChildren(function(a,n){if(n){i.logDebug("%s._loadKeyPath(%s) -> reloaded %s.",a,e,a);t.call(i,o,"loaded");a._loadKeyPath(s.join(i.options.keyPathSeparator),t)}else{i.logWarning("%s._loadKeyPath(%s) -> reloadChildren() failed.",l,e);t.call(i,o,"error")}})}else{t.call(i,o,"loaded");o._loadKeyPath(s.join(i.options.keyPathSeparator),t)}return}}}t.call(i,undefined,"notfound",a,s.length===0);i.logWarning("Node not found: "+a);return},resetLazy:function(){if(this.parent===null){throw"Use tree.reload() instead"}else if(!this.data.isLazy){throw"node.resetLazy() requires lazy nodes."}this.expand(false);this.removeChildren()},_addChildNode:function(e,t){var i=this.tree,s=i.options,a=i.persistence;e.parent=this;if(this.childList===null){this.childList=[]}else if(!t){if(this.childList.length>0){$(this.childList[this.childList.length-1].span).removeClass(s.classNames.lastsib)}}if(t){var n=$.inArray(t,this.childList);if(n<0){throw"<beforeNode> must be a child of <this>"}this.childList.splice(n,0,e)}else{this.childList.push(e)}var r=i.isInitializing();if(s.persist&&a.cookiesFound&&r){if(a.activeKey===e.data.key){i.activeNode=e}if(a.focusedKey===e.data.key){i.focusNode=e}e.bExpanded=$.inArray(e.data.key,a.expandedKeyList)>=0;e.bSelected=$.inArray(e.data.key,a.selectedKeyList)>=0}else{if(e.data.activate){i.activeNode=e;if(s.persist){a.activeKey=e.data.key}}if(e.data.focus){i.focusNode=e;if(s.persist){a.focusedKey=e.data.key}}e.bExpanded=e.data.expand===true;if(e.bExpanded&&s.persist){a.addExpand(e.data.key)}e.bSelected=e.data.select===true;if(e.bSelected&&s.persist){a.addSelect(e.data.key)}}if(s.minExpandLevel>=e.getLevel()){this.bExpanded=true}if(e.bSelected&&s.selectMode==3){var o=this;while(o){if(!o.hasSubSel){o._setSubSel(true)}o=o.parent}}if(i.bEnableUpdate){this.render()}return e},addChild:function(e,t){if(typeof e=="string"){throw"Invalid data type for "+e}else if(!e||e.length===0){return}else if(e instanceof DynaTreeNode){return this._addChildNode(e,t)}if(!e.length){e=[e]}var i=this.tree.enableUpdate(false);var s=null;for(var a=0,n=e.length;a<n;a++){var r=e[a];var o=this._addChildNode(new DynaTreeNode(this,this.tree,r),t);if(!s){s=o}if(r.children){o.addChild(r.children,null)}}this.tree.enableUpdate(i);return s},append:function(e){this.tree.logWarning("node.append() is deprecated (use node.addChild() instead).");return this.addChild(e,null)},appendAjax:function(e){var t=this;this.removeChildren(false,true);this.setLazyNodeStatus(DTNodeStatus_Loading);if(e.debugLazyDelay){var i=e.debugLazyDelay;e.debugLazyDelay=0;this.tree.logInfo("appendAjax: waiting for debugLazyDelay "+i);setTimeout(function(){t.appendAjax(e)},i);return}var s=e.success,a=e.error,n="nodeLoaded.dynatree."+this.tree.$tree.attr("id")+"."+this.data.key;var r=$.extend({},this.tree.options.ajaxDefaults,e,{success:function(e,i,a){var r=t.tree.phase,o=t.tree.options;t.tree.phase="init";if(o.postProcess){e=o.postProcess.call(this,e,this.dataType)}else if(e&&e.hasOwnProperty("d")){e=typeof e.d=="string"?$.parseJSON(e.d):e.d}if(!$.isArray(e)||e.length!==0){t.addChild(e,null)}t.tree.phase="postInit";if(s){s.call(o,t,e,i)}t.tree.logDebug("trigger "+n);t.tree.$tree.trigger(n,[t,true]);t.tree.phase=r;t.setLazyNodeStatus(DTNodeStatus_Ok);if($.isArray(e)&&e.length===0){t.childList=[];t.render()}},error:function(e,i,s){t.tree.logWarning("appendAjax failed:",i,":\n",e,"\n",s);if(a){a.call(r,t,e,i,s)}t.tree.$tree.trigger(n,[t,false]);t.setLazyNodeStatus(DTNodeStatus_Error,{info:i,tooltip:""+s})}});$.ajax(r)},move:function(e,t){var i;if(this===e){return}if(!this.parent){throw"Cannot move system root"}if(t===undefined||t=="over"){t="child"}var s=this.parent;var a=t==="child"?e:e.parent;if(a.isDescendantOf(this)){throw"Cannot move a node to it's own descendant"}if(this.parent.childList.length==1){this.parent.childList=this.parent.data.isLazy?[]:null;this.parent.bExpanded=false}else{i=$.inArray(this,this.parent.childList);if(i<0){throw"Internal error"}this.parent.childList.splice(i,1)}if(this.parent.ul&&this.li){this.parent.ul.removeChild(this.li)}this.parent=a;if(a.hasChildren()){switch(t){case"child":a.childList.push(this);break;case"before":i=$.inArray(e,a.childList);if(i<0){throw"Internal error"}a.childList.splice(i,0,this);break;case"after":i=$.inArray(e,a.childList);if(i<0){throw"Internal error"}a.childList.splice(i+1,0,this);break;default:throw"Invalid mode "+t}}else{a.childList=[this]}if(!a.ul){a.ul=document.createElement("ul");a.ul.style.display="none";if(a.li){a.li.appendChild(a.ul)}}if(this.li){a.ul.appendChild(this.li)}if(this.tree!==e.tree){this.visit(function(t){t.tree=e.tree},null,true);throw"Not yet implemented."}if(!s.isDescendantOf(a)){s.render()}if(!a.isDescendantOf(s)){a.render()}},lastentry:undefined};var DynaTreeStatus=Class.create();DynaTreeStatus._getTreePersistData=function(e,t){var i=new DynaTreeStatus(e,t);i.read();return i.toDict()};getDynaTreePersistData=DynaTreeStatus._getTreePersistData;DynaTreeStatus.prototype={initialize:function(e,t){if(e===undefined){e=$.ui.dynatree.prototype.options.cookieId}t=$.extend({},$.ui.dynatree.prototype.options.cookie,t);this.cookieId=e;this.cookieOpts=t;this.cookiesFound=undefined;this.activeKey=null;this.focusedKey=null;this.expandedKeyList=null;this.selectedKeyList=null},_log:function(e){Array.prototype.unshift.apply(arguments,["debug"]);_log.apply(this,arguments)},read:function(){this.cookiesFound=false;var e=$.cookie(this.cookieId+"-active");this.activeKey=e||"";if(e){this.cookiesFound=true}e=$.cookie(this.cookieId+"-focus");this.focusedKey=e||"";if(e){this.cookiesFound=true}e=$.cookie(this.cookieId+"-expand");this.expandedKeyList=e?e.split(","):[];if(e){this.cookiesFound=true}e=$.cookie(this.cookieId+"-select");this.selectedKeyList=e?e.split(","):[];if(e){this.cookiesFound=true}},write:function(){$.cookie(this.cookieId+"-active",this.activeKey===null?"":this.activeKey,this.cookieOpts);$.cookie(this.cookieId+"-focus",this.focusedKey===null?"":this.focusedKey,this.cookieOpts);$.cookie(this.cookieId+"-expand",this.expandedKeyList===null?"":this.expandedKeyList.join(","),this.cookieOpts);$.cookie(this.cookieId+"-select",this.selectedKeyList===null?"":this.selectedKeyList.join(","),this.cookieOpts)},addExpand:function(e){if($.inArray(e,this.expandedKeyList)<0){this.expandedKeyList.push(e);$.cookie(this.cookieId+"-expand",this.expandedKeyList.join(","),this.cookieOpts)}},clearExpand:function(e){var t=$.inArray(e,this.expandedKeyList);if(t>=0){this.expandedKeyList.splice(t,1);$.cookie(this.cookieId+"-expand",this.expandedKeyList.join(","),this.cookieOpts)}},addSelect:function(e){if($.inArray(e,this.selectedKeyList)<0){this.selectedKeyList.push(e);$.cookie(this.cookieId+"-select",this.selectedKeyList.join(","),this.cookieOpts)}},clearSelect:function(e){var t=$.inArray(e,this.selectedKeyList);if(t>=0){this.selectedKeyList.splice(t,1);$.cookie(this.cookieId+"-select",this.selectedKeyList.join(","),this.cookieOpts)}},isReloading:function(){return this.cookiesFound===true},toDict:function(){return{cookiesFound:this.cookiesFound,activeKey:this.activeKey,focusedKey:this.activeKey,expandedKeyList:this.expandedKeyList,selectedKeyList:this.selectedKeyList}},lastentry:undefined};var DynaTree=Class.create();DynaTree.version="@@Version";DynaTree.prototype={initialize:function(e){this.phase="init";this.$widget=e;this.options=e.options;this.$tree=e.element;this.timer=null;this.divTree=this.$tree.get(0);_initDragAndDrop(this)},_load:function(e){var t=this.$widget;var i=this.options,s=this;this.bEnableUpdate=true;this._nodeCount=1;this.activeNode=null;this.focusNode=null;if(i.rootVisible!==undefined){this.logWarning("Option 'rootVisible' is no longer supported.")}if(i.minExpandLevel<1){this.logWarning("Option 'minExpandLevel' must be >= 1.");i.minExpandLevel=1}if(i.classNames!==$.ui.dynatree.prototype.options.classNames){i.classNames=$.extend({},$.ui.dynatree.prototype.options.classNames,i.classNames)}if(i.ajaxDefaults!==$.ui.dynatree.prototype.options.ajaxDefaults){i.ajaxDefaults=$.extend({},$.ui.dynatree.prototype.options.ajaxDefaults,i.ajaxDefaults)}if(i.dnd!==$.ui.dynatree.prototype.options.dnd){i.dnd=$.extend({},$.ui.dynatree.prototype.options.dnd,i.dnd)}if(!i.imagePath){$("script").each(function(){var e=/.*dynatree[^\/]*\.js$/i;if(this.src.search(e)>=0){if(this.src.indexOf("/")>=0){i.imagePath=this.src.slice(0,this.src.lastIndexOf("/"))+"/skin/"}else{i.imagePath="skin/"}s.logDebug("Guessing imagePath from '%s': '%s'",this.src,i.imagePath);return false}})}this.persistence=new DynaTreeStatus(i.cookieId,i.cookie);if(i.persist){if(!$.cookie){_log("warn","Please include jquery.cookie.js to use persistence.")}this.persistence.read()}this.logDebug("DynaTree.persistence: %o",this.persistence.toDict());this.cache={tagEmpty:"<span class='"+i.classNames.empty+"'></span>",tagVline:"<span class='"+i.classNames.vline+"'></span>",tagExpander:"<span class='"+i.classNames.expander+"'></span>",tagConnector:"<span class='"+i.classNames.connector+"'></span>",tagNodeIcon:"<span class='"+i.classNames.nodeIcon+"'></span>",tagCheckbox:"<span class='"+i.classNames.checkbox+"'></span>",lastentry:undefined};if(i.children||i.initAjax&&i.initAjax.url||i.initId){$(this.divTree).empty()}var a=this.$tree.find(">ul:first").hide();this.tnRoot=new DynaTreeNode(null,this,{});this.tnRoot.bExpanded=true;this.tnRoot.render();this.divTree.appendChild(this.tnRoot.ul);var n=this.tnRoot,r=i.persist&&this.persistence.isReloading(),o=false,l=this.enableUpdate(false);this.logDebug("Dynatree._load(): read tree structure...");if(i.children){n.addChild(i.children)}else if(i.initAjax&&i.initAjax.url){o=true;n.data.isLazy=true;this._reloadAjax(e)}else if(i.initId){this._createFromTag(n,$("#"+i.initId))}else{this._createFromTag(n,a);a.remove()}this._checkConsistency();if(!o&&i.selectMode==3){n._updatePartSelectionState()}this.logDebug("Dynatree._load(): render nodes...");this.enableUpdate(l);this.logDebug("Dynatree._load(): bind events...");this.$widget.bind();this.logDebug("Dynatree._load(): postInit...");this.phase="postInit";if(i.persist){this.persistence.write()}if(this.focusNode&&this.focusNode.isVisible()){this.logDebug("Focus on init: %o",this.focusNode);this.focusNode.focus()}if(!o){if(i.onPostInit){i.onPostInit.call(this,r,false)}if(e){e.call(this,"ok")}}this.phase="idle"},_reloadAjax:function(e){var t=this.options;if(!t.initAjax||!t.initAjax.url){throw"tree.reload() requires 'initAjax' mode."}var i=this.persistence;var s=$.extend({},t.initAjax);if(s.addActiveKey){s.data.activeKey=i.activeKey}if(s.addFocusedKey){s.data.focusedKey=i.focusedKey}if(s.addExpandedKeyList){s.data.expandedKeyList=i.expandedKeyList.join(",")}if(s.addSelectedKeyList){s.data.selectedKeyList=i.selectedKeyList.join(",")}if(s.success){this.logWarning("initAjax: success callback is ignored; use onPostInit instead.")}if(s.error){this.logWarning("initAjax: error callback is ignored; use onPostInit instead.")}var a=i.isReloading();s.success=function(i,s,n){if(t.selectMode==3){i.tree.tnRoot._updatePartSelectionState()}if(t.onPostInit){t.onPostInit.call(i.tree,a,false)}if(e){e.call(i.tree,"ok")}};s.error=function(i,s,n,r){if(t.onPostInit){t.onPostInit.call(i.tree,a,true,s,n,r)}if(e){e.call(i.tree,"error",s,n,r)}};this.logDebug("Dynatree._init(): send Ajax request...");this.tnRoot.appendAjax(s)},toString:function(){return"Dynatree '"+this.$tree.attr("id")+"'"},toDict:function(e){var t=this.tnRoot.toDict(true);return e?t:t.children},serializeArray:function(e){var t=this.getSelectedNodes(e),i=this.$tree.attr("name")||this.$tree.attr("id"),s=[];for(var a=0,n=t.length;a<n;a++){s.push({name:i,value:t[a].data.key})}return s},getPersistData:function(){return this.persistence.toDict()},logDebug:function(e){if(this.options.debugLevel>=2){Array.prototype.unshift.apply(arguments,["debug"]);_log.apply(this,arguments)}},logInfo:function(e){if(this.options.debugLevel>=1){Array.prototype.unshift.apply(arguments,["info"]);_log.apply(this,arguments)}},logWarning:function(e){Array.prototype.unshift.apply(arguments,["warn"]);_log.apply(this,arguments)},isInitializing:function(){return this.phase=="init"||this.phase=="postInit"},isReloading:function(){return(this.phase=="init"||this.phase=="postInit")&&this.options.persist&&this.persistence.cookiesFound},isUserEvent:function(){return this.phase=="userEvent"},redraw:function(){this.tnRoot.render(false,false)},renderInvisibleNodes:function(){this.tnRoot.render(false,true)},reload:function(e){this._load(e)},getRoot:function(){return this.tnRoot},enable:function(){this.$widget.enable()},disable:function(){this.$widget.disable()},getNodeByKey:function(e){var t=document.getElementById(this.options.idPrefix+e);if(t){return t.dtnode?t.dtnode:null}var i=null;this.visit(function(t){if(t.data.key===e){i=t;return false}},true);return i},getActiveNode:function(){return this.activeNode},reactivate:function(e){var t=this.activeNode;if(t){this.activeNode=null;t.activate();if(e){t.focus()}}},getSelectedNodes:function(e){var t=[];this.tnRoot.visit(function(i){if(i.bSelected){t.push(i);if(e===true){return"skip"}}});return t},activateKey:function(e){var t=e===null?null:this.getNodeByKey(e);if(!t){if(this.activeNode){this.activeNode.deactivate()}this.activeNode=null;return null}t.focus();t.activate();return t},loadKeyPath:function(e,t){var i=e.split(this.options.keyPathSeparator);if(i[0]===""){i.shift()}if(i[0]==this.tnRoot.data.key){this.logDebug("Removed leading root key.");i.shift()}e=i.join(this.options.keyPathSeparator);return this.tnRoot._loadKeyPath(e,t)},selectKey:function(e,t){var i=this.getNodeByKey(e);if(!i){return null}i.select(t);return i},enableUpdate:function(e){if(this.bEnableUpdate==e){return e}this.bEnableUpdate=e;if(e){this.redraw()}return!e},count:function(){return this.tnRoot.countChildren()},visit:function(e,t){return this.tnRoot.visit(e,t)},_createFromTag:function(parentTreeNode,$ulParent){var self=this;$ulParent.find(">li").each(function(){var $li=$(this),$liSpan=$li.find(">span:first"),$liA=$li.find(">a:first"),title,href=null,target=null,tooltip;if($liSpan.length){title=$liSpan.html()}else if($liA.length){title=$liA.html();href=$liA.attr("href");target=$liA.attr("target");tooltip=$liA.attr("title")}else{title=$li.html();var iPos=title.search(/<ul/i);if(iPos>=0){title=$.trim(title.substring(0,iPos))}else{title=$.trim(title)}}var data={title:title,tooltip:tooltip,isFolder:$li.hasClass("folder"),isLazy:$li.hasClass("lazy"),expand:$li.hasClass("expanded"),select:$li.hasClass("selected"),activate:$li.hasClass("active"),focus:$li.hasClass("focused"),noLink:$li.hasClass("noLink")};if(href){data.href=href;data.target=target}if($li.attr("title")){data.tooltip=$li.attr("title")}if($li.attr("id")){data.key=""+$li.attr("id")}if($li.attr("data")){var dataAttr=$.trim($li.attr("data"));if(dataAttr){if(dataAttr.charAt(0)!="{"){dataAttr="{"+dataAttr+"}"}try{$.extend(data,eval("("+dataAttr+")"))}catch(e){throw"Error parsing node data: "+e+"\ndata:\n'"+dataAttr+"'"}}}var childNode=parentTreeNode.addChild(data);var $ul=$li.find(">ul:first");if($ul.length){self._createFromTag(childNode,$ul)}})},_checkConsistency:function(){},_setDndStatus:function(e,t,i,s,a){var n=e?$(e.span):null,r=$(t.span),o,l=0,d="center";if(!this.$dndMarker){this.$dndMarker=$("<div id='dynatree-drop-marker'></div>").hide().css({"z-index":1e3}).prependTo($(this.divTree).parent())}if(s==="after"||s==="before"||s==="over"){switch(s){case"before":this.$dndMarker.removeClass("dynatree-drop-after dynatree-drop-over");this.$dndMarker.addClass("dynatree-drop-before");d="top";break;case"after":this.$dndMarker.removeClass("dynatree-drop-before dynatree-drop-over");this.$dndMarker.addClass("dynatree-drop-after");d="bottom";break;default:this.$dndMarker.removeClass("dynatree-drop-after dynatree-drop-before");this.$dndMarker.addClass("dynatree-drop-over");r.addClass("dynatree-drop-target");l=8}if(jquerySupports.positionMyOfs){o={my:"left"+offsetString(l)+" center",at:"left "+d,of:r}}else{o={my:"left center",at:"left "+d,of:r,offset:""+l+" 0"}}this.$dndMarker.show().position(o)}else{r.removeClass("dynatree-drop-target");this.$dndMarker.hide()}if(s==="after"){r.addClass("dynatree-drop-after")}else{r.removeClass("dynatree-drop-after")}if(s==="before"){r.addClass("dynatree-drop-before")}else{r.removeClass("dynatree-drop-before")}if(a===true){if(n){n.addClass("dynatree-drop-accept")}r.addClass("dynatree-drop-accept");i.addClass("dynatree-drop-accept")}else{if(n){n.removeClass("dynatree-drop-accept")}r.removeClass("dynatree-drop-accept");i.removeClass("dynatree-drop-accept")}if(a===false){if(n){n.addClass("dynatree-drop-reject")}r.addClass("dynatree-drop-reject");i.addClass("dynatree-drop-reject")}else{if(n){n.removeClass("dynatree-drop-reject")}r.removeClass("dynatree-drop-reject");i.removeClass("dynatree-drop-reject")}},_onDragEvent:function(e,t,i,s,a,n){var r,o,l,d=this.options.dnd,h=null,c=$(t.span);switch(e){case"helper":var u=$("<div class='dynatree-drag-helper'><span class='dynatree-drag-helper-img' /></div>").append(c.find(".dynatree-title").clone());$("ul.dynatree-container",t.tree.divTree).append(u);u.data("dtSourceNode",t);h=u;break;case"start":if(t.isStatusNode()){h=false}else if(d.onDragStart){h=d.onDragStart(t)}if(h===false){this.logDebug("tree.onDragStart() cancelled");a.helper.trigger("mouseup");a.helper.hide()}else{c.addClass("dynatree-drag-source")}break;case"enter":l=d.onDragEnter?d.onDragEnter(t,i,a,n):null;if(!l){h=false}else if($.isArray(l)){h={over:$.inArray("over",l)>=0,before:$.inArray("before",l)>=0,after:$.inArray("after",l)>=0}}else{h={over:l===true||l==="over",before:l===true||l==="before",after:l===true||l==="after"}}a.helper.data("enterResponse",h);break;case"over":o=a.helper.data("enterResponse");r=null;if(o===false){}else if(typeof o==="string"){r=o}else{var f=c.offset();var p={x:s.pageX-f.left,y:s.pageY-f.top};var v={x:p.x/c.width(),y:p.y/c.height()};if(o.after&&v.y>.75){r="after"}else if(!o.over&&o.after&&v.y>.5){r="after"}else if(o.before&&v.y<=.25){r="before"}else if(!o.over&&o.before&&v.y<=.5){r="before"}else if(o.over){r="over"}if(d.preventVoidMoves){if(t===i){r=null}else if(r==="before"&&i&&t===i.getNextSibling()){r=null}else if(r==="after"&&i&&t===i.getPrevSibling()){r=null}else if(r==="over"&&i&&i.parent===t&&i.isLastSibling()){r=null}}a.helper.data("hitMode",r)}if(r==="over"&&d.autoExpandMS&&t.hasChildren()!==false&&!t.bExpanded){t.scheduleAction("expand",d.autoExpandMS)}if(r&&d.onDragOver){h=d.onDragOver(t,i,r,a,n);if(h==="over"||h==="before"||h==="after"){r=h}}this._setDndStatus(i,t,a.helper,r,h!==false&&r!==null);break;case"drop":var y=a.helper.hasClass("dynatree-drop-reject");r=a.helper.data("hitMode");if(r&&d.onDrop&&!y){d.onDrop(t,i,r,a,n)}break;case"leave":t.scheduleAction("cancel");a.helper.data("enterResponse",null);a.helper.data("hitMode",null);this._setDndStatus(i,t,a.helper,"out",undefined);if(d.onDragLeave){d.onDragLeave(t,i,a,n)}break;case"stop":c.removeClass("dynatree-drag-source");if(d.onDragStop){d.onDragStop(t)}break;default:throw"Unsupported drag event: "+e}return h},cancelDrag:function(){var e=$.ui.ddmanager.current;if(e){e.cancel()}},lastentry:undefined};$.widget("ui.dynatree",{_init:function(){if(versionCompare($.ui.version,"1.8")<0){if(this.options.debugLevel>=0){_log("warn","ui.dynatree._init() was called; you should upgrade to jquery.ui.core.js v1.8 or higher.")}return this._create()}if(this.options.debugLevel>=2){_log("debug","ui.dynatree._init() was called; no current default functionality.")}},_create:function(){var e=this.options;if(e.debugLevel>=1){logMsg("Dynatree._create(): version='%s', debugLevel=%o.",$.ui.dynatree.version,this.options.debugLevel)}this.options.event+=".dynatree";var t=this.element.get(0);this.tree=new DynaTree(this);this.tree._load();this.tree.logDebug("Dynatree._init(): done.")},bind:function(){this.unbind();var e="click.dynatree dblclick.dynatree";if(this.options.keyboard){e+=" keypress.dynatree keydown.dynatree"}this.element.bind(e,function(e){var t=$.ui.dynatree.getNode(e.target);if(!t){return true}var i=t.tree;var s=i.options;i.logDebug("event(%s): dtnode: %s",e.type,t);var a=i.phase;i.phase="userEvent";try{switch(e.type){case"click":return s.onClick&&s.onClick.call(i,t,e)===false?false:t._onClick(e);case"dblclick":return s.onDblClick&&s.onDblClick.call(i,t,e)===false?false:t._onDblClick(e);case"keydown":return s.onKeydown&&s.onKeydown.call(i,t,e)===false?false:t._onKeydown(e);case"keypress":return s.onKeypress&&s.onKeypress.call(i,t,e)===false?false:t._onKeypress(e)}}catch(s){var n=null;i.logWarning("bind(%o): dtnode: %o, error: %o",e,t,s)}finally{i.phase=a}});function t(e){e=$.event.fix(e||window.event);var t=$.ui.dynatree.getNode(e.target);return t?t._onFocus(e):false}var i=this.tree.divTree;if(i.addEventListener){i.addEventListener("focus",t,true);i.addEventListener("blur",t,true)}else{i.onfocusin=i.onfocusout=t}},unbind:function(){this.element.unbind(".dynatree")},enable:function(){this.bind();$.Widget.prototype.enable.apply(this,arguments)},disable:function(){this.unbind();$.Widget.prototype.disable.apply(this,arguments)},getTree:function(){return this.tree},getRoot:function(){return this.tree.getRoot()},getActiveNode:function(){return this.tree.getActiveNode()},getSelectedNodes:function(){return this.tree.getSelectedNodes()},lastentry:undefined});if(versionCompare($.ui.version,"1.8")<0){$.ui.dynatree.getter="getTree getRoot getActiveNode getSelectedNodes"}$.extend($.ui.dynatree,{version:"DEVELOPMENT",buildType:"DEVELOP",_DynaTreeClass:DynaTree,_DynaTreeNodeClass:DynaTreeNode,getNode:function(e){if(e instanceof DynaTreeNode){return e}if(e.selector!==undefined){e=e[0]}while(e){if(e.dtnode){return e.dtnode}e=e.parentNode}return null},getPersistData:DynaTreeStatus._getTreePersistData});$.ui.dynatree.prototype.options={title:"Dynatree",minExpandLevel:1,imagePath:null,children:null,initId:null,initAjax:null,autoFocus:true,keyboard:true,persist:false,autoCollapse:false,clickFolderMode:3,activeVisible:true,checkbox:false,selectMode:2,fx:null,noLink:false,onClick:null,onDblClick:null,onKeydown:null,onKeypress:null,onFocus:null,onBlur:null,onQueryActivate:null,onQuerySelect:null,onQueryExpand:null,onPostInit:null,onActivate:null,onDeactivate:null,onSelect:null,onExpand:null,onLazyRead:null,onCustomRender:null,onCreate:null,onRender:null,postProcess:null,dnd:{onDragStart:null,onDragStop:null,revert:false,autoExpandMS:1e3,preventVoidMoves:true,onDragEnter:null,onDragOver:null,onDrop:null,onDragLeave:null},ajaxDefaults:{cache:false,timeout:0,dataType:"json"},strings:{loading:"Loading&#8230;",loadError:"Load error!"},generateIds:false,idPrefix:"dynatree-id-",keyPathSeparator:"/",cookieId:"dynatree",cookie:{expires:null},classNames:{container:"dynatree-container",node:"dynatree-node",folder:"dynatree-folder",empty:"dynatree-empty",vline:"dynatree-vline",expander:"dynatree-expander",connector:"dynatree-connector",checkbox:"dynatree-checkbox",radio:"dynatree-radio",nodeIcon:"dynatree-icon",title:"dynatree-title",noConnector:"dynatree-no-connector",nodeError:"dynatree-statusnode-error",nodeWait:"dynatree-statusnode-wait",hidden:"dynatree-hidden",combinedExpanderPrefix:"dynatree-exp-",combinedIconPrefix:"dynatree-ico-",nodeLoading:"dynatree-loading",hasChildren:"dynatree-has-children",active:"dynatree-active",selected:"dynatree-selected",expanded:"dynatree-expanded",lazy:"dynatree-lazy",focused:"dynatree-focused",partsel:"dynatree-partsel",lastsib:"dynatree-lastsib"},debugLevel:2,lastentry:undefined};if(versionCompare($.ui.version,"1.8")<0){$.ui.dynatree.defaults=$.ui.dynatree.prototype.options}$.ui.dynatree.nodedatadefaults={title:null,key:null,isFolder:false,isLazy:false,tooltip:null,href:null,icon:null,addClass:null,noLink:false,activate:false,focus:false,expand:false,select:false,hideCheckbox:false,unselectable:false,children:null,lastentry:undefined};function _initDragAndDrop(e){var t=e.options.dnd||null;if(t&&(t.onDragStart||t.onDrop)){_registerDnd()}if(t&&t.onDragStart){e.$tree.draggable({addClasses:false,appendTo:"body",containment:false,delay:0,distance:4,revert:t.revert!==true?false:function(e){logMsg("draggable.revert(), dropped=",e);if(typeof e==="boolean"){return!e}var t=$.ui.ddmanager&&$.ui.ddmanager.current&&$.ui.ddmanager.current.helper;var i=t&&t.hasClass("dynatree-drop-reject");return i},scroll:true,scrollSpeed:7,scrollSensitivity:10,connectToDynatree:true,helper:function(e){var t=$.ui.dynatree.getNode(e.target);if(!t){return"<div></div>"}return t.tree._onDragEvent("helper",t,null,e,null,null)},start:function(e,t){var i=t.helper.data("dtSourceNode");return!!i}})}if(t&&t.onDrop){e.$tree.droppable({addClasses:false,tolerance:"pointer",greedy:false})}}var didRegisterDnd=false;var _registerDnd=function(){if(didRegisterDnd){return}$.ui.plugin.add("draggable","connectToDynatree",{start:function(e,t){var i=$(this).data("ui-draggable")||$(this).data("draggable"),s=t.helper.data("dtSourceNode")||null;if(s){i.offset.click.top=-2;i.offset.click.left=+16;return s.tree._onDragEvent("start",s,null,e,t,i)}},drag:function(e,t){var i=$(this).data("ui-draggable")||$(this).data("draggable"),s=t.helper.data("dtSourceNode")||null,a=t.helper.data("dtTargetNode")||null,n=$.ui.dynatree.getNode(e.target);if(e.target&&!n){var r=$(e.target).closest("div.dynatree-drag-helper,#dynatree-drop-marker").length>0;if(r){return}}t.helper.data("dtTargetNode",n);if(a&&a!==n){a.tree._onDragEvent("leave",a,s,e,t,i)}if(n){if(!n.tree.options.dnd.onDrop){}else if(n===a){n.tree._onDragEvent("over",n,s,e,t,i)}else{n.tree._onDragEvent("enter",n,s,e,t,i)}}},stop:function(e,t){var i=$(this).data("ui-draggable")||$(this).data("draggable"),s=t.helper.data("dtSourceNode")||null,a=t.helper.data("dtTargetNode")||null,n=e.type,r=n=="mouseup"&&e.which==1;logMsg("draggable-connectToDynatree.stop: targetNode(from event): %s, dtTargetNode: %s",a,t.helper.data("dtTargetNode"));if(!r){logMsg("Drag was cancelled")}if(a){if(r){a.tree._onDragEvent("drop",a,s,e,t,i)}a.tree._onDragEvent("leave",a,s,e,t,i)}if(s){s.tree._onDragEvent("stop",s,null,e,t,i)}}});didRegisterDnd=true}})(jQuery);