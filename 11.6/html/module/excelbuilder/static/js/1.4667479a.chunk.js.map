{"version":3,"sources":["components/outlink/index.js","components/formula/components/FormulaField.jsx","components/formula/components/FormulaEdit.jsx","components/formula/constants.js","components/formula/components/FunctionList.jsx","components/formula/index.jsx"],"names":["Outlink","props","_this","Object","D_MYOA2016_all_ui_2017_excelbuilder_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_11__","this","D_MYOA2016_all_ui_2017_excelbuilder_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_possibleConstructorReturn__WEBPACK_IMPORTED_MODULE_13__","D_MYOA2016_all_ui_2017_excelbuilder_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_getPrototypeOf__WEBPACK_IMPORTED_MODULE_14__","call","owner","state","visible","targetFormId","targetFieldId","columns","linkages","using","D_MYOA2016_all_ui_2017_excelbuilder_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread__WEBPACK_IMPORTED_MODULE_10__","defaultValue","changeTargetForm","updateOutlink","handleCancel","_this2","closeOutLink","window","setTimeout","setState","outLinkShowFlag","outLinkShowFlag2","value","_this3","formId","$","get","forms","with_id","res","data","_this4","_this$props","formsOfApp","columnsOfForm","noTarget","multi","keys","map","key","target_columns","run_id","filter","column","id","length","push","name","react__WEBPACK_IMPORTED_MODULE_16___default","a","createElement","antd_es_modal__WEBPACK_IMPORTED_MODULE_1__","title","onOk","handleOk","bind","onCancel","footer","antd_es_button__WEBPACK_IMPORTED_MODULE_9__","type","size","onClick","className","antd_es_select__WEBPACK_IMPORTED_MODULE_5__","onChange","style","width","form","Option","antd_es_tooltip__WEBPACK_IMPORTED_MODULE_7__","href","e","targetId","linkage","index","item","margin-left","antd_es_icon__WEBPACK_IMPORTED_MODULE_3__","index2","cursor","Component","SubMenu","menu","handleMenuItemClick","ItemGroup","callback","info","split","CurrentForm","_ref","handle","react_default","mode","Item","OtherForms","_ref2","items","FormulaField","classCallCheck","possibleConstructorReturn","getPrototypeOf","switchPanel","assertThisInitialized","current","fields","allFields","panel","formulaData","response","status","params","undefined","just","float","FormulaField_CurrentForm","changeFormulaData","FormulaField_OtherForms","FormulaEdit","setEditingBoard","refs","editingBoard","setFormula","target","rows","ref","OPRATOR","sign","ARR_FUNC_TOKEN","统计函数","desc","数据（含货币）函数","FunctionList","setSelectionRange","formulaValue","Formula"],"mappings":"2RAIqBA,cACnB,SAAAA,EAAYC,GAAO,IAAAC,EAAA,OAAAC,OAAAC,EAAA,EAAAD,CAAAE,KAAAL,IACjBE,EAAAC,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAAH,GAAAQ,KAAAH,KAAMJ,KACDQ,MAAQP,EAAKD,MAAMQ,MACxBP,EAAKQ,MAAQ,CACZC,SAAS,EAETC,aAAc,GACdC,cAAe,GACfC,QAAS,GACTC,SAAU,IAERd,EAAMe,MACPd,EAAKQ,MAALP,OAAAc,EAAA,EAAAd,CAAA,GAAiBD,EAAKQ,MAAUR,EAAKO,MAAMC,MAAMT,EAAMe,QAEvDd,EAAKQ,MAALP,OAAAc,EAAA,EAAAd,CAAA,GAAiBD,EAAKQ,MAAUR,EAAKO,MAAMC,MAAMQ,cAEhDhB,EAAKQ,MAAME,cACZV,EAAKiB,iBAAiBjB,EAAKQ,MAAME,cAjBlBV,0EAsBjB,IAAIQ,EAAKP,OAAAc,EAAA,EAAAd,CAAA,GAAOE,KAAKK,cACdA,EAAK,eACLA,EAAK,QACZL,KAAKJ,MAAMmB,cAAcV,GACzBL,KAAKgB,sDAGO,IAAAC,EAAAjB,KAEVA,KAAKJ,MAAMsB,cACZlB,KAAKJ,MAAMsB,eAEbC,OAAOC,WAAW,WAAKH,EAAKb,MAAMiB,SAAS,CAACC,iBAAiB,EAAOC,kBAAkB,KAAW,4CAIjFC,GAAM,IAAAC,EAAAzB,KACjB0B,EAAS1B,KAAKJ,MAAM8B,OACX,IAAVA,IACDC,IAAEC,IAAI,kDAAmD,CACtDC,MAAOL,GAAS,GAChBE,OAAQA,EACRI,SAAS,GACP,SAACC,GACHN,EAAKJ,SAAS,CAACZ,QAASsB,EAAIC,SAE/BhC,KAAKqB,SAAS,CAACd,aAAciB,sCAIzB,IAAAS,EAAAjC,KAAAkC,EAC6ClC,KAAKJ,MAAnDuC,EADCD,EACDC,WAAYC,EADXF,EACWE,cAAeC,EAD1BH,EAC0BG,SAAUC,EADpCJ,EACoCI,MACtCT,EAAQ/B,OAAOyC,KAAKJ,GAAYK,IAAI,SAAAC,GAAG,OAAGN,EAAWM,KACrDhC,EAAUX,OAAOyC,KAAKH,GAAeI,IAAI,SAAAC,GAAG,OAAGL,EAAcK,KAC7DC,EAAiB1C,KAAKK,MAAMI,QAChC,GAAG6B,EAAM,CACR,IAAIK,EAAS3C,KAAKK,MAAMI,QAAQmC,OAAO,SAAAC,GAAM,MAAkB,YAAdA,EAAOC,KACrDH,GAAUA,EAAOI,SAClBL,EAAiB,GACjB1C,KAAKK,MAAMI,QAAQ+B,IAAI,SAAAK,GAAM,OAAIH,EAAeM,KAAflD,OAAAc,EAAA,EAAAd,CAAA,GAAwB+C,MACzDH,EAAeM,KAAK,CAACF,GAAI,gBAAiBG,KAAM,8BAChDP,EAAeM,KAAK,CAACF,GAAI,YAAaG,KAAM,qCAI/C,OACEC,EAAAC,EAAAC,cAAA,WACEF,EAAAC,EAAAC,cAAAC,EAAA,GAAOC,MAAOjB,EAAU,uCAAW,uCAAU/B,QAASN,KAAKK,MAAMC,QAASiD,KAAMvD,KAAKwD,SAASC,KAAKzD,MAAO0D,SAAU1D,KAAKgB,aAAayC,KAAKzD,MAAO2D,OAAQ,CACxJT,EAAAC,EAAAC,cAAAQ,EAAA,GAAQnB,IAAI,OAAOoB,KAAK,QAAQC,KAAK,QAAQC,QAAS/D,KAAKgB,aAAayC,KAAKzD,OAA7E,iBACKkD,EAAAC,EAAAC,cAAAQ,EAAA,GAAQnB,IAAI,SAASoB,KAAK,UAAUC,KAAK,QAAQC,QAAS/D,KAAKwD,SAASC,KAAKzD,OAA7E,mBAENkD,EAAAC,EAAAC,cAAA,OAAKY,UAAU,yBACRd,EAAAC,EAAAC,cAAA,OAAKY,UAAU,uBACbd,EAAAC,EAAAC,cAAA,aAAQf,EAAU,2BAAS,4BAC3Ba,EAAAC,EAAAC,cAAA,QAAMY,UAAU,qCACrBd,EAAAC,EAAAC,cAAAa,EAAA,GAAQzC,MAAO,CAACxB,KAAKK,MAAME,cAAe2D,SAAUlE,KAAKc,iBAAiB2C,KAAKzD,MAAOmE,MAAO,CAACC,MAAS,MAEnGvC,EAAMW,IAAI,SAAA6B,GAAI,OAAInB,EAAAC,EAAAC,cAAAa,EAAA,EAAQK,OAAR,CAAe9C,MAAO6C,EAAKvB,IAAII,EAAAC,EAAAC,cAAAmB,EAAA,GAASjB,MAAOe,EAAKpB,MAAOoB,EAAKpB,aAOnFZ,EAYO,KAXTa,EAAAC,EAAAC,cAAA,OAAKY,UAAU,yBACbd,EAAAC,EAAAC,cAAA,OAAKY,UAAU,uBACbd,EAAAC,EAAAC,cAAA,+CACAF,EAAAC,EAAAC,cAAA,QAAMY,UAAU,qCACrBd,EAAAC,EAAAC,cAAAa,EAAA,GAAQzC,MAAO,CAACxB,KAAKK,MAAMG,eAAgB0D,SAAU,SAAA1C,GAAK,OAAIS,EAAKZ,SAAS,CAACb,cAAegB,KAAS2C,MAAO,CAACC,MAAS,MAElH1B,EAAeF,IAAI,SAAAK,GAAM,OAAIK,EAAAC,EAAAC,cAAAa,EAAA,EAAQK,OAAR,CAAe9C,MAAOqB,EAAOC,IAAII,EAAAC,EAAAC,cAAAmB,EAAA,GAASjB,MAAOT,EAAOI,MAAOJ,EAAOI,aAOtGC,EAAAC,EAAAC,cAAA,OAAKY,UAAU,yBACbd,EAAAC,EAAAC,cAAA,KAAGoB,KAAK,qBAAqBT,QAAS,SAAAU,GAAK,IACpC/D,EAAYuB,EAAK5B,MAAjBK,SACLA,EAASsC,KAAK,CAACF,GAAI,GAAI4B,SAAU,KAClCzC,EAAKZ,SAAS,CAACX,eAAe2B,EAAU,uCAAW,wCAAaa,EAAAC,EAAAC,cAAA,yEAAoBf,EAAU,uCAAW,yCAG1GrC,KAAKK,MAAMK,SAAS8B,IAAI,SAACmC,EAASC,GAAV,OACtB1B,EAAAC,EAAAC,cAAA,OAAKY,UAAU,yBACbd,EAAAC,EAAAC,cAAAa,EAAA,GAAQzC,MAAO,CAACmD,EAAQ7B,IAAKoB,SAAU,SAAA1C,GAAQ,IACxCd,EAAYuB,EAAK5B,MAAjBK,SACLA,EAASkE,GAAT,GAAwBpD,EACxBS,EAAKZ,SAAS,CAACX,cACdyD,MAAO,CAACC,MAAS,MAEhB3D,EAAQ+B,IAAI,SAAAqC,GAAI,OAAI3B,EAAAC,EAAAC,cAAAa,EAAA,EAAQK,OAAR,CAAe9C,MAAOqD,EAAK/B,IAAII,EAAAC,EAAAC,cAAAmB,EAAA,GAASjB,MAAOuB,EAAK5B,MAAO4B,EAAK5B,UAGxFC,EAAAC,EAAAC,cAAAa,EAAA,GAAQzC,MAAO,CAACmD,EAAQD,UAAWR,SAAU,SAAA1C,GAAQ,IAC9Cd,EAAYuB,EAAK5B,MAAjBK,SACLA,EAASkE,GAAT,SAA8BpD,EAC9BS,EAAKZ,SAAS,CAACX,cACdyD,MAAO,CAACC,MAAS,IAAKU,cAAe,SACrC7C,EAAK5B,MAAMI,QAAQ+B,IAAI,SAAAqC,GAAI,OAAI3B,EAAAC,EAAAC,cAAAa,EAAA,EAAQK,OAAR,CAAe9C,MAAOqD,EAAK/B,IAAII,EAAAC,EAAAC,cAAAmB,EAAA,GAASjB,MAAOuB,EAAK5B,MAAO4B,EAAK5B,UAElGC,EAAAC,EAAAC,cAAA,SAAGF,EAAAC,EAAAC,cAAA2B,EAAA,GAAMlB,KAAK,eAAeE,QAAS,SAAAU,GAAK,IACpC/D,EAAYuB,EAAK5B,MAAjBK,SACLA,EAAWA,EAASkC,OAAO,SAAC+B,EAAQK,GAAT,OAAkBA,IAASJ,IACvD3C,EAAKZ,SAAS,CAACX,cAAcyD,MAAO,CAACc,OAAS,uBAjI9BC,+PCC/BC,EAAUC,EAAA,EAAKD,QAGfE,GAFgBD,EAAA,EAAKE,UAEC,SAACC,GAAD,OAAc,SAACC,GAC1C,IAAMX,EAAOW,EAAK/C,IAAIgD,MAAM,KAAK,GACjCF,EAASV,MAKJa,EAAc,SAAAC,GAAoB,IAAlB3D,EAAkB2D,EAAlB3D,KAAM4D,EAAYD,EAAZC,OAC3B,OACCC,EAAA1C,EAAAC,cAAAgC,EAAA,GACCjB,MAAO,CAAEC,MAAO,KAChB0B,KAAK,SACL9B,UAAU,uCACVD,QAASsB,EAAoBO,IAG5B5D,GAAQA,EAAKQ,IAAI,SAACqC,EAAMD,GAAP,OAChBiB,EAAA1C,EAAAC,cAAAgC,EAAA,EAAMW,KAAN,CAAWtD,IAAK,2BAAmBoC,EAAO,IAAMD,GAAQC,OAOvDmB,EAAa,SAAAC,GAAoB,IAAlBjE,EAAkBiE,EAAlBjE,KAAM4D,EAAYK,EAAZL,OAC1B,OACCC,EAAA1C,EAAAC,cAAAgC,EAAA,GACCjB,MAAO,CAAEC,MAAO,KAChB0B,KAAK,SACL9B,UAAU,uCACVD,QAASsB,EAAoBO,IAG5B5D,GAAQA,EAAKQ,IAAI,SAAC6B,EAAMO,GAAP,OACjBiB,EAAA1C,EAAAC,cAAC+B,EAAD,CAAS1C,IAAK,MAAQmC,EAAOtB,MAAOe,EAAKA,MAEvCA,EAAK6B,MAAM1D,IAAI,SAACqC,EAAMD,GAAP,OACdiB,EAAA1C,EAAAC,cAAAgC,EAAA,EAAMW,KAAN,CAAWtD,IAAK,QAAU4B,EAAKA,KAAO,IAAMQ,EAAO,IAAMD,GAAQC,UAQnDsB,cAEpB,SAAAA,IAAa,IAAAtG,EAAA,OAAAC,OAAAsG,EAAA,EAAAtG,CAAAE,KAAAmG,IACZtG,EAAAC,OAAAuG,EAAA,EAAAvG,CAAAE,KAAAF,OAAAwG,EAAA,EAAAxG,CAAAqG,GAAAhG,KAAAH,QACKuG,YAAc1G,EAAK0G,YAAY9C,KAAjB3D,OAAA0G,EAAA,EAAA1G,QAAA0G,EAAA,EAAA1G,CAAAD,KACnBA,EAAKQ,MAAQ,CACZoG,QAAS,IACTC,OAAQ,GACRC,UAAW,GACXC,MAAO,QAPI/G,mFAWO,IAAAoB,EAAAjB,KAkBnB,GAfA2B,IAAEC,IAAI,kDACL,CACCF,OAAQ1B,KAAKJ,MAAMiH,YAAYnF,OAC/BG,MAAO,IAER,SAAAiF,GACwB,OAApBA,EAASC,QACX9F,EAAKI,SAAS,CACbqF,OAAQI,EAAS9E,SAOe,KAAjChC,KAAKJ,MAAMiH,YAAYhF,MAAc,CAEvC,IAAImF,EAAS,CACZtF,OAAQ1B,KAAKJ,MAAMiH,YAAYnF,OAC/BG,MAAO7B,KAAKJ,MAAMiH,YAAYhF,YAIGoF,GAA/BjH,KAAKJ,MAAMiH,YAAYK,MAAoD,GAA/BlH,KAAKJ,MAAMiH,YAAYK,OACrEF,EAAM,MAAW,GAGlBrF,IAAEC,IAAI,kDAAmDoF,EAAQ,SAAAF,GACxC,OAApBA,EAASC,QACX9F,EAAKI,SAAS,CACbsF,UAAWG,EAAS9E,2CAQlB,IAAAP,EAAAzB,KACP,OACC6F,EAAA1C,EAAAC,cAAA,OAAKY,UAAU,4BACd6B,EAAA1C,EAAAC,cAAA,MAAIY,UAAU,4BAEqB,KAAjChE,KAAKJ,MAAMiH,YAAYhF,MACtB,qBACAgE,EAAA1C,EAAAC,cAAA,WACCyC,EAAA1C,EAAAC,cAAA,QAAMW,QAAS,kBAAMtC,EAAK8E,YAAY,UAAtC,sBACAV,EAAA1C,EAAAC,cAAA,QAAMW,QAAS,kBAAMtC,EAAK8E,YAAY,WAAWpC,MAAO,CAACgD,MAAM,UAA/D,8BAK8B,KAAjCnH,KAAKJ,MAAMiH,YAAYhF,MACtBgE,EAAA1C,EAAAC,cAACgE,EAAD,CAAapF,KAAMhC,KAAKK,MAAMqG,OAAQd,OAAQ5F,KAAKJ,MAAMyH,oBACzDxB,EAAA1C,EAAAC,cAAA,WAEuB,SAArBpD,KAAKK,MAAMuG,MACXf,EAAA1C,EAAAC,cAACgE,EAAD,CAAapF,KAAMhC,KAAKK,MAAMqG,OAAQd,OAAQ5F,KAAKJ,MAAMyH,oBACzDxB,EAAA1C,EAAAC,cAACkE,EAAD,CAAYtF,KAAMhC,KAAKK,MAAMsG,UAAWf,OAAQ5F,KAAKJ,MAAMyH,0DAQtDT,GACX5G,KAAKqB,SAAS,CACbuF,iBApFuC1B,aCnDrBqC,8LAGnBvH,KAAKJ,MAAM4H,gBAAgBxH,KAAKyH,KAAKC,+CAG9B,IAAA7H,EAAAG,KACP,OACC6F,EAAA1C,EAAAC,cAAA,WACCyC,EAAA1C,EAAAC,cAAA,MAAIY,UAAU,4BAAd,4BACA6B,EAAA1C,EAAAC,cAAA,YACCc,SAAU,SAACO,GAAD,OAAO5E,EAAKD,MAAM+H,WAAWlD,EAAEmD,OAAOpG,QAChDqG,KAAK,IACL7D,UAAU,oCACV8D,IAAI,eACJtG,MAAOxB,KAAKJ,MAAM4B,gBAfkB0D,+CCD5B6C,EAAU,CACtB,CAAEC,KAAM,IAAK1E,MAAO,gBACpB,CAAE0E,KAAM,IAAK1E,MAAO,gBACpB,CAAE0E,KAAM,IAAK1E,MAAO,gBACpB,CAAE0E,KAAM,IAAK1E,MAAO,gBACpB,CAAE0E,KAAM,MAAO1E,MAAO,gBACtB,CAAE0E,KAAM,IAAK1E,MAAO,gBACpB,CAAE0E,KAAM,IAAK1E,MAAO,sBACpB,CAAE0E,KAAM,IAAK1E,MAAO,sBACpB,CAAE0E,KAAM,IAAK1E,MAAO,gBACpB,CAAE0E,KAAM,IAAK1E,MAAO,gBACpB,CAAE0E,KAAM,KAAM1E,MAAO,kCACrB,CAAE0E,KAAM,KAAM1E,MAAO,kCACrB,CAAE0E,KAAM,KAAM1E,MAAO,sBACrB,CAAE0E,KAAM,IAAK1E,MAAO,UACpB,CAAE0E,KAAM,KAAM1E,MAAO,UACrB,CAAE0E,KAAM,KAAM1E,MAAO,UACrB,CAAE0E,KAAM,IAAK1E,MAAO,IACpB,CAAE0E,KAAM,IAAK1E,MAAO,IACpB,CAAE0E,KAAM,IAAK1E,MAAO,IACpB,CAAE0E,KAAM,IAAK1E,MAAO,IACpB,CAAE0E,KAAM,IAAK1E,MAAO,IACpB,CAAE0E,KAAM,IAAK1E,MAAO,IACpB,CAAE0E,KAAM,IAAK1E,MAAO,IACpB,CAAE0E,KAAM,IAAK1E,MAAO,IACpB,CAAE0E,KAAM,IAAK1E,MAAO,IACpB,CAAE0E,KAAM,IAAK1E,MAAO,KAIR2E,EAAiB,CAC7BC,2BAAO,CACN,CACCjF,KAAQ,UACRkF,KAAQ,0DAET,CACClF,KAAQ,8BACRkF,KAAQ,kFAET,CACClF,KAAQ,sEACRkF,KAAQ,sHAET,CACClF,KAAQ,sEACRkF,KAAQ,sHAET,CACClF,KAAQ,sEACRkF,KAAQ,sHAET,CACClF,KAAQ,sEACRkF,KAAQ,uHAGVC,yDAAY,CACX,CACCnF,KAAQ,0CACRkF,KAAQ,0MAHE,uDAaVA,KAAQ,yRAeR,CAAAlF,KAAQ,SAAAkF,KACR,0DAAQ,CAAAlF,KAAA,wCAAAkF,KAAA,uNASR,EAAAlF,KAAQ,yCACRkF,KAAQ,kLASR,CAAAlF,KAAQ,0CACRkF,KAAQ,sLAQT,wCACSA,KAAA,2NAUAA,KACR,iOA6CAA,KAAQ,iOAURA,KAAQ,imBAcT,iMAgBC,2CAAQA,KAAA,2LAST,WACSA,KAAA,gEACR,CAAAlF,KAAQ,WAAAkF,KAAA,uEAAAlF,KAAA,cAAAkF,KAAA,uEAAAlF,KAAA,YAAAkF,KAAA,uEAAAlF,KAAA,WAAAkF,KAAA,iEAAAlF,KAAA,gBAAAkF,KAAA,uEAAAlF,KAAA,WAAAkF,KAAA,uEAAAlF,KAAA,aAAAkF,KAAA,uEAAAlF,KAAA,aAAAkF,KAAA,iEAAAlF,KAAA,mFAAAkF,KAAA,oOASA,CAAAlF,KAAA,oFACAkF,KAAA,qOASV,CAAAlF,KAEE,kFAAQkF,KAAA,oOAUA,CAAAlF,KAAA,sFACAkF,KAAA,6OASA,CAAAlF,KAAA,mFACAkF,KAAA,oOASA,CAAAlF,KAAA,mFACAkF,KAAA,4PASA,CAAAlF,KAAA,qFACAkF,KAAA,+PASR,CAAQlF,KAAA,qFACAkF,KAAA,2PAUR,CAAAlF,KAAQ,yDAAAkF,KAAA,0hBA6CA,CAAAlF,KACR,wDAGAkF,KAAQ,yOC7VUE,w5BCgEMC,iEAAkC9G,KAAMuB,wOAwCpBwF,MAA3C,2DACAJ,KAAA,wqDAmHWK","file":"static/js/1.4667479a.chunk.js","sourcesContent":["import React, {Component} from 'react';\r\nimport {Modal, Select, Button, Icon, Tooltip } from 'antd';\r\nimport $ from 'jquery';\r\n\r\nexport default class Outlink extends Component{\r\n\t\tconstructor(props) {\r\n\t\t\t\tsuper(props);\r\n\t\t\t\tthis.owner = this.props.owner;\r\n\t\t\t\tthis.state = {\r\n\t\t\t\t\tvisible: true,\r\n\t\t\t\t\t\r\n\t\t\t\t\ttargetFormId: '',\r\n\t\t\t\t\ttargetFieldId: '',\r\n\t\t\t\t\tcolumns: [],\r\n\t\t\t\t\tlinkages: []\r\n\t\t\t\t}\r\n\t\t\t\tif(props.using){\r\n\t\t\t\t\t\tthis.state = {...this.state, ...this.owner.state[props.using]};\r\n\t\t\t\t}else{\r\n\t\t\t\t\t\tthis.state = {...this.state, ...this.owner.state.defaultValue};\t\r\n\t\t\t\t}\r\n\t\t\t\tif(this.state.targetFormId){\r\n\t\t\t\t\t\tthis.changeTargetForm(this.state.targetFormId);\t\t\t\r\n\t\t\t\t}\r\n\t\t}\r\n\r\n\t\thandleOk(){\r\n\t\t\t\tlet state = {...this.state};\r\n\t\t\t\tdelete state[\"visible\"];\r\n\t\t\t\tdelete state[\"columns\"];\r\n\t\t\t\tthis.props.updateOutlink(state);\r\n\t\t\t\tthis.handleCancel();\r\n\t\t}\r\n\r\n\t\thandleCancel(){\r\n\t\t\t\t//this.setState({visible: false});\r\n\t\t\tif(this.props.closeOutLink){\r\n\t\t\t\t\tthis.props.closeOutLink();\r\n\t\t\t}\r\n\t\t\twindow.setTimeout(()=>{this.owner.setState({outLinkShowFlag: false, outLinkShowFlag2: false});}, 0);\r\n\t\t}\r\n\t\t\r\n\t\t\r\n\t\tchangeTargetForm(value){\r\n\t\t\t\tlet formId = this.props.formId;\r\n\t\t\t\tif(formId != \"\"){\r\n\t\t\t\t\t\t$.get('/general/appbuilder/web/appdesign/appform/items', {\r\n\t\t\t\t\t\t\t\t\tforms: value || '',\r\n\t\t\t\t\t\t\t\t\tformId: formId,\r\n\t\t\t\t\t\t\t\t\twith_id: true\r\n\t\t\t\t\t\t\t\t}, (res) => {\r\n\t\t\t\t\t\t\t\t\tthis.setState({columns: res.data});\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tthis.setState({targetFormId: value});\r\n\t\t\t\t}\r\n\t\t}\r\n\r\n\t\trender(){\t\t\t\r\n\t\t\t\tlet {formsOfApp, columnsOfForm, noTarget, multi} = this.props;\r\n\t\t\t\tlet forms = Object.keys(formsOfApp).map(key=> formsOfApp[key]);\r\n\t\t\t\tlet columns = Object.keys(columnsOfForm).map(key=> columnsOfForm[key]);\r\n\t\t\t\tlet target_columns = this.state.columns;\r\n\t\t\t\tif(multi){\t\t\t\r\n\t\t\t\t\tlet run_id = this.state.columns.filter(column => column.id === '_RUN_ID');\r\n\t\t\t\t\tif(run_id && run_id.length){\r\n\t\t\t\t\t\t\ttarget_columns = [];\r\n\t\t\t\t\t\t\tthis.state.columns.map(column => target_columns.push({...column}));\r\n\t\t\t\t\t\t\ttarget_columns.push({id: \"_SIGN_COMMENT\", name: \"_会签意见\"});\r\n\t\t\t\t\t\t\ttarget_columns.push({id: \"_RUN_FLOW\", name: \"_运行流程图\"});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\treturn (\r\n\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t<Modal title={noTarget? \"设置链接表单\" : \"设置关联提取\"} visible={this.state.visible} onOk={this.handleOk.bind(this)} onCancel={this.handleCancel.bind(this)} footer={[\r\n\t\t\t\t\t\t\t\t\t\t<Button key=\"back\" type=\"ghost\" size=\"large\" onClick={this.handleCancel.bind(this)}>取 消</Button>,\r\n          \t\t\t\t\t<Button key=\"submit\" type=\"primary\" size=\"large\" onClick={this.handleOk.bind(this)}>提 交</Button>\r\n        \t\t\t\t]}>\r\n\t\t\t\t\t\t\t\t\t<div className=\"ant-row ant-form-item\">\r\n\t\t\t\t            <div className=\"ant-form-item-label\">\r\n\t\t\t\t              <label>{noTarget? \"链接表单\" : \"关联表单\"}</label>\r\n\t\t\t\t              <span className=\"ant-input-wrapper config-typename\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Select value={[this.state.targetFormId]} onChange={this.changeTargetForm.bind(this)} style={{\"width\": 150}}>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tforms.map(form => <Select.Option value={form.id}><Tooltip title={form.name}>{form.name}</Tooltip></Select.Option>)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</Select>\r\n\t\t\t\t              </span>\r\n\t\t\t\t            </div>\r\n\t\t\t\t          </div>\r\n\t\t\t\t          {\r\n\t\t\t\t          \t!noTarget ?\r\n\t\t\t\t          <div className=\"ant-row ant-form-item\">\r\n\t\t\t\t            <div className=\"ant-form-item-label\">\r\n\t\t\t\t              <label>字段显示为</label>\r\n\t\t\t\t              <span className=\"ant-input-wrapper config-typename\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Select value={[this.state.targetFieldId]} onChange={value => this.setState({targetFieldId: value})} style={{\"width\": 150}}>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttarget_columns.map(column => <Select.Option value={column.id}><Tooltip title={column.name}>{column.name}</Tooltip></Select.Option>)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</Select>\r\n\t\t\t\t              </span>\r\n\t\t\t\t            </div>\r\n\t\t\t\t          </div> : null\r\n\t\t\t\t        \t}\r\n\t\t\t\t          <div className=\"ant-row ant-form-item\">\r\n\t\t\t\t          \t\t<a href=\"javascript:void(0)\" onClick={e => {\r\n\t\t\t\t          \t\t\t\tlet {linkages} = this.state;\r\n\t\t\t\t          \t\t\t\tlinkages.push({id: '', targetId: ''});\r\n\t\t\t\t          \t\t\tthis.setState({linkages});}}>{noTarget? \"添加链接条件\" : \"添加关联条件\"}</a><span> 格式为：本表单字段 = {noTarget? \"链接表单字段\" : \"关联表单字段\"}</span>\r\n\t\t\t\t          </div>\r\n\t\t\t\t          {\r\n\t\t\t\t          \t\tthis.state.linkages.map((linkage, index) =>  \r\n\t\t\t\t          \t\t\t\t<div className=\"ant-row ant-form-item\">\r\n\t\t\t\t          \t\t\t\t\t\t<Select value={[linkage.id]} onChange={value=> {\r\n\t\t\t\t          \t\t\t\t\t\t\t\tlet {linkages} = this.state;\r\n\t\t\t\t          \t\t\t\t\t\t\t\tlinkages[index]['id'] = value;\r\n\t\t\t\t          \t\t\t\t\t\t\t\tthis.setState({linkages});\r\n\t\t\t\t          \t\t\t\t\t\t}} style={{\"width\": 150}}>\r\n\t\t\t\t          \t\t\t\t\t\t\t\t{\r\n\t\t\t\t          \t\t\t\t\t\t\t\t\t\tcolumns.map(item => <Select.Option value={item.id}><Tooltip title={item.name}>{item.name}</Tooltip></Select.Option>)\r\n\t\t\t\t          \t\t\t\t\t\t\t\t}\r\n\t\t\t\t          \t\t\t\t\t\t</Select>\r\n\t\t\t\t          \t\t\t\t\t\t<Select value={[linkage.targetId]} onChange={value=> {\r\n\t\t\t\t          \t\t\t\t\t\t\t\tlet {linkages} = this.state;\r\n\t\t\t\t          \t\t\t\t\t\t\t\tlinkages[index]['targetId'] = value;\r\n\t\t\t\t          \t\t\t\t\t\t\t\tthis.setState({linkages});\r\n\t\t\t\t          \t\t\t\t\t\t}} style={{\"width\": 150, \"margin-left\": '10px'}}>\r\n\t\t\t\t          \t\t\t\t\t\t\t\t{this.state.columns.map(item => <Select.Option value={item.id}><Tooltip title={item.name}>{item.name}</Tooltip></Select.Option>)}\r\n\t\t\t\t          \t\t\t\t\t\t</Select>\r\n\t\t\t\t          \t\t\t\t\t\t<a><Icon type=\"minus-circle\" onClick={e => {\r\n\t\t\t\t          \t\t\t\t\t\t\t\tlet {linkages} = this.state;\r\n\t\t\t\t          \t\t\t\t\t\t\t\tlinkages = linkages.filter((linkage,index2)=>index2!==index);\r\n\t\t\t\t          \t\t\t\t\t\t\tthis.setState({linkages});}} style={{\"cursor\":\"hand\"}}/></a>\r\n\t\t\t\t          \t\t\t\t</div>\r\n\t\t\t\t          \t\t)\r\n\t\t\t\t          }\r\n\t\t\t\t         \r\n        \t\t\t\t</Modal>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t);\r\n\t\t}\r\n}","import React, {Component} from 'react'\r\nimport {Menu} from 'antd';\r\nimport $ from 'jquery';\r\n\r\n\r\nconst SubMenu = Menu.SubMenu;\r\nconst MenuItemGroup = Menu.ItemGroup;\r\n\r\nconst handleMenuItemClick = (callback) => (info) => {\r\n\tconst item = info.key.split(\"-\")[1]\r\n\tcallback(item)\r\n}\r\n\r\n\r\n// 本表单字段\r\nconst CurrentForm = ({data, handle}) => {\r\n\treturn (\r\n\t\t<Menu\r\n\t\t\tstyle={{ width: 158 }}\r\n\t\t\tmode=\"inline\"\r\n\t\t\tclassName=\"formula-modal-field-list thin-scroll\"\r\n\t\t\tonClick={handleMenuItemClick(handle)}\r\n\t\t>\r\n\t\t\t{\r\n\t\t\t\tdata && data.map((item, index) =>\r\n\t\t\t\t\t<Menu.Item key={\"item-\" + \"本表单.\" + item + \"-\" + index}>{item}</Menu.Item>)\r\n\t\t\t}\r\n\t\t</Menu>\r\n\t)\r\n}\r\n\r\n// 其它表单字段\r\nconst OtherForms = ({data, handle}) => {\r\n\treturn (\r\n\t\t<Menu\r\n\t\t\tstyle={{ width: 158 }}\r\n\t\t\tmode=\"inline\"\r\n\t\t\tclassName=\"formula-modal-field-list thin-scroll\"\r\n\t\t\tonClick={handleMenuItemClick(handle)}\r\n\t\t>\r\n\t\t\t{\r\n\t\t\t\tdata && data.map((form, index) =>\r\n\t\t\t\t<SubMenu key={\"sub\" + index} title={form.form}>\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tform.items.map((item, index) =>\r\n\t\t\t\t\t\t\t<Menu.Item key={\"item-\" + form.form + \".\" + item + \"-\" + index}>{item}</Menu.Item>)\r\n\t\t\t\t\t}\r\n\t\t\t\t</SubMenu>)\r\n\t\t\t}\r\n\t\t</Menu>\r\n\t)\r\n}\r\n\r\nexport default class FormulaField extends Component{\r\n\r\n\tconstructor(){\r\n\t\tsuper()\r\n\t\tthis.switchPanel = this.switchPanel.bind(this)\r\n\t\tthis.state = {\r\n\t\t\tcurrent: '1',\r\n\t\t\tfields: [],\r\n\t\t\tallFields: [],\r\n\t\t\tpanel: 'self'\r\n\t\t}\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\r\n\t\t// 本表单\r\n\t\t$.get('/general/appbuilder/web/appdesign/appform/items',\r\n\t\t\t{\r\n\t\t\t\tformId: this.props.formulaData.formId,\r\n\t\t\t\tforms: ''\r\n\t\t\t},\r\n\t\t\tresponse => {\r\n\t\t\t\tif(response.status === 'ok') {\r\n\t\t\t\t\tthis.setState({\r\n\t\t\t\t\t\tfields: response.data\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t)\r\n\r\n\t\t// 其它表单\r\n\t\tif(this.props.formulaData.forms !== '') {\r\n\r\n\t\t\tlet params = {\r\n\t\t\t\tformId: this.props.formulaData.formId,\r\n\t\t\t\tforms: this.props.formulaData.forms\r\n\t\t\t}\r\n\r\n\t\t\t//仅提取触发器的数据填充和数据过滤有此字段\r\n\t\t\tif(this.props.formulaData.just != undefined && this.props.formulaData.just == true){\r\n\t\t\t\tparams['just'] = true\r\n\t\t\t}\r\n\r\n\t\t\t$.get('/general/appbuilder/web/appdesign/appform/items', params, response => {\r\n\t\t\t\t\tif(response.status === 'ok') {\r\n\t\t\t\t\t\tthis.setState({\r\n\t\t\t\t\t\t\tallFields: response.data\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t)\r\n\t\t}\r\n\t}\r\n\r\n\trender(){\r\n\t\treturn(\r\n\t\t\t<div className=\"formula-modal-field-wrap\">\r\n\t\t\t\t<h3 className=\"formula-modal-body-title\">\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tthis.props.formulaData.forms === '' ?\r\n\t\t\t\t\t\t\t'本表单' :\r\n\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t<span onClick={() => this.switchPanel('self')}>本表单</span>\r\n\t\t\t\t\t\t\t\t<span onClick={() => this.switchPanel('others')} style={{float:'right'}}>其它表单</span>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t}\r\n\t\t\t\t</h3>\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.props.formulaData.forms === '' ?\r\n\t\t\t\t\t\t<CurrentForm data={this.state.fields} handle={this.props.changeFormulaData} /> :\r\n\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tthis.state.panel === 'self' ?\r\n\t\t\t\t\t\t\t\t<CurrentForm data={this.state.fields} handle={this.props.changeFormulaData} /> :\r\n\t\t\t\t\t\t\t\t<OtherForms data={this.state.allFields} handle={this.props.changeFormulaData} />\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t}\r\n\t\t\t</div>\r\n\t\t)\r\n\t}\r\n\r\n\tswitchPanel(panel) {\r\n\t\tthis.setState({\r\n\t\t\tpanel\r\n\t\t})\r\n\t}\r\n}\r\n","import React, {Component} from 'react'\r\n\r\nexport default class FormulaEdit extends Component{\r\n\r\n\tcomponentDidMount() {\r\n\t\tthis.props.setEditingBoard(this.refs.editingBoard)\r\n\t}\r\n\r\n\trender(){\r\n\t\treturn(\r\n\t\t\t<div >\r\n\t\t\t\t<h3 className=\"formula-modal-edit-title\">公式编辑</h3>\r\n\t\t\t\t<textarea\r\n\t\t\t\t\tonChange={(e) => this.props.setFormula(e.target.value)}\r\n\t\t\t\t\trows=\"3\"\r\n\t\t\t\t\tclassName=\"formula-edit-textarea thin-scroll\"\r\n\t\t\t\t\tref=\"editingBoard\"\r\n\t\t\t\t\tvalue={this.props.value}>\r\n\t\t\t\t</textarea>\r\n\t\t\t</div>\r\n\t\t)\r\n\t}\r\n}\r\n","\r\nexport const OPRATOR = [\r\n\t{ sign: '+', title: '加号'},\r\n\t{ sign: '-', title: '减号'},\r\n\t{ sign: '*', title: '乘号'},\r\n\t{ sign: '/', title: '除号'},\r\n\t{ sign: 'MOD', title: '取余'},\r\n\t{ sign: '=', title: '等于'},\r\n\t{ sign: '(', title: '左括号'},\r\n\t{ sign: ')', title: '右括号'},\r\n\t{ sign: '<', title: '小于'},\r\n\t{ sign: '>', title: '大于'},\r\n\t{ sign: '<=', title: '小于或等于'},\r\n\t{ sign: '>=', title: '大于或等于'},\r\n\t{ sign: '<>', title: '不等于'},\r\n\t{ sign: '!', title: '非'},\r\n\t{ sign: '&&', title: '且'},\r\n\t{ sign: '||', title: '或'},\r\n\t{ sign: '1', title: ''},\r\n\t{ sign: '2', title: ''},\r\n\t{ sign: '3', title: ''},\r\n\t{ sign: '4', title: ''},\r\n\t{ sign: '5', title: ''},\r\n\t{ sign: '6', title: ''},\r\n\t{ sign: '7', title: ''},\r\n\t{ sign: '8', title: ''},\r\n\t{ sign: '9', title: ''},\r\n\t{ sign: '0', title: ''},\r\n]\r\n\r\n\r\nexport const ARR_FUNC_TOKEN = {\r\n\t\"统计函数\":[\r\n\t\t{\r\n\t\t\t\"name\": \"COUNT()\",\r\n\t\t\t\"desc\": \"此函数返回记录数。\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"COUNT(<字段名>)\",\r\n\t\t\t\"desc\": \"此函数返回指定字段的个数。\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"SUM(<数值型或货币型字段名>)\",\r\n\t\t\t\"desc\": \"此函数返回数字型或货币型字段的合计值。\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"AVG(<数值型或货币型字段名>)\",\r\n\t\t\t\"desc\": \"此函数返回数字型或货币型字段的平均值。\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"MAX(<数值型或货币型字段名>)\",\r\n\t\t\t\"desc\": \"此函数返回数字型或货币型字段的最大值。\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"MIN(<数值型或货币型字段名>)\",\r\n\t\t\t\"desc\": \"此函数返回数字型或货币型字段的最小值。\"\r\n\t\t}\r\n\t],\r\n\t\"数据（含货币）函数\":[\r\n\t\t{\r\n\t\t\t\"name\": \"FLOOR(<数值表达式>)\",\r\n\t\t\t\"desc\": \"此函数返回不超过表达式数值的最大整数。\\\r\n\t\t\t\t例如：FLOOR(125.2) 返回结果为：125\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"ROUND(<数值表达式>,整数)\",\r\n\t\t\t\"desc\": \"此函数返回指定表达式四舍五入到整数部分规定保留的小数点位数的值。\\\r\n    \t\t例如：ROUND(125.256,2) 返回结果为：125.26\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"RAND()\",\r\n\t\t\t\"desc\": \"此函数返回随机数。\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"ABS(<数值表达式>)\",\r\n\t\t\t\"desc\": \"此函数返回数值表达式的绝对值。\\\r\n    \t\t例如：ABS(-125) 返回结果为：125\"\r\n\t\t}\r\n\t],\r\n\t\"日期和时间函数\":[\r\n\t\t{\r\n\t\t\t\"name\": \"YEAR(<日期表达式>)\",\r\n\t\t\t\"desc\": \"此函数返回日期表达式的年份值。\\\r\n    \t\t例如：YEAR(#2007.1.28#) 返回结果为：2007\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"MONTH(<日期表达式>)\",\r\n\t\t\t\"desc\": \"此函数返回日期表达式的月份值。\\\r\n    \t\t例如：MONTH(#2007.1.28#) 返回结果为：1\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"DAY(<日期表达式>)\",\r\n\t\t\t\"desc\": \"此函数返回日期表达式的天数。\\\r\n    \t\t例如：DAY(#2007.1.28#) 返回结果为：28\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"QUARTER(<日期表达式>)\",\r\n\t\t\t\"desc\": \"此函数返回日期表达式的季度数。\\\r\n    \t\t例如：QUARTER(#2007.1.28#) 返回结果为：1\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"WEEK(<日期表达式>)\",\r\n\t\t\t\"desc\": \"此函数返回日期表达式的星期数。\\\r\n    \t\t例如：WEEK(#2007.1.28#) 返回结果为：4\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"WEEKDAY(<日期表达式>)\",\r\n\t\t\t\"desc\": \"此函数返回日期表达式的星期几（星期日返回1，星期一返回2，以此类推星期六返回7）。\\\r\n    \t\t例如：WEEKDAY(#2007.1.28#) 返回结果为：1\"\r\n\t\t},\t\t\r\n\t\t{\r\n\t\t\t\"name\": \"HOUR(<日期表达式>)\",\r\n\t\t\t\"desc\": \"此函数返回日期表达式的小时数。\\\r\n    \t\t例如：HOUR(#2007.1.28 09:59:42#) 返回结果为：9\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"MINUTE(<日期表达式>)\",\r\n\t\t\t\"desc\": \"此函数返回日期表达式的分钟数。\\\r\n    \t\t例如：MINUTE(#2007.1.28 09:59:42#) 返回结果为：59\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"SECOND(<日期表达式>)\",\r\n\t\t\t\"desc\": \"此函数返回日期表达式的秒数。\\\r\n    \t\t例如：SECOND(#2007.1.28 09:59:42#) 返回结果为：42\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"THISDATE\",\r\n\t\t\t\"desc\": \"此函数返回当前日期。\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"THISYEAR\",\r\n\t\t\t\"desc\": \"此函数返回当前年度值。\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"THISQUARTER\",\r\n\t\t\t\"desc\": \"此函数返回当前季度值。\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"THISMONTH\",\r\n\t\t\t\"desc\": \"此函数返回当前月份值。\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"THISWEEK\",\r\n\t\t\t\"desc\": \"此函数返回当前周数。\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"THISDAYOFWEEK\",\r\n\t\t\t\"desc\": \"此函数返回当前星期数。\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"THISHOUR\",\r\n\t\t\t\"desc\": \"此函数返回当前小时数。\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"THISMINUTE\",\r\n\t\t\t\"desc\": \"此函数返回当前分钟数。\"\r\n\t\t},\t\r\n\t\t{\r\n\t\t\t\"name\": \"THISSECOND\",\r\n\t\t\t\"desc\": \"此函数返回当前秒数。\"\r\n\t\t},\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t{\r\n\t\t\t\"name\": \"YEARBETWEEN(<日期表达式1>,<日期表达式2>)\",\r\n\t\t\t\"desc\": \"此函数返回日期表达式1到日期表达式2的年份。\\\r\n    \t\t例如：YEARBETWEEN(#2005.07.03#,#2007.07.28#) 返回结果为：2\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"MONTHBETWEEN(<日期表达式1>,<日期表达式2>)\",\r\n\t\t\t\"desc\": \"此函数返回日期表达式1到日期表达式2的月份。\\\r\n    \t\t例如：MONTHBETWEEN(#2007.01.28#,#2007.07.28#) 返回结果为：6\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"DAYBETWEEN(<日期表达式1>,<日期表达式2>)\",\r\n\t\t\t\"desc\": \"此函数返回日期表达式1到日期表达式2的天数。\\\r\n    \t\t例如：DAYBETWEEN(#2007.01.03#,#2007.01.28#) 返回结果为：25\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"QUARTERBETWEEN(<日期表达式1>,<日期表达式2>)\",\r\n\t\t\t\"desc\": \"此函数返回日期表达式1到日期表达式2的季度数。\\\r\n    \t\t例如：QUARTERBETWEEN(#2007.01.03#,#2007.07.28#) 返回结果为：2\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"WEEKBETWEEN(<日期表达式1>,<日期表达式2>)\",\r\n\t\t\t\"desc\": \"此函数返回日期表达式1到日期表达式2的周数。\\\r\n    \t\t例如：WEEKBETWEEN(#2007.01.03#,#2007.01.28#) 返回结果为：4\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"HOURBETWEEN(<日期表达式1>,<日期表达式2>)\",\r\n\t\t\t\"desc\": \"此函数返回日期表达式1到日期表达式2的小时数。\\\r\n    \t\t例如：HOURBETWEEN(#2007.01.03 09:59:42#,#2007.01.03 10:59:42#) 返回结果为：1\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"MINUTEBETWEEN(<日期表达式1>,<日期表达式2>)\",\r\n\t\t\t\"desc\": \"此函数返回日期表达式1到日期表达式2的分钟数。\\\r\n    \t\t例如：MINUTEBETWEEN(#2007.01.03 09:59:42#,#2007.01.03 10:59:42#) 返回结果为：60\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"SECONDBETWEEN(<日期表达式1>,<日期表达式2>)\",\r\n\t\t\t\"desc\": \"此函数返回日期表达式1到日期表达式2的秒数。\\\r\n    \t\t例如：SECONDBETWEEN(#2007.01.03 09:59:42#,#2007.01.03 10:59:42#) 返回结果为：3600\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"ADDYEAR(<日期表达式>,整数)\",\r\n\t\t\t\"desc\": \"此函数返回日期表达式增加指定年数后的日期值。\\\r\n    \t\t例如：ADDYEAR(#2005.07.03#,2) 返回结果为：#2007.07.03#\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"ADDMONTH(<日期表达式>,整数)\",\r\n\t\t\t\"desc\": \"此函数返回日期表达式增加指定月数后的日期值。\\\r\n    \t\t例如：ADDMONTH(#2007.07.03#,2) 返回结果为：#2007.09.03#\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"ADDDAY(<日期表达式>,整数)\",\r\n\t\t\t\"desc\": \"此函数返回日期表达式增加指定天数后的日期值。\\\r\n    \t\t例如：ADDDAY(#2005.07.03#,2) 返回结果为：#2005.07.05#\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"ADDQUARTER(<日期表达式>,整数)\",\r\n\t\t\t\"desc\": \"此函数返回日期表达式增加指定季度数后的日期值。\\\r\n    \t\t例如：ADDQUARTER(#2007.01.03#,2) 返回结果为：#2007.07.03#\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"ADDWEEK(<日期表达式>,整数)\",\r\n\t\t\t\"desc\": \"此函数返回日期表达式增加指定周数后的日期值。\\\r\n    \t\t例如：ADDWEEK(#2007.01.03#,3) 返回结果为：#2007.01.24#\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"ADDHOUR(<日期表达式>,整数)\",\r\n\t\t\t\"desc\": \"此函数返回日期表达式增加指定小时数后的日期值。\\\r\n    \t\t例如：ADDHOUR(#09:59:42#,1) 返回结果为：#10:59:42#\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"ADDMINUTE(<日期表达式>,整数)\",\r\n\t\t\t\"desc\": \"此函数返回日期表达式增加指定分数后的日期值。\\\r\n    \t\t例如：ADDMINUTE(#09:59:42#,1) 返回结果为：#10:00:42#\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"ADDSECOND(<日期表达式>,整数)\",\r\n\t\t\t\"desc\": \"此函数返回日期表达式增加指定秒数后的日期值。\\\r\n    \t\t例如：ADDSECOND(#09:59:42#,1) 返回结果为：#09:59:43#\"\r\n\t\t},\r\n\t],\r\n\t\"字符串函数\": [\r\n\t\t{\r\n\t\t\t\"name\": \"CONCAT(<字符串表达式1>,<字符串表达式2>,...,<字符串表达式n>)\",\r\n\t\t\t\"desc\": \"此函数连接两个字符串。\\\r\n    \t\t例如：CONCAT(\\\"abc\\\",\\\"def\\\") 返回结果为：\\\"abcdef\\\"\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"TRIM(<字符串表达式>)\",\r\n\t\t\t\"desc\": \"此函数截取字符串表达式左右两边多余空格。\\\r\n    \t\t例如：trim(\\\"  abc  \\\") 返回结果为：\\\"abc\\\"\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"LTRIM(<字符串表达式>)\",\r\n\t\t\t\"desc\": \"此函数截取字符串表达式左边多余空格。\\\r\n    \t\t例如：LTRIM(\\\"  abc  \\\") 返回结果为：\\\"abc  \\\"\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"RTRIM(<字符串表达式>)\",\r\n\t\t\t\"desc\": \"此函数截取字符串表达式右边多余空格。\\\r\n    \t\t例如：RTRIM(\\\"  abc  \\\") 返回结果为：\\\"  abc\\\"\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"SUBSTR(<字符串表达式>,<起始位>,<长度>)\",\r\n\t\t\t\"desc\": \"此函数返回字符串表达式从[起始位]开始共[长度]个字符的子串。\\\r\n    \t\t例如：SUBSTR(\\\"abcd\\\", 2, 2) 返回结果为：\\\"bc\\\"\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"STRLEN(<字符串表达式>)\",\r\n\t\t\t\"desc\": \"此函数返回字符串表达式所包含的字符个数。\\\r\n    \t\t例如：STRLEN(\\\"abcd你好\\\") 返回结果为：6\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"LEFT(<字符串表达式>,<长度>)\",\r\n\t\t\t\"desc\": \"此函数返回字符串表达式左边开始共[长度]个字符的子串。\\\r\n    \t\t例如：LEFT(\\\"abcd你好\\\", 5) 返回结果为：\\\"abcd你\\\"\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"RIGHT(<字符串表达式>,<长度>)\",\r\n\t\t\t\"desc\": \"此函数返回字符串表达式右边开始共[长度]个字符的子串。\\\r\n    \t\t例如：RIGHT(\\\"abcd你好\\\", 5) 返回结果为：\\\"bcd你好\\\"\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"STRPOS(<字符串表达式1>,<字符串表达式2>)\",\r\n\t\t\t\"desc\": \"此函数返回字符串表达式1中首次出现字符串表达式2的位置，字符位置从1开始计数，未搜索到时返回0。\\\r\n    \t\t例如：STRPOS(\\\"abcd你好\\\", \\\"bcd\\\") 返回结果为：1\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"REPLACE(<待搜索的字符串表达式>,<待查找的字符串表达式>,<替换用的字符串表达式>)\",\r\n\t\t\t\"desc\": \"此函数返回用替换用的字符串表达式替换待搜索的字符串表达式中出现的所有待查找的字符串表达式。\\\r\n    \t\t例如：REPLACE(\\\"abcdefghicde\\\",\\\"cde\\\",\\\"xxx\\\") 返回结果为：abxxxfghixxx\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"REG(<字符串表达式>,<正则表达式>)\",\r\n\t\t\t\"desc\": \"此函数返回字符串表达式是否满足正则表达式规则，满足返回1，否则返回0。\\\r\n    \t\t例如：REG(\\\"fo\\no\\\", \\\"^fo\\no$\\\") 返回结果为：1\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"PINYINQUANMA(<字符串表达式>)\",\r\n\t\t\t\"desc\": \"返回<字符串表达式>对应的拼音。\\\r\n    \t\t例如：PINYINQUANMA(\\\"中国\\\")，返回结果为：zhongguo\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"PINYINJIANMA(<字符串表达式>)\",\r\n\t\t\t\"desc\": \"返回<字符串表达式>对应的拼音简称。\\\r\n    \t\t例如：PINYINJIANMA(\\\"中国\\\")，返回结果为：zg\"\r\n\t\t}\r\n\t],\r\n\t\"集合函数\":[\r\n\t\t{\r\n\t\t\t\"name\": \"SET(<表达式1>,<表达式2>,<表达式3>)\",\r\n\t\t\t\"desc\": \"例如：SET(1,2,3,4)，SET(\\\"abc\\\",\\\"cde\\\",\\\"efg\\\"）\"\r\n\t\t}\r\n\t],\r\n\t\"转换函数\":[\r\n\t\t{\r\n\t\t\t\"name\": \"STRTODATETIME(<字符串表达式>)\",\r\n\t\t\t\"desc\": \"字符转日期。\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"STRTOFLOAT(<字符串表达式>)\",\r\n\t\t\t\"desc\": \"字符转数值。\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"FLOATTOSTR(<数值表达式>)\",\r\n\t\t\t\"desc\": \"数值转字符。\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"FLOATTODATETIME(<数值表达式>)\",\r\n\t\t\t\"desc\": \"数值转日期。\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"DATETIMETOSTR(<日期表达式>)\",\r\n\t\t\t\"desc\": \"日期转字符。\"\r\n\t\t}\r\n\t],\r\n\t\"类型不定函数\":[\r\n\t\t{\r\n\t\t\t\"name\": \"IF THEN [ELSE] END\",\r\n\t\t\t\"desc\": \"例如：IF 商品=\\\"牛奶\\\" THEN 0.02 ELSE 0.1 END\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"CASE IF cexpr1 THEN expr1 IF cexpr2 THEN expr2 [ELSE exprn] END\",\r\n\t\t\t\"desc\": \"例如：CASE IF 商品=\\\"牛奶\\\" THEN 0.02\\\r\n                 IF 商品=\\\"面包\\\" THEN 0.015\\\r\n                 IF 商品=\\\"咖啡\\\" THEN 0.15\\\r\n                 ELSE 0.1 END\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"GREATER(表达式1,表达式2)\",\r\n\t\t\t\"desc\": \"返回两者中较大者\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"LESS(表达式1,表达式2)\",\r\n\t\t\t\"desc\": \"返回两者中较小者\"\r\n\t\t}\r\n\t],\r\n\t\"系统函数\":[\r\n\t\t{\r\n\t\t\t\"name\": \"LOGIN_UNIT\",\r\n\t\t\t\"desc\": \"当前单位\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"LOGIN_USER\",\r\n\t\t\t\"desc\": \"当前用户\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"LOGIN_DEPT\",\r\n\t\t\t\"desc\": \"当前部门\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"LOGIN_PRIV\",\r\n\t\t\t\"desc\": \"当前角色\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"WRITE_DEPT\",\r\n\t\t\t\"desc\": \"制单部门\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"WRITER\",\r\n\t\t\t\"desc\": \"制单人\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"WRITE_TIME\",\r\n\t\t\t\"desc\": \"制单时间\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"SYSDATE\",\r\n\t\t\t\"desc\": \"系统日期\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"LOGIN_USER_ID\",\r\n\t\t\t\"desc\": \"当前用户ID\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"LOGIN_DEPT_ID\",\r\n\t\t\t\"desc\": \"当前部门ID\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"LONG_DEPT_NAME\",\r\n\t\t\t\"desc\": \"长部门名称\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"LOGIN_OTHER_PRIV\",\r\n\t\t\t\"desc\": \"当前辅助角色\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"CUR_GEOLOCATION\",\r\n\t\t\t\"desc\": \"返回用户当前所在的地理位置。\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"LOGIN_UID\",\r\n\t\t\t\"desc\": \"当前用户UID\" \r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"LOGIN_BYNAME\",\r\n\t\t\t\"desc\": \"当前用户别名\" \r\n\t\t}\t\t\r\n\t],\r\n\t\"常量\":[\r\n\t\t{\r\n\t\t\t\"name\": \"TRUE\",\r\n\t\t\t\"desc\": \"真\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"FALSE\",\r\n\t\t\t\"desc\": \"假\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"NULL\",\r\n\t\t\t\"desc\": \"空\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"#2007.1.28#\",\r\n\t\t\t\"desc\": \"返回2007年1月28日。\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"#1.28#\",\r\n\t\t\t\"desc\": \"返回1月28日。\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"\\\"张三\\\"\",\r\n\t\t\t\"desc\": \"返回字符常量张三\"\r\n\t\t}\r\n\t],\r\n\t\"算术运算符\":[\r\n\t\t{\r\n\t\t\t\"name\": \"+\",\r\n\t\t\t\"desc\": \"加\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"-\",\r\n\t\t\t\"desc\": \"减\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"*\",\r\n\t\t\t\"desc\": \"乘\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"/\",\r\n\t\t\t\"desc\": \"除\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"DIV\",\r\n\t\t\t\"desc\": \"整除\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"MOD\",\r\n\t\t\t\"desc\": \"取余\"\r\n\t\t}\r\n\t],\r\n\t\"关系运算符\":[\r\n\t\t{\r\n\t\t\t\"name\":\"=\",\r\n\t\t\t\"desc\":\"相等比较符\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\":\"<>\",\r\n\t\t\t\"desc\":\"不等比较符\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\":\"<\",\r\n\t\t\t\"desc\":\"小于比较符\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\":\">\",\r\n\t\t\t\"desc\":\"大于比较符\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\":\"<=\",\r\n\t\t\t\"desc\":\"小于等于比较符\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\":\">=\",\r\n\t\t\t\"desc\":\"大于等于比较符\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\":\"LIKE(<表达式>)\",\r\n\t\t\t\"desc\":\"包含比较符\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\":\"LLIKE(<表达式>)\",\r\n\t\t\t\"desc\":\"左包含比较符\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\":\"RLIKE(<表达式>)\",\r\n\t\t\t\"desc\":\"右包含比较符\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\":\"IN(<集合表达式>)\",\r\n\t\t\t\"desc\":\"属于比较符\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\":\"BETWEEN(<表达式1>,<表达式2>)\",\r\n\t\t\t\"desc\":\"介于两值之间比较符\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\":\"ISNOTNULL\",\r\n\t\t\t\"desc\":\"有值比较符\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\":\"ISNULL\",\r\n\t\t\t\"desc\":\"无值比较符\"\r\n\t\t}\r\n\t],\r\n\t\"逻辑运算符\":[\r\n\t\t{\r\n\t\t\t\"name\": \"&&\",\r\n\t\t\t\"desc\": \"与\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"||\",\r\n\t\t\t\"desc\": \"或\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"!\",\r\n\t\t\t\"desc\": \"非\"\r\n\t\t},\r\n\t],\r\n\t\"其他\":[\r\n\t\t{\r\n\t\t\t\"name\": \"()\",\r\n\t\t\t\"desc\": \"括号\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"//\",\r\n\t\t\t\"desc\": \"注释符\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \",\",\r\n\t\t\t\"desc\": \"逗号分隔符\"\r\n\t\t}\r\n\t]\r\n}\r\n","import React, {Component} from 'react'\r\nimport {Collapse, Tooltip} from 'antd';\r\nimport {ARR_FUNC_TOKEN} from '../constants';\r\nconst Panel = Collapse.Panel;\r\n\r\nexport default class FunctionList extends Component{\r\n\r\n  handleChange(key) {\r\n      // console.log(key);\r\n  }\r\n\r\n  render(){\r\n    return(\r\n      <div className=\"formula-modal-funclist-wrap\" >\r\n        <h3 className=\"formula-modal-funclist-title\">函数列表</h3>\r\n        <div className=\"formula-panel-collapse-wrap thin-scroll\">\r\n          <Collapse defaultActiveKey={['0']} onChange={this.handleChange.bind(this)} className=\"formula-panel-collapse\">\r\n            {Object.keys(ARR_FUNC_TOKEN).map((collectionFuncName, collectionIndex) =>\r\n              (\r\n                <Panel header={collectionFuncName} key={collectionIndex} className=\"formula-panel-collapse-titles\">\r\n                  <ul>\r\n                    {ARR_FUNC_TOKEN[collectionFuncName].map((func, funcIndex) =>\r\n                      (\r\n                      \t<Tooltip title={func.name}>\r\n                        <li className=\"formula-panel-collapse-items\"\r\n                          key={funcIndex}\r\n                          onClick={() => this.props.setFuncDesc(func.desc)}\r\n                          onDoubleClick={() => this.props.changeFormulaData(func.name)}\r\n                        >{func.name}</li>\r\n                        </Tooltip>\r\n                      )\r\n                    )}\r\n                  </ul>\r\n                </Panel>\r\n              )\r\n            )}\r\n          </Collapse>\r\n        </div>\r\n        <div className=\"formula-panel-function-tips thin-scroll\">\r\n          <div className=\"formula-panel-tips-content\" >\r\n            <span className=\"formula-panel-tips-title\">说明：</span>\r\n            <span className=\"formula-panel-tip\">{this.props.funcDesc}</span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n","import './formula.css'\r\nimport React, {Component} from 'react'\r\nimport { Modal, Button ,Row, Col, message, notification } from 'antd';\r\nimport FormulaField from './components/FormulaField'\r\nimport FormulaEdit  from './components/FormulaEdit'\r\nimport FunctionList from './components/FunctionList'\r\nimport FormulaOprator from  './components/FormulaOprator'\r\nimport $ from 'jquery';\r\n\r\nclass Formula extends Component {\r\n\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\t\tconst { formulaData } = this.props\r\n\t\tconst initialValue = formulaData.value || ''\r\n\t\tconst initialCursorIndex = initialValue.length\r\n\t\tthis.state= {\r\n\t\t\tvisible: true,\r\n\t\t\tfuncDesc: '',\r\n\t\t\tformulaValue: initialValue,\r\n\t\t\teditingBoard: null,\r\n\t\t\tinitialCursorIndex,\r\n\t\t\tokLoading: false,\r\n\t\t\tvalidateLoading: false\r\n\t\t}\r\n\t}\r\n\r\n\tsetEditingBoard(ref) {\r\n\t\tthis.setState({\r\n\t\t\teditingBoard: ref\r\n\t\t})\r\n\t}\r\n\r\n\tsetFormula(value) {\r\n\t\tthis.setState({\r\n\t\t\tformulaValue: value\r\n\t\t})\r\n\t}\r\n\r\n\tchangeFormulaData(value) {\r\n\t\tconst eb = this.state.editingBoard\r\n\t\tif(eb.selectionStart !== eb.selectionEnd) {\r\n\t\t\tthis.replaceFormulaData(eb.selectionStart, eb.selectionEnd, value)\r\n\t\t\tthis.state.initialCursorIndex = -1\r\n\t\t\treturn\r\n\t\t}\r\n\t\tif(eb.selectionStart === eb.value.length || this.state.initialCursorIndex !== -1) {\r\n\t\t\tthis.appendFormulaData(value)\r\n\t\t\tthis.state.initialCursorIndex = -1\r\n\t\t\treturn\r\n\t\t}\r\n\t\tthis.insertFormulaData(eb.selectionStart, value)\r\n\t\tthis.state.initialCursorIndex = -1\r\n\t}\r\n\r\n\tappendFormulaData(value) {\r\n\t\tthis.setState((prevState) => ({\r\n\t\t\tformulaValue: prevState.formulaValue + value\r\n\t\t}))\r\n\t\tthis.state.editingBoard.focus()\r\n\t}\r\n\r\n\tinsertFormulaData(offset, value) {\r\n\t\tthis.setState((prevState) => ({\r\n\t\t\tformulaValue: prevState.formulaValue.slice(0, offset) + value + prevState.formulaValue.slice(offset)\r\n\t\t}))\r\n\t\tthis.state.editingBoard.focus()\r\n\t\t//debugger\r\n\t\tsetTimeout(() => {\r\n\t\t\tthis.state.editingBoard.setSelectionRange(Number(offset + value.length), Number(offset + value.length))\r\n\t\t}, 0)\r\n\t}\r\n\r\n\treplaceFormulaData(start, end, value) {\r\n\t\tthis.setState((prevState) => ({\r\n\t\t\tformulaValue: prevState.formulaValue.slice(0,start) + value + prevState.formulaValue.slice(end)\r\n\t\t}))\r\n\t\tthis.state.editingBoard.focus()\r\n\t\tsetTimeout(() => {\r\n\t\t\tthis.state.editingBoard.setSelectionRange(Number(start + value.length), Number(start + value.length))\r\n\t\t}, 0)\r\n\t}\r\n\r\n\tsetFuncDesc(desc) {\r\n\t\tthis.setState({\r\n\t\t\tfuncDesc: desc\r\n\t\t})\r\n\t}\r\n\r\n\tshowModal() {\r\n\t\tthis.setState({\r\n\t\t\tvisible: true\r\n\t\t});\r\n\t}\r\n\r\n\thandleOk() {\r\n\t\tconst self = this\r\n\r\n\t\tthis.setState({ okLoading: true })\r\n\t\tsetTimeout(() => {\r\n\t\t\tif(this.state.okLoading === true) {\r\n\t\t\t\tthis.setState({ okLoading: false })\r\n\t\t\t\tmessage.error('验证失败') // 网络极慢 or Internal server error\r\n\t\t\t}\r\n\t\t}, 5000)\r\n\r\n\t\tthis.validate({\r\n\t\t\tonSuccess(expr) {\r\n\t\t\t\t//\"expr\":\"STRTOFLOAT(本表单.{EA2846C8-F3AC-AC6E-223A-B40EF0F22633})+STRTOFLOAT(本表单.{1E54AA87-8977-06C0-A965-0D60651DA0A0})\"\r\n\t\t\t\tself.props.formulaData.receiver(self.state.formulaValue, expr)\r\n\t\t\t\tself.props.formulaData.cancel()\r\n\t\t\t},\r\n\t\t\tonFail(msg) {\r\n\t\t\t\tnotification.error({\r\n\t\t\t\t\tmessage: '验证失败',\r\n\t\t\t\t\tdescription: msg,\r\n\t\t\t\t\tduration: 5\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\thandleValidation() {\r\n\t\tthis.setState({ validateLoading: true })\r\n\t\tsetTimeout(() => {\r\n\t\t\tif(this.state.validateLoading === true) {\r\n\t\t\t\tthis.setState({ validateLoading: false })\r\n\t\t\t\tmessage.error('验证失败') // 网络极慢 or Internal server error\r\n\t\t\t}\r\n\t\t}, 5000)\r\n\r\n\t\tthis.validate({\r\n\t\t\tonSuccess() {\r\n\t\t\t\tmessage.success('验证通过')\r\n\t\t\t},\r\n\t\t\tonFail(msg) {\r\n\t\t\t\tnotification.error({\r\n\t\t\t\t\tmessage: '验证失败',\r\n\t\t\t\t\tdescription: msg,\r\n\t\t\t\t\tduration: null\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\tvalidate(opts) {\r\n\r\n\t\t$.post('/general/appbuilder/web/appdesign/appform/checkfunc',\r\n\t\t\t{\r\n\t\t\t\tformId: this.props.formulaData.formId,\r\n\t\t\t\tlogic: this.props.formulaData.logic || false,\r\n\t\t\t\texpr: this.state.formulaValue\r\n\t\t\t},\r\n\t\t\t(response) => {\r\n\t\t\t\tthis.setState({ validateLoading: false, okLoading: false })\r\n\r\n\t\t\t\tif(response.status === 'ok') {\r\n\t\t\t\t\tif(response.data.result === false) {\r\n\t\t\t\t\t\topts.onFail && opts.onFail(response.data.info)\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tlet expr = response.data.expr ? response.data.expr : ''\r\n\t\t\t\t\t\topts.onSuccess && opts.onSuccess(expr)\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t)\r\n\t}\r\n\r\n\thandleCancel(e) {\r\n\t\tthis.props.formulaData.cancel()\r\n\t}\r\n\r\n\trender() {\r\n\t\treturn (\r\n\t\t<div>\r\n\t\t\t<Modal title=\"编辑公式\"\r\n\t\t\t\twidth={1100} bodyStyle={{width:1100,height:480,overflow:'auto'}} style={{top:4}}\r\n\t\t\t\tclassName=\"formula-edit-modal thin-scroll\"\r\n\t\t\t\tvisible={this.state.visible}\r\n\t\t\t\tonOk={this.handleOk.bind(this)}\r\n\t\t\t\tonCancel={this.handleCancel.bind(this)}\r\n\t\t\t\tfooter={[\r\n\t\t\t\t\t<Button key=\"back\" type=\"ghost\" size=\"large\" onClick={this.handleCancel.bind(this)}>取 消</Button>,\r\n          <Button key=\"test\" type=\"ghost\" size=\"large\" loading={this.state.validateLoading} onClick={this.handleValidation.bind(this)}>验 证</Button>,\r\n          <Button key=\"submit\" type=\"primary\" size=\"large\" loading={this.state.okLoading} onClick={this.handleOk.bind(this)}>提 交</Button>\r\n        ]}\r\n\t\t\t>\r\n\t\t\t\t<Row>\r\n\t\t\t\t\t<Col span=\"4\">\r\n\t\t\t\t\t\t<FormulaField formulaData={this.props.formulaData} changeFormulaData={this.changeFormulaData.bind(this)} />\r\n\t\t\t\t\t</Col>\r\n\t\t\t\t\t<Col span=\"14\" className=\"formula-modal-edit-wrap\">\r\n\t\t\t\t\t\t<FormulaEdit\r\n\t\t\t\t\t\t\tvalue={this.state.formulaValue}\r\n\t\t\t\t\t\t\tsetEditingBoard={this.setEditingBoard.bind(this)}\r\n\t\t\t\t\t\t\tsetFormula={this.setFormula.bind(this)} />\r\n\t\t\t\t\t\t<FormulaOprator changeFormulaData={this.changeFormulaData.bind(this)} />\r\n\t\t\t\t\t</Col>\r\n\t\t\t\t\t<Col span=\"6\">\r\n\t\t\t\t\t\t<FunctionList\r\n\t\t\t\t\t\t\tfuncDesc={this.state.funcDesc}\r\n\t\t\t\t\t\t\tsetFuncDesc={this.setFuncDesc.bind(this)}\r\n\t\t\t\t\t\t\tchangeFormulaData={this.changeFormulaData.bind(this)}\r\n\t\t\t\t\t \t/>\r\n\t\t\t\t\t</Col>\r\n\t\t\t\t</Row>\r\n\t\t\t</Modal>\r\n\t\t</div>\r\n\t\t);\r\n\t}\r\n}\r\n\r\n/*\r\nFormula.propTypes = {\r\n\tformulaData: React.PropTypes.shape({\r\n\t\tvalue: React.PropTypes.string.isRequired,\r\n\t\tformId: React.PropTypes.string.isRequired,\r\n\t\tforms: React.PropTypes.string.isRequired,\r\n\t\tlogic: React.PropTypes.bool.isRequired,\r\n\t\treceiver: React.PropTypes.func.isRequired,\r\n\t\tcancel: React.PropTypes.func.isRequired\r\n\t})\r\n}\r\n*/\r\n\r\nexport default Formula\r\n"],"sourceRoot":""}