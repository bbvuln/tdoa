/**
 * jqGrid extension for form editing Grid Data
 * Tony Tomov tony@trirand.com
 * http://trirand.com/blog/
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl-2.0.html
**/
/*global xmlJsonClass, jQuery, $  */
"use strict";
(function($){var D={};$.jgrid.extend({searchGrid:function(p){p=$.extend({recreateFilter:false,drag:true,sField:'searchField',sValue:'searchString',sOper:'searchOper',sFilter:'filters',loadDefaults:true,beforeShowSearch:null,afterShowSearch:null,onInitializeSearch:null,afterRedraw:null,afterChange:null,closeAfterSearch:false,closeAfterReset:false,closeOnEscape:false,searchOnEnter:false,multipleSearch:false,multipleGroup:false,top:0,left:0,jqModal:true,modal:false,resize:true,width:450,height:'auto',dataheight:'auto',showQuery:false,errorcheck:true,sopt:null,stringResult:undefined,onClose:null,onSearch:null,onReset:null,toTop:true,overlay:30,columns:[],tmplNames:null,tmplFilters:null,tmplLabel:' Template: ',showOnLoad:false,layer:null},$.jgrid.search,p||{});return this.each(function(){var b=this;if(!b.grid){return}var c="fbox_"+b.p.id,showFrm=true,IDs={themodal:'searchmod'+c,modalhead:'searchhd'+c,modalcontent:'searchcnt'+c,scrollelm:c},defaultFilters=b.p.postData[p.sFilter];if(typeof(defaultFilters)==="string"){defaultFilters=$.jgrid.parse(defaultFilters)}if(p.recreateFilter===true){$("#"+$.jgrid.jqID(IDs.themodal)).remove()}function showFilter(a){showFrm=$(b).triggerHandler("jqGridFilterBeforeShow",[a]);if(typeof(showFrm)==="undefined"){showFrm=true}if(showFrm&&$.isFunction(p.beforeShowSearch)){showFrm=p.beforeShowSearch.call(b,a)}if(showFrm){$.jgrid.viewModal("#"+$.jgrid.jqID(IDs.themodal),{gbox:"#gbox_"+$.jgrid.jqID(c),jqm:p.jqModal,modal:p.modal,overlay:p.overlay,toTop:p.toTop});$(b).triggerHandler("jqGridFilterAfterShow",[a]);if($.isFunction(p.afterShowSearch)){p.afterShowSearch.call(b,a)}}}if($("#"+$.jgrid.jqID(IDs.themodal)).html()!==null){showFilter($("#fbox_"+$.jgrid.jqID(+b.p.id)))}else{var d=$("<div><div id='"+c+"' class='searchFilter' style='overflow:auto'></div></div>").insertBefore("#gview_"+$.jgrid.jqID(b.p.id)),align="left",butleft="";if(b.p.direction=="rtl"){align="right";butleft=" style='text-align:left'";d.attr("dir","rtl")}var f=$.extend([],b.p.colModel),bS="<a href='javascript:void(0)' id='"+c+"_search' class='fm-button ui-state-default ui-corner-all fm-button-icon-right ui-reset'><span class='ui-icon ui-icon-search'></span>"+p.Find+"</a>",bC="<a href='javascript:void(0)' id='"+c+"_reset' class='fm-button ui-state-default ui-corner-all fm-button-icon-left ui-search'><span class='ui-icon ui-icon-arrowreturnthick-1-w'></span>"+p.Reset+"</a>",bQ="",tmpl="",colnm,found=false,bt,cmi=-1;if(p.showQuery){bQ="<a href='javascript:void(0)' id='"+c+"_query' class='fm-button ui-state-default ui-corner-all fm-button-icon-left'><span class='ui-icon ui-icon-comment'></span>Query</a>"}if(!p.columns.length){$.each(f,function(i,n){if(!n.label){n.label=b.p.colNames[i]}if(!found){var a=(typeof n.search==='undefined')?true:n.search,hidden=(n.hidden===true),ignoreHiding=(n.searchoptions&&n.searchoptions.searchhidden===true);if((ignoreHiding&&a)||(a&&!hidden)){found=true;colnm=n.index||n.name;cmi=i}}})}else{f=p.columns}if((!defaultFilters&&colnm)||p.multipleSearch===false){var g="eq";if(cmi>=0&&f[cmi].searchoptions&&f[cmi].searchoptions.sopt){g=f[cmi].searchoptions.sopt[0]}else if(p.sopt&&p.sopt.length){g=p.sopt[0]}defaultFilters={"groupOp":"AND",rules:[{"field":colnm,"op":g,"data":""}]}}found=false;if(p.tmplNames&&p.tmplNames.length){found=true;tmpl=p.tmplLabel;tmpl+="<select class='ui-template'>";tmpl+="<option value='default'>Default</option>";$.each(p.tmplNames,function(i,n){tmpl+="<option value='"+i+"'>"+n+"</option>"});tmpl+="</select>"}bt="<table class='EditTable' style='border:0px none;margin-top:5px' id='"+c+"_2'><tbody><tr><td colspan='2'><hr class='ui-widget-content' style='margin:1px'/></td></tr><tr><td class='EditButton' style='text-align:"+align+"'>"+bC+tmpl+"</td><td class='EditButton' "+butleft+">"+bQ+bS+"</td></tr></tbody></table>";c=$.jgrid.jqID(c);$("#"+c).jqFilter({columns:f,filter:p.loadDefaults?defaultFilters:null,showQuery:p.showQuery,errorcheck:p.errorcheck,sopt:p.sopt,groupButton:p.multipleGroup,ruleButtons:p.multipleSearch,afterRedraw:p.afterRedraw,_gridsopt:$.jgrid.search.odata,ajaxSelectOptions:b.p.ajaxSelectOptions,groupOps:p.groupOps,onChange:function(){if(this.p.showQuery){$('.query',this).html(this.toUserFriendlyString())}if($.isFunction(p.afterChange)){p.afterChange.call(b,$("#"+c),p)}},direction:b.p.direction});d.append(bt);if(found&&p.tmplFilters&&p.tmplFilters.length){$(".ui-template",d).bind('change',function(){var a=$(this).val();if(a=="default"){$("#"+c).jqFilter('addFilter',defaultFilters)}else{$("#"+c).jqFilter('addFilter',p.tmplFilters[parseInt(a,10)])}return false})}if(p.multipleGroup===true){p.multipleSearch=true}$(b).triggerHandler("jqGridFilterInitialize",[$("#"+c)]);if($.isFunction(p.onInitializeSearch)){p.onInitializeSearch.call(b,$("#"+c))}p.gbox="#gbox_"+c;if(p.layer){$.jgrid.createModal(IDs,d,p,"#gview_"+$.jgrid.jqID(b.p.id),$("#gbox_"+$.jgrid.jqID(b.p.id))[0],"#"+$.jgrid.jqID(p.layer),{position:"relative"})}else{$.jgrid.createModal(IDs,d,p,"#gview_"+$.jgrid.jqID(b.p.id),$("#gbox_"+$.jgrid.jqID(b.p.id))[0])}if(p.searchOnEnter||p.closeOnEscape){$("#"+$.jgrid.jqID(IDs.themodal)).keydown(function(e){var a=$(e.target);if(p.searchOnEnter&&e.which===13&&!a.hasClass('add-group')&&!a.hasClass('add-rule')&&!a.hasClass('delete-group')&&!a.hasClass('delete-rule')&&(!a.hasClass("fm-button")||!a.is("[id$=_query]"))){$("#"+c+"_search").focus().click();return false}if(p.closeOnEscape&&e.which===27){$("#"+$.jgrid.jqID(IDs.modalhead)).find(".ui-jqdialog-titlebar-close").focus().click();return false}})}if(bQ){$("#"+c+"_query").bind('click',function(){$(".queryresult",d).toggle();return false})}if(p.stringResult===undefined){p.stringResult=p.multipleSearch}$("#"+c+"_search").bind('click',function(){var a=$("#"+c),sdata={},res,filters=a.jqFilter('filterData');if(p.errorcheck){a[0].hideError();if(!p.showQuery){a.jqFilter('toSQLString')}if(a[0].p.error){a[0].showError();return false}}if(p.stringResult){try{res=xmlJsonClass.toJson(filters,'','',false)}catch(e){try{res=JSON.stringify(filters)}catch(e2){}}if(typeof(res)==="string"){sdata[p.sFilter]=res;$.each([p.sField,p.sValue,p.sOper],function(){sdata[this]=""})}}else{if(p.multipleSearch){sdata[p.sFilter]=filters;$.each([p.sField,p.sValue,p.sOper],function(){sdata[this]=""})}else{sdata[p.sField]=filters.rules[0].field;sdata[p.sValue]=filters.rules[0].data;sdata[p.sOper]=filters.rules[0].op;sdata[p.sFilter]=""}}b.p.search=true;$.extend(b.p.postData,sdata);$(b).triggerHandler("jqGridFilterSearch");if($.isFunction(p.onSearch)){p.onSearch.call(b)}$(b).trigger("reloadGrid",[{page:1}]);if(p.closeAfterSearch){$.jgrid.hideModal("#"+$.jgrid.jqID(IDs.themodal),{gb:"#gbox_"+$.jgrid.jqID(b.p.id),jqm:p.jqModal,onClose:p.onClose})}return false});$("#"+c+"_reset").bind('click',function(){var a={},fl=$("#"+c);b.p.search=false;if(p.multipleSearch===false){a[p.sField]=a[p.sValue]=a[p.sOper]=""}else{a[p.sFilter]=""}fl[0].resetFilter();if(found){$(".ui-template",d).val("default")}$.extend(b.p.postData,a);$(b).triggerHandler("jqGridFilterReset");if($.isFunction(p.onReset)){p.onReset.call(b)}$(b).trigger("reloadGrid",[{page:1}]);return false});showFilter($("#"+c));$(".fm-button:not(.ui-state-disabled)",d).hover(function(){$(this).addClass('ui-state-hover')},function(){$(this).removeClass('ui-state-hover')})}})},editGridRow:function(C,p){p=$.extend({top:0,left:0,width:300,height:'auto',dataheight:'auto',modal:false,overlay:30,drag:true,resize:true,url:null,mtype:"POST",clearAfterAdd:true,closeAfterEdit:false,reloadAfterSubmit:true,onInitializeForm:null,beforeInitData:null,beforeShowForm:null,afterShowForm:null,beforeSubmit:null,afterSubmit:null,onclickSubmit:null,afterComplete:null,onclickPgButtons:null,afterclickPgButtons:null,editData:{},recreateForm:false,jqModal:true,closeOnEscape:false,addedrow:"first",topinfo:'',bottominfo:'',saveicon:[],closeicon:[],savekey:[false,13],navkeys:[false,38,40],checkOnSubmit:false,checkOnUpdate:false,_savedData:{},processing:false,onClose:null,ajaxEditOptions:{},serializeEditData:null,viewPagerButtons:true},$.jgrid.edit,p||{});D[$(this)[0].p.id]=p;return this.each(function(){var l=this;if(!l.grid||!C){return}var m=l.p.id,frmgr="FrmGrid_"+m,frmtborg="TblGrid_"+m,frmtb="#"+$.jgrid.jqID(frmtborg),IDs={themodal:'editmod'+m,modalhead:'edithd'+m,modalcontent:'editcnt'+m,scrollelm:frmgr},onBeforeShow=$.isFunction(D[l.p.id].beforeShowForm)?D[l.p.id].beforeShowForm:false,onAfterShow=$.isFunction(D[l.p.id].afterShowForm)?D[l.p.id].afterShowForm:false,onBeforeInit=$.isFunction(D[l.p.id].beforeInitData)?D[l.p.id].beforeInitData:false,onInitializeForm=$.isFunction(D[l.p.id].onInitializeForm)?D[l.p.id].onInitializeForm:false,showFrm=true,maxCols=1,maxRows=0,postdata,extpost,newData,diff,frmoper;frmgr=$.jgrid.jqID(frmgr);if(C==="new"){C="_empty";frmoper="add";p.caption=D[l.p.id].addCaption}else{p.caption=D[l.p.id].editCaption;frmoper="edit"}if(p.recreateForm===true&&$("#"+$.jgrid.jqID(IDs.themodal)).html()!==null){$("#"+$.jgrid.jqID(IDs.themodal)).remove()}var o=true;if(p.checkOnUpdate&&p.jqModal&&!p.modal){o=false}function getFormData(){$(frmtb+" > tbody > tr > td > .FormElement").each(function(){var b=$(".customelement",this);if(b.length){var c=b[0],nm=$(c).attr('name');$.each(l.p.colModel,function(){if(this.name===nm&&this.editoptions&&$.isFunction(this.editoptions.custom_value)){try{postdata[nm]=this.editoptions.custom_value.call(l,$("#"+$.jgrid.jqID(nm),frmtb),'get');if(postdata[nm]===undefined){throw"e1";}}catch(e){if(e==="e1"){$.jgrid.info_dialog(jQuery.jgrid.errors.errcap,"function 'custom_value' "+$.jgrid.edit.msg.novalue,jQuery.jgrid.edit.bClose)}else{$.jgrid.info_dialog(jQuery.jgrid.errors.errcap,e.message,jQuery.jgrid.edit.bClose)}}return true}})}else{switch($(this).get(0).type){case"checkbox":if($(this).is(":checked")){postdata[this.name]=$(this).val()}else{var d=$(this).attr("offval");postdata[this.name]=d}break;case"select-one":postdata[this.name]=$("option:selected",this).val();extpost[this.name]=$("option:selected",this).text();break;case"select-multiple":postdata[this.name]=$(this).val();if(postdata[this.name]){postdata[this.name]=postdata[this.name].join(",")}else{postdata[this.name]=""}var f=[];$("option:selected",this).each(function(i,a){f[i]=$(a).text()});extpost[this.name]=f.join(",");break;case"password":case"text":case"textarea":case"button":postdata[this.name]=$(this).val();break}if(l.p.autoencode){postdata[this.name]=$.jgrid.htmlEncode(postdata[this.name])}}});return true}function createData(c,d,e,f){var g,hc,trdata,cnt=0,tmp,dc,elc,retpos=[],ind=false,tdtmpl="<td class='CaptionTD'>&#160;</td><td class='DataTD'>&#160;</td>",tmpl="",i;for(i=1;i<=f;i++){tmpl+=tdtmpl}if(c!='_empty'){ind=$(d).jqGrid("getInd",c)}$(d.p.colModel).each(function(i){g=this.name;if(this.editrules&&this.editrules.edithidden===true){hc=false}else{hc=this.hidden===true?true:false}dc=hc?"style='display:none'":"";if(g!=='cb'&&g!=='subgrid'&&this.editable===true&&g!=='rn'){if(ind===false){tmp=""}else{if(g==d.p.ExpandColumn&&d.p.treeGrid===true){tmp=$("td:eq("+i+")",d.rows[ind]).text()}else{try{tmp=$.unformat.call(d,$("td:eq("+i+")",d.rows[ind]),{rowId:c,colModel:this},i)}catch(_){tmp=(this.edittype&&this.edittype=="textarea")?$("td:eq("+i+")",d.rows[ind]).text():$("td:eq("+i+")",d.rows[ind]).html()}if(!tmp||tmp=="&nbsp;"||tmp=="&#160;"||(tmp.length==1&&tmp.charCodeAt(0)==160)){tmp=''}}}var a=$.extend({},this.editoptions||{},{id:g,name:g}),frmopt=$.extend({},{elmprefix:'',elmsuffix:'',rowabove:false,rowcontent:''},this.formoptions||{}),rp=parseInt(frmopt.rowpos,10)||cnt+1,cp=parseInt((parseInt(frmopt.colpos,10)||1)*2,10);if(c=="_empty"&&a.defaultValue){tmp=$.isFunction(a.defaultValue)?a.defaultValue.call(l):a.defaultValue}if(!this.edittype){this.edittype="text"}if(l.p.autoencode){tmp=$.jgrid.htmlDecode(tmp)}elc=$.jgrid.createEl.call(l,this.edittype,a,tmp,false,$.extend({},$.jgrid.ajaxOptions,d.p.ajaxSelectOptions||{}));if(tmp===""&&this.edittype=="checkbox"){tmp=$(elc).attr("offval")}if(tmp===""&&this.edittype=="select"){tmp=$("option:eq(0)",elc).text()}if(D[l.p.id].checkOnSubmit||D[l.p.id].checkOnUpdate){D[l.p.id]._savedData[g]=tmp}$(elc).addClass("FormElement");if(this.edittype=='text'||this.edittype=='textarea'){$(elc).addClass("ui-widget-content ui-corner-all")}trdata=$(e).find("tr[rowpos="+rp+"]");if(frmopt.rowabove){var b=$("<tr><td class='contentinfo' colspan='"+(f*2)+"'>"+frmopt.rowcontent+"</td></tr>");$(e).append(b);b[0].rp=rp}if(trdata.length===0){trdata=$("<tr "+dc+" rowpos='"+rp+"'></tr>").addClass("FormData").attr("id","tr_"+g);$(trdata).append(tmpl);$(e).append(trdata);trdata[0].rp=rp}$("td:eq("+(cp-2)+")",trdata[0]).html(typeof frmopt.label==='undefined'?d.p.colNames[i]:frmopt.label);$("td:eq("+(cp-1)+")",trdata[0]).append(frmopt.elmprefix).append(elc).append(frmopt.elmsuffix);retpos[cnt]=i;cnt++}});if(cnt>0){var h=$("<tr class='FormData' style='display:none'><td class='CaptionTD'></td><td colspan='"+(f*2-1)+"' class='DataTD'><input class='FormElement' id='id_g' type='text' name='"+d.p.id+"_id' value='"+c+"'/></td></tr>");h[0].rp=cnt+999;$(e).append(h);if(D[l.p.id].checkOnSubmit||D[l.p.id].checkOnUpdate){D[l.p.id]._savedData[d.p.id+"_id"]=c}}return retpos}function fillData(c,d,f){var g,cnt=0,tmp,fld,opt,vl,vlc;if(D[l.p.id].checkOnSubmit||D[l.p.id].checkOnUpdate){D[l.p.id]._savedData={};D[l.p.id]._savedData[d.p.id+"_id"]=c}var h=d.p.colModel;if(c=='_empty'){$(h).each(function(){g=this.name;opt=$.extend({},this.editoptions||{});fld=$("#"+$.jgrid.jqID(g),"#"+f);if(fld&&fld.length&&fld[0]!==null){vl="";if(opt.defaultValue){vl=$.isFunction(opt.defaultValue)?opt.defaultValue.call(l):opt.defaultValue;if(fld[0].type=='checkbox'){vlc=vl.toLowerCase();if(vlc.search(/(false|0|no|off|undefined)/i)<0&&vlc!==""){fld[0].checked=true;fld[0].defaultChecked=true;fld[0].value=vl}else{fld[0].checked=false;fld[0].defaultChecked=false}}else{fld.val(vl)}}else{if(fld[0].type=='checkbox'){fld[0].checked=false;fld[0].defaultChecked=false;vl=$(fld).attr("offval")}else if(fld[0].type&&fld[0].type.substr(0,6)=='select'){fld[0].selectedIndex=0}else{fld.val(vl)}}if(D[l.p.id].checkOnSubmit===true||D[l.p.id].checkOnUpdate){D[l.p.id]._savedData[g]=vl}}});$("#id_g","#"+f).val(c);return}var j=$(d).jqGrid("getInd",c,true);if(!j){return}$('td[role="gridcell"]',j).each(function(i){g=h[i].name;if(g!=='cb'&&g!=='subgrid'&&g!=='rn'&&h[i].editable===true){if(g==d.p.ExpandColumn&&d.p.treeGrid===true){tmp=$(this).text()}else{try{tmp=$.unformat.call(d,$(this),{rowId:c,colModel:h[i]},i)}catch(_){tmp=h[i].edittype=="textarea"?$(this).text():$(this).html()}}if(l.p.autoencode){tmp=$.jgrid.htmlDecode(tmp)}if(D[l.p.id].checkOnSubmit===true||D[l.p.id].checkOnUpdate){D[l.p.id]._savedData[g]=tmp}g=$.jgrid.jqID(g);switch(h[i].edittype){case"password":case"text":case"button":case"image":case"textarea":if(tmp=="&nbsp;"||tmp=="&#160;"||(tmp.length==1&&tmp.charCodeAt(0)==160)){tmp=''}$("#"+g,"#"+f).val(tmp);break;case"select":var a=tmp.split(",");a=$.map(a,function(n){return $.trim(n)});$("#"+g+" option","#"+f).each(function(){if(!h[i].editoptions.multiple&&($.trim(tmp)==$.trim($(this).text())||a[0]==$.trim($(this).text())||a[0]==$.trim($(this).val()))){this.selected=true}else if(h[i].editoptions.multiple){if($.inArray($.trim($(this).text()),a)>-1||$.inArray($.trim($(this).val()),a)>-1){this.selected=true}else{this.selected=false}}else{this.selected=false}});break;case"checkbox":tmp=tmp+"";if(h[i].editoptions&&h[i].editoptions.value){var b=h[i].editoptions.value.split(":");if(b[0]==tmp){$("#"+g,"#"+f)[l.p.useProp?'prop':'attr']("checked",true);$("#"+g,"#"+f)[l.p.useProp?'prop':'attr']("defaultChecked",true)}else{$("#"+g,"#"+f)[l.p.useProp?'prop':'attr']("checked",false);$("#"+g,"#"+f)[l.p.useProp?'prop':'attr']("defaultChecked",false)}}else{tmp=tmp.toLowerCase();if(tmp.search(/(false|0|no|off|undefined)/i)<0&&tmp!==""){$("#"+g,"#"+f)[l.p.useProp?'prop':'attr']("checked",true);$("#"+g,"#"+f)[l.p.useProp?'prop':'attr']("defaultChecked",true)}else{$("#"+g,"#"+f)[l.p.useProp?'prop':'attr']("checked",false);$("#"+g,"#"+f)[l.p.useProp?'prop':'attr']("defaultChecked",false)}}break;case'custom':try{if(h[i].editoptions&&$.isFunction(h[i].editoptions.custom_value)){h[i].editoptions.custom_value.call(l,$("#"+g,"#"+f),'set',tmp)}else{throw"e1";}}catch(e){if(e=="e1"){$.jgrid.info_dialog(jQuery.jgrid.errors.errcap,"function 'custom_value' "+$.jgrid.edit.msg.nodefined,jQuery.jgrid.edit.bClose)}else{$.jgrid.info_dialog(jQuery.jgrid.errors.errcap,e.message,jQuery.jgrid.edit.bClose)}}break}cnt++}});if(cnt>0){$("#id_g",frmtb).val(c)}}function setNulls(){$.each(l.p.colModel,function(i,n){if(n.editoptions&&n.editoptions.NullIfEmpty===true){if(postdata.hasOwnProperty(n.name)&&postdata[n.name]===""){postdata[n.name]='null'}}})}function postIt(){var d,ret=[true,"",""],onCS={},opers=l.p.prmNames,idname,oper,key,selr,i;var f=$(l).triggerHandler("jqGridAddEditBeforeCheckValues",[$("#"+frmgr),frmoper]);if(f&&typeof(f)==='object'){postdata=f}if($.isFunction(D[l.p.id].beforeCheckValues)){f=D[l.p.id].beforeCheckValues.call(l,postdata,$("#"+frmgr),postdata[l.p.id+"_id"]=="_empty"?opers.addoper:opers.editoper);if(f&&typeof(f)==='object'){postdata=f}}for(key in postdata){if(postdata.hasOwnProperty(key)){ret=$.jgrid.checkValues.call(l,postdata[key],key,l);if(ret[0]===false){break}}}setNulls();if(ret[0]){onCS=$(l).triggerHandler("jqGridAddEditClickSubmit",[D[l.p.id],postdata,frmoper]);if(onCS===undefined&&$.isFunction(D[l.p.id].onclickSubmit)){onCS=D[l.p.id].onclickSubmit.call(l,D[l.p.id],postdata)||{}}ret=$(l).triggerHandler("jqGridAddEditBeforeSubmit",[postdata,$("#"+frmgr),frmoper]);if(ret===undefined){ret=[true,"",""]}if(ret[0]&&$.isFunction(D[l.p.id].beforeSubmit)){ret=D[l.p.id].beforeSubmit.call(l,postdata,$("#"+frmgr))}}if(ret[0]&&!D[l.p.id].processing){D[l.p.id].processing=true;$("#sData",frmtb+"_2").addClass('ui-state-active');oper=opers.oper;idname=opers.id;postdata[oper]=($.trim(postdata[l.p.id+"_id"])=="_empty")?opers.addoper:opers.editoper;if(postdata[oper]!=opers.addoper){postdata[idname]=postdata[l.p.id+"_id"]}else{if(postdata[idname]===undefined){postdata[idname]=postdata[l.p.id+"_id"]}}delete postdata[l.p.id+"_id"];postdata=$.extend(postdata,D[l.p.id].editData,onCS);if(l.p.treeGrid===true){if(postdata[oper]==opers.addoper){selr=$(l).jqGrid("getGridParam",'selrow');var g=l.p.treeGridModel=='adjacency'?l.p.treeReader.parent_id_field:'parent_id';postdata[g]=selr}for(i in l.p.treeReader){if(l.p.treeReader.hasOwnProperty(i)){var h=l.p.treeReader[i];if(postdata.hasOwnProperty(h)){if(postdata[oper]==opers.addoper&&i==='parent_id_field'){continue}delete postdata[h]}}}}postdata[idname]=$.jgrid.stripPref(l.p.idPrefix,postdata[idname]);var j=$.extend({url:D[l.p.id].url?D[l.p.id].url:$(l).jqGrid('getGridParam','editurl'),type:D[l.p.id].mtype,data:$.isFunction(D[l.p.id].serializeEditData)?D[l.p.id].serializeEditData.call(l,postdata):postdata,complete:function(a,b){postdata[idname]=l.p.idPrefix+postdata[idname];if(b!="success"){ret[0]=false;ret[1]=$(l).triggerHandler("jqGridAddEditErrorTextFormat",[a,frmoper]);if($.isFunction(D[l.p.id].errorTextFormat)){ret[1]=D[l.p.id].errorTextFormat.call(l,a)}else{ret[1]=b+" Status: '"+a.statusText+"'. Error code: "+a.status}}else{ret=$(l).triggerHandler("jqGridAddEditAfterSubmit",[a,postdata,frmoper]);if(ret===undefined){ret=[true,"",""]}if(ret[0]&&$.isFunction(D[l.p.id].afterSubmit)){ret=D[l.p.id].afterSubmit.call(l,a,postdata)}}if(ret[0]===false){$("#FormError>td",frmtb).html(ret[1]);$("#FormError",frmtb).show()}else{$.each(l.p.colModel,function(){if(extpost[this.name]&&this.formatter&&this.formatter=='select'){try{delete extpost[this.name]}catch(e){}}});postdata=$.extend(postdata,extpost);if(l.p.autoencode){$.each(postdata,function(n,v){postdata[n]=$.jgrid.htmlDecode(v)})}if(postdata[oper]==opers.addoper){if(!ret[2]){ret[2]=$.jgrid.randId()}postdata[idname]=ret[2];if(D[l.p.id].closeAfterAdd){if(D[l.p.id].reloadAfterSubmit){$(l).trigger("reloadGrid")}else{if(l.p.treeGrid===true){$(l).jqGrid("addChildNode",ret[2],selr,postdata)}else{$(l).jqGrid("addRowData",ret[2],postdata,p.addedrow);$(l).jqGrid("setSelection",ret[2])}}$.jgrid.hideModal("#"+$.jgrid.jqID(IDs.themodal),{gb:"#gbox_"+$.jgrid.jqID(m),jqm:p.jqModal,onClose:D[l.p.id].onClose})}else if(D[l.p.id].clearAfterAdd){if(D[l.p.id].reloadAfterSubmit){$(l).trigger("reloadGrid")}else{if(l.p.treeGrid===true){$(l).jqGrid("addChildNode",ret[2],selr,postdata)}else{$(l).jqGrid("addRowData",ret[2],postdata,p.addedrow)}}fillData("_empty",l,frmgr)}else{if(D[l.p.id].reloadAfterSubmit){$(l).trigger("reloadGrid")}else{if(l.p.treeGrid===true){$(l).jqGrid("addChildNode",ret[2],selr,postdata)}else{$(l).jqGrid("addRowData",ret[2],postdata,p.addedrow)}}}}else{if(D[l.p.id].reloadAfterSubmit){$(l).trigger("reloadGrid");if(!D[l.p.id].closeAfterEdit){setTimeout(function(){$(l).jqGrid("setSelection",postdata[idname])},1000)}}else{if(l.p.treeGrid===true){$(l).jqGrid("setTreeRow",postdata[idname],postdata)}else{$(l).jqGrid("setRowData",postdata[idname],postdata)}}if(D[l.p.id].closeAfterEdit){$.jgrid.hideModal("#"+$.jgrid.jqID(IDs.themodal),{gb:"#gbox_"+$.jgrid.jqID(m),jqm:p.jqModal,onClose:D[l.p.id].onClose})}}if($.isFunction(D[l.p.id].afterComplete)){d=a;setTimeout(function(){$(l).triggerHandler("jqGridAddEditAfterComplete",[d,postdata,$("#"+frmgr),frmoper]);D[l.p.id].afterComplete.call(l,d,postdata,$("#"+frmgr));d=null},500)}if(D[l.p.id].checkOnSubmit||D[l.p.id].checkOnUpdate){$("#"+frmgr).data("disabled",false);if(D[l.p.id]._savedData[l.p.id+"_id"]!="_empty"){for(var c in D[l.p.id]._savedData){if(postdata[c]){D[l.p.id]._savedData[c]=postdata[c]}}}}}D[l.p.id].processing=false;$("#sData",frmtb+"_2").removeClass('ui-state-active');try{$(':input:visible',"#"+frmgr)[0].focus()}catch(e){}}},$.jgrid.ajaxOptions,D[l.p.id].ajaxEditOptions);if(!j.url&&!D[l.p.id].useDataProxy){if($.isFunction(l.p.dataProxy)){D[l.p.id].useDataProxy=true}else{ret[0]=false;ret[1]+=" "+$.jgrid.errors.nourl}}if(ret[0]){if(D[l.p.id].useDataProxy){var k=l.p.dataProxy.call(l,j,"set_"+l.p.id);if(typeof(k)=="undefined"){k=[true,""]}if(k[0]===false){ret[0]=false;ret[1]=k[1]||"Error deleting the selected row!"}else{if(j.data.oper==opers.addoper&&D[l.p.id].closeAfterAdd){$.jgrid.hideModal("#"+$.jgrid.jqID(IDs.themodal),{gb:"#gbox_"+$.jgrid.jqID(m),jqm:p.jqModal,onClose:D[l.p.id].onClose})}if(j.data.oper==opers.editoper&&D[l.p.id].closeAfterEdit){$.jgrid.hideModal("#"+$.jgrid.jqID(IDs.themodal),{gb:"#gbox_"+$.jgrid.jqID(m),jqm:p.jqModal,onClose:D[l.p.id].onClose})}}}else{$.ajax(j)}}}if(ret[0]===false){$("#FormError>td",frmtb).html(ret[1]);$("#FormError",frmtb).show()}}function compareData(a,b){var c=false,key;for(key in a){if(a[key]!=b[key]){c=true;break}}return c}function checkUpdates(){var a=true;$("#FormError",frmtb).hide();if(D[l.p.id].checkOnUpdate){postdata={};extpost={};getFormData();newData=$.extend({},postdata,extpost);diff=compareData(newData,D[l.p.id]._savedData);if(diff){$("#"+frmgr).data("disabled",true);$(".confirm","#"+IDs.themodal).show();a=false}}return a}function restoreInline(){if(C!=="_empty"&&typeof(l.p.savedRow)!=="undefined"&&l.p.savedRow.length>0&&$.isFunction($.fn.jqGrid.restoreRow)){for(var i=0;i<l.p.savedRow.length;i++){if(l.p.savedRow[i].id==C){$(l).jqGrid('restoreRow',C);break}}}}function updateNav(a,b){if(a===0){$("#pData",frmtb+"_2").addClass('ui-state-disabled')}else{$("#pData",frmtb+"_2").removeClass('ui-state-disabled')}if(a==b){$("#nData",frmtb+"_2").addClass('ui-state-disabled')}else{$("#nData",frmtb+"_2").removeClass('ui-state-disabled')}}function getCurrPos(){var a=$(l).jqGrid("getDataIDs"),selrow=$("#id_g",frmtb).val(),pos=$.inArray(selrow,a);return[pos,a]}if($("#"+$.jgrid.jqID(IDs.themodal)).html()!==null){showFrm=$(l).triggerHandler("jqGridAddEditBeforeInitData",[$("#"+$.jgrid.jqID(frmgr))]);if(typeof(showFrm)=="undefined"){showFrm=true}if(showFrm&&onBeforeInit){showFrm=onBeforeInit.call(l,$("#"+frmgr))}if(showFrm===false){return}restoreInline();$(".ui-jqdialog-title","#"+$.jgrid.jqID(IDs.modalhead)).html(p.caption);$("#FormError",frmtb).hide();if(D[l.p.id].topinfo){$(".topinfo",frmtb).html(D[l.p.id].topinfo);$(".tinfo",frmtb).show()}else{$(".tinfo",frmtb).hide()}if(D[l.p.id].bottominfo){$(".bottominfo",frmtb+"_2").html(D[l.p.id].bottominfo);$(".binfo",frmtb+"_2").show()}else{$(".binfo",frmtb+"_2").hide()}fillData(C,l,frmgr);if(C=="_empty"||!D[l.p.id].viewPagerButtons){$("#pData, #nData",frmtb+"_2").hide()}else{$("#pData, #nData",frmtb+"_2").show()}if(D[l.p.id].processing===true){D[l.p.id].processing=false;$("#sData",frmtb+"_2").removeClass('ui-state-active')}if($("#"+frmgr).data("disabled")===true){$(".confirm","#"+$.jgrid.jqID(IDs.themodal)).hide();$("#"+frmgr).data("disabled",false)}$(l).triggerHandler("jqGridAddEditBeforeShowForm",[$("#"+frmgr),frmoper]);if(onBeforeShow){onBeforeShow.call(l,$("#"+frmgr))}$("#"+$.jgrid.jqID(IDs.themodal)).data("onClose",D[l.p.id].onClose);$.jgrid.viewModal("#"+$.jgrid.jqID(IDs.themodal),{gbox:"#gbox_"+$.jgrid.jqID(m),jqm:p.jqModal,jqM:false,overlay:p.overlay,modal:p.modal});if(!o){$(".jqmOverlay").click(function(){if(!checkUpdates()){return false}$.jgrid.hideModal("#"+$.jgrid.jqID(IDs.themodal),{gb:"#gbox_"+$.jgrid.jqID(m),jqm:p.jqModal,onClose:D[l.p.id].onClose});return false})}$(l).triggerHandler("jqGridAddEditAfterShowForm",[$("#"+frmgr),frmoper]);if(onAfterShow){onAfterShow.call(l,$("#"+frmgr))}}else{var q=isNaN(p.dataheight)?p.dataheight:p.dataheight+"px",frm=$("<form name='FormPost' id='"+frmgr+"' class='FormGrid' onSubmit='return false;' style='width:100%;overflow:auto;position:relative;height:"+q+";'></form>").data("disabled",false),tbl=$("<table id='"+frmtborg+"' class='EditTable' cellspacing='0' cellpadding='0' border='0'><tbody></tbody></table>");showFrm=$(l).triggerHandler("jqGridAddEditBeforeInitData",[$("#"+frmgr),frmoper]);if(typeof(showFrm)=="undefined"){showFrm=true}if(showFrm&&onBeforeInit){showFrm=onBeforeInit.call(l,$("#"+frmgr))}if(showFrm===false){return}restoreInline();$(l.p.colModel).each(function(){var a=this.formoptions;maxCols=Math.max(maxCols,a?a.colpos||0:0);maxRows=Math.max(maxRows,a?a.rowpos||0:0)});$(frm).append(tbl);var s=$("<tr id='FormError' style='display:none'><td class='ui-state-error' colspan='"+(maxCols*2)+"'></td></tr>");s[0].rp=0;$(tbl).append(s);s=$("<tr style='display:none' class='tinfo'><td class='topinfo' colspan='"+(maxCols*2)+"'>"+D[l.p.id].topinfo+"</td></tr>");s[0].rp=0;$(tbl).append(s);var t=l.p.direction=="rtl"?true:false,bp=t?"nData":"pData",bn=t?"pData":"nData";createData(C,l,tbl,maxCols);var u="<a href='javascript:void(0)' id='"+bp+"' class='fm-button ui-state-default ui-corner-left'><span class='ui-icon ui-icon-triangle-1-w'></span></a>",bN="<a href='javascript:void(0)' id='"+bn+"' class='fm-button ui-state-default ui-corner-right'><span class='ui-icon ui-icon-triangle-1-e'></span></a>",bS="<a href='javascript:void(0)' id='sData' class='fm-button ui-state-default ui-corner-all'>"+p.bSubmit+"</a>",bC="<a href='javascript:void(0)' id='cData' class='fm-button ui-state-default ui-corner-all'>"+p.bCancel+"</a>";var w="<table border='0' cellspacing='0' cellpadding='0' class='EditTable' id='"+frmtborg+"_2'><tbody><tr><td colspan='2'><hr class='ui-widget-content' style='margin:1px'/></td></tr><tr id='Act_Buttons'><td class='navButton'>"+(t?bN+u:u+bN)+"</td><td class='EditButton'>"+bS+bC+"</td></tr>";w+="<tr style='display:none' class='binfo'><td class='bottominfo' colspan='2'>"+D[l.p.id].bottominfo+"</td></tr>";w+="</tbody></table>";if(maxRows>0){var x=[];$.each($(tbl)[0].rows,function(i,r){x[i]=r});x.sort(function(a,b){if(a.rp>b.rp){return 1}if(a.rp<b.rp){return-1}return 0});$.each(x,function(a,b){$('tbody',tbl).append(b)})}p.gbox="#gbox_"+$.jgrid.jqID(m);var y=false;if(p.closeOnEscape===true){p.closeOnEscape=false;y=true}var z=$("<span></span>").append(frm).append(w);$.jgrid.createModal(IDs,z,p,"#gview_"+$.jgrid.jqID(l.p.id),$("#gbox_"+$.jgrid.jqID(l.p.id))[0]);if(t){$("#pData, #nData",frmtb+"_2").css("float","right");$(".EditButton",frmtb+"_2").css("text-align","left")}if(D[l.p.id].topinfo){$(".tinfo",frmtb).show()}if(D[l.p.id].bottominfo){$(".binfo",frmtb+"_2").show()}z=null;w=null;$("#"+$.jgrid.jqID(IDs.themodal)).keydown(function(e){var a=e.target;if($("#"+frmgr).data("disabled")===true){return false}if(D[l.p.id].savekey[0]===true&&e.which==D[l.p.id].savekey[1]){if(a.tagName!="TEXTAREA"){$("#sData",frmtb+"_2").trigger("click");return false}}if(e.which===27){if(!checkUpdates()){return false}if(y){$.jgrid.hideModal(this,{gb:p.gbox,jqm:p.jqModal,onClose:D[l.p.id].onClose})}return false}if(D[l.p.id].navkeys[0]===true){if($("#id_g",frmtb).val()=="_empty"){return true}if(e.which==D[l.p.id].navkeys[1]){$("#pData",frmtb+"_2").trigger("click");return false}if(e.which==D[l.p.id].navkeys[2]){$("#nData",frmtb+"_2").trigger("click");return false}}});if(p.checkOnUpdate){$("a.ui-jqdialog-titlebar-close span","#"+$.jgrid.jqID(IDs.themodal)).removeClass("jqmClose");$("a.ui-jqdialog-titlebar-close","#"+$.jgrid.jqID(IDs.themodal)).unbind("click").click(function(){if(!checkUpdates()){return false}$.jgrid.hideModal("#"+$.jgrid.jqID(IDs.themodal),{gb:"#gbox_"+$.jgrid.jqID(m),jqm:p.jqModal,onClose:D[l.p.id].onClose});return false})}p.saveicon=$.extend([true,"left","ui-icon-disk"],p.saveicon);p.closeicon=$.extend([true,"left","ui-icon-close"],p.closeicon);if(p.saveicon[0]===true){$("#sData",frmtb+"_2").addClass(p.saveicon[1]=="right"?'fm-button-icon-right':'fm-button-icon-left').append("<span class='ui-icon "+p.saveicon[2]+"'></span>")}if(p.closeicon[0]===true){$("#cData",frmtb+"_2").addClass(p.closeicon[1]=="right"?'fm-button-icon-right':'fm-button-icon-left').append("<span class='ui-icon "+p.closeicon[2]+"'></span>")}if(D[l.p.id].checkOnSubmit||D[l.p.id].checkOnUpdate){bS="<a href='javascript:void(0)' id='sNew' class='fm-button ui-state-default ui-corner-all' style='z-index:1002'>"+p.bYes+"</a>";bN="<a href='javascript:void(0)' id='nNew' class='fm-button ui-state-default ui-corner-all' style='z-index:1002'>"+p.bNo+"</a>";bC="<a href='javascript:void(0)' id='cNew' class='fm-button ui-state-default ui-corner-all' style='z-index:1002'>"+p.bExit+"</a>";var A,zI=p.zIndex||999;zI++;if($.browser.msie&&$.browser.version==6){A='<iframe style="display:block;position:absolute;z-index:-1;filter:Alpha(Opacity=\'0\');" src="javascript:false;"></iframe>'}else{A=""}$("<div class='ui-widget-overlay jqgrid-overlay confirm' style='z-index:"+zI+";display:none;'>&#160;"+A+"</div><div class='confirm ui-widget-content ui-jqconfirm' style='z-index:"+(zI+1)+"'>"+p.saveData+"<br/><br/>"+bS+bN+bC+"</div>").insertAfter("#"+frmgr);$("#sNew","#"+$.jgrid.jqID(IDs.themodal)).click(function(){postIt();$("#"+frmgr).data("disabled",false);$(".confirm","#"+$.jgrid.jqID(IDs.themodal)).hide();return false});$("#nNew","#"+$.jgrid.jqID(IDs.themodal)).click(function(){$(".confirm","#"+$.jgrid.jqID(IDs.themodal)).hide();$("#"+frmgr).data("disabled",false);setTimeout(function(){$(":input","#"+frmgr)[0].focus()},0);return false});$("#cNew","#"+$.jgrid.jqID(IDs.themodal)).click(function(){$(".confirm","#"+$.jgrid.jqID(IDs.themodal)).hide();$("#"+frmgr).data("disabled",false);$.jgrid.hideModal("#"+$.jgrid.jqID(IDs.themodal),{gb:"#gbox_"+$.jgrid.jqID(m),jqm:p.jqModal,onClose:D[l.p.id].onClose});return false})}$(l).triggerHandler("jqGridAddEditInitializeForm",[$("#"+frmgr),frmoper]);if(onInitializeForm){onInitializeForm.call(l,$("#"+frmgr))}if(C=="_empty"||!D[l.p.id].viewPagerButtons){$("#pData,#nData",frmtb+"_2").hide()}else{$("#pData,#nData",frmtb+"_2").show()}$(l).triggerHandler("jqGridAddEditBeforeShowForm",[$("#"+frmgr),frmoper]);if(onBeforeShow){onBeforeShow.call(l,$("#"+frmgr))}$("#"+$.jgrid.jqID(IDs.themodal)).data("onClose",D[l.p.id].onClose);$.jgrid.viewModal("#"+$.jgrid.jqID(IDs.themodal),{gbox:"#gbox_"+$.jgrid.jqID(m),jqm:p.jqModal,overlay:p.overlay,modal:p.modal});if(!o){$(".jqmOverlay").click(function(){if(!checkUpdates()){return false}$.jgrid.hideModal("#"+$.jgrid.jqID(IDs.themodal),{gb:"#gbox_"+$.jgrid.jqID(m),jqm:p.jqModal,onClose:D[l.p.id].onClose});return false})}$(l).triggerHandler("jqGridAddEditAfterShowForm",[$("#"+frmgr),frmoper]);if(onAfterShow){onAfterShow.call(l,$("#"+frmgr))}$(".fm-button","#"+$.jgrid.jqID(IDs.themodal)).hover(function(){$(this).addClass('ui-state-hover')},function(){$(this).removeClass('ui-state-hover')});$("#sData",frmtb+"_2").click(function(){postdata={};extpost={};$("#FormError",frmtb).hide();getFormData();if(postdata[l.p.id+"_id"]=="_empty"){postIt()}else if(p.checkOnSubmit===true){newData=$.extend({},postdata,extpost);diff=compareData(newData,D[l.p.id]._savedData);if(diff){$("#"+frmgr).data("disabled",true);$(".confirm","#"+$.jgrid.jqID(IDs.themodal)).show()}else{postIt()}}else{postIt()}return false});$("#cData",frmtb+"_2").click(function(){if(!checkUpdates()){return false}$.jgrid.hideModal("#"+$.jgrid.jqID(IDs.themodal),{gb:"#gbox_"+$.jgrid.jqID(m),jqm:p.jqModal,onClose:D[l.p.id].onClose});return false});$("#nData",frmtb+"_2").click(function(){if(!checkUpdates()){return false}$("#FormError",frmtb).hide();var a=getCurrPos();a[0]=parseInt(a[0],10);if(a[0]!=-1&&a[1][a[0]+1]){$(l).triggerHandler("jqGridAddEditClickPgButtons",['next',$("#"+frmgr),a[1][a[0]]]);if($.isFunction(p.onclickPgButtons)){p.onclickPgButtons.call(l,'next',$("#"+frmgr),a[1][a[0]])}fillData(a[1][a[0]+1],l,frmgr);$(l).jqGrid("setSelection",a[1][a[0]+1]);$(l).triggerHandler("jqGridAddEditAfterClickPgButtons",['next',$("#"+frmgr),a[1][a[0]]]);if($.isFunction(p.afterclickPgButtons)){p.afterclickPgButtons.call(l,'next',$("#"+frmgr),a[1][a[0]+1])}updateNav(a[0]+1,a[1].length-1)}return false});$("#pData",frmtb+"_2").click(function(){if(!checkUpdates()){return false}$("#FormError",frmtb).hide();var a=getCurrPos();if(a[0]!=-1&&a[1][a[0]-1]){$(l).triggerHandler("jqGridAddEditClickPgButtons",['prev',$("#"+frmgr),a[1][a[0]]]);if($.isFunction(p.onclickPgButtons)){p.onclickPgButtons.call(l,'prev',$("#"+frmgr),a[1][a[0]])}fillData(a[1][a[0]-1],l,frmgr);$(l).jqGrid("setSelection",a[1][a[0]-1]);$(l).triggerHandler("jqGridAddEditAfterClickPgButtons",['prev',$("#"+frmgr),a[1][a[0]]]);if($.isFunction(p.afterclickPgButtons)){p.afterclickPgButtons.call(l,'prev',$("#"+frmgr),a[1][a[0]-1])}updateNav(a[0]-1,a[1].length-1)}return false})}var B=getCurrPos();updateNav(B[0],B[1].length-1)})},viewGridRow:function(u,p){p=$.extend({top:0,left:0,width:0,height:'auto',dataheight:'auto',modal:false,overlay:30,drag:true,resize:true,jqModal:true,closeOnEscape:false,labelswidth:'30%',closeicon:[],navkeys:[false,38,40],onClose:null,beforeShowForm:null,beforeInitData:null,viewPagerButtons:true},$.jgrid.view,p||{});return this.each(function(){var j=this;if(!j.grid||!u){return}var k=j.p.id,frmgr="ViewGrid_"+$.jgrid.jqID(k),frmtb="ViewTbl_"+$.jgrid.jqID(k),frmgr_id="ViewGrid_"+k,frmtb_id="ViewTbl_"+k,IDs={themodal:'viewmod'+k,modalhead:'viewhd'+k,modalcontent:'viewcnt'+k,scrollelm:frmgr},onBeforeInit=$.isFunction(p.beforeInitData)?p.beforeInitData:false,showFrm=true,maxCols=1,maxRows=0;function focusaref(){if(p.closeOnEscape===true||p.navkeys[0]===true){setTimeout(function(){$(".ui-jqdialog-titlebar-close","#"+$.jgrid.jqID(IDs.modalhead)).focus()},0)}}function createData(c,d,e,f){var g,hc,trdata,cnt=0,tmp,dc,retpos=[],ind=false,tdtmpl="<td class='CaptionTD form-view-label ui-widget-content' width='"+p.labelswidth+"'>&#160;</td><td class='DataTD form-view-data ui-helper-reset ui-widget-content'>&#160;</td>",tmpl="",tdtmpl2="<td class='CaptionTD form-view-label ui-widget-content'>&#160;</td><td class='DataTD form-view-data ui-widget-content'>&#160;</td>",fmtnum=['integer','number','currency'],max1=0,max2=0,maxw,setme,viewfld;for(var i=1;i<=f;i++){tmpl+=i==1?tdtmpl:tdtmpl2}$(d.p.colModel).each(function(){if(this.editrules&&this.editrules.edithidden===true){hc=false}else{hc=this.hidden===true?true:false}if(!hc&&this.align==='right'){if(this.formatter&&$.inArray(this.formatter,fmtnum)!==-1){max1=Math.max(max1,parseInt(this.width,10))}else{max2=Math.max(max2,parseInt(this.width,10))}}});maxw=max1!==0?max1:max2!==0?max2:0;ind=$(d).jqGrid("getInd",c);$(d.p.colModel).each(function(i){g=this.name;setme=false;if(this.editrules&&this.editrules.edithidden===true){hc=false}else{hc=this.hidden===true?true:false}dc=hc?"style='display:none'":"";viewfld=(typeof this.viewable!='boolean')?true:this.viewable;if(g!=='cb'&&g!=='subgrid'&&g!=='rn'&&viewfld){if(ind===false){tmp=""}else{if(g==d.p.ExpandColumn&&d.p.treeGrid===true){tmp=$("td:eq("+i+")",d.rows[ind]).text()}else{tmp=$("td:eq("+i+")",d.rows[ind]).html()}}setme=this.align==='right'&&maxw!==0?true:false;var a=$.extend({},this.editoptions||{},{id:g,name:g}),frmopt=$.extend({},{rowabove:false,rowcontent:''},this.formoptions||{}),rp=parseInt(frmopt.rowpos,10)||cnt+1,cp=parseInt((parseInt(frmopt.colpos,10)||1)*2,10);if(frmopt.rowabove){var b=$("<tr><td class='contentinfo' colspan='"+(f*2)+"'>"+frmopt.rowcontent+"</td></tr>");$(e).append(b);b[0].rp=rp}trdata=$(e).find("tr[rowpos="+rp+"]");if(trdata.length===0){trdata=$("<tr "+dc+" rowpos='"+rp+"'></tr>").addClass("FormData").attr("id","trv_"+g);$(trdata).append(tmpl);$(e).append(trdata);trdata[0].rp=rp}$("td:eq("+(cp-2)+")",trdata[0]).html('<b>'+(typeof frmopt.label==='undefined'?d.p.colNames[i]:frmopt.label)+'</b>');$("td:eq("+(cp-1)+")",trdata[0]).append("<span>"+tmp+"</span>").attr("id","v_"+g);if(setme){$("td:eq("+(cp-1)+") span",trdata[0]).css({'text-align':'right',width:maxw+"px"})}retpos[cnt]=i;cnt++}});if(cnt>0){var h=$("<tr class='FormData' style='display:none'><td class='CaptionTD'></td><td colspan='"+(f*2-1)+"' class='DataTD'><input class='FormElement' id='id_g' type='text' name='id' value='"+c+"'/></td></tr>");h[0].rp=cnt+99;$(e).append(h)}return retpos}function fillData(a,b){var c,hc,cnt=0,tmp,opt,trv;trv=$(b).jqGrid("getInd",a,true);if(!trv){return}$('td',trv).each(function(i){c=b.p.colModel[i].name;if(b.p.colModel[i].editrules&&b.p.colModel[i].editrules.edithidden===true){hc=false}else{hc=b.p.colModel[i].hidden===true?true:false}if(c!=='cb'&&c!=='subgrid'&&c!=='rn'){if(c==b.p.ExpandColumn&&b.p.treeGrid===true){tmp=$(this).text()}else{tmp=$(this).html()}opt=$.extend({},b.p.colModel[i].editoptions||{});c=$.jgrid.jqID("v_"+c);$("#"+c+" span","#"+frmtb).html(tmp);if(hc){$("#"+c,"#"+frmtb).parents("tr:first").hide()}cnt++}});if(cnt>0){$("#id_g","#"+frmtb).val(a)}}function updateNav(a,b){if(a===0){$("#pData","#"+frmtb+"_2").addClass('ui-state-disabled')}else{$("#pData","#"+frmtb+"_2").removeClass('ui-state-disabled')}if(a==b){$("#nData","#"+frmtb+"_2").addClass('ui-state-disabled')}else{$("#nData","#"+frmtb+"_2").removeClass('ui-state-disabled')}}function getCurrPos(){var a=$(j).jqGrid("getDataIDs"),selrow=$("#id_g","#"+frmtb).val(),pos=$.inArray(selrow,a);return[pos,a]}if($("#"+$.jgrid.jqID(IDs.themodal)).html()!==null){if(onBeforeInit){showFrm=onBeforeInit.call(j,$("#"+frmgr));if(typeof(showFrm)=="undefined"){showFrm=true}}if(showFrm===false){return}$(".ui-jqdialog-title","#"+$.jgrid.jqID(IDs.modalhead)).html(p.caption);$("#FormError","#"+frmtb).hide();fillData(u,j);if($.isFunction(p.beforeShowForm)){p.beforeShowForm.call(j,$("#"+frmgr))}$.jgrid.viewModal("#"+$.jgrid.jqID(IDs.themodal),{gbox:"#gbox_"+$.jgrid.jqID(k),jqm:p.jqModal,jqM:false,overlay:p.overlay,modal:p.modal});focusaref()}else{var l=isNaN(p.dataheight)?p.dataheight:p.dataheight+"px";var m=$("<form name='FormPost' id='"+frmgr_id+"' class='FormGrid' style='width:100%;overflow:auto;position:relative;height:"+l+";'></form>"),tbl=$("<table id='"+frmtb_id+"' class='EditTable' cellspacing='1' cellpadding='2' border='0' style='table-layout:fixed'><tbody></tbody></table>");if(onBeforeInit){showFrm=onBeforeInit.call(j,$("#"+frmgr));if(typeof(showFrm)=="undefined"){showFrm=true}}if(showFrm===false){return}$(j.p.colModel).each(function(){var a=this.formoptions;maxCols=Math.max(maxCols,a?a.colpos||0:0);maxRows=Math.max(maxRows,a?a.rowpos||0:0)});$(m).append(tbl);createData(u,j,tbl,maxCols);var n=j.p.direction=="rtl"?true:false,bp=n?"nData":"pData",bn=n?"pData":"nData",bP="<a href='javascript:void(0)' id='"+bp+"' class='fm-button ui-state-default ui-corner-left'><span class='ui-icon ui-icon-triangle-1-w'></span></a>",bN="<a href='javascript:void(0)' id='"+bn+"' class='fm-button ui-state-default ui-corner-right'><span class='ui-icon ui-icon-triangle-1-e'></span></a>",bC="<a href='javascript:void(0)' id='cData' class='fm-button ui-state-default ui-corner-all'>"+p.bClose+"</a>";if(maxRows>0){var o=[];$.each($(tbl)[0].rows,function(i,r){o[i]=r});o.sort(function(a,b){if(a.rp>b.rp){return 1}if(a.rp<b.rp){return-1}return 0});$.each(o,function(a,b){$('tbody',tbl).append(b)})}p.gbox="#gbox_"+$.jgrid.jqID(k);var q=false;if(p.closeOnEscape===true){p.closeOnEscape=false;q=true}var s=$("<span></span>").append(m).append("<table border='0' class='EditTable' id='"+frmtb+"_2'><tbody><tr id='Act_Buttons'><td class='navButton' width='"+p.labelswidth+"'>"+(n?bN+bP:bP+bN)+"</td><td class='EditButton'>"+bC+"</td></tr></tbody></table>");$.jgrid.createModal(IDs,s,p,"#gview_"+$.jgrid.jqID(j.p.id),$("#gview_"+$.jgrid.jqID(j.p.id))[0]);if(n){$("#pData, #nData","#"+frmtb+"_2").css("float","right");$(".EditButton","#"+frmtb+"_2").css("text-align","left")}if(!p.viewPagerButtons){$("#pData, #nData","#"+frmtb+"_2").hide()}s=null;$("#"+IDs.themodal).keydown(function(e){if(e.which===27){if(q){$.jgrid.hideModal(this,{gb:p.gbox,jqm:p.jqModal,onClose:p.onClose})}return false}if(p.navkeys[0]===true){if(e.which===p.navkeys[1]){$("#pData","#"+frmtb+"_2").trigger("click");return false}if(e.which===p.navkeys[2]){$("#nData","#"+frmtb+"_2").trigger("click");return false}}});p.closeicon=$.extend([true,"left","ui-icon-close"],p.closeicon);if(p.closeicon[0]===true){$("#cData","#"+frmtb+"_2").addClass(p.closeicon[1]=="right"?'fm-button-icon-right':'fm-button-icon-left').append("<span class='ui-icon "+p.closeicon[2]+"'></span>")}if($.isFunction(p.beforeShowForm)){p.beforeShowForm.call(j,$("#"+frmgr))}$.jgrid.viewModal("#"+$.jgrid.jqID(IDs.themodal),{gbox:"#gbox_"+$.jgrid.jqID(k),jqm:p.jqModal,modal:p.modal});$(".fm-button:not(.ui-state-disabled)","#"+frmtb+"_2").hover(function(){$(this).addClass('ui-state-hover')},function(){$(this).removeClass('ui-state-hover')});focusaref();$("#cData","#"+frmtb+"_2").click(function(){$.jgrid.hideModal("#"+$.jgrid.jqID(IDs.themodal),{gb:"#gbox_"+$.jgrid.jqID(k),jqm:p.jqModal,onClose:p.onClose});return false});$("#nData","#"+frmtb+"_2").click(function(){$("#FormError","#"+frmtb).hide();var a=getCurrPos();a[0]=parseInt(a[0],10);if(a[0]!=-1&&a[1][a[0]+1]){if($.isFunction(p.onclickPgButtons)){p.onclickPgButtons.call(j,'next',$("#"+frmgr),a[1][a[0]])}fillData(a[1][a[0]+1],j);$(j).jqGrid("setSelection",a[1][a[0]+1]);if($.isFunction(p.afterclickPgButtons)){p.afterclickPgButtons.call(j,'next',$("#"+frmgr),a[1][a[0]+1])}updateNav(a[0]+1,a[1].length-1)}focusaref();return false});$("#pData","#"+frmtb+"_2").click(function(){$("#FormError","#"+frmtb).hide();var a=getCurrPos();if(a[0]!=-1&&a[1][a[0]-1]){if($.isFunction(p.onclickPgButtons)){p.onclickPgButtons.call(j,'prev',$("#"+frmgr),a[1][a[0]])}fillData(a[1][a[0]-1],j);$(j).jqGrid("setSelection",a[1][a[0]-1]);if($.isFunction(p.afterclickPgButtons)){p.afterclickPgButtons.call(j,'prev',$("#"+frmgr),a[1][a[0]-1])}updateNav(a[0]-1,a[1].length-1)}focusaref();return false})}var t=getCurrPos();updateNav(t[0],t[1].length-1)})},delGridRow:function(o,p){p=$.extend({top:0,left:0,width:240,height:'auto',dataheight:'auto',modal:false,overlay:30,drag:true,resize:true,url:'',mtype:"POST",reloadAfterSubmit:true,beforeShowForm:null,beforeInitData:null,afterShowForm:null,beforeSubmit:null,onclickSubmit:null,afterSubmit:null,jqModal:true,closeOnEscape:false,delData:{},delicon:[],cancelicon:[],onClose:null,ajaxDelOptions:{},processing:false,serializeDelData:null,useDataProxy:false},$.jgrid.del,p||{});D[$(this)[0].p.id]=p;return this.each(function(){var j=this;if(!j.grid){return}if(!o){return}var k=$.isFunction(D[j.p.id].beforeShowForm),onAfterShow=$.isFunction(D[j.p.id].afterShowForm),onBeforeInit=$.isFunction(D[j.p.id].beforeInitData)?D[j.p.id].beforeInitData:false,gID=j.p.id,onCS={},showFrm=true,dtbl="DelTbl_"+$.jgrid.jqID(gID),postd,idname,opers,oper,dtbl_id="DelTbl_"+gID,IDs={themodal:'delmod'+gID,modalhead:'delhd'+gID,modalcontent:'delcnt'+gID,scrollelm:dtbl};if(jQuery.isArray(o)){o=o.join()}if($("#"+$.jgrid.jqID(IDs.themodal)).html()!==null){if(onBeforeInit){showFrm=onBeforeInit.call(j,$("#"+dtbl));if(typeof(showFrm)=="undefined"){showFrm=true}}if(showFrm===false){return}$("#DelData>td","#"+dtbl).text(o);$("#DelError","#"+dtbl).hide();if(D[j.p.id].processing===true){D[j.p.id].processing=false;$("#dData","#"+dtbl).removeClass('ui-state-active')}if(k){D[j.p.id].beforeShowForm.call(j,$("#"+dtbl))}$.jgrid.viewModal("#"+$.jgrid.jqID(IDs.themodal),{gbox:"#gbox_"+$.jgrid.jqID(gID),jqm:D[j.p.id].jqModal,jqM:false,overlay:D[j.p.id].overlay,modal:D[j.p.id].modal});if(onAfterShow){D[j.p.id].afterShowForm.call(j,$("#"+dtbl))}}else{var l=isNaN(D[j.p.id].dataheight)?D[j.p.id].dataheight:D[j.p.id].dataheight+"px";var m="<div id='"+dtbl_id+"' class='formdata' style='width:100%;overflow:auto;position:relative;height:"+l+";'>";m+="<table class='DelTable'><tbody>";m+="<tr id='DelError' style='display:none'><td class='ui-state-error'></td></tr>";m+="<tr id='DelData' style='display:none'><td >"+o+"</td></tr>";m+="<tr><td class=\"delmsg\" style=\"white-space:pre;\">"+D[j.p.id].msg+"</td></tr><tr><td >&#160;</td></tr>";m+="</tbody></table></div>";var n="<a href='javascript:void(0)' id='dData' class='fm-button ui-state-default ui-corner-all'>"+p.bSubmit+"</a>",bC="<a href='javascript:void(0)' id='eData' class='fm-button ui-state-default ui-corner-all'>"+p.bCancel+"</a>";m+="<table cellspacing='0' cellpadding='0' border='0' class='EditTable' id='"+dtbl+"_2'><tbody><tr><td><hr class='ui-widget-content' style='margin:1px'/></td></tr><tr><td class='DelButton EditButton'>"+n+"&#160;"+bC+"</td></tr></tbody></table>";p.gbox="#gbox_"+$.jgrid.jqID(gID);$.jgrid.createModal(IDs,m,p,"#gview_"+$.jgrid.jqID(j.p.id),$("#gview_"+$.jgrid.jqID(j.p.id))[0]);if(onBeforeInit){showFrm=onBeforeInit.call(j,$("#"+dtbl));if(typeof(showFrm)=="undefined"){showFrm=true}}if(showFrm===false){return}$(".fm-button","#"+dtbl+"_2").hover(function(){$(this).addClass('ui-state-hover')},function(){$(this).removeClass('ui-state-hover')});p.delicon=$.extend([true,"left","ui-icon-scissors"],D[j.p.id].delicon);p.cancelicon=$.extend([true,"left","ui-icon-cancel"],D[j.p.id].cancelicon);if(p.delicon[0]===true){$("#dData","#"+dtbl+"_2").addClass(p.delicon[1]=="right"?'fm-button-icon-right':'fm-button-icon-left').append("<span class='ui-icon "+p.delicon[2]+"'></span>")}if(p.cancelicon[0]===true){$("#eData","#"+dtbl+"_2").addClass(p.cancelicon[1]=="right"?'fm-button-icon-right':'fm-button-icon-left').append("<span class='ui-icon "+p.cancelicon[2]+"'></span>")}$("#dData","#"+dtbl+"_2").click(function(){var c=[true,""];onCS={};var d=$("#DelData>td","#"+dtbl).text();if($.isFunction(D[j.p.id].onclickSubmit)){onCS=D[j.p.id].onclickSubmit.call(j,D[j.p.id],d)||{}}if($.isFunction(D[j.p.id].beforeSubmit)){c=D[j.p.id].beforeSubmit.call(j,d)}if(c[0]&&!D[j.p.id].processing){D[j.p.id].processing=true;opers=j.p.prmNames;postd=$.extend({},D[j.p.id].delData,onCS);oper=opers.oper;postd[oper]=opers.deloper;idname=opers.id;d=String(d).split(",");if(!d.length){return false}for(var f in d){if(d.hasOwnProperty(f)){d[f]=$.jgrid.stripPref(j.p.idPrefix,d[f])}}postd[idname]=d.join();$(this).addClass('ui-state-active');var g=$.extend({url:D[j.p.id].url?D[j.p.id].url:$(j).jqGrid('getGridParam','editurl'),type:D[j.p.id].mtype,data:$.isFunction(D[j.p.id].serializeDelData)?D[j.p.id].serializeDelData.call(j,postd):postd,complete:function(a,b){if(b!="success"){c[0]=false;if($.isFunction(D[j.p.id].errorTextFormat)){c[1]=D[j.p.id].errorTextFormat.call(j,a)}else{c[1]=b+" Status: '"+a.statusText+"'. Error code: "+a.status}}else{if($.isFunction(D[j.p.id].afterSubmit)){c=D[j.p.id].afterSubmit.call(j,a,postd)}}if(c[0]===false){$("#DelError>td","#"+dtbl).html(c[1]);$("#DelError","#"+dtbl).show()}else{if(D[j.p.id].reloadAfterSubmit&&j.p.datatype!="local"){$(j).trigger("reloadGrid")}else{if(j.p.treeGrid===true){try{$(j).jqGrid("delTreeNode",j.p.idPrefix+d[0])}catch(e){}}else{for(var i=0;i<d.length;i++){$(j).jqGrid("delRowData",j.p.idPrefix+d[i])}}j.p.selrow=null;j.p.selarrrow=[]}if($.isFunction(D[j.p.id].afterComplete)){setTimeout(function(){D[j.p.id].afterComplete.call(j,a,d)},500)}}D[j.p.id].processing=false;$("#dData","#"+dtbl+"_2").removeClass('ui-state-active');if(c[0]){$.jgrid.hideModal("#"+$.jgrid.jqID(IDs.themodal),{gb:"#gbox_"+$.jgrid.jqID(gID),jqm:p.jqModal,onClose:D[j.p.id].onClose})}}},$.jgrid.ajaxOptions,D[j.p.id].ajaxDelOptions);if(!g.url&&!D[j.p.id].useDataProxy){if($.isFunction(j.p.dataProxy)){D[j.p.id].useDataProxy=true}else{c[0]=false;c[1]+=" "+$.jgrid.errors.nourl}}if(c[0]){if(D[j.p.id].useDataProxy){var h=j.p.dataProxy.call(j,g,"del_"+j.p.id);if(typeof(h)=="undefined"){h=[true,""]}if(h[0]===false){c[0]=false;c[1]=h[1]||"Error deleting the selected row!"}else{$.jgrid.hideModal("#"+$.jgrid.jqID(IDs.themodal),{gb:"#gbox_"+$.jgrid.jqID(gID),jqm:p.jqModal,onClose:D[j.p.id].onClose})}}else{$.ajax(g)}}}if(c[0]===false){$("#DelError>td","#"+dtbl).html(c[1]);$("#DelError","#"+dtbl).show()}return false});$("#eData","#"+dtbl+"_2").click(function(){$.jgrid.hideModal("#"+$.jgrid.jqID(IDs.themodal),{gb:"#gbox_"+$.jgrid.jqID(gID),jqm:D[j.p.id].jqModal,onClose:D[j.p.id].onClose});return false});if(k){D[j.p.id].beforeShowForm.call(j,$("#"+dtbl))}$.jgrid.viewModal("#"+$.jgrid.jqID(IDs.themodal),{gbox:"#gbox_"+$.jgrid.jqID(gID),jqm:D[j.p.id].jqModal,overlay:D[j.p.id].overlay,modal:D[j.p.id].modal});if(onAfterShow){D[j.p.id].afterShowForm.call(j,$("#"+dtbl))}}if(D[j.p.id].closeOnEscape===true){setTimeout(function(){$(".ui-jqdialog-titlebar-close","#"+$.jgrid.jqID(IDs.modalhead)).focus()},0)}})},navGrid:function(f,o,g,h,j,k,l){o=$.extend({edit:true,editicon:"ui-icon-pencil",add:true,addicon:"ui-icon-plus",del:true,delicon:"ui-icon-trash",search:true,searchicon:"ui-icon-search",refresh:true,refreshicon:"ui-icon-refresh",refreshstate:'firstpage',view:false,viewicon:"ui-icon-document",position:"left",closeOnEscape:true,beforeRefresh:null,afterRefresh:null,cloneToTop:false,alertwidth:200,alertheight:'auto',alerttop:null,alertleft:null,alertzIndex:null},$.jgrid.nav,o||{});return this.each(function(){if(this.nav){return}var b={themodal:'alertmod',modalhead:'alerthd',modalcontent:'alertcnt'},$t=this,twd,tdw;if(!$t.grid||typeof f!='string'){return}if($("#"+b.themodal).html()===null){if(!o.alerttop&&!o.alertleft){if(typeof window.innerWidth!='undefined'){o.alertleft=window.innerWidth;o.alerttop=window.innerHeight}else if(typeof document.documentElement!='undefined'&&typeof document.documentElement.clientWidth!='undefined'&&document.documentElement.clientWidth!==0){o.alertleft=document.documentElement.clientWidth;o.alerttop=document.documentElement.clientHeight}else{o.alertleft=1024;o.alerttop=768}o.alertleft=o.alertleft/2-parseInt(o.alertwidth,10)/2;o.alerttop=o.alerttop/2-25}$.jgrid.createModal(b,"<div>"+o.alerttext+"</div><span tabindex='0'><span tabindex='-1' id='jqg_alrt'></span></span>",{gbox:"#gbox_"+$.jgrid.jqID($t.p.id),jqModal:true,drag:true,resize:true,caption:o.alertcap,top:o.alerttop,left:o.alertleft,width:o.alertwidth,height:o.alertheight,closeOnEscape:o.closeOnEscape,zIndex:o.alertzIndex},"","",true)}var c=1;if(o.cloneToTop&&$t.p.toppager){c=2}for(var i=0;i<c;i++){var d,navtbl=$("<table cellspacing='0' cellpadding='0' border='0' class='ui-pg-table navtable' style='float:left;table-layout:auto;'><tbody><tr></tr></tbody></table>"),sep="<td class='ui-pg-button ui-state-disabled' style='width:4px;'><span class='ui-separator'></span></td>",pgid,elemids;if(i===0){pgid=f;elemids=$t.p.id;if(pgid==$t.p.toppager){elemids+="_top";c=1}}else{pgid=$t.p.toppager;elemids=$t.p.id+"_top"}if($t.p.direction=="rtl"){$(navtbl).attr("dir","rtl").css("float","right")}if(o.add){h=h||{};d=$("<td class='ui-pg-button ui-corner-all'></td>");$(d).append("<div class='ui-pg-div'><span class='ui-icon "+o.addicon+"'></span>"+o.addtext+"</div>");$("tr",navtbl).append(d);$(d,navtbl).attr({"title":o.addtitle||"",id:h.id||"add_"+elemids}).click(function(){if(!$(this).hasClass('ui-state-disabled')){if($.isFunction(o.addfunc)){o.addfunc.call($t)}else{$($t).jqGrid("editGridRow","new",h)}}return false}).hover(function(){if(!$(this).hasClass('ui-state-disabled')){$(this).addClass("ui-state-hover")}},function(){$(this).removeClass("ui-state-hover")});d=null}if(o.edit){d=$("<td class='ui-pg-button ui-corner-all'></td>");g=g||{};$(d).append("<div class='ui-pg-div'><span class='ui-icon "+o.editicon+"'></span>"+o.edittext+"</div>");$("tr",navtbl).append(d);$(d,navtbl).attr({"title":o.edittitle||"",id:g.id||"edit_"+elemids}).click(function(){if(!$(this).hasClass('ui-state-disabled')){var a=$t.p.selrow;if(a){if($.isFunction(o.editfunc)){o.editfunc.call($t,a)}else{$($t).jqGrid("editGridRow",a,g)}}else{$.jgrid.viewModal("#"+b.themodal,{gbox:"#gbox_"+$.jgrid.jqID($t.p.id),jqm:true});$("#jqg_alrt").focus()}}return false}).hover(function(){if(!$(this).hasClass('ui-state-disabled')){$(this).addClass("ui-state-hover")}},function(){$(this).removeClass("ui-state-hover")});d=null}if(o.view){d=$("<td class='ui-pg-button ui-corner-all'></td>");l=l||{};$(d).append("<div class='ui-pg-div'><span class='ui-icon "+o.viewicon+"'></span>"+o.viewtext+"</div>");$("tr",navtbl).append(d);$(d,navtbl).attr({"title":o.viewtitle||"",id:l.id||"view_"+elemids}).click(function(){if(!$(this).hasClass('ui-state-disabled')){var a=$t.p.selrow;if(a){if($.isFunction(o.viewfunc)){o.viewfunc.call($t,a)}else{$($t).jqGrid("viewGridRow",a,l)}}else{$.jgrid.viewModal("#"+b.themodal,{gbox:"#gbox_"+$.jgrid.jqID($t.p.id),jqm:true});$("#jqg_alrt").focus()}}return false}).hover(function(){if(!$(this).hasClass('ui-state-disabled')){$(this).addClass("ui-state-hover")}},function(){$(this).removeClass("ui-state-hover")});d=null}if(o.del){d=$("<td class='ui-pg-button ui-corner-all'></td>");j=j||{};$(d).append("<div class='ui-pg-div'><span class='ui-icon "+o.delicon+"'></span>"+o.deltext+"</div>");$("tr",navtbl).append(d);$(d,navtbl).attr({"title":o.deltitle||"",id:j.id||"del_"+elemids}).click(function(){if(!$(this).hasClass('ui-state-disabled')){var a;if($t.p.multiselect){a=$t.p.selarrrow;if(a.length===0){a=null}}else{a=$t.p.selrow}if(a){if($.isFunction(o.delfunc)){o.delfunc.call($t,a)}else{$($t).jqGrid("delGridRow",a,j)}}else{$.jgrid.viewModal("#"+b.themodal,{gbox:"#gbox_"+$.jgrid.jqID($t.p.id),jqm:true});$("#jqg_alrt").focus()}}return false}).hover(function(){if(!$(this).hasClass('ui-state-disabled')){$(this).addClass("ui-state-hover")}},function(){$(this).removeClass("ui-state-hover")});d=null}if(o.add||o.edit||o.del||o.view){$("tr",navtbl).append(sep)}if(o.search){d=$("<td class='ui-pg-button ui-corner-all'></td>");k=k||{};$(d).append("<div class='ui-pg-div'><span class='ui-icon "+o.searchicon+"'></span>"+o.searchtext+"</div>");$("tr",navtbl).append(d);$(d,navtbl).attr({"title":o.searchtitle||"",id:k.id||"search_"+elemids}).click(function(){if(!$(this).hasClass('ui-state-disabled')){if($.isFunction(o.searchfunc)){o.searchfunc.call($t,k)}else{$($t).jqGrid("searchGrid",k)}}return false}).hover(function(){if(!$(this).hasClass('ui-state-disabled')){$(this).addClass("ui-state-hover")}},function(){$(this).removeClass("ui-state-hover")});if(k.showOnLoad&&k.showOnLoad===true){$(d,navtbl).click()}d=null}if(o.refresh){d=$("<td class='ui-pg-button ui-corner-all'></td>");$(d).append("<div class='ui-pg-div'><span class='ui-icon "+o.refreshicon+"'></span>"+o.refreshtext+"</div>");$("tr",navtbl).append(d);$(d,navtbl).attr({"title":o.refreshtitle||"",id:"refresh_"+elemids}).click(function(){if(!$(this).hasClass('ui-state-disabled')){if($.isFunction(o.beforeRefresh)){o.beforeRefresh.call($t)}$t.p.search=false;try{var a=$t.p.id;$t.p.postData.filters="";$("#fbox_"+$.jgrid.jqID(a)).jqFilter('resetFilter');if($.isFunction($t.clearToolbar)){$t.clearToolbar.call($t,false)}}catch(e){}switch(o.refreshstate){case'firstpage':$($t).trigger("reloadGrid",[{page:1}]);break;case'current':$($t).trigger("reloadGrid",[{current:true}]);break}if($.isFunction(o.afterRefresh)){o.afterRefresh.call($t)}}return false}).hover(function(){if(!$(this).hasClass('ui-state-disabled')){$(this).addClass("ui-state-hover")}},function(){$(this).removeClass("ui-state-hover")});d=null}tdw=$(".ui-jqgrid").css("font-size")||"11px";$('body').append("<div id='testpg2' class='ui-jqgrid ui-widget ui-widget-content' style='font-size:"+tdw+";visibility:hidden;' ></div>");twd=$(navtbl).clone().appendTo("#testpg2").width();$("#testpg2").remove();$(pgid+"_"+o.position,pgid).append(navtbl);if($t.p._nvtd){if(twd>$t.p._nvtd[0]){$(pgid+"_"+o.position,pgid).width(twd);$t.p._nvtd[0]=twd}$t.p._nvtd[1]=twd}tdw=null;twd=null;navtbl=null;this.nav=true}})},navButtonAdd:function(c,p){p=$.extend({caption:"newButton",title:'',buttonicon:'ui-icon-newwin',onClickButton:null,position:"last",cursor:'pointer'},p||{});return this.each(function(){if(!this.grid){return}if(typeof c==="string"&&c.indexOf("#")!==0){c="#"+$.jgrid.jqID(c)}var a=$(".navtable",c)[0],$t=this;if(a){if(p.id&&$("#"+$.jgrid.jqID(p.id),a).html()!==null){return}var b=$("<td></td>");if(p.buttonicon.toString().toUpperCase()=="NONE"){$(b).addClass('ui-pg-button ui-corner-all').append("<div class='ui-pg-div'>"+p.caption+"</div>")}else{$(b).addClass('ui-pg-button ui-corner-all').append("<div class='ui-pg-div'><span class='ui-icon "+p.buttonicon+"'></span>"+p.caption+"</div>")}if(p.id){$(b).attr("id",p.id)}if(p.position=='first'){if(a.rows[0].cells.length===0){$("tr",a).append(b)}else{$("tr td:eq(0)",a).before(b)}}else{$("tr",a).append(b)}$(b,a).attr("title",p.title||"").click(function(e){if(!$(this).hasClass('ui-state-disabled')){if($.isFunction(p.onClickButton)){p.onClickButton.call($t,e)}}return false}).hover(function(){if(!$(this).hasClass('ui-state-disabled')){$(this).addClass('ui-state-hover')}},function(){$(this).removeClass("ui-state-hover")})}})},navSeparatorAdd:function(c,p){p=$.extend({sepclass:"ui-separator",sepcontent:''},p||{});return this.each(function(){if(!this.grid){return}if(typeof c==="string"&&c.indexOf("#")!==0){c="#"+$.jgrid.jqID(c)}var a=$(".navtable",c)[0];if(a){var b="<td class='ui-pg-button ui-state-disabled' style='width:4px;'><span class='"+p.sepclass+"'></span>"+p.sepcontent+"</td>";$("tr",a).append(b)}})},GridToForm:function(c,d){return this.each(function(){var a=this;if(!a.grid){return}var b=$(a).jqGrid("getRowData",c);if(b){for(var i in b){if($("[name="+$.jgrid.jqID(i)+"]",d).is("input:radio")||$("[name="+$.jgrid.jqID(i)+"]",d).is("input:checkbox")){$("[name="+$.jgrid.jqID(i)+"]",d).each(function(){if($(this).val()==b[i]){$(this)[a.p.useProp?'prop':'attr']("checked",true)}else{$(this)[a.p.useProp?'prop':'attr']("checked",false)}})}else{$("[name="+$.jgrid.jqID(i)+"]",d).val(b[i])}}}})},FormToGrid:function(e,f,g,h){return this.each(function(){var b=this;if(!b.grid){return}if(!g){g='set'}if(!h){h='first'}var c=$(f).serializeArray();var d={};$.each(c,function(i,a){d[a.name]=a.value});if(g=='add'){$(b).jqGrid("addRowData",e,d,h)}else if(g=='set'){$(b).jqGrid("setRowData",e,d)}})}})})(jQuery);
