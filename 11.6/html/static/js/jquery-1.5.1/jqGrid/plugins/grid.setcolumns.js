/**
 * jqGrid extension for manipulating columns properties
 * Piotr Roznicki roznicki@o2.pl
 * http://www.roznicki.prv.pl
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl-2.0.html
**/
;(function($){$.jgrid.extend({setColumns:function(p){p=$.extend({top:0,left:0,width:200,height:'auto',dataheight:'auto',modal:false,drag:true,beforeShowForm:null,afterShowForm:null,afterSubmitForm:null,closeOnEscape:true,ShrinkToFit:false,jqModal:false,saveicon:[true,"left","ui-icon-disk"],closeicon:[true,"left","ui-icon-close"],onClose:null,colnameview:true,closeAfterSubmit:true,updateAfterCheck:false,recreateForm:false},$.jgrid.col,p||{});return this.each(function(){var b=this;if(!b.grid){return}var c=typeof p.beforeShowForm==='function'?true:false;var d=typeof p.afterShowForm==='function'?true:false;var f=typeof p.afterSubmitForm==='function'?true:false;var g=b.p.id,dtbl="ColTbl_"+g,IDs={themodal:'colmod'+g,modalhead:'colhd'+g,modalcontent:'colcnt'+g,scrollelm:dtbl};if(p.recreateForm===true&&$("#"+IDs.themodal).html()!=null){$("#"+IDs.themodal).remove()}if($("#"+IDs.themodal).html()!=null){if(c){p.beforeShowForm($("#"+dtbl))}$.jgrid.viewModal("#"+IDs.themodal,{gbox:"#gbox_"+g,jqm:p.jqModal,jqM:false,modal:p.modal});if(d){p.afterShowForm($("#"+dtbl))}}else{var h=isNaN(p.dataheight)?p.dataheight:p.dataheight+"px";var j="<div id='"+dtbl+"' class='formdata' style='width:100%;overflow:auto;position:relative;height:"+h+";'>";j+="<table class='ColTable' cellspacing='1' cellpading='2' border='0'><tbody>";for(i=0;i<this.p.colNames.length;i++){if(!b.p.colModel[i].hidedlg){j+="<tr><td style='white-space: pre;'><input type='checkbox' style='margin-right:5px;' id='col_"+this.p.colModel[i].name+"' class='cbox' value='T' "+((this.p.colModel[i].hidden===false)?"checked":"")+"/>"+"<label for='col_"+this.p.colModel[i].name+"'>"+this.p.colNames[i]+((p.colnameview)?" ("+this.p.colModel[i].name+")":"")+"</label></td></tr>"}}j+="</tbody></table></div>"var k=!p.updateAfterCheck?"<a href='javascript:void(0)' id='dData' class='fm-button ui-state-default ui-corner-all'>"+p.bSubmit+"</a>":"",bC="<a href='javascript:void(0)' id='eData' class='fm-button ui-state-default ui-corner-all'>"+p.bCancel+"</a>";j+="<table border='0' class='EditTable' id='"+dtbl+"_2'><tbody><tr style='display:block;height:3px;'><td></td></tr><tr><td class='DataTD ui-widget-content'></td></tr><tr><td class='ColButton EditButton'>"+k+"&#160;"+bC+"</td></tr></tbody></table>";p.gbox="#gbox_"+g;$.jgrid.createModal(IDs,j,p,"#gview_"+b.p.id,$("#gview_"+b.p.id)[0]);if(p.saveicon[0]==true){$("#dData","#"+dtbl+"_2").addClass(p.saveicon[1]=="right"?'fm-button-icon-right':'fm-button-icon-left').append("<span class='ui-icon "+p.saveicon[2]+"'></span>")}if(p.closeicon[0]==true){$("#eData","#"+dtbl+"_2").addClass(p.closeicon[1]=="right"?'fm-button-icon-right':'fm-button-icon-left').append("<span class='ui-icon "+p.closeicon[2]+"'></span>")}if(!p.updateAfterCheck){$("#dData","#"+dtbl+"_2").click(function(e){for(i=0;i<b.p.colModel.length;i++){if(!b.p.colModel[i].hidedlg){var a=b.p.colModel[i].name.replace(/\./g,"\\.");if($("#col_"+a,"#"+dtbl).attr("checked")){$(b).jqGrid("showCol",b.p.colModel[i].name);$("#col_"+a,"#"+dtbl).attr("defaultChecked",true)}else{$(b).jqGrid("hideCol",b.p.colModel[i].name);$("#col_"+a,"#"+dtbl).attr("defaultChecked","")}}}if(p.ShrinkToFit===true){$(b).jqGrid("setGridWidth",b.grid.width-0.001,true)}if(p.closeAfterSubmit)$.jgrid.hideModal("#"+IDs.themodal,{gb:"#gbox_"+g,jqm:p.jqModal,onClose:p.onClose});if(f){p.afterSubmitForm($("#"+dtbl))}return false})}else{$(":input","#"+dtbl).click(function(e){var a=this.id.substr(4);if(a){if(this.checked){$(b).jqGrid("showCol",a)}else{$(b).jqGrid("hideCol",a)}if(p.ShrinkToFit===true){$(b).jqGrid("setGridWidth",b.grid.width-0.001,true)}}return this})}$("#eData","#"+dtbl+"_2").click(function(e){$.jgrid.hideModal("#"+IDs.themodal,{gb:"#gbox_"+g,jqm:p.jqModal,onClose:p.onClose});return false});$("#dData, #eData","#"+dtbl+"_2").hover(function(){$(this).addClass('ui-state-hover')},function(){$(this).removeClass('ui-state-hover')});if(c){p.beforeShowForm($("#"+dtbl))}$.jgrid.viewModal("#"+IDs.themodal,{gbox:"#gbox_"+g,jqm:p.jqModal,jqM:true,modal:p.modal});if(d){p.afterShowForm($("#"+dtbl))}}})}})})(jQuery);