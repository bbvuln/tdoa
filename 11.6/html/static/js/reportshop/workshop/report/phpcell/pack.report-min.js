function TCRSReport(o,p,w,u,t,y,x,s,r,B,v,A,q,z){this.openMode=o;this.repId=p;this.s_repname="";this.organId=w;this.userId=u;this.writeTime=t;this.s_title="";this.s_memo="";this.s_writer_organid="";this.s_writer=y;if(this.s_writer==""||this.s_writer==this.userId){this.s_writer=this.userId;this.s_writer_organid=w}this.s_assign_user=x;if(this.s_assign_user==undefined){this.s_assign_user=""}this.s_assign_user_dept="";this.refKID="";this.refCID="";this.s_kid="";this.mobile=B;this.b_mobile=B;this.mobilestyle=v;this.s_repno="";this.showZeroValue=false;this.writeColList=null;this.readColList=null;this.obj_target_cell=null;this.obj_mouse_enter_cell=null;this.obj_mouse_enter_row=null;this.s_last_cell_bg_color=null;this.obj_target_inline_obj=null;this.crsDataSet=new TCRSDataSet();this.crsTableIndex=new TCRSTableIndex(this.crsDataSet,this.repId);this.crsFormulasCache=new TCRSFormulasCache(this.crsDataSet,this.repId);this.crsCodeIndex=new TCRSCodeIndex(this.crsDataSet);this.crsAutoCode=new TCRSAutoCode(this.crsDataSet);this.crsDeptCache=new TCRSDepartment(this.crsDataSet,w);this.crsUserCache=new TCRSUser(this.crsDataSet);this.crsChartCache=new TCRSChart(this.crsDataSet,this.repId);this.crsWorkflow=new TCRSWorkflow(this.crsDataSet,this.repId);this.crsHyperlink=new TCRSHyperlink(this.crsDataSet,this.repId);this.crsReportState=new TCRSReportState(this.crsDataSet,this.repId,this.userId,this.writeTime);this.b_as_form=A||B;this.crsCommon=new TCRSCommon(this.b_as_form,B);this.obj_cell_maps={};this.ListKey="";this.s_read_filter="";this.s_dataflow="";this.i_active_sheet_index=0;this.obj_active_cell=null;this.s_begin_task="";this.s_cur_task=r;this.s_valid_cur_task="";this.b_is_endtask=false;this.s_write_mode="";this.s_write_role="";this.s_can_roll_back="";this.s_next_task="";this.i_remind_type=0;this.s_only_redirect_task="";this.b_submit=false;this.s_begin_writer="";this.arr_prev_done_tasks=null;this.b_saved=false;this.s_para=unescape(s);this.i_width=0;this.i_height=0;this.arr_schema=null;this.s_data_flow="";this.func_show_list_view=null;this.arr_upload_files=[];this.b_is_query=false;this.b_from_center=false;this.b_inline=false;this.s_postfix=q;this.s_timer="";this.b_has_inline_calcu=false;this.b_crs_gz=false;this.b_has_sign_seal=false;this.DWebSignSeal=null;this.b_delete_fresh=z;this.s_P="";this.arr_colwrite_cols=[];this.s_puserid="";this.s_pwritetime="";this.b_subrep_row_seq=1;this.b_calculate_in_time=false;this.b_save_silent=false;this.b_cansave=true;this.s_noappend_tab="";this.s_nodelete_tab="";this.s_noinsert_tab="";this.b_has_workflow=false;this.arr_fill_selected_value_cols=null;this.arr_fill_selected_value_row=0;this.b_sync_query_data=false;this.b_usepda=false;this.s_rollback_sign="";this.b_autoheight=false;this.b_show_info_flag=false}TCRSReport.prototype={constructor:TCRSReport,get_valid_cur_task:function(){var b=crsReport.s_cur_task;if(b==""){b=crsReport.s_begin_task}else{b=crsReport.crsWorkflow.get_valid_task(b)}return b},doOpenReport:function(){if(this.openMode!="delete"){this.crsChartCache.load_chart()}this.initPara();this.crsCommon.draw(this.openMode!="write");if(this.openMode=="copynew"){this.writeTime=this.crsDataSet.get_now();this.crsTableIndex.clear_data_item_id();this.openMode="write"}if(this.openMode!="delete"){this.set_timer()}},initPara:function(){this.s_valid_cur_task=this.get_valid_cur_task();this.crsTableIndex.initColSchema()},blur_handler:function(){this.crsCommon.blur_handler()},calculate:function(){this.crsCommon.calculate()},save_as_excel:function(){this.blur_handler();this.crsCommon.save_as_excel()},execute_manu_formulas:function(b){this.crsFormulasCache.execute_formulas("",CRS_MANUL_EXEC,0,"",1,b,false,false,false)},check:function(){this.save_data(false)},fill_values:function(bp,aL,a7){if(aL.openMode=="delete"){return}aL.crsFormulasCache.s_info="";if(bp==""){aL.crsCommon.begin_update();aL.crsCommon.end_update();return""}aL.crsCommon.begin_update();var aj=[];var ba=bp.split("@");var bD=null,aH=0,a9=0;var aR=1,aE="",bj=null,aD=null,aG=-1;var bw=[];var bz=[];for(var bq=0,k=0,be=ba.length;bq<be;bq++,k++){if(ba[bq]==""){continue}if(aL.arr_fill_selected_value_cols!=null){if(aH==0){aH=(be-1)/aL.i_fill_selected_value_row;a9=aL.arr_fill_selected_value_cols.length/aL.i_fill_selected_value_row}bD=Math.floor((k-1)/aH)}var bB=ba[bq].split(";");var bx=bB[0].indexOf("_");if(bx==-1){bx=bB[0].length}var aK=bB[0].substr(0,bx);bB=bB.slice(1);var aK=aK%aL.crsFormulasCache.rows.length;var au=aL.crsFormulasCache.rows[aK].formulastype;aE="";aG=-1;if(au=="\u9a8c\u8bc1\u516c\u5f0f"){if(aL.crsFormulasCache.arr_formulas[aK].arr_cur_column_ref!=null){for(var ax=0,aw=bB.length;ax<aw;ax++){var bm=bB[ax].indexOf("->displayseq");var bx=bm;while(bB[ax].charAt(bx)!=","){bx--}var by=parseInt(bB[ax].substring(bx+1,bm));if(by==1){bm=bB[ax].indexOf("->displayseq",bm+1);if(bm!=-1){bx=bm;while(bB[ax].charAt(bx)!=","){bx--}by=parseInt(bB[ax].substring(bx+1,bm))}}if(aL.crsFormulasCache.arr_formulas[aK].i_cur_seq>0&&aL.crsFormulasCache.arr_formulas[aK].i_cur_seq!=by){continue}for(var bt=0,az=aL.crsFormulasCache.arr_formulas[aK].arr_cur_column_ref.length;bt<az;bt++){var bd=aL.crsFormulasCache.arr_formulas[aK].arr_cur_table_ref[bt];if(aL.crsFormulasCache.arr_formulas[aK].arr_cur_column_ref[bt].charAt(0)!="{"){aL.crsFormulasCache.arr_formulas[aK].arr_cur_column_ref[bt]=crsReport.crsTableIndex.get_col_kid_by_id(bd,aL.crsFormulasCache.arr_formulas[aK].arr_cur_column_ref[bt])}var aN=crsReport.crsTableIndex.getAColSchema(aL.crsFormulasCache.arr_formulas[aK].arr_cur_column_ref[bt]);var bn=aN.get_cell_point(by);var aM=parseInt(crsReport.crsTableIndex.rows[aN.row_idx].sheetindex)-1;crsReport.crsCommon.set_cell_backgroud_color(aM,bn.x,bn.y,is_color_position(aL.crsFormulasCache.rows[aK].fill_table));if(bt==0&&aL.crsFormulasCache.arr_formulas[aK].s_error_hint_content!=""){aL.crsFormulasCache.s_info+="\u3010"+aL.crsFormulasCache.arr_formulas[aK].s_label+"//"+HandleMemoStr(aL.crsFormulasCache.arr_formulas[aK].s_error_hint_content,false)+"\u3011 \u7b2c\u3010"+by+"\u3011\u884c\u6216\u5217\u4e0d\u6ee1\u8db3\n"}}}}}else{if(au=="\u56de\u5199\u516c\u5f0f"){}else{var bk={};for(var bt=0,a0=bB.length;bt<a0;bt++){if(bB[bt]==""){continue}var bC=bB[bt].split(",");for(var bv=0,aB=bC.length;bv<aB;bv++){bx=bC[bv].indexOf("->");if(bx==-1){continue}var aJ=bC[bv].substr(0,bx);if(aJ=="1899-12-30"){aJ=""}if(typeof aJ=="string"){aJ=aJ.replaceAll("#13","\n")}var bh=bC[bv].substr(bx+2,bC[bv].length);bx=bh.indexOf(CRSLimiter);if(bx==-1){var a6=aL.crsTableIndex.getAColSchema(bh);var bd=aL.crsTableIndex.rows[a6.row_idx].label;var aS=a6.col.rows[a6.col_idx].columnlabel}else{var bd=bh.substr(0,bx),aS=bh.substr(bx+3)}if(aJ==""&&bz.indexOf(aS)!=-1){continue}if(bz.indexOf(aS)==-1){bz.push(aS)}var aU;var a5=aK+bd+aS;if(bk[a5]==undefined){bk[a5]={};aU=aL.crsFormulasCache.get_fill_type(aK,bd,aS);if(aU==""){for(var ax=0,av=a7.length;ax<av;ax++){aU=aL.crsFormulasCache.get_fill_type(a7[ax],bd,aS);if(aU!=""){break}}if(aU==""){aU="\u586b\u5165\u503c"}}bk[a5].fill_type=aU;var aT=aL.crsTableIndex.get_col_kid_by_name(bd,aS);bk[a5].col_schema=aL.crsTableIndex.getAColSchema(aT)}else{aU=bk[a5].fill_type}if(aE!=bd||bj==null){if(aE!=bd||bj==null){bj=aL.crsTableIndex.search("label",bd)}aE=bd;if(aR!=1){aR=1}if(bj.tabletype=="\u660e\u7ec6\u8868"){if(bt==0&&aG==-1){if(bD!=null){var a4=crsReport.arr_fill_selected_value_cols;aR=a4[bD*a9][4]}else{if(aL.crsFormulasCache.arr_formulas[aK].i_cur_seq==0){aL.crsFormulasCache.arr_formulas[aK].i_cur_seq=1}var bl=bw.indexOf(bd);if(bl!=-1){if(aL.crsFormulasCache.arr_formulas[aK].b_do_match){aR=aL.crsFormulasCache.arr_formulas[aK].i_cur_seq}else{aR=bw[bl+1]}bw[bl+1]=aR+a0;aG=0}else{aR=aL.crsFormulasCache.arr_formulas[aK].i_cur_seq;bw.push(bd);bw.push(aR+a0);aG=0}}}if(a0+aR-1>bj.initcz&&aL.crsFormulasCache.arr_formulas[aK].has_fill()){var bc=a0+aR-1-bj.initcz;var aV=aL.crsTableIndex.getColumn(bj.id);var bi=rectNameToIndex(aV.getColumnDefRect());if(bj.expandtype=="\u6309\u884c\u5411\u4e0b"){if(crsReport.b_as_form){crsReport.crsCommon.crsForm.append_record(bj,bk[a5].col_schema,bc)}else{var aY=bi[1].y-bi[0].y+1;var aC=bi[0].y+(bj.initcz-1)*aY;var aA=aY*bc;aL.crsTableIndex.update_cell_refer(bj.sheetindex,bj.expandtype,bi,bc,true);aL.crsCommon.crsTable.crsCellControler.insert_row(aL.obj_cell_maps[bj.sheetindex-1]["row"+aC+"column"+bi[0].x],bj.sheetindex-1,aC,aA);aL.crsCommon.crsTable.crsCellControler.cache_td(bj.sheetindex-1);for(var ax=0;ax<aA;ax++){var by=aC+(ax+1)*aY;var bo="row"+by+"column"+bi[0].x;$(aL.obj_cell_maps[bj.sheetindex-1][bo]).parent("#row"+by).attr("rid",aL.crsTableIndex.create_row_kid(aV.rows[0].kid))}bj.initcz=a0+aR-1;aL.crsTableIndex.auto_increment(aV.rows[0].kid)}}else{if(bj.expandtype=="\u6309\u5217\u5411\u53f3"){var aY=bi[1].x-bi[0].x+1;var aC=bi[0].x+(bj.initcz-1)*aY;var aA=aY*bc;aL.crsTableIndex.update_cell_refer(bj.sheetindex,bj.expandtype,bi,bc,true);aL.crsCommon.crsTable.crsCellControler.insert_column(bj.sheetindex-1,aC,aA);aL.crsCommon.crsTable.crsCellControler.cache_td(bj.sheetindex-1);var aP="";for(var ax=0;ax<aA;ax++){for(var bs=bi[0].y;bs<=bi[1].y;){var by=aC+(ax+1)*aY;var bo="row"+bs+"column"+by;if(bs==bi[0].y){aP=aL.crsTableIndex.create_row_kid(aV.rows[0].kid)}var ay=$(aL.obj_cell_maps[bj.sheetindex-1][bo]);ay.attr("rid",aP);if(ay.attr("rowspan")!=undefined){bs+=parseInt(ay.attr("rowspan"))}else{bs+=1}}}aL.crsTableIndex.auto_increment(aV.rows[0].kid)}}}}}if(aU=="\u6784\u9020\u4e0b\u62c9\u5217\u8868"||aU=="\u6784\u9020\u4e0b\u62c9\u5217\u8868\uff08\u5141\u8bb8\u5176\u4ed6\u503c\uff09"){var aO=false;if(aL.crsFormulasCache.s_exec_time=="\u7b5b\u9009\u6761\u4ef6\u6539\u53d8\u540e\u81ea\u52a8\u6267\u884c"&&aL.crsFormulasCache.arr_formulas[aK].b_do_match){if(aU=="\u6784\u9020\u4e0b\u62c9\u5217\u8868"){var aW="n."+aR+"."+bd+aS+"."}else{var aW="y."+aR+"."+bd+aS+"."}}else{if(aU=="\u6784\u9020\u4e0b\u62c9\u5217\u8868"){var aW="n.0."+bd+aS+"."}else{var aW="y.0."+bd+aS+"."}aO=true}if(bt==0){var a1=bk[a5].col_schema.canwrite?"":" disabled";if(aJ.indexOf(CRSLess+"col"+CRSGreaterSign)==-1){if(crsReport.crsTableIndex.rows[bk[a5].col_schema.row_idx].tabletype=="\u4e3b\u8868"){if(crsReport.b_mobile){var bf=$("div[cid='"+bk[a5].col_schema.kid+"']")}else{var bf=$("td[cid='"+bk[a5].col_schema.kid+"']")}var aI=crsReport.crsCommon.get_cell_value(bf);if(aI!=""){if(crsReport.b_mobile){$(bf).html('<div class="select_arrow"><select onchange="javascript:crsReport.crsCommon._do_editor_deactive(this);"'+a1+'><option value=""></option>'+((aU=="\u6784\u9020\u4e0b\u62c9\u5217\u8868")?"":'<option value="<\u8f93\u5165...>"><\u8f93\u5165...></option>')+((false&&aU=="\u6784\u9020\u4e0b\u62c9\u5217\u8868")?"":'<option value="'+aI+'" selected>'+aI+"</option>")+'</select><span class="caret"></span></div>')}else{$(bf).html('<select onchange="javascript:crsReport.crsCommon._do_editor_deactive(this);"'+a1+'><option value=""></option>'+((aU=="\u6784\u9020\u4e0b\u62c9\u5217\u8868")?"":'<option value="<\u8f93\u5165...>"><\u8f93\u5165...></option>')+((false&&aU=="\u6784\u9020\u4e0b\u62c9\u5217\u8868")?"":'<option value="'+aI+'" selected>'+aI+"</option>")+"</select>")}}else{if(crsReport.b_mobile){$(bf).html('<div class="select_arrow"><select onchange="javascript:crsReport.crsCommon._do_editor_deactive(this);"'+a1+'><option value=""></option>'+((aU=="\u6784\u9020\u4e0b\u62c9\u5217\u8868")?"":'<option value="<\u8f93\u5165...>"><\u8f93\u5165...></option>')+'</select><span class="caret"></span></div>')}else{$(bf).html('<select onchange="javascript:crsReport.crsCommon._do_editor_deactive(this);"'+a1+'><option value=""></option>'+((aU=="\u6784\u9020\u4e0b\u62c9\u5217\u8868")?"":'<option value="<\u8f93\u5165...>"><\u8f93\u5165...></option>')+"</select>")}}}else{if(crsReport.b_mobile){if(aO){var bb="div[cid='"+bk[a5].col_schema.kid+"']:eq(0),#page2 div[cid='"+bk[a5].col_schema.kid+"']"}else{var bb="#page2 div[cid='"+bk[a5].col_schema.kid+"']"}}else{if(crsReport.b_as_form){var bb="td[aria-describedby$='"+bk[a5].col_schema.kid+"']"}else{var bb="td[cid='"+bk[a5].col_schema.kid+"']"}}$(bb).each(function(){var b=true;if(aO||crsReport.b_mobile){b=true}else{var c=crsReport.crsCommon.get_row_seq(this);if(c==aR){}else{b=false;if(c>aR){return false}}}if(b){var a=crsReport.crsCommon.get_cell_value(this);if(a!=""){if(crsReport.b_mobile){$(this).html('<div class="select_arrow"><select onchange="javascript:crsReport.crsCommon._do_editor_deactive(this);"'+a1+'><option value=""></option>'+((aU=="\u6784\u9020\u4e0b\u62c9\u5217\u8868")?"":'<option value="<\u8f93\u5165...>"><\u8f93\u5165...></option>')+'<option value="'+a+'" selected>'+a+'</option></select><span class="caret"></span></div>')}else{$(this).html('<select onchange="javascript:crsReport.crsCommon._do_editor_deactive(this);"'+a1+'><option value=""></option>'+((aU=="\u6784\u9020\u4e0b\u62c9\u5217\u8868")?"":'<option value="<\u8f93\u5165...>"><\u8f93\u5165...></option>')+'<option value="'+a+'" selected>'+a+"</option></select>")}}else{if(crsReport.b_mobile){$(this).html('<div class="select_arrow"><select onchange="javascript:crsReport.crsCommon._do_editor_deactive(this);"'+a1+'><option value=""></option>'+((aU=="\u6784\u9020\u4e0b\u62c9\u5217\u8868")?"":'<option value="<\u8f93\u5165...>"><\u8f93\u5165...></option>')+'</select><span class="caret"></span></div>')}else{$(this).html('<select onchange="javascript:crsReport.crsCommon._do_editor_deactive(this);"'+a1+'><option value=""></option>'+((aU=="\u6784\u9020\u4e0b\u62c9\u5217\u8868")?"":'<option value="<\u8f93\u5165...>"><\u8f93\u5165...></option>')+"</select>")}}}})}}else{if(aL.crsTableIndex.listValues[aW]==undefined){aL.crsTableIndex.listValues[aW]={};aL.crsTableIndex.listValues[aW].formulas_label=aL.crsFormulasCache.rows[aK].label;aL.crsTableIndex.listValues[aW].key=aW;aL.crsTableIndex.listValues[aW].data_list=[];aL.crsTableIndex.listValues[aW].obj_view=null}else{aL.crsTableIndex.listValues[aW].data_list=[];aL.crsTableIndex.listValues[aW].obj_view=null}if(crsReport.crsTableIndex.rows[bk[a5].col_schema.row_idx].tabletype=="\u4e3b\u8868"){if(crsReport.b_mobile){var aF=$("div[cid='"+bk[a5].col_schema.kid+"'] > input:eq(0)")}else{var aF=$("td[cid='"+bk[a5].col_schema.kid+"'] > input:eq(0)")}if(crsReport.b_mobile){if($(aF).attr("placeholder")!="\u8bf7\u9009\u62e9"&&a1==""){$(aF).attr("placeholder","\u8bf7\u9009\u62e9");$(aF).click(function(){crsReport.crsCommon.obj_cur_editor=$(this);crsReport.crsTableIndex.loadCodeItem($(this).parent())})}}else{if(!$(aF).hasClass("userField")){$(aF).addClass("userField");$(aF).parent().append("<a href=\"javascript:\" onclick=\"$(this).siblings().val('');$(this).parent().attr('val','');return false;\" class=\"ref-delete-handle inline-block\"></a>");if(a1==""){$(aF).click(function(){crsReport.crsCommon.obj_cur_editor=$(this);crsReport.crsTableIndex.loadCodeItem($(this).parent())})}if($(aF).parent().width()-32>10){$(aF).width($(aF).parent().width()-32)}}}}else{if(crsReport.b_mobile){if(aO){var bb="div[cid='"+bk[a5].col_schema.kid+"']:eq(0),#page2 div[cid='"+bk[a5].col_schema.kid+"']"}else{var bb="#page2 div[cid='"+bk[a5].col_schema.kid+"']"}}else{if(crsReport.b_as_form){var bb="td[aria-describedby$='"+bk[a5].col_schema.kid+"']"}else{var bb="td[cid='"+bk[a5].col_schema.kid+"']"}}if(!crsReport.b_mobile){$(bb).each(function(){var a=crsReport.crsCommon.get_cell_value(this);var b=$(this).children();if(!$(b).hasClass("userField")){$(b).addClass("userField").mouseenter(function(){crsReport.crsCommon._id(this)});$(this).append("<a href=\"javascript:\" onclick=\"$(this).siblings().val('');$(this).parent().attr('val','');return false;\" class=\"ref-delete-handle inline-block\"></a>");if(a1==""){var c=this;$(b).attr("onclick","crsReport.crsCommon.obj_cur_editor = $(this); crsReport.crsTableIndex.loadCodeItem($(this).parent());")}if($(b).parent().width()-32>10){$(b).width($(b).parent().width()-32)}}if(aO&&crsReport.b_as_form){crsReport.crsCommon.crsForm.obj_detail_dump_row["tab_"+bk[a5].col_schema.tableid][bk[a5].col_schema.kid]=$(this).html()}})}else{if(aO){var bu=crsReport.crsCommon.crsForm.obj_detail_dump_row["tab_"+bk[a5].col_schema.tableid][bk[a5].col_schema.kid];var aZ=bu.indexOf('<div class="field"');var aZ=bu.indexOf(">",aZ);var aX=bu.indexOf("</div>",aZ);var bE=bu.substring(aZ+1,aX),at=bE;bE=bE.replace(">"," placeholder=\"\u8bf7\u9009\u62e9\" onclick=\"crsReport.crsCommon.obj_cur_editor = $(this); crsReport.crsTableIndex.loadCodeItem($('#page1 #' + $('#page2 > div > div').attr('id')).find('div[rid=\\'' + $(this).parent().parent().attr('rid') + '\\'] > div[cid=\\'"+bk[a5].col_schema.kid+"\\']'));\">");bu=bu.replace(at,bE);crsReport.crsCommon.crsForm.obj_detail_dump_row["tab_"+bk[a5].col_schema.tableid][bk[a5].col_schema.kid]=bu}else{if(crsReport.crsCommon.crsForm.is_editing()){var bE=$("#page2 div[cid='"+bk[a5].col_schema.kid+"']").html();var br=bE.indexOf(' placeholder="\u8bf7\u9009\u62e9"');if(br!=-1){bE=bE.substring(0,br)+" placeholder=\"\u8bf7\u9009\u62e9\" onclick=\"crsReport.crsCommon.obj_cur_editor = $(this); crsReport.crsTableIndex.loadCodeItem($('#page1 #' + $('#page2 > div > div').attr('id')).find('div[rid=\\'' + $(this).parent().parent().attr('rid') + '\\'] > div[cid=\\'"+bk[a5].col_schema.kid+"\\']'));\">"}else{bE=bE.replace(">"," placeholder=\"\u8bf7\u9009\u62e9\" onclick=\"crsReport.crsCommon.obj_cur_editor = $(this); crsReport.crsTableIndex.loadCodeItem($('#page1 #' + $('#page2 > div > div').attr('id')).find('div[rid=\\'' + $(this).parent().parent().attr('rid') + '\\'] > div[cid=\\'"+bk[a5].col_schema.kid+"\\']'));\">")}$("#page2 div[cid='"+bk[a5].col_schema.kid+"']").html(bE)}}}}}}if(aJ!=""){var bg=aJ.split(" ");for(var ax=0,av=bg.length;ax<av;ax++){var bA=HandleMemoStr(bg[ax],false);if(bA.indexOf("<col>")==-1){if(crsReport.crsTableIndex.rows[bk[a5].col_schema.row_idx].tabletype=="\u4e3b\u8868"){crsReport.crsCommon.add_option($("td[cid='"+bk[a5].col_schema.kid+"'],div[cid='"+bk[a5].col_schema.kid+"']").find("select"),bA)}else{if(crsReport.b_mobile){if(aO){var bb="div[cid='"+bk[a5].col_schema.kid+"']:eq(0),#page2 div[cid='"+bk[a5].col_schema.kid+"']"}else{var bb="#page2 div[cid='"+bk[a5].col_schema.kid+"']"}}else{if(!crsReport.b_mobile&&crsReport.b_as_form){var bb="td[aria-describedby$='"+bk[a5].col_schema.kid+"']"}else{var bb="td[cid='"+bk[a5].col_schema.kid+"']"}}$(bb).each(function(){var c=true;if(aO||crsReport.b_mobile){c=true}else{var d=crsReport.crsCommon.get_row_seq(this);if(d==aR){}else{c=false;if(d>aR){}}}if(c){crsReport.crsCommon.add_option($(this).find("select"),bA)}if(aO&&crsReport.b_as_form&&ax==av-1){if(crsReport.b_mobile){var b=crsReport.crsCommon.crsForm.obj_detail_dump_row["tab_"+bk[a5].col_schema.tableid][bk[a5].col_schema.kid];var f=b.indexOf('<div class="field"');var f=b.indexOf(">",f);var e=b.indexOf("</div>",f);var a=b.substring(f+1,e);b=b.replace(a,$(this).html());crsReport.crsCommon.crsForm.obj_detail_dump_row["tab_"+bk[a5].col_schema.tableid][bk[a5].col_schema.kid]=b}else{crsReport.crsCommon.crsForm.obj_detail_dump_row["tab_"+bk[a5].col_schema.tableid][bk[a5].col_schema.kid]=$(this).html()}}})}}else{aL.crsTableIndex.listValues[aW].data_list.push(bA)}}}}else{if(aU=="\u586b\u5165\u503c"){var a2=bk[a5].col_schema.display_rect[0].x,a3=bk[a5].col_schema.display_rect[0].y;bj=aL.crsTableIndex.search("label",bd);if(aL.crsTableIndex.rows[bk[a5].col_schema.row_idx].tabletype=="\u660e\u7ec6\u8868"){var a8;if(aL.crsTableIndex.rows[bk[a5].col_schema.row_idx].expandtype=="\u6309\u5217\u5411\u53f3"||aL.crsTableIndex.rows[bk[a5].col_schema.row_idx].expandtype=="\u4e0d\u6269\u5c55\uff08\u6309\u5217\u5411\u53f3\uff09"){a8=bk[a5].col_schema.display_rect[1].x-bk[a5].col_schema.display_rect[0].x+1;a2+=a8*(bt+aR-1)}else{a8=bk[a5].col_schema.display_rect[1].y-bk[a5].col_schema.display_rect[0].y+1;a3+=a8*(bt+aR-1)}}aJ=HandleMemoStr(aJ,false);if(aJ=="_CURRENT_GEOLOCATION"){var s=[];s.push(bj.sheetindex-1);s.push(a2);s.push(a3);s.push(bk[a5].col_schema);crsReport.crsCommon._push_curposition_cell(s)}else{crsReport.crsCommon.set_cell_value(bj.sheetindex-1,a2,a3,aJ,bk[a5].col_schema)}if(typeof plugin_is_disable=="function"||typeof plugin_action=="function"){if(aj[bk[a5].col_schema.kid]==undefined){aj[bk[a5].col_schema.kid]=[]}var p=1;if(aL.crsTableIndex.rows[bk[a5].col_schema.row_idx].tabletype=="\u660e\u7ec6\u8868"){p=bt+aR}if(aj[bk[a5].col_schema.kid].indexOf(p)==-1){aj[bk[a5].col_schema.kid].push(p)}}}}}}}}}aL.crsCommon.end_update();if(typeof plugin_is_disable=="function"){for(s_k in aj){if(typeof aj[s_k]=="function"){continue}for(s_k2 in aj[s_k]){if(typeof aj[s_k][s_k2]=="function"){continue}var C=getColPlatKId(s_k);var aQ=plugin_is_disable(C,undefined,undefined,aj[s_k][s_k2]);if(aQ!=undefined&&aQ){crsReport.crsCommon.set_cell_disable(C,aj[s_k][s_k2],aQ)}}}}if(typeof plugin_action=="function"){for(s_k in aj){if(typeof aj[s_k]=="function"){continue}for(s_k2 in aj[s_k]){if(typeof aj[s_k][s_k2]=="function"){continue}var C=getColPlatKId(s_k);plugin_action(crsReport.openMode,C,aj[s_k][s_k2],crsReport.crsCommon.get_cell_value(C,aj[s_k][s_k2]))}}}},handle_before_save:function(){this.blur_handler();this.crsCommon.calculate(true);this.crsFormulasCache.execute_formulas(this.get_valid_cur_task(),CRS_SAVE_EXEC,"","","0","",false,false,false)},save_data:function(b){if(b==undefined){b=true}var c=this.crsTableIndex.save_data(b,false,true,false,false);if(this.b_mobile&&c&&b){if(is_mark=="y"){$("#attForm").ajaxSubmit({type:"post",url:"/general/reportshop/workshop/report/phpcell/save_remark.php",dataType:"json",async:false,success:function(a){if(a.status){var d=$(a.licontent);d.appendTo(".remake-list");$("#ATTACHMENT1_div").html("");UE.instants.ueditorInstant0.setContent("");$("#attForm>input.addfile").remove()}else{}},error:function(e,a,d){alert("\u6570\u636e\u5f02\u5e38\uff01")}})}}return c},free:function(){if(this.s_timer!=""){clearTimeout(this.s_timer)}var a=this.crsTableIndex.free();if(a!=""&&a.substring(0,8)=="!DATAREF"&&this.refCID!=""&&this.refKID!=""){a=a.substring(9);window.parent.opener.crsReport.get_subrep_data(this.refKID,this.refCID,a);a=""}return a},get_subrep_data:function(c,a,h){var g=h.split(",");for(var e=0,f=g.length-1;e<f;e++){var b=g[e].indexOf("->");if(b!=-1){var k=g[e].substring(0,b),d=g[e].substring(b+2);var m=this.crsTableIndex.getAColSchema(d);var l=m.get_cell_point(this.b_subrep_row_seq);this.crsCommon.set_cell_value(parseInt(this.crsTableIndex.rows[m.row_idx].sheetindex)-1,l.x,l.y,k,m);this.crsFormulasCache.execute_formulas(this.get_valid_cur_task(),CRS_CHANGE_EXEC,0,d,this.b_subrep_row_seq,"",false,false,false)}}},get_val_from_para:function(m){var g="";if(this.s_para!=""){var k=this.s_para.indexOf(m);if(k!=-1){var h=this.s_para.length,l=k+m.length;while(this.s_para.charAt(l)==" "){l++}if(l<h&&this.s_para.charAt(l)=="="){l++;while(this.s_para.charAt(l)==" "){l++}var n=l+1;while(n<h&&this.s_para.charAt(n)!=" "){n++}g=this.s_para.substring(l,n)}else{l=k;while(l>=0&&this.s_para.charAt(l)!=" "&&this.s_para.charAt(l)!="="){l--}while(l>=0&&this.s_para.charAt(l)==" "){l--}if(this.s_para.charAt(l)=="="){l--;while(l>=0&&this.s_para.charAt(l)==" "){l--}var n=l-1;while(n>=0&&this.s_para.charAt(n)!=" "){n--}g=this.s_para.substring(n+1,l+1)}}}}if(g!=""){if(g.charAt(0)=='"'){g=g.substr(1)}if(g.charAt(g.length-1)=='"'){g=g.substring(0,g.length-1)}}return g=="\u4e0e"?"":g},get_sub_query:function(d,c){return""},get_column_data_type:function(f,d,e){return""},has_inline_func:function(){return this.b_has_inline_calcu},has_manu_exec_func:function(){return this.crsFormulasCache.has_manu_exec_func()},has_workflow:function(){return this.s_write_mode!=""||this.b_has_workflow},has_chart:function(){return this.crsChartCache.length()>0},get_chart_type:function(){if(this.crsChartCache.length()>0){return this.crsChartCache.rows[0].chart_type}return"\u67f1\u72b6\u56fe"},pivot:function(l){var h=$(this.obj_active_cell).attr("cid");if(h==""){return}var f=this.crsCellControler.get_cell_point(this.obj_active_cell);var g=this.crsTableIndex.getAColSchema(h);var k=g.get_display_seq(f.x,f.y);this.crsFormulasCache.execute_formulas("","NaN",1,h,k,l,false,false,true)},resize:function(){this.crsCommon.resize()},submit_picture:function(d,c){if(d==undefined){d="FILE1"}ajaxFileUpload(d,"img",this.show_picture,c)},show_picture:function(m,n){if(m!=""){if(n==undefined){n=crsReport.obj_target_cell}crsReport.arr_upload_files.push(m);var g=$(n).width()-20,l=$(n).height()-2;var f=$(n).children("i").length>0?"<i align='right'>"+$(n).children("i").html()+"</i>":"";var h="<img src='/attachment/reportshop/images/"+m+"' width='"+g+"' height='"+l+"' ondblclick='window.parent.float_image(this)' onmouseover='crsReport.show_delete(this)'/>";$(n).html(h+f);$(n).attr("val2",m);var k=crsReport.crsCommon.get_row_seq(n);crsReport.crsFormulasCache.execute_formulas(crsReport.get_valid_cur_task(),CRS_CHANGE_EXEC,0,$(n).attr("cid"),k,"",false,false,false);crsReport.crsFormulasCache.execute_formulas(crsReport.get_valid_cur_task(),CRS_CHANGE_EXEC,0,$(n).attr("cid"),k,"",true,false,false)}},show_delete:function(h){if($(h).next(":not(i)").length>0){return}if(this.openMode=="read"){return}var g=$(h).parent().attr("cid");if(g==undefined&&this.b_as_form){g=this.crsCommon.crsForm._get_cid_by_td($(h).parent())}if(g==""){return}var e=this.crsTableIndex.getAColSchema(g);if(e==null||!e.canwrite||!e.canread||(this.writeColList!=null&&this.writeColList.indexOf(g)==-1)){return}var f='<img id="delete_icon" title="\u5220\u9664" src="/static/images/closesearch.gif" align=absmiddle style="cursor:pointer;" onclick="crsReport.delete_attach(this)" onmouseout="crsReport.hide_delete(this);"/>';$(h).after(f)},hide_delete:function(b){$(b).remove()},delete_attach:function(l){l=$(l).prev();var k=$(l)[0].localName.toLowerCase();if(k=="img"){var f=$(l).attr("src");f=f.replaceAll("/attachment/reportshop/images/","");if(this.arr_upload_files.indexOf(f)==-1){this.arr_upload_files.push(f)}g=$(l).parent();$(l).parent().removeAttr("val");$(l).parent().removeAttr("val2");$(l).next().remove();$(l).remove();f=this.crsCommon.get_rid_and_cid(g);$(g).prepend('<a class="addfile" href="javascript:;">\u9009\u62e9\u56fe\u7247<input class="addfile" hidefocus="true" type="file" size="1" id="'+f+'" name="'+f+'" accept="image/*" onchange="crsReport.submit_picture(\''+f+'\', $(this).parent().parent());" onclick="crsReport.crsCommon._id(this);"></a>');var h=this.crsCommon.get_row_seq(g);crsReport.crsFormulasCache.execute_formulas(crsReport.get_valid_cur_task(),CRS_CHANGE_EXEC,0,$(g).attr("cid"),h,"",false,false,false);crsReport.crsFormulasCache.execute_formulas(crsReport.get_valid_cur_task(),CRS_CHANGE_EXEC,0,$(g).attr("cid"),h,"",true,false,false)}else{if(k=="a"){var f=$(l).attr("href");f=f.replaceAll("/attachment/reportshop/attachment/","");if(this.arr_upload_files.indexOf(f)==-1){this.arr_upload_files.push(f)}var g=$(l).parent();$(l).parent().removeAttr("val");$(l).parent().removeAttr("val2");$(l).next().remove();$(l).remove();f=f.substring(1,f.indexOf("}_"));var e=$.md5(f);$(g).prepend('<a class="addfile" href="javascript:;">\u9009\u62e9\u9644\u4ef6<input title="\u6ce8\u610f\uff1a\u4e0a\u4f20\u7684\u9644\u4ef6\u8bf7\u4e0d\u8981\u8bbe\u7f6e\u4e3a\u53ea\u8bfb\uff01" class="addfile" hidefocus="true" type="file" size="1" id="'+e+'" name="'+e+'" onchange="crsReport.submit_attach(\''+e+"', $(this).parent().parent(), '"+f+'\');" onclick="crsReport.crsCommon._id(this);"></a>');var h=this.crsCommon.get_row_seq(g);crsReport.crsFormulasCache.execute_formulas(crsReport.get_valid_cur_task(),CRS_CHANGE_EXEC,0,$(g).attr("cid"),h,"",false,false,false);crsReport.crsFormulasCache.execute_formulas(crsReport.get_valid_cur_task(),CRS_CHANGE_EXEC,0,$(g).attr("cid"),h,"",true,false,false)}}},submit_attach:function(d,c,e){if(e==undefined){e=""}if(d==undefined){d="FILE1"}ajaxFileUpload(d,"attach",this.show_attach,c,e)},show_attach:function(l,f){if(l!=""){if(f==undefined){f=crsReport.obj_target_cell}var g=l.split("}_");crsReport.arr_upload_files.push(l);var e=$(f).children("i").length>0?"<i align='right'>"+$(f).children("i").html()+"</i>":"";var k="<a href='/attachment/reportshop/attachment/"+l+"' target='_blank' onmouseover='crsReport.show_delete(this)'>"+g[1]+"</a>";$(f).html(k+e);$(f).attr("val",g[1]);$(f).attr("val2",g[1]);var h=crsReport.crsCommon.get_row_seq(f);crsReport.crsFormulasCache.execute_formulas(crsReport.get_valid_cur_task(),CRS_CHANGE_EXEC,0,$(f).attr("cid"),h,"",false,false,false);crsReport.crsFormulasCache.execute_formulas(crsReport.get_valid_cur_task(),CRS_CHANGE_EXEC,0,$(f).attr("cid"),h,"",true,false,false)}},hide_edit:function(b){$(b).remove()},edit:function(a){$(a).parent().html($(a).parent().children("i").html())},show_edit:function(h){if($(h).next(":not(i)").length>0){return}if(this.openMode=="read"){return}var g=$(h).parent().attr("cid");if(g==undefined&&this.b_as_form){g=this.crsCommon.crsForm._get_cid_by_td($(h).parent())}if(g==""){return}var e=this.crsTableIndex.getAColSchema(g);if(e==null||!e.canwrite||!e.canread||(this.writeColList!=null&&this.writeColList.indexOf(g)==-1)){return}var f='<img title="\u7f16\u8f91" src="/static/images/edit.gif" align=absmiddle style="cursor:pointer;" onclick="crsReport.edit(this)" onmouseout="crsReport.hide_edit(this);"/>';$(h).after(f)},get_all_values:function(e){var f=null;for(s_k in e){if(e[s_k]["tabid"]!=""&&e[s_k]["colid"]!=""){if(f==null){var g=this.crsTableIndex.get_col_kid_by_id(e[s_k]["tabid"],e[s_k]["colid"]);f=this.crsTableIndex.getAColSchema(g);break}}}var a=this.crsTableIndex.rows[f.row_idx].initcz;if(a==""){a=1}var h=[];for(var d=0;d<a;d++){var c=[];for(s_k in e){if(e[s_k]["tabid"]!=""&&e[s_k]["colid"]!=""){var g=this.crsTableIndex.get_col_kid_by_id(e[s_k]["tabid"],e[s_k]["colid"]);f=this.crsTableIndex.getAColSchema(g);var b=f.get_cell_point(d+1);c[e[s_k]["colid"]]=this.crsCommon.get_cell_value(parseInt(this.crsTableIndex.rows[f.row_idx].sheetindex)-1,b.x,b.y)}}h.push(c)}return h},fill_selected_value:function(n,l,p,q){var m=1;var k=this.crsTableIndex.get_col_kid_by_id(n,l);var r=this.crsTableIndex.getAColSchema(k);var t=this.crsTableIndex.rows[r.row_idx].initcz;if($(this.crsCommon.obj_cur_editor).parents("#page2").length>0){var s=$("#page1 div[rid='"+this.crsCommon.obj_cur_editor.parent().parent().attr("rid")+"']");m=this.crsCommon.crsForm._get_row_seq(s)+q;if(m>t){if(this.crsTableIndex.rows[r.row_idx].expandtype!="\u6309\u884c\u5411\u4e0b"&&this.crsTableIndex.rows[r.row_idx].expandtype!="\u6309\u5217\u5411\u53f3"){return}this.crsCommon.crsForm.append_record(this.crsTableIndex.rows[r.row_idx],r)}}else{m=this.crsCommon.get_row_seq(this.crsCommon.obj_cur_editor.parent())+q;if(m>t){if(this.crsTableIndex.rows[r.row_idx].expandtype!="\u6309\u884c\u5411\u4e0b"&&this.crsTableIndex.rows[r.row_idx].expandtype!="\u6309\u5217\u5411\u53f3"){return}if(this.b_as_form){this.crsCommon.crsForm.append_record(this.crsTableIndex.rows[r.row_idx],r)}else{this.crsCommon.crsTable.append_record(this.crsCommon.obj_cur_editor.parent())}}}var o=r.get_cell_point(m);this.crsCommon.set_cell_value(0,o.x,o.y,p);if(this.arr_fill_selected_value_cols==null){this.arr_fill_selected_value_cols=[]}this.arr_fill_selected_value_cols.push([this.get_valid_cur_task(),CRS_CHANGE_EXEC,0,k,m,"",false,false,false])},end_fill_selected_value:function(a){if(this.arr_fill_selected_value_cols==null){return}this.i_fill_selected_value_row=a;this.crsFormulasCache.execute_formulas(crsReport.arr_fill_selected_value_cols);this.arr_fill_selected_value_cols=null;this.i_fill_selected_value_row=0},on_dblclick:function(d){var g=(d.srcElement==undefined)?d.target:d.srcElement;if($(g).attr("cid")==undefined){if(crsReport.b_mobile){var f=$(g).parent("div");if($(f).length==0){f=$(g).parent("em")}g=f}else{g=$(g).parent("td")}if(!this.b_as_form&&$(g).attr("cid")==undefined){return}}var e=crsReport.crsTableIndex.get_ref_report(g);if(e!=null){if(typeof window.link_report=="function"){link_report(e)}else{window.parent.link_report(e)}}return false},_s_exec:function(){this.crsFormulasCache.execute_formulas("",CRS_WRITE_EXEC,"1","","0","",false,false,false)},set_timer:function(){if(this.has_chart()){var b=this.crsChartCache.first();if(b.realtime>0){this._s_exec();this.s_timer=window.setTimeout("crsReport.set_timer()",b.realtime*1000)}}},show_hint:function(a){if(this.b_mobile){show_it(a)}else{if(this.b_cansave&&this.b_show_info_flag){$("#save_dialog span:eq(0)",window.parent.document).text(a)}else{alert(a)}}}};function TCRSDataSet(){this.xml=""}TCRSDataSet.prototype={constructor:TCRSDataSet,execQuery:function(aTab,aCols,aWhere,cb,obj,s_key,_s_temp_table_list,_s_snapshot_sql){if(_s_temp_table_list==undefined){_s_temp_table_list=""}if(_s_snapshot_sql==undefined){_s_snapshot_sql=""}if(crsReport.arr_schema!=null&&s_key!=undefined&&s_key!=""){if(crsReport.arr_schema[s_key]!=undefined){if(crsReport.b_crs_gz&&typeof crsReport.arr_schema[s_key]=="string"){crsReport.arr_schema[s_key]=crs_decode(crsReport.arr_schema[s_key]);crsReport.arr_schema[s_key]=eval(crsReport.arr_schema[s_key])}if(cb==undefined){return crsReport.arr_schema[s_key]}else{cb(crsReport.arr_schema[s_key],obj);return}}}var s_url="/general/reportshop/utils/get_rep_para.php";if(aTab=="user"||aTab=="user_priv"||aTab=="department"||aTab=="unit"){s_url="/general/reportshop/utils/get_"+aTab+"_list.php"}if(cb==undefined){var s=$.ajax({url:s_url,type:"post",data:{tab:aTab,cols:aCols,con:crsReport.b_crs_gz?crs_encode(aWhere):HandleMemoStr2(aWhere),json:"1",P:crsReport.s_P},dataType:"json",async:false}).responseText;if(crsReport.b_crs_gz){s=eval(crs_decode(s))}return s}else{$.ajax({url:s_url,type:"post",data:{tab:aTab,cols:aCols,con:crsReport.b_crs_gz?crs_encode(aWhere):HandleMemoStr2(aWhere),json:"1",P:crsReport.s_P},dataType:crsReport.b_crs_gz?"text":"json",success:function(json){if(crsReport.b_crs_gz){json=eval(crs_decode(json))}cb(json,obj)},error:function(request,strError){crsReport.show_hint("\u52a0\u8f7d\u5931\u8d25\uff0c\u8bf7\u5237\u65b0\u9875\u9762\u91cd\u65b0\u52a0\u8f7d\u3002")},async:false})}},execQuery2:function(e,h,d,k,f,l,g){if(crsReport.arr_schema!=null&&g!=undefined&&g!=""){if(crsReport.arr_schema[g]!=undefined){if(crsReport.b_crs_gz&&typeof crsReport.arr_schema[g]=="string"){crsReport.arr_schema[g]=crs_decode(crsReport.arr_schema[g])}f(crsReport.arr_schema[g],l);return}}$.ajax({url:"/general/reportshop/utils/get_datas.php",type:"post",data:{tab:e,col:h,con:d,order:k,json:"1",P:crsReport.s_P},dataType:"text",success:function(a){if(crsReport.b_crs_gz){a=crs_decode(a)}f(a,l)},error:function(a,b){crsReport.show_hint("\u52a0\u8f7d\u5931\u8d25\uff0c\u8bf7\u5237\u65b0\u9875\u9762\u91cd\u65b0\u52a0\u8f7d\u3002")},async:false})},exec_sql_list:function(y,D,p,s,v,u,x,r,A,w,C,z,B){var q=JSON.stringify(D);if(y==""){y="\u6570\u636e\u6e90_TD_OA"}if(B==undefined){B=""}var t=false;$.ajax({url:"/general/reportshop/utils/db_action.php",type:"post",data:{database:(y),action:"exec1",action_map:crsReport.b_crs_gz?crs_encode(q):q,b_pivot:p,cur_table_list:v,cur_column_list:crsReport.b_sync_query_data?u:"",column_ref_back:x,cond_sql_list:r,temp_table_list:z,actions:crsReport.b_crs_gz?crs_encode(B):HandleMemoStr2(B),json:"1",cur_rep:crsReport.s_postfix,repid:crsReport.repId,batch:1},dataType:"text",beforeSend:function(){show_hint("\u83b7\u53d6\u6570\u636e\u4e2d\uff0c\u8bf7\u7a0d\u540e")},complete:function(){hide_hint()},success:function(a){if(crsReport.b_crs_gz){a=crs_decode(a)}A(a,w,C);crsReport.crsFormulasCache.end_execute()},error:function(a,b){crsReport.crsFormulasCache.end_execute();crsReport.show_hint("\u63d0\u53d6\u5931\u8d25\uff0c\u8bf7\u91cd\u65b0\u63d0\u53d6")},async:false})},execUpdate:function(b,c){if(c==undefined){c=false}b=b.replaceAll("\\","#005C`");b=b.replaceAll("\n",CRSNewLine);return $.ajax({url:"/general/reportshop/utils/set_datas.php",type:"post",data:{repid:crsReport.repId,cur_rep:c?crsReport.s_postfix:"",actions:crsReport.b_crs_gz?crs_encode(b):HandleMemoStr2(b),json:"1",P:crsReport.s_P,batch:1},dataType:"text",success:function(a){},error:function(d,a){crsReport.show_hint("\u4fdd\u5b58\u51fa\u9519\uff1a"+a)},async:false}).responseText},get_next_autocode:function(c,h,f){if(h==undefined){h=""}if(f==undefined){f=""}var k=new Date();var g=k.getTime();var e=$.ajax({url:"/general/reportshop/design/report/console/autocode/autocode.php?t="+g,type:"post",data:{repid:crsReport.repId,cur_rep:crsReport.s_postfix,action:"generate",id:c,P:crsReport.s_P,json:1,batch:1,actions:crsReport.b_crs_gz?crs_encode(h):HandleMemoStr2(h)},dataType:"text",async:false}).responseText;return e},roll_back:function(d,c){$.ajax({url:"/general/reportshop/design/report/console/autocode/autocode.php?id="+d+"action=rollback&code="+c+"&P="+crsReport.s_P,type:"get",dataType:"text",async:false})},is_exist_key:function(g,m,l,n){var k=false;var h=$.ajax({url:"/general/reportshop/utils/misc2.php",data:{action:"is_exists_key",tabid:g,key_where:m,userid:l,writetime:n,json:1,P:crsReport.s_P},type:"post",dataType:"text",async:false}).responseText;k=h=="y";return k},get_now:function(){return $.ajax({url:"/general/reportshop/utils/misc.php?action=timestamp&P="+crsReport.s_P,type:"get",dataType:"text",async:false}).responseText},calculate:function(_arr_actions,_arr_incalcu_cell,cb,obj,_b_asyn,_b_save_excel){var s=_arr_actions.toString();var s_incal=JSON.stringify(_arr_incalcu_cell);_b_asyn=false;var b_deleted=false;do{if(b_deleted){s="[]";b_deleted=false}$.ajax({url:"/general/reportshop/utils/js_action.php",data:{action:"calcu",actions:crsReport.b_crs_gz?crs_encode(s):s,incalcu_cells:crsReport.b_crs_gz?crs_encode(s_incal):s_incal,cur_rep:crsReport.s_postfix,P:crsReport.s_P},type:"post",dataType:crsReport.b_crs_gz?"text":"json",beforeSend:function(){},complete:function(){},success:function(json){if(crsReport.b_crs_gz){json=crs_decode(json)}if(typeof json=="string"&&json=="+reload"){b_deleted=true}else{json=eval(json);cb(json,obj,_b_save_excel)}},error:function(request,strError){},async:_b_asyn})}while(b_deleted)},save_as_excel:function(b){$("iframe[name='actionFrame']",window.parent.document).attr("src","/general/reportshop/utils/js_action.php?action=save_as_excel&file_name="+b+"&cur_rep="+crsReport.s_postfix+"&P="+crsReport.s_P)},free_me:function(f){var h="";for(var l=0,g=crsReport.arr_upload_files.length;l<g;l++){if(crsReport.arr_upload_files[l]!=""){h+=crsReport.arr_upload_files[l]+","}}f="";if(crsReport.openMode=="edit"&&crsReport.b_saved&&crsReport.b_delete_fresh){f=crsReport.crsTableIndex.create_cur_table_data(true)}var k={actions:crsReport.b_crs_gz?crs_encode(f):MapKey(HandleMemoStr2(f)),cur_rep:crsReport.s_postfix,batch:1,json:1,open_mode:crsReport.openMode,has_workflow:crsReport.b_submit&&crsReport.has_workflow(),saved:(crsReport.b_saved?1:0),refrid:crsReport.refKID,refcid:crsReport.refCID,P:crsReport.s_P};k.rep_repid=crsReport.repId;k.rep_organid=crsReport.organId;k.rep_userid=crsReport.userId;k.rep_writetime=crsReport.writeTime;k.rep_title=crsReport.s_title;if(h!=""){k.upload_files=h}if(crsReport.b_saved&&k.has_workflow){if(!crsReport.b_submit&&crsReport.b_is_endtask&&crsReport.writeColList!=null&&crsReport.writeColList.length==0){crsReport.b_submit=true}k.task_IsSubmit=crsReport.b_submit;k.task_BeginWriter=crsReport.s_begin_writer;k.task_CurTask=crsReport.s_cur_task;k.task_CurOrgan=crsReport.s_writer_organid;k.task_CurWriter=crsReport.s_writer;k.task_NextTask=crsReport.s_next_task;k.task_RedirectTask=crsReport.s_only_redirect_task;k.task_RemindType=crsReport.i_remind_type;k.task_AssignUser=crsReport.s_assign_user;k.task_RollbackSign=crsReport.s_rollback_sign}return $.ajax({url:"/general/reportshop/utils/free_me.php",type:"post",data:k,dataType:"text",success:function(a){},error:function(a,b){},async:false}).responseText},open_hyperlink:function(f,g,l,h,k){var m=$.ajax({url:"/general/reportshop/utils/misc2.php",type:"post",data:{action:"open_hyperlink",repid:crsReport.repId,kid:f,seq:g,postfix:l,userid:crsReport.userId,writetime:crsReport.writeTime,json:1,actions:crsReport.b_crs_gz?crs_encode(h):MapKey(HandleMemoStr2(h)),batch:1,rid:k,P:crsReport.s_P},dataType:"text",success:function(a){},error:function(a,b){},async:false}).responseText;return m},get_user_by_id:function(b){var a=[];$.ajax({url:"/general/reportshop/utils/get_user_by_id.php",type:"post",data:{userid_list:b,P:crsReport.s_P},dataType:"json",success:function(c){a=c},error:function(c,d){},async:false});return a},get_user_by_name:function(a){var b=[];var d=$.ajax({url:"/general/reportshop/utils/get_user_by_name.php",type:"post",data:{username_list:a,P:crsReport.s_P},dataType:"json",success:function(c){b=c},error:function(c,e){},async:false}).responseText;return b},get_dept_by_id:function(b){var a=[];var d=$.ajax({url:"/general/reportshop/utils/get_dept_by_id.php",type:"post",data:{deptid_list:b,P:crsReport.s_P},dataType:"json",success:function(c){a=c},error:function(c,e){},async:false}).responseText;return a},get_dept_by_name:function(a){var b=[];var d=$.ajax({url:"/general/reportshop/utils/get_dept_by_name.php",type:"post",data:{deptname_list:a,P:crsReport.s_P},dataType:"json",success:function(c){b=c},error:function(c,e){},async:false}).responseText;return b},get_repname_by_no:function(b){var a=$.ajax({url:"/general/reportshop/utils/get_repname_by_no.php",type:"post",data:{repno:b,P:crsReport.s_P},dataType:"json",success:function(c){},error:function(c,d){},async:false}).responseText;return a},get_long_dept_name:function(a){return $.ajax({url:"/general/reportshop/utils/get_long_dept_name.php",type:"post",data:{dept_id:a,P:crsReport.s_P},dataType:"text",async:false}).responseText},copy_attach:function(b,c,a){$.ajax({url:"/general/reportshop/utils/upload.php",type:"post",data:{action:"upload",filetype:"attach",filename:b,rid:c,cid:a,P:crsReport.s_P},dataType:"json",async:false})},get_next_task:function(a,c){var b={res:"+ERR"};$.ajax({url:"/general/reportshop/utils/get_next_task.php",type:"post",data:{repid:crsReport.repId,organid:crsReport.organId,userid:crsReport.userId,writetime:crsReport.writeTime,cur_task:a,origin_cur_task:crsReport.s_cur_task,cur_rep:crsReport.s_postfix,from_user:crsReport.s_assign_user,from_user_dept:crsReport.s_assign_user_dept,json:1,batch:1,actions:crsReport.b_crs_gz?crs_encode(c):HandleMemoStr2(c),P:crsReport.s_P},dataType:"json",success:function(d){b=d},async:false});return b}};function TCRSDataRecord(h,g,f,l,k){this.dataSet=h;this.rows=[];this.doLoaded=false;this.columnList=f;if(f!=undefined){this.arr_column_list=f.split(";")}this.condExpr=l;this.tabName=g;this.orderExpr=k;this.cursor=0}TCRSDataRecord.prototype={loadData:function(b){if(this.doLoaded){return}if(this.tabName.indexOf("crscell.")==0){this.tabName=this.tabName.substr(8)}this.dataSet.execQuery(this.tabName,this.columnList,this.orderExpr!=""?this.condExpr+" order by "+this.orderExpr:this.condExpr,this.loadDataCB,this,b);this.doLoaded=true},loadDataCB:function(e,f){var d=f.rows;$.each(e,function(b,a){d.push(a)})},isEmpty:function(){return this.rows.length==0},EOF:function(){return this.rows.length<=this.cursor},first:function(){this.cursor=0;return this.rows[this.cursor]},next:function(){++this.cursor;if(this.EOF()){return null}else{return this.rows[this.cursor]}},length:function(){return this.rows.length},search:function(c,f){var g=this.cursor;if(!this.isEmpty()){var h=this.first();while(!this.EOF()){if(h[c]==f){this.cursor=g;return h}h=this.next()}}this.cursor=g;return null},multi_search:function(c,o){var l=this.cursor;if(!this.isEmpty()){var m=this.first();while(!this.EOF()){for(var p=0,k=c.length;p<k;p++){var n=c[p],q=o[p];if(m[n]!=q){break}}if(p==c.length){this.cursor=l;return m}m=this.next()}}this.cursor=l;return null},get_nth_by_col_name:function(b){return indexOf(this.arr_column_list,b)},empty:function(){this.rows=[];this.doLoaded=false}};function TCRSTable(d,c){this.tabId=d;this.column=c}function TCRSTableIndex(c,d){this.repId=d;this.curColumn=null;this.crsDataSet=c;TCRSDataRecord.call(this,this.crsDataSet,"crscell.crs_tableindex","id,sheetindex,label,tabletype,expandtype,initcz,ishidden","repid='"+this.repId+"'","position");this.columns=[];this.colSchemas={};this.listValues={};this.obj_new_row_kid=null;this.obj_loaded_row_kid=null;this.obj_deleted_row_kid=null;this.arr_tab_property=null;this.arr_tab_id=null;this.arr_cur_tab_name=null;this.arr_hidden_rows=null;this.arr_hidden_cols=null;this.arr_col_name_to_kid=null;this.arr_col_id_to_kid=null;this.arr_incalcu_cell=null}TCRSTableIndex.prototype=new TCRSDataRecord();TCRSTableIndex.prototype.initColSchema=function(){this.loadData("#tablecrs_tableindex"+this.repId);if(!this.isEmpty()){var o=crsReport.s_cur_task;if(o==""){o=crsReport.s_begin_task}var n=this.first();while(!this.EOF()){if(n.initcz<1){n.initcz=1}var r=this.getColumn(n.id);if(r.i_init_cz!=n.initcz){r.i_init_cz=n.initcz}r.loadData("#tablecrs_columnindex"+n.id);if(!r.isEmpty()){var p=r.first();while(!r.EOF()){if(p.datas_from_template==undefined){p.datas_from_template=""}if(crsReport.b_as_form&&p.datas_from_template!=""){p.datas_from_template=HandleMemoStr(p.datas_from_template,false).split("\u2522")}if(p.color==""){p.color=16}var m=getColPlatKId(p.kid);this.colSchemas[m]={};if(crsReport.openMode=="read"){var k=false}else{var k=true}if(p.has_inline_calcu=="y"){if(this.arr_incalcu_cell==null){this.arr_incalcu_cell=[]}this.arr_incalcu_cell.push(m);if(p.readonly!="\u662f"){p.readonly="\u662f"}}if(p.readonly=="\u662f"||p.datatype=="\u81ea\u52a8\u7f16\u53f7"||p.datatype=="\u81ea\u589e\u578b"){k=false}var q=true;if(p.ishidden=="\u662f"||n.ishidden=="\u662f"||(p.ishidden2!=undefined&&p.ishidden2=="\u662f")){if(p.ishidden!="\u662f"){p.ishidden="\u662f"}q=false;k=false}if(k&&crsReport.writeColList!=null&&crsReport.writeColList.indexOf(p.kid)==-1){k=false}if(q&&crsReport.readColList!=null&&crsReport.readColList.indexOf(p.kid)==-1){q=false}this.colSchemas[m].canread=q;this.colSchemas[m].canwrite=k;if((this.colSchemas[m].canwrite||this.colSchemas[m].canread)&&p.istogether!=undefined&&p.istogether=="\u662f"){crsReport.arr_colwrite_cols.push(p.kid)}if(k&&n.canwrite==undefined){n.canwrite=true}if(q&&n.canread==undefined){n.canread=true}if((q||k)&&!crsReport.b_has_sign_seal&&p.datatype=="\u624b\u5199\u7b7e\u7ae0"){crsReport.b_has_sign_seal=true}if(n.tabletype=="\u4e3b\u8868"){if(q||k){if(p.datatype=="\u56fe\u7247\u578b"){if(r.arr_picture_cols==null){r.arr_picture_cols=[]}r.arr_picture_cols.push(p.kid)}else{r.arr_output_cols.push(r.cursor)}}else{if(r.arr_hidden_cols==null){r.arr_hidden_cols=[]}r.arr_hidden_cols.push(r.cursor)}}if(!q&&!k){if(this.arr_hidden_rows==null){this.arr_hidden_rows={}}if(this.arr_hidden_rows[n.id]==undefined){this.arr_hidden_rows[n.id]={col:[],dat:[]}}this.arr_hidden_rows[n.id]["col"].push(p.kid)}this.colSchemas[m].ismust=false;if(p.ismust=="\u662f"){this.colSchemas[m].ismust=true}else{if(p.ismust!=""){var l=p.ismust.split(",");if(l.indexOf(o)!=-1){this.colSchemas[m].ismust=true}}}this.colSchemas[m].id=p.id;this.colSchemas[m].kid=p.kid;this.colSchemas[m].tableid=p.tableid;this.colSchemas[m].datatype=p.datatype;this.colSchemas[m].displaystyle=p.displaystyle;this.colSchemas[m].codeid=p.codeid;this.colSchemas[m].display_rect=rectNameToIndex(p.cellspan);this.colSchemas[m].row_idx=this.cursor;this.colSchemas[m].col=r;this.colSchemas[m].col_idx=r.cursor;this.colSchemas[m].check_value=function(d){var b="";if(d==undefined||d==null||d==""||d.charAt(0)=="#"){return""}var e=this.col.rows[this.col_idx];if(e.datatype=="\u65e5\u671f\u578b"){var g="";var f="";var w="";var s="";if(d.indexOf(":")!=-1){if(d.indexOf(" ")==-1){d="0000-00-00 "+d}var c=d.split(" ");var u=c[0].split("-");var h=c[1].split(":");var v=h.length;g=h[0];if(v>1){f=h[1]}if(v>2){w=h[2]}if(v>3){s=h[3]}}else{var u=d.split("-");g=0;f=0;w=0;s=0}if(u.length<2){u.push("00");u.push("00")}else{if(u.length<3){u.push("00")}}var a=Date.parse(u[1]+"/"+u[2]+"/"+u[0]+" "+g+":"+f+":"+w+"."+s);if(typeof a!="number"){b="\u3010"+e.columnlabel+"\u3011\u6307\u6807\u53ea\u5141\u8bb8\u8f93\u5165\u65e5\u671f\u578b\u6570\u636e\uff0c\u8bf7\u68c0\u67e5\u60a8\u7684\u8f93\u5165\uff01"}}else{if(e.datatype=="\u6570\u503c\u578b"){if(d.search(/^[-]{0,1}[0-9]+[.]{0,1}[0-9]*([Ee][+-]{0,1}[0-9]{0,2}){0,1}[%]{0,1}$/g)==-1){b="\u3010"+e.columnlabel+"\u3011\u6307\u6807\u53ea\u5141\u8bb8\u8f93\u5165\u6570\u503c\u578b\u6570\u636e\uff0c\u8bf7\u68c0\u67e5\u60a8\u7684\u8f93\u5165\uff01"}}else{if(e.datatype=="\u8d27\u5e01\u578b"){if(d.search(/^[-]{0,1}[0-9]+[.]{0,1}[0-9]*([Ee][+-]{0,1}[0-9]{0,2}){0,1}$/g)==-1){b="\u3010"+e.columnlabel+"\u3011\u6307\u6807\u53ea\u5141\u8bb8\u8f93\u5165\u8d27\u5e01\u578b\u6570\u636e\uff0c\u8bf7\u68c0\u67e5\u60a8\u7684\u8f93\u5165\uff01"}}}}return b};this.colSchemas[m].get_display_seq=function(c,a){var b=1;if(crsReport.crsTableIndex.rows[this.row_idx].tabletype=="\u660e\u7ec6\u8868"){var d=this.display_rect;if(crsReport.crsTableIndex.rows[this.row_idx].expandtype=="\u4e0d\u6269\u5c55"||crsReport.crsTableIndex.rows[this.row_idx].expandtype=="\u6309\u884c\u5411\u4e0b"){b=(a-d[0].y)/(d[1].y-d[0].y+1)+1}else{b=(c-d[0].x)/(d[1].x-d[0].x+1)+1}}return b};this.colSchemas[m].get_cell_point=function(b){var c={x:this.display_rect[0].x,y:this.display_rect[0].y};var a=crsReport.crsTableIndex.rows[this.row_idx];if(b>1&&a.tabletype=="\u660e\u7ec6\u8868"){if(a.expandtype=="\u6309\u884c\u5411\u4e0b"||a.expandtype=="\u4e0d\u6269\u5c55"){c.y+=(this.display_rect[1].y-this.display_rect[0].y+1)*(b-1)}else{c.x+=(this.display_rect[1].x-this.display_rect[0].x+1)*(b-1)}}return c};this.colSchemas[m].get_cell_rect=function(d){var b=[];b.push({x:this.display_rect[0].x,y:this.display_rect[0].y});b.push({x:this.display_rect[1].x,y:this.display_rect[1].y});var c=crsReport.crsTableIndex.rows[this.row_idx];if(d>1&&c.tabletype=="\u660e\u7ec6\u8868"){if(c.expandtype=="\u6309\u884c\u5411\u4e0b"||c.expandtype=="\u4e0d\u6269\u5c55"){var a=this.display_rect[1].y-this.display_rect[0].y+1;b[0].y+=a*(d-1);b[1].y+=a*(d-1)}else{var a=this.display_rect[1].x-this.display_rect[0].x+1;b[0].x+=a*(d-1);b[1].x+=a*(d-1)}}return b};if(p.radiogroup!=""&&p.datatype=="\u903b\u8f91\u578b"){if(r.arr_radio_group==undefined){r.arr_radio_group=[]}r.arr_radio_group.push(HandleMemoStr(p.radiogroup,false))}p=r.next()}}n=this.next()}}if(typeof plugin_set_hidden=="function"){plugin_set_hidden()}};TCRSTableIndex.prototype.getAColSchema=function(c){var d=getColPlatKId(c);return this.colSchemas[d]};TCRSTableIndex.prototype.getColumn=function(f){var h=0,g=this.columns.length;for(;h<g;h++){if(this.columns[h].tabId==f){break}}if(h>=g){var e=new TCRSColumnIndex(this.crsDataSet,f);this.columns.push(new TCRSTable(f,e));return e}else{return this.columns[h].column}};TCRSTableIndex.prototype.getFirstTable=function(){this.loadData("#tablecrs_tableindex"+this.repId);res=null;if(!this.isEmpty()){var c=this.first();while(!this.EOF()){if(c.ishidden!="\u662f"){this.curColumn=this.getColumn(c.id);res=[];res.push(c.tabletype=="\u4ea4\u53c9\u8868"?"\u4e3b\u8868":c.tabletype);res.push(c.sheetindex);res.push(c.expandtype);res.push(c.initcz);var d=this.curColumn.getRecordCount();if(d>c.initcz){c.initcz=d}res.push(d);res.push(this.curColumn.getColumnDefRect(c.expandtype));break}c=this.next()}}return res};TCRSTableIndex.prototype.getNextTable=function(){this.loadData("#tablecrs_tableindex"+this.repId);res=null;if(!this.isEmpty()){var c=this.next();while(!this.EOF()){if(c.ishidden!="\u662f"){this.curColumn=this.getColumn(c.id);res=[];res.push(c.tabletype=="\u4ea4\u53c9\u8868"?"\u4e3b\u8868":c.tabletype);res.push(c.sheetindex);res.push(c.expandtype);res.push(c.initcz);var d=this.curColumn.getRecordCount();if(d>c.initcz){c.initcz=d}res.push(d);res.push(this.curColumn.getColumnDefRect(c.expandtype));break}c=this.next()}}return res};TCRSTableIndex.prototype.GetFirstWritableCellList=function(k){var o=null;this.loadData("#tablecrs_tableindex"+this.repId);var q=true;if(!this.isEmpty()){var m=this.first();while(!this.EOF()){if(m.ishidden!="\u662f"){if(k!=null){for(var p=0,l=k.length;p<l;p++){var r=this.getColumn(m.id);var n=this.getAColSchema(k[p]);if(true||r==n.col){q=true;break}else{if(q){q=false}}}}if(q){break}}m=this.next()}if(m!=null){r=this.getColumn(m.id);this.curColumn=r;o=r.getWriteCellList(m,k)}}return o};TCRSTableIndex.prototype.GetNextWritableCellList=function(k){var o=null;this.loadData("#tablecrs_tableindex"+this.repId);var q=true;if(!this.isEmpty()){var m=this.next();while(!this.EOF()){if(m.ishidden!="\u662f"){if(k!=null){for(var p=0,l=k.length;p<l;p++){var r=this.getColumn(m.id);var n=this.getAColSchema(k[p]);if(true||r==n.col){q=true;break}else{if(q){q=false}}}}if(q){break}}m=this.next()}if(m!=null){r=this.getColumn(m.id);this.curColumn=r;o=r.getWriteCellList(m,k)}}return o};TCRSTableIndex.prototype.get_sheet_sz=function(){var a=$("table").last();return parseInt($(a).attr("id").replace("sheet",""))+1};TCRSTableIndex.prototype.loadCodeItem=function(B){var G=crsReport.crsCommon.get_row_seq(B);var C=this.getAColSchema(crsReport.crsCommon.get_cid_by_td(B));var t=this.rows[C.row_idx].label+C.col.rows[C.col_idx].columnlabel;var F="y."+G+"."+t+".";if(this.listValues[F]==undefined){F="n."+G+"."+t+".";if(this.listValues[F]==undefined){G=0;F="y."+G+"."+t+".";if(this.listValues[F]==undefined){F="n."+G+"."+t+".";if(this.listValues[F]==undefined){F=""}}}}if(F!=""&&this.listValues[F]!=undefined){if(this.listValues[F].data_list.length>0&&this.listValues[F].data_list[0].substr(0,5)=="<col>"){if(crsReport.func_show_list_view!=null){crsReport.func_show_list_view(this.listValues[F].data_list,F.substr(0,2)=="n.")}if(F.substr(0,2)=="n."){return}}else{var z='<select onchange="javascript:crsReport.change_handler(this);" style="position: absolute;left:'+i_l+"; top:"+i_t+";width:"+i_w+";height:"+i_h+';" id="'+$(B).attr("cid")+'"><option></option>';for(var A=0,w=this.listValues[F].data_list.length;A<w;A++){var v=(this.listValues[F].data_list[A]==val)?"selected":"";if(A==0){if(F.substr(0,2)=="y."){z+="<option value='<\u8f93\u5165...>'><\u8f93\u5165...></option>"}}z+="<option value='"+this.listValues[F].data_list[A]+"' "+v+">"+this.listValues[F].data_list[A]+"</option>"}z+="</select>";return z}}return;if(C.datatype=="\u4ee3\u7801\u578b"){if(C.codeid=="-10"){return'<form name="form1"style="position: absolute;left:'+i_l+"; top:"+i_t+";height:"+i_h+";width:"+i_w+';" id="'+$(B).attr("cid")+'"><a href="javascript:;" class="orgAdd" onClick="SelectDept();">\u6dfb\u52a0</a>&nbsp;&nbsp;<a href="javascript:;" class="orgClear" onClick="ClearUser()">\u6e05\u7a7a</a>&nbsp;&nbsp;<a href="javascript:;" class="orgAdd" onClick="javascript:getName(this);">\u786e\u8ba4</a><input type="hidden" name="TO_ID" value=""><textarea style="height:'+i_h+";width:"+i_w+';" cols=20 name=TO_NAME rows=1 class="BigStatic" wrap="yes" readonly>'+val+"</textarea></form>"}else{if(C.codeid=="-11"){return'<form name="form1" style="position: absolute;left:'+i_l+"; top:"+i_t+";height:"+i_h+";width:"+i_w+';z-index:1;" id="'+$(B).attr("cid")+'"><a href="javascript:;" class="orgAdd" onClick="SelectUser(\'admin\',\'COPY_TO_ID\', \'COPY_TO_NAME\');">\u6dfb\u52a0</a>&nbsp;&nbsp;<a href="javascript:;" class="orgClear" onClick="ClearUser(\'COPY_TO_ID\', \'COPY_TO_NAME\')">\u6e05\u7a7a</a>&nbsp;&nbsp;<a href="javascript:;" class="orgAdd" onClick="javascript:getName(this);">\u786e\u8ba4</a><input type="hidden" name="COPY_TO_ID" value=""><textarea style="height:'+i_h+";width:"+i_w+';" cols=20 name="COPY_TO_NAME" rows=2 class="BigStatic" wrap="yes" readonly>'+val+"</textarea></form>"}else{if(parseInt(C.codeid)>0){var D=crsReport.crsCodeIndex.get_select(C.codeid,val);if(D==""){var f="";if(crsReport.crsCodeIndex.is_readonly(C.codeid)){f="readOnly"}return"<input "+f+' style="position: absolute;left:'+i_l+"; top:"+i_t+";height:"+i_h+";width:"+i_w+';" id="'+getColPlatKId($(B).attr("cid"))+'" name="" size="20" class="BigInput" value="'+val+'" onClick="javascript:crsReport.crsCodeIndex.get_tree('+C.codeid+", '"+val+"', 0, 1, 0, '', '"+getColPlatKId($(B).attr("cid"))+'\');" onchange="javascript:crsReport.change_handler(this);">'}else{return'<select style="position: absolute;left:'+i_l+"; top:"+i_t+";width:"+i_w+';" id="'+$(B).attr("cid")+'" onchange="javascript:crsReport.change_handler(this);">'+D+"</select>"}}else{if(C.codeid!=""){var u=HandleMemoStr(C.codeid,false).split("|");var E="";for(var s=0,x=u.length;s<x;s++){if(s==0&&u[0]!=""){E+="<option value=''></option><option value='<\u8f93\u5165...>'><\u8f93\u5165...></option>"}var f=HandleMemoStr(u[s],false);if(f==val){E+="<option value='"+f+"' selected>"+f+"</option>"}else{E+="<option value='"+f+"'>"+f+"</option>"}}return'<select style="position: absolute;left:'+i_l+"; top:"+i_t+";width:"+i_w+';" id="'+$(B).attr("cid")+'" onchange="javascript:crsReport.change_handler(this);">'+E+"</select>"}}}}}else{if(C.datatype=="\u65e5\u671f\u578b"){if(C.displaystyle=="yyyy\u5e74"){return'<input style="position: absolute;left:'+i_l+"; top:"+i_t+";height:"+i_h+";width:"+i_w+';" id="'+$(B).attr("cid")+'" name="" size="20" class="BigInput" value="'+val+'" onClick="WdatePicker({dateFmt:\'yyyy\'})" onchange="javascript:crsReport.change_handler(this);">'}else{if(C.displaystyle=="yyyy\u5e74mm\u6708"||C.displaystyle=="yyyy.mm"){var y=(C.displaystyle=="yyyy\u5e74mm\u6708")?"yyyy\u5e74MM\u6708":"yyyy.MM";return'<input style="position: absolute;left:'+i_l+"; top:"+i_t+";height:"+i_h+";width:"+i_w+';" id="'+$(B).attr("cid")+'" name="" size="20" class="BigInput" value="'+val+'" onClick="WdatePicker({dateFmt:\''+y+'\'})"onchange="javascript:crsReport.change_handler(this);">'}else{if(C.displaystyle.indexOf(":")!=-1){return'<input style="position: absolute;left:'+i_l+"; top:"+i_t+";height:"+i_h+";width:"+i_w+';" id="'+$(B).attr("cid")+'" name="" size="20" class="BigInput" value="'+val+'" onClick="WdatePicker({dateFmt:\'yyyy-MM-dd HH:mm:ss:ms\'})" onchange="javascript:crsReport.change_handler(this);">'}else{return'<input style="position: absolute;left:'+i_l+"; top:"+i_t+";height:"+i_h+";width:"+i_w+';" id="'+$(B).attr("cid")+'" name="" size="20" class="BigInput" value="'+val+'" onClick="WdatePicker({dateFmt:\'yyyy-MM-dd\'})"onchange="javascript:crsReport.change_handler(this);">'}}}}else{if(C.datatype=="\u5b57\u7b26\u578b"){return'<textarea style="position: absolute;left:'+i_l+"; top:"+i_t+";height:"+i_h+";width:"+i_w+';" id="'+B.cid+'"onchange="javascript:crsReport.change_handler(this);">'+val+"</textarea>"}else{if(C.datatype=="\u81ea\u589e\u578b"){}else{if(C.datatype=="\u903b\u8f91\u578b"){if($(B).attr("val")=="\u221a"){crsReport.crsCellControler.set_cell_value(B,"")}else{crsReport.crsCellControler.set_cell_value(B,"\u221a")}}else{if(C.datatype=="\u56fe\u7247\u578b"){if($(B).html()==""){return'<form name="form01" method="post" enctype= "multipart/form-data">\u8bf7\u9009\u62e9\u56fe\u7247<input style="position:absolute;margin-left:-220px;opacity:0;" type= "file" id="FILE1" accept="image/*" name="FILE1" onchange="javascript:crsReport.submit_picture(this);" /></form>'}}else{if(C.datatype=="\u9644\u4ef6\u578b"){if($(B).html()==""){return'<form name="form01" method="post" enctype= "multipart/form-data">\u8bf7\u9009\u62e9\u9644\u4ef6<input style="position:absolute;margin-left:-220px;opacity:0;" type= "file" id="FILE1" name="FILE1" onchange="javascript:crsReport.submit_attach(this);" /></form>'}}else{return'<input style="position: absolute;left:'+i_l+"; top:"+i_t+";height:"+i_h+";width:"+i_w+';" id="'+$(B).attr("cid")+'" name="" class="BigInput" value="'+val+'" onchange="javascript:crsReport.change_handler(this);">'}}}}}}}};TCRSTableIndex.prototype.get_col_kid_by_name=function(l,q){var n=l+"."+q;if(this.arr_col_name_to_kid!=null&&this.arr_col_name_to_kid[n]!=undefined){return this.arr_col_name_to_kid[n]}this.loadData("#tablecrs_tableindex"+this.repId);for(var p=0,m=this.rows.length;p<m;p++){if(this.rows[p].label==l){var o=this.getColumn(this.rows[p].id);o.loadData("#tablecrs_columnindex"+this.rows[p].id);for(var r=0,k=o.rows.length;r<k;r++){if(o.rows[r].columnlabel==q){if(this.arr_col_name_to_kid==null){this.arr_col_name_to_kid=[]}this.arr_col_name_to_kid[n]=o.rows[r].kid;return o.rows[r].kid}}break}}return""};TCRSTableIndex.prototype.get_col_kid_by_id=function(l,k){this.loadData("#tablecrs_tableindex"+this.repId);if(this.arr_col_id_to_kid!=null&&this.arr_col_id_to_kid[k]!=undefined){return this.arr_col_id_to_kid[k]}for(var o=0,m=this.rows.length;o<m;o++){if(this.rows[o].id==l){var n=this.getColumn(this.rows[o].id);n.loadData("#tablecrs_columnindex"+this.rows[o].id);for(var p=0,h=n.rows.length;p<h;p++){if(n.rows[p].id==k){if(this.arr_col_id_to_kid==null){this.arr_col_id_to_kid=[]}this.arr_col_id_to_kid[k]=n.rows[p].kid;return n.rows[p].kid}}break}}return""};TCRSTableIndex.prototype.get_col_id_by_col_kid=function(c){var d=this.getAColSchema(c);return d.id};TCRSTableIndex.prototype.get_tab_id_by_col_kid=function(c){var d=this.getAColSchema(c);return this.rows[d.row_idx].id};TCRSTableIndex.prototype.get_tab_id_by_name=function(d){var c=this.search("label",d);if(c!=null){return c.id}else{return -1}};TCRSTableIndex.prototype.get_cell_value=function(s,m,o,n){this.loadData("#tablecrs_tableindex"+this.repId);if(o==undefined){if(!this.isEmpty()){var k=this.first();while(!this.EOF()){var r=this.getColumn(k.id);r.loadData("#tablecrs_columnindex"+k.id);if(!r.isEmpty()){var p=r.first();while(!r.EOF()){if(s==p.kid){return r.get_raw_value(p.id,m)}p=r.next()}}k=this.next()}}}else{if(!n){s=this.get_tab_id_by_name(s)}var l=this.getColumn(s);var q=this.search("id",s);if(q.tabletype=="\u4ea4\u53c9\u8868"){}else{return l.get_cell_value(m,o,n,q,false)}}};TCRSTableIndex.prototype.get_cur_tab_name=function(d){this.loadData("#tablecrs_tableindex"+this.repId);var c=this.getColumn(d);return c.get_cur_tab_name()};TCRSTableIndex.prototype.get_col_name=function(b,c){this.loadData("#tablecrs_tableindex"+this.repId);var a=this.getColumn(b);return a.get_name_by_id(c)};TCRSTableIndex.prototype.get_tab_type_by_id=function(d){var c=this.search("id",d);if(c!=null){return c.tabletype}else{return""}};TCRSTableIndex.prototype.get_tab_size_by_id=function(d){var c=this.search("id",d);if(c!=null&&c.tabletype=="\u660e\u7ec6\u8868"){return c.initcz}else{return 1}};TCRSTableIndex.prototype.clear_values_on_list=function(d,f,e){if(this.listValues["y."+e+"."+d+f+"."]!=undefined){this.listValues["y."+e+"."+d+f+"."]=undefined}else{if(this.listValues["n."+e+"."+d+f+"."]!=undefined){this.listValues["n."+e+"."+d+f+"."]=undefined}}if(crsReport.b_as_form){}};TCRSTableIndex.prototype.clear_data_item=function(o){if(o==null||o.length<=0){return}var p=0,r=o.length/3;while(p<r){var k=o[p*3];if(k!=""){var n=this.search("label",k);if(n!=null){var l=this.getColumn(n.id);var q=p;var m=[];while(q<r){if(o[q*3]==k){m.push(o[q*3+1]);m.push(o[q*3+2]);o[q*3]=""}q++}l.clear_data_item(n,m)}}p=q}};TCRSTableIndex.prototype.create_cur_table_data=function(b){return this.save_data(true,true,false,false,b)};TCRSTableIndex.prototype.reset_cell_color=function(m){if(m==null||m.length<=0){return}var p=0,r=m.length/3;while(p<r){var k=m[p*3];if(k!=""){var n=this.search("id",k);if(n!=null){var l=this.getColumn(n.id);var q=p;var o=[];while(q<r){if(m[q*3]==k){o.push(m[q*3+1]);o.push(m[q*3+2]);m[q*3]=""}q++}l.reset_cell_color(n,o)}}p++}};TCRSTableIndex.prototype.update_cell_refer=function(l,o,r,k,m){var p=this.cursor;if(!this.isEmpty()){var n=this.first();while(!this.EOF()){if(n.sheetindex==l){var q=this.getColumn(n.id);if(q!=null){q.update_cell_refer(r,m?"insert":"delete",k,o)}}n=this.next()}}this.cursor=p};TCRSTableIndex.prototype.get_first_data_item=function(){if(this.curColumn!=null){return this.curColumn.get_first_data_item()}return null};TCRSTableIndex.prototype.get_next_data_item=function(){if(this.curColumn!=null){return this.curColumn.get_next_data_item()}return null};TCRSTableIndex.prototype.save_data=function(ax,av,am,ab,an){var au="";var Y=[];if(!ab&&!an&&(this.obj_new_row_kid!=null||this.obj_loaded_row_kid!=null)){if(!av){if(this.obj_loaded_row_kid!=null){for(s_key in this.obj_loaded_row_kid){this.obj_loaded_row_kid[s_key].init()}}if(this.obj_new_row_kid!=null){for(s_key in this.obj_new_row_kid){this.obj_new_row_kid[s_key].init()}}}var aw=crsReport.get_valid_cur_task();var N=this;if(!av){var S=[]}if(crsReport.b_as_form){if(!crsReport.crsTableIndex.isEmpty()){var al=crsReport.crsTableIndex.first();while(!crsReport.crsTableIndex.EOF()){var V=true;var ar,at,U;if(al.tabletype=="\u4e3b\u8868"){ar="main_tab_"+al.id;at="rid";U="cid"}else{ar="detail_tab_"+al.id;if(crsReport.b_mobile){at="rid";U="cid"}else{at="id";U="aria-describedby"}}var ah=parseInt(al.sheetindex)-1,ak=1,ag="";if(crsReport.b_mobile){var W="#page1 #"+ar+">div["+at+"]>div["+U+"]"}else{var W="table[id^='"+ar+"'] tbody tr["+at+"] td["+U+"]"}$(W).each(function(){if(V){V=false}if(crsReport.b_mobile){var b=$(this).parent("div").attr(at)}else{var b=$(this).parent("tr").attr(at)}if(al.tabletype=="\u660e\u7ec6\u8868"){if(ag!=""&&ag!=b){ak++}if(ag!=b){ag=b}}var m=$(this).attr(U);if(m.charAt(0)!="{"){var c=m.indexOf("{");if(c==-1){return true}m=m.substr(c)}if(b.charAt(0)!="{"||m.charAt(0)!="{"){return true}var q=N.getAColSchema(m),a="";var o=q.col.rows[q.col_idx];var n=q.get_cell_point(ak);if(!an){a=$(this).attr("val");if(a==undefined){if(q.datatype=="\u903b\u8f91\u578b"){if($(this).children().eq(0)[0].checked){a="on"}else{a=""}}else{a=$(this).children().eq(0).val()}if(a==undefined){a=""}}if(a==""){a=$(this).attr("val2")}if(a==undefined){a=""}if(q.datatype=="\u624b\u5199\u7b7e\u7ae0"&&crsReport.DWebSignSeal!=null){var e=my_md5(getColPlatKId(b+m));a=crsReport.DWebSignSeal.GetStoreDataEx(e+"_hw;"+e+"_seal")}if(a==""){if(q.datatype=="\u56fe\u7247\u578b"){}else{if(q.datatype=="\u81ea\u52a8\u7f16\u53f7"&&crsReport.openMode=="write"){if(!av){a=crsReport.crsAutoCode.get_next_autocode(o.codeid,false);if(a!=""){crsReport.crsCommon.set_cell_value(ah,n.x,n.y,a)}}}else{if(q.datatype=="\u4ee3\u7801\u578b"){if(q.codeid=="-10"||q.codeid=="-11"){if($(this).children(":eq(1)").length>0){if(crsReport.b_mobile){a=$(this).children(":eq(1)").html()}else{a=$(this).children(":eq(1)").val()}if(a!=""&&a.charAt(a.length-1)==","){a=a.substr(0,a.length-1)}}else{if($(this).children().length==1){if(a!=""&&a.charAt(a.length-1)==","){a=a.substr(0,a.length-1)}if(q.codeid=="-10"){a=crsReport.crsDeptCache.get_name_by_id(a)}else{a=crsReport.crsUserCache.get_name_by_id(a)}}else{if(a!=""&&a.charAt(a.length-1)==","){a=a.substr(0,a.length-1)}}}}}}}}else{if(q.datatype=="\u65e5\u671f\u578b"){if(q.displaystyle=="yyyy\u5e74"){a+="-01-01"}else{if(q.displaystyle=="yyyy\u5e74mm\u6708"||q.displaystyle=="yyyy.mm"){a+="-01"}}}else{if(q.datatype=="\u4ee3\u7801\u578b"){if(q.codeid=="-10"||q.codeid=="-11"){if($(this).children(":eq(1)").length>0){if(crsReport.b_mobile){a=$(this).children(":eq(1)").html()}else{a=$(this).children(":eq(1)").val()}if(a!=""&&a.charAt(a.length-1)==","){a=a.substr(0,a.length-1)}}else{if($(this).children().length==1){if(a!=""&&a.charAt(a.length-1)==","){a=a.substr(0,a.length-1)}if(q.codeid=="-10"){a=crsReport.crsDeptCache.get_name_by_id(a)}else{a=crsReport.crsUserCache.get_name_by_id(a)}}else{if(a!=""&&a.charAt(a.length-1)==","){a=a.substr(0,a.length-1)}}}}else{a=crsReport.crsCodeIndex.get_value_by_display_text(q.codeid,a)}}else{if(q.datatype=="\u5b57\u7b26\u578b"){if(q.displaystyle=="\u53bb\u7a7a\u683c\u53ca\u6362\u884c"){a=a.trim();if(a!=""&&typeof a=="string"){a=a.replaceAll("<br>","")}}}else{if(q.datatype=="\u56fe\u7247\u578b"){if(ax){var g=crsReport.arr_upload_files.indexOf(a);Y.push(g)}a+=" "+ah+" "+Math.floor($(this).offset().left)+" "+Math.floor($(this).offset().top)+" "+Math.floor($(this).offset().left+$(this).width()-1)+" "+Math.floor($(this).offset().top+$(this).height()-1)+" "+n.x+" "+n.y}else{if(q.datatype=="\u9644\u4ef6\u578b"){a="{"+getColPlatKId(b+m)+"}_"+a;if(ax){var g=crsReport.arr_upload_files.indexOf(a);Y.push(g)}}else{if(q.datatype=="\u903b\u8f91\u578b"){if(a=="on"){a="\u221a"}}}}}}}}if(crsReport.arr_colwrite_cols.indexOf(q.kid)!=-1){if($(this).attr("pval")!=undefined&&$(this).attr("pval")!=""){var l=$(this).attr("pval");if(a==l){a=""}l=l.replaceAll("|",CRSUpRight1);l=l.replaceAll("\n",CRSNewLine);l=l.replaceAll(CRSUpRight,"|");var f=l.split("|");var r=f.indexOf(crsReport.s_writer);if(r!=-1){if(a!=""&&a.charAt(0)!="["){f[r+1]=a}a="";for(var r=0,h=f.length/3;r<h;r++){f[r*3+2]=f[r*3+2].replaceAll(CRSUpRight1,"|");f[r*3+2]=f[r*3+2].replaceAll(CRSNewLine,"\n");if(a!=""){a+=CRSUpRight}a+=f[r*3]+CRSUpRight+f[r*3+1]+CRSUpRight+f[r*3+2]}}else{a=$(this).attr("pval")+CRSUpRight+crsReport.s_writer_organid+CRSUpRight+crsReport.s_writer+CRSUpRight+a}}else{if(a!=""){a=crsReport.s_writer_organid+CRSUpRight+crsReport.s_writer+CRSUpRight+a}}}}else{if(N.obj_loaded_row_kid==null||N.obj_loaded_row_kid[getColPlatKId(b)]==undefined){return true}a=$(this).attr("pval");if(a==undefined){a=""}}if(av){if(a==""){if(q.datatype=="\u6570\u503c\u578b"||q.datatype=="\u8d27\u5e01\u578b"||q.datatype=="\u65e5\u671f\u578b"){a="null"}}if(typeof a=="string"){a=a.replaceAll("'",CRSSlash+"'")}q.col.obj_data_cache.add_cur_col_val(q.get_display_seq(n.x,n.y),m,a)}else{if(a!=""){var d=q.check_value(a);if(d!=""){if(au.indexOf(d)==-1){au+=d+"\n"}}}else{if(q.datatype=="\u6570\u503c\u578b"||q.datatype=="\u8d27\u5e01\u578b"||q.datatype=="\u65e5\u671f\u578b"){a="null"}}if(typeof a=="string"){a=a.replaceAll("'",CRSSlash+"'")}var p=null;if(N.obj_new_row_kid!=null){p=N.obj_new_row_kid[getColPlatKId(b)];if(p==undefined){p=null}}if(p==null){if(N.obj_loaded_row_kid!=null){p=N.obj_loaded_row_kid[getColPlatKId(b)];if(p==undefined){p=null}if(a!=$(this).attr("pval")&&(crsReport.writeColList==null||crsReport.writeColList.indexOf(m)!=-1)){p.update_col_value("col"+q.id,a)}}}p.add_col_value("col"+q.id,a,q.datatype=="\u81ea\u589e\u578b");if(crsReport.crsTableIndex.rows[q.row_idx].tabletype=="\u660e\u7ec6\u8868"){p.calc_display_seq(o.cellspan,crsReport.crsTableIndex.rows[q.row_idx].expandtype,n.x,n.y)}if(!av&&a!=$(this).attr("pval")){S.push(ah);S.push(n.x);S.push(n.y);S.push(a)}}});if(crsReport.crsTableIndex.arr_hidden_rows!=null){if(V){if(crsReport.crsTableIndex.arr_hidden_rows[al.id]!=undefined){var ai=0;for(s_rid in crsReport.crsTableIndex.arr_hidden_rows[al.id]["dat"]){if(typeof crsReport.crsTableIndex.arr_hidden_rows[al.id]["dat"][s_rid]=="function"){break}ai++;var L=null;if(N.obj_new_row_kid!=null){L=N.obj_new_row_kid[getColPlatKId(s_rid)];if(L==undefined){L=null}}if(L==null){if(N.obj_loaded_row_kid!=null){L=N.obj_loaded_row_kid[getColPlatKId(s_rid)];if(L==undefined){L=null}var K=0;for(s_cid in crsReport.crsTableIndex.arr_hidden_rows[al.id]["dat"][s_rid]){if(typeof crsReport.crsTableIndex.arr_hidden_rows[al.id]["dat"][s_rid][s_cid]=="function"){break}var M=crsReport.crsTableIndex.getAColSchema(s_cid);if(av){M.col.obj_data_cache.add_cur_col_val(ai,s_cid,crsReport.crsTableIndex.arr_hidden_rows[al.id]["dat"][s_rid][s_cid]["val"])}else{if(crsReport.crsTableIndex.arr_hidden_rows[al.id]["dat"][s_rid][s_cid]["val"]!=crsReport.crsTableIndex.arr_hidden_rows[al.id]["dat"][s_rid][s_cid]["pval"]){L.update_col_value("col"+M.id,crsReport.crsTableIndex.arr_hidden_rows[al.id]["dat"][s_rid][s_cid]["val"])}}K++}}}else{var K=0;for(s_cid in crsReport.crsTableIndex.arr_hidden_rows[al.id]["dat"][s_rid]){if(typeof crsReport.crsTableIndex.arr_hidden_rows[al.id]["dat"][s_rid][s_cid]=="function"){break}var M=crsReport.crsTableIndex.getAColSchema(s_cid);if(av){M.col.obj_data_cache.add_cur_col_val(ai,s_cid,crsReport.crsTableIndex.arr_hidden_rows[al.id]["dat"][s_rid][s_cid]["val"])}else{L.add_col_value("col"+M.id,crsReport.crsTableIndex.arr_hidden_rows[al.id]["dat"][s_rid][s_cid]["val"],M.datatype=="\u81ea\u589e\u578b")}K++}}L.calc_display_seq(ai)}}}else{if(crsReport.crsTableIndex.arr_hidden_rows[al.id]!=undefined){var ai=0;for(s_rid in crsReport.crsTableIndex.arr_hidden_rows[al.id]["dat"]){if(typeof crsReport.crsTableIndex.arr_hidden_rows[al.id]["dat"][s_rid]=="function"){break}ai++;var L=null;if(N.obj_new_row_kid!=null){L=N.obj_new_row_kid[getColPlatKId(s_rid)];if(L==undefined){L=null}}if(L==null){if(N.obj_loaded_row_kid!=null){L=N.obj_loaded_row_kid[getColPlatKId(s_rid)];if(L==undefined){L=null}var K=0;for(s_cid in crsReport.crsTableIndex.arr_hidden_rows[al.id]["dat"][s_rid]){if(typeof crsReport.crsTableIndex.arr_hidden_rows[al.id]["dat"][s_rid][s_cid]=="function"){break}var M=crsReport.crsTableIndex.getAColSchema(s_cid);if(av){M.col.obj_data_cache.add_cur_col_val(ai,s_cid,crsReport.crsTableIndex.arr_hidden_rows[al.id]["dat"][s_rid][s_cid]["val"])}else{if(crsReport.crsTableIndex.arr_hidden_rows[al.id]["dat"][s_rid][s_cid]["val"]!=crsReport.crsTableIndex.arr_hidden_rows[al.id]["dat"][s_rid][s_cid]["pval"]){L.update_col_value("col"+M.id,crsReport.crsTableIndex.arr_hidden_rows[al.id]["dat"][s_rid][s_cid]["val"])}}K++}}}else{var K=0;for(s_cid in crsReport.crsTableIndex.arr_hidden_rows[al.id]["dat"][s_rid]){if(typeof crsReport.crsTableIndex.arr_hidden_rows[al.id]["dat"][s_rid][s_cid]=="function"){break}var M=crsReport.crsTableIndex.getAColSchema(s_cid);if(av){M.col.obj_data_cache.add_cur_col_val(ai,s_cid,crsReport.crsTableIndex.arr_hidden_rows[al.id]["dat"][s_rid][s_cid]["val"])}else{L.add_col_value("col"+M.id,crsReport.crsTableIndex.arr_hidden_rows[al.id]["dat"][s_rid][s_cid]["val"],M.datatype=="\u81ea\u589e\u578b")}K++}}}}}}al=crsReport.crsTableIndex.next()}}}else{$("table[id^='sheet'] td").each(function(){if($(this).attr("cid")!=undefined&&($(this).attr("rid")!=undefined||$(this).parent("tr").attr("rid")!=undefined)){var m=crsReport.crsCommon.crsTable.crsCellControler.get_sheet_index_by_cell($(this));var n=crsReport.crsCommon.crsTable.crsCellControler.get_cell_point($(this));var a=N.getAColSchema($(this).attr("cid")),b="",c="";c=$(this).attr("rid");if(c==undefined){c=$(this).parent("tr").attr("rid")}var o=a.col.rows[a.col_idx];if(!an){b=$(this).attr("val");if(b==undefined){b=""}if(b==""){b=$(this).attr("val2")}if(b==undefined){b=""}if(a.datatype=="\u624b\u5199\u7b7e\u7ae0"&&crsReport.DWebSignSeal!=null){var f=my_md5(getColPlatKId(c+a.kid));b=crsReport.DWebSignSeal.GetStoreDataEx(f+"_hw;"+f+"_seal")}if(b==""){if(a.datatype=="\u56fe\u7247\u578b"){}else{if(a.datatype=="\u81ea\u52a8\u7f16\u53f7"&&crsReport.openMode=="write"){if(!av){b=crsReport.crsAutoCode.get_next_autocode(o.codeid,false);if(b!=""){crsReport.crsCommon.set_cell_value(m,n.x,n.y,b)}}}else{if(a.datatype=="\u4ee3\u7801\u578b"){if(a.codeid=="-10"){if($(this).children(":eq(1)").length>0){b=$(this).children(":eq(1)").val();if(b!=""&&b.charAt(b.length-1)==","){b=b.substr(0,b.length-1)}}else{if($(this).children().length==1){if(b!=""&&b.charAt(b.length-1)==","){b=b.substr(0,b.length-1)}b=crsReport.crsDeptCache.get_name_by_id(b)}else{if(b!=""&&b.charAt(b.length-1)==","){b=b.substr(0,b.length-1)}}}}else{if(a.codeid=="-11"){if($(this).children(":eq(1)").length>0){b=$(this).children(":eq(1)").val();if(b!=""&&b.charAt(b.length-1)==","){b=b.substr(0,b.length-1)}}else{if($(this).children().length==1){if(b!=""&&b.charAt(b.length-1)==","){b=b.substr(0,b.length-1)}b=crsReport.crsUserCache.get_name_by_id(b)}else{if(b!=""&&b.charAt(b.length-1)==","){b=b.substr(0,b.length-1)}}}}}}}}}else{if(a.datatype=="\u65e5\u671f\u578b"){if(a.displaystyle=="yyyy\u5e74"){b+="-01-01"}else{if(a.displaystyle=="yyyy\u5e74mm\u6708"||a.displaystyle=="yyyy.mm"){b+="-01"}}if(b!=""){b=b.replace(".","-")}}else{if(a.datatype=="\u4ee3\u7801\u578b"){if(a.codeid=="-10"){if($(this).children(":eq(1)").length>0){b=$(this).children(":eq(1)").val();if(b!=""&&b.charAt(b.length-1)==","){b=b.substr(0,b.length-1)}}else{if($(this).children().length==1){if(b!=""&&b.charAt(b.length-1)==","){b=b.substr(0,b.length-1)}b=crsReport.crsDeptCache.get_name_by_id(b)}else{if(b!=""&&b.charAt(b.length-1)==","){b=b.substr(0,b.length-1)}}}}else{if(a.codeid=="-11"){if($(this).children(":eq(1)").length>0){b=$(this).children(":eq(1)").val();if(b!=""&&b.charAt(b.length-1)==","){b=b.substr(0,b.length-1)}}else{if($(this).children().length==1){if(b!=""&&b.charAt(b.length-1)==","){b=b.substr(0,b.length-1)}b=crsReport.crsUserCache.get_name_by_id(b)}else{if(b!=""&&b.charAt(b.length-1)==","){b=b.substr(0,b.length-1)}}}}else{b=crsReport.crsCodeIndex.get_value_by_display_text(a.codeid,b)}}}else{if(a.datatype=="\u5b57\u7b26\u578b"){if(a.displaystyle=="\u53bb\u7a7a\u683c\u53ca\u6362\u884c"){b=b.trim();if(b!=""&&typeof b=="string"){b=b.replaceAll("<br>","")}}}else{if(a.datatype=="\u56fe\u7247\u578b"){if(ax){var l=crsReport.arr_upload_files.indexOf(b);Y.push(l)}b+=" "+m+" "+Math.floor($(this).offset().left)+" "+Math.floor($(this).offset().top)+" "+Math.floor($(this).offset().left+$(this).width()-1)+" "+Math.floor($(this).offset().top+$(this).height()-1)+" "+n.x+" "+n.y}else{if(a.datatype=="\u9644\u4ef6\u578b"){b="{"+getColPlatKId(c+a.kid)+"}_"+b;if(ax){var l=crsReport.arr_upload_files.indexOf(b);Y.push(l)}}else{if(a.datatype=="\u903b\u8f91\u578b"){if(b=="on"){b="\u221a"}}}}}}}}if(crsReport.arr_colwrite_cols.indexOf(a.kid)!=-1){if($(this).attr("pval")!=undefined&&$(this).attr("pval")!=""){var h=$(this).attr("pval");h=h.replaceAll("|",CRSUpRight1);h=h.replaceAll("\n",CRSNewLine);h=h.replaceAll(CRSUpRight,"|");var e=h.split("|");var q=e.indexOf(crsReport.s_writer);if(q!=-1){if(b!=""&&b.charAt(0)!="["){e[q+1]=b}b="";for(var q=0,g=e.length/3;q<g;q++){e[q*3+2]=e[q*3+2].replaceAll(CRSUpRight1,"|");e[q*3+2]=e[q*3+2].replaceAll(CRSNewLine,"\n");if(b!=""){b+=CRSUpRight}b+=e[q*3]+CRSUpRight+e[q*3+1]+CRSUpRight+e[q*3+2]}}else{b=$(this).attr("pval")+CRSUpRight+crsReport.s_writer_organid+CRSUpRight+crsReport.s_writer+CRSUpRight+b}}else{if(a!=""){b=crsReport.s_writer_organid+CRSUpRight+crsReport.s_writer+CRSUpRight+b}}}}else{if(N.obj_loaded_row_kid==null||N.obj_loaded_row_kid[getColPlatKId(c)]==undefined){return true}b=$(this).attr("pval");if(b==undefined){b=""}}if(av){if(b==""){if(a.datatype=="\u6570\u503c\u578b"||a.datatype=="\u8d27\u5e01\u578b"||a.datatype=="\u65e5\u671f\u578b"){b="null"}}if(typeof b=="string"){b=b.replaceAll("'",CRSSlash+"'")}a.col.obj_data_cache.add_cur_col_val(a.get_display_seq(n.x,n.y),$(this).attr("cid"),b)}else{if(b!=""){var d=a.check_value(b);if(d!=""){if(au.indexOf(d)==-1){au+=d+"\n"}}}else{if(a.datatype=="\u6570\u503c\u578b"||a.datatype=="\u8d27\u5e01\u578b"||a.datatype=="\u65e5\u671f\u578b"){b="null"}}if(typeof b=="string"){b=b.replaceAll("'",CRSSlash+"'")}var p=null;if(N.obj_new_row_kid!=null){p=N.obj_new_row_kid[getColPlatKId(c)];if(p==undefined){p=null}}if(p==null){if(N.obj_loaded_row_kid!=null){p=N.obj_loaded_row_kid[getColPlatKId(c)];if(p==undefined){p=null}if(b!=$(this).attr("pval")&&(crsReport.writeColList==null||crsReport.writeColList.indexOf($(this).attr("cid"))!=-1)){p.update_col_value("col"+a.id,b)}}}p.add_col_value("col"+a.id,b,a.datatype=="\u81ea\u589e\u578b");if(crsReport.crsTableIndex.rows[a.row_idx].tabletype=="\u660e\u7ec6\u8868"){p.calc_display_seq(o.cellspan,crsReport.crsTableIndex.rows[a.row_idx].expandtype,n.x,n.y)}if(!av&&b!=$(this).attr("pval")){S.push(m);S.push(n.x);S.push(n.y);S.push(b)}}}})}if(!av){if(this.arr_tab_property==null){this.arr_tab_property=new Array(this.rows.length);for(var T=0,Q=this.rows.length;T<Q;T++){this.arr_tab_property[T]=new TCRSTableProperty()}for(T in this.colSchemas){var af=this.colSchemas[T].col.rows[this.colSchemas[T].col_idx];if(af.iskey=="\u662f"){if(crsReport.writeColList==null||crsReport.writeColList.indexOf(af.kid)!=-1||crsReport.readColList==null||crsReport.readColList.indexOf(af.kid)!=-1){this.arr_tab_property[this.colSchemas[T].row_idx].add_key_col(af)}}if(af.ismust=="\u662f"||af.ismust=="\u6240\u6709\u4efb\u52a1"||aw!=""&&af.ismust.indexOf(aw)!=-1){if(crsReport.writeColList==null||crsReport.writeColList.indexOf(af.kid)!=-1){this.arr_tab_property[this.colSchemas[T].row_idx].add_must_col(af)}}if(af.isonly=="\u662f"){if(crsReport.writeColList==null||crsReport.writeColList.indexOf(af.kid)!=-1||crsReport.readColList==null||crsReport.readColList.indexOf(af.kid)!=-1){this.arr_tab_property[this.colSchemas[T].row_idx].add_only_col(af)}}}}for(var T=0,Q=this.arr_tab_property.length;T<Q;T++){this.arr_tab_property[T].init()}if(this.obj_loaded_row_kid!=null){for(T in this.obj_loaded_row_kid){if(this.obj_deleted_row_kid==null||this.obj_deleted_row_kid[T]==undefined){var aj=this.obj_loaded_row_kid[T];this.arr_tab_property[aj.obj_col_schema.row_idx].add_row(aj)}}}if(this.obj_new_row_kid!=null){for(T in this.obj_new_row_kid){var aj=this.obj_new_row_kid[T];this.arr_tab_property[aj.obj_col_schema.row_idx].add_row(aj)}}for(var T=0,Q=this.arr_tab_property.length;T<Q;T++){if(!this.arr_tab_property[T].do_check(T)){if(au!=""){au+=this.arr_tab_property[T].s_newline}au+=this.arr_tab_property[T].s_err_info}}crsReport.crsFormulasCache.execute_formulas(aw,"",0,"",0,"",true,false,false);if(crsReport.crsFormulasCache.s_info!=""){if(au!=""){au+=!crsReport.b_mobile?"\n":"<br>"}au+=crsReport.crsFormulasCache.s_info;crsReport.crsFormulasCache.s_info=""}if(au!=""){if(ax&&!crsReport.b_cansave){ax=false}}}}if(ax){var k=CRSSep2;var O="";crsReport.s_title=crsReport.s_title.replaceAll("'",CRSSlash+"'").replaceAll(";",CRSSep);crsReport.s_memo=crsReport.s_memo.replaceAll("'",CRSSlash+"'").replaceAll(";",CRSSep);if(av){O+="R"+k+crsReport.repId+";";for(var T=0,Q=crsReport.crsTableIndex.columns.length;T<Q;T++){var aq=crsReport.crsTableIndex.columns[T].column;if(!aq.b_do_create_cur_table){aq.b_do_create_cur_table=true}crsReport.crsFormulasCache.s_temp_table_list+=aq.obj_data_cache.s_cur_tab_name+",";O+=aq.obj_data_cache.s_cdef_column_list;if(an){if(aq.obj_data_cache.rows!=null){var R="";for(var ac=0,ao=aq.obj_data_cache.rows.length;ac<ao;ac++){if(aq.obj_data_cache.rows[ac][0]==""){continue}for(var Z=0,ap=aq.obj_data_cache.rows[ac].length;Z<ap;Z++){if(Z==0){R="''"}else{if(aq.obj_data_cache.rows[ac][Z]=="null"){R+=",null"}else{if(typeof aq.obj_data_cache.rows[ac][Z]!="string"){R+=",'"+aq.obj_data_cache.rows[ac][Z]+"'"}else{R+=",'"+HandleMemoStr(aq.obj_data_cache.rows[ac][Z],false).replaceAll("'","/'").replaceAll(";",CRSSep)+"'"}}}}O+="I"+k+aq.i_tab_id+k+"f"+k+aq.obj_data_cache.columnList.replaceAll(";",",")+",curlabel"+k+R+",'"+crsReport.s_postfix+"';"}}}else{var P="'','','','"+crsReport.userId+"','"+crsReport.writeTime+"','','unchecked','n','n','"+crsReport.refKID+"'",ad="";for(Z in aq.obj_data_cache.obj_cur_rows){for(var aa=1,ao=aq.obj_data_cache.obj_cur_rows[Z].length;aa<ao;aa++){if(aa==1){ad=P+","+Z.replace("d","")}if(aq.obj_data_cache.obj_cur_rows[Z][aa]=="null"){ad+=",null"}else{if(typeof aq.obj_data_cache.obj_cur_rows[Z][aa]!="string"){ad+=",'"+aq.obj_data_cache.obj_cur_rows[Z][aa]+"'"}else{ad+=",'"+aq.obj_data_cache.obj_cur_rows[Z][aa].replaceAll(";",CRSSep)+"'"}}}O+="I"+k+aq.i_tab_id+k+"f"+k+aq.obj_data_cache.columnList.replaceAll(";",",")+",curlabel"+k+ad+",'"+crsReport.s_postfix+"';"}aq.obj_data_cache.end_add_cur_col_val()}}}else{if(this.obj_deleted_row_kid!=null){for(T in this.obj_deleted_row_kid){if(this.obj_loaded_row_kid!=null&&this.obj_loaded_row_kid[T]!=undefined){O+="D"+k+this.rows[this.obj_loaded_row_kid[T].obj_col_schema.row_idx].id+k+getColRealKId(T)+";"}}}if(this.obj_loaded_row_kid!=null){for(T in this.obj_loaded_row_kid){if(this.obj_deleted_row_kid==null||this.obj_deleted_row_kid[T]==undefined){this.obj_loaded_row_kid[T].set_write_info(crsReport.organId,crsReport.userId,crsReport.writeTime,crsReport.s_title,crsReport.s_memo);if(this.obj_loaded_row_kid[T].s_val!=""){O+="U"+k+this.rows[this.obj_loaded_row_kid[T].obj_col_schema.row_idx].id+k+this.obj_loaded_row_kid[T].s_val+k+getColRealKId(T)+";"}}else{this.obj_loaded_row_kid[T]=undefined;delete this.obj_loaded_row_kid[T]}}}if(this.obj_new_row_kid!=null){var ae="kid, organid, userid, writetime, uploadtime, logiccheck, isfrozen, ismerge, rkid, displayseq, title, memo, ";for(T in this.obj_new_row_kid){var aj=this.obj_new_row_kid[T];aj.set_write_info(crsReport.organId,crsReport.userId,crsReport.writeTime,crsReport.s_title,crsReport.s_memo);if(aj.arr_val_list!=null&&(aj.i_display_seq==1&&crsReport.openMode=="write"||!aj.is_blank())){O+="I"+k+this.rows[aj.obj_col_schema.row_idx].id+k+"f"+k+ae+aj.arr_col_list.toString()+k+"'"+getColRealKId(T)+"','"+crsReport.organId+"','"+crsReport.userId+"','"+crsReport.writeTime+"','0000-00-00 00:00:00', 'unchecked', 'n', 'n', '"+crsReport.refKID+"','"+aj.i_display_seq+"','"+crsReport.s_title+"','"+crsReport.s_memo+"',"+aj.get_delimited_text().replaceAll("'null'","null")+";";this.update_row_kid(T,aj);this.obj_new_row_kid[T]=undefined;delete this.obj_new_row_kid[T]}}var T=-1;for(T in this.obj_new_row_kid){break}if(T==-1){this.obj_new_row_kid=null}}if(this.obj_deleted_row_kid!=null){this.obj_deleted_row_kid=null}}crsReport.s_title=crsReport.s_title.replaceAll(CRSSlash+"'","'").replaceAll(";",CRSSep);crsReport.s_memo=crsReport.s_memo.replaceAll(CRSSlash+"'","'").replaceAll(";",CRSSep);if(O!=""){if(av){return O}au=crsReport.crsDataSet.execUpdate(O,av)!="+OK"?"\u4fdd\u5b58\u6570\u636e\u5931\u8d25":"";for(var K=0,X=Y.length;K<X;K++){crsReport.arr_upload_files[Y[K]]=""}if(!av&&S!=null){for(var T=0,Q=S.length/4;T<Q;T++){crsReport.crsCommon.set_cell_pvalue(S[T*4],S[T*4+1],S[T*4+2],S[T*4+3])}}if(!av&&crsReport.crsTableIndex.arr_hidden_rows!=null){for(K in crsReport.crsTableIndex.arr_hidden_rows){if(typeof crsReport.crsTableIndex.arr_hidden_rows[K]=="function"){break}if(crsReport.crsTableIndex.arr_hidden_rows[K]!=undefined){for(s_rid in crsReport.crsTableIndex.arr_hidden_rows[K]["dat"]){if(typeof crsReport.crsTableIndex.arr_hidden_rows[K]["dat"][s_rid]=="function"){break}for(s_cid in crsReport.crsTableIndex.arr_hidden_rows[K]["dat"][s_rid]){if(typeof crsReport.crsTableIndex.arr_hidden_rows[K]["dat"][s_rid][s_cid]=="function"){break}if(crsReport.crsTableIndex.arr_hidden_rows[K]["dat"][s_rid][s_cid]["val"]!=crsReport.crsTableIndex.arr_hidden_rows[K]["dat"][s_rid][s_cid]["pval"]){crsReport.crsTableIndex.arr_hidden_rows[K]["dat"][s_rid][s_cid]["pval"]=crsReport.crsTableIndex.arr_hidden_rows[K]["dat"][s_rid][s_cid]["val"]}}}}}}}if(!av&&!an&&au==""){if(crsReport.b_submit){crsReport.show_hint("\u63d0\u4ea4\u6210\u529f\uff01")}else{crsReport.show_hint("\u4fdd\u5b58\u6210\u529f\uff01")}crsReport.b_saved=true}}if(au!=""){crsReport.show_hint(au)}return au==""||crsReport.b_cansave};TCRSTableIndex.prototype.can_append2=function(k,l){var g={};g.b_can_append=false;if($(k).attr("cid")!=undefined){var h=this.getAColSchema($(k).attr("cid"));if(h==null){return g}if(crsReport.writeColList!=null){var m=false;if(!h.col.isEmpty()){var n=h.col.first();while(!h.col.EOF()){if(crsReport.writeColList.indexOf(n.kid)!=-1){m=true;break}n=h.col.next()}}if(!m){return g}}g.expandtype=this.rows[h.row_idx].expandtype;if(g.expandtype=="\u6309\u884c\u5411\u4e0b"||g.expandtype=="\u6309\u5217\u5411\u53f3"){g.b_can_append=true;h.col.get_noclear_and_defaultval_column_list(g)}g.def_rect=h.col.getColumnDefRect("");g.initcz=this.rows[h.row_idx].initcz;if(g.b_can_append&&l){this.rows[h.row_idx].initcz++}}return g};TCRSTableIndex.prototype.can_delete2=function(l,n,p){if(p==undefined){p=false}var h={};h.b_can_delete=false;if($(l).attr("cid")!=undefined){var k=this.getAColSchema($(l).attr("cid"));if(k==null){return h}if(crsReport.writeColList!=null&&!p){var m=false;if(!k.col.isEmpty()){var o=k.col.first();while(!k.col.EOF()){if(crsReport.writeColList.indexOf(o.kid)!=-1){m=true;break}o=k.col.next()}}if(!m){return h}}h.expandtype=this.rows[k.row_idx].expandtype;if(h.expandtype=="\u6309\u884c\u5411\u4e0b"||h.expandtype=="\u6309\u5217\u5411\u53f3"){h.b_can_delete=true}h.def_rect=k.col.getColumnDefRect("");if(this.rows[k.row_idx].initcz<=1){h.b_all=true}else{if(h.b_can_delete&&n){this.rows[k.row_idx].initcz--}}}return h};TCRSTableIndex.prototype.auto_increment=function(c){if(c!=""){var d=this.getAColSchema(c);if(d!=null){if(this.rows[d.row_idx].tabletype=="\u660e\u7ec6\u8868"){d.col.auto_increment(this.rows[d.row_idx].sheetindex-1,this.rows[d.row_idx].expandtype)}}}};TCRSTableIndex.prototype.create_row_kid=function(f){var d=getGuidGenerator();var e=new TCRSRowProperty(this.getAColSchema(f).col,0,crsReport.organId,crsReport.userId,crsReport.writeTime,crsReport.s_title,crsReport.s_memo);if(this.obj_new_row_kid==null){this.obj_new_row_kid={}}this.obj_new_row_kid[getColPlatKId(d)]=e;return d};TCRSTableIndex.prototype.update_row_kid=function(d,c){d=getColPlatKId(d);if(this.obj_loaded_row_kid==null){this.obj_loaded_row_kid={}}this.obj_loaded_row_kid[d]=c};TCRSTableIndex.prototype.delete_row_kid=function(b){if(this.obj_deleted_row_kid==null){this.obj_deleted_row_kid={}}b=getColPlatKId(b);if(this.obj_new_row_kid==null||this.obj_new_row_kid[b]==undefined){this.obj_deleted_row_kid[b]=null}else{if(this.obj_new_row_kid!=null){if(this.obj_new_row_kid[b]!=undefined){this.obj_new_row_kid[b]=null;delete this.obj_new_row_kid[b]}this.obj_deleted_row_kid[b]=null}}};TCRSTableIndex.prototype.get_autocode_list=function(h){var e=null;if(this.colSchemas!=null){for(s_k in this.colSchemas){var g=this.colSchemas[s_k].col.rows[this.colSchemas[s_k].col_idx];if(g.datatype=="\u81ea\u52a8\u7f16\u53f7"&&g.ishidden!="\u662f"&&(crsReport.writeColList==null||crsReport.writeColList.indexOf(g.kid)!=-1)){if(g.codeid!=""){var f=crsReport.crsAutoCode.get_next_autocode(g.codeid,h);if(f!=""){if(e==null){e=[]}e.push(this.rows[this.colSchemas[s_k].row_idx].sheetindex-1);e.push(g.cellspan);e.push(f)}}}}return e}};TCRSTableIndex.prototype.get_ref_report=function(u,v){var x="";if(v==undefined){x=crsReport.crsCommon.get_rid_by_td(u);if(crsReport.b_as_form){if(crsReport.b_mobile){v=crsReport.crsCommon.crsForm._get_row_seq($(u).parent("div"))-1}else{v=crsReport.crsCommon.crsForm._get_row_seq($(u).parent("tr"))-1}u=crsReport.crsCommon.crsForm._get_cid_by_td(u)}else{var s=crsReport.crsCommon.crsTable.crsCellControler.get_cell_point(u);u=$(u).attr("cid")}}var y=this.getAColSchema(u);if(v==undefined){v=y.get_display_seq(s.x,s.y)-1}var p=null;if(y!=null){if(y.col.rows[y.col_idx].refrepid!=""&&y.col.rows[y.col_idx].refrepid!="0"){if(!crsReport.b_is_query||!crsReport.b_from_center){var F=crsReport.crsTableIndex.create_cur_table_data(false);var r=crsReport.crsDataSet.open_hyperlink(u,v+1,crsReport.s_postfix,F,x);if(r!=""){var o=parseInt(r.substr(0,1));r=r.substr(1);if(o){r+="&rid="+x+"&cid="+u;crsReport.b_subrep_row_seq=v+1}if(r.indexOf("openmode=write")!=-1){if(y.col.rows[y.col_idx].refrepcond!=""){var q=y.col.rows[y.col_idx].refrepcond.split("|");var B=q[0];var A=HandleMemoStr(B,false);G=A.indexOf("\u672c\u62a5\u8868.");while(G!=-1){G=A.indexOf("{",G);var t=A.indexOf("}",G);var C=A.substring(G,t+1);y=this.getAColSchema(C);var w=rectNameToIndex(y.col.rows[y.col_idx].cellspan);var D=this.rows[y.row_idx];if(D.tabletype=="\u660e\u7ec6\u8868"&&v>0){w[0].y+=(w[1].y-w[0].y+1)*v}var E=crsReport.crsCommon.get_cell_value(0,w[0].x,w[0].y);if(y.datatype=="\u65e5\u671f\u578b"){if(E!=""){E=E.replace(".","-");if(y.displaystyle=="yyyy\u5e74"){E+="-00-00"}else{if(y.displaystyle=="yyyy\u5e74mm\u6708"||y.displaystyle=="yyyy.mm"){E+="-00"}}}}A=A.replaceAll("\u672c\u62a5\u8868."+C,E).replaceAll('"',"");G=A.indexOf("\u672c\u62a5\u8868.")}if(A!=""){r+="&spara="+escape(A)}}}else{if(o&&crsReport.openMode!="read"){r=r.replace("openmode=read","openmode=edit")}}if(crsReport.b_mobile){if(crsReport.b_usepda){open_win("/pda/apps/report/index.php?"+r)}else{open_win("/mobile/reportshop/report/index.php?"+r)}}else{if(crsReport.b_is_query&&crsReport.b_from_center){r+="&isquery=y"}var z=window.open(window.parent.location.pathname+"?"+r,"awin"+y.col.rows[y.col_idx].refrepid,"menubar=0,toolbar=0,scrollbars=no,status=1,resizable=1,left=0,top=0,width="+screen.availWidth+",height="+screen.availHeight);if(window.external&&typeof window.external.OA_SMS!="undefined"){}else{z.moveTo(0,0);z.resizeTo(screen.availWidth,screen.availHeight);z.focus()}}}else{p={rep:HandleMemoStr(y.col.rows[y.col_idx].refrepid,false),para:""};if(y.col.rows[y.col_idx].refrepcond!=""){var q=y.col.rows[y.col_idx].refrepcond.split("|");var B=q[0];p.para=HandleMemoStr(B,false);var G=p.para.indexOf("\u672c\u62a5\u8868.");while(G!=-1){G=p.para.indexOf("{",G);var t=p.para.indexOf("}",G);var C=p.para.substring(G,t+1);y=this.getAColSchema(C);var w=rectNameToIndex(y.col.rows[y.col_idx].cellspan);var D=this.rows[y.row_idx];if(D.tabletype=="\u660e\u7ec6\u8868"&&v>0){w[0].y+=(w[1].y-w[0].y+1)*v}var E=crsReport.crsCommon.get_cell_value(0,w[0].x,w[0].y);if(y.datatype=="\u65e5\u671f\u578b"){if(E!=""){E=E.replace(".","-");if(y.displaystyle=="yyyy\u5e74"){E+="-00-00"}else{if(y.displaystyle=="yyyy\u5e74mm\u6708"||y.displaystyle=="yyyy.mm"){E+="-00"}}}}p.para=p.para.replaceAll("\u672c\u62a5\u8868."+C,E).replaceAll('"',"");G=p.para.indexOf("\u672c\u62a5\u8868.")}}}return p}var F=crsReport.crsTableIndex.create_cur_table_data(false);var r=crsReport.crsDataSet.open_hyperlink(u,v+1,crsReport.s_postfix,F,x);if(r!=""&&r.indexOf("openmode=read")!=-1){var o=r.substr(0,1);r=r.substr(1);if(crsReport.b_mobile){if(crsReport.b_usepda){open_win("/pda/apps/report/index.php?"+r)}else{open_win("/mobile/reportshop/report/index.php?"+r)}}else{if(crsReport.b_is_query&&crsReport.b_from_center){r+="&isquery=y"}var z=window.open(window.parent.location.pathname+"?"+r,"awin"+y.col.rows[y.col_idx].refrepid,"menubar=0,toolbar=0,scrollbars=no,status=1,resizable=1,left=0,top=0,width="+screen.availWidth+",height="+screen.availHeight);if(window.external!=undefined&&typeof window.external.OA_SMS=="function"){}else{z.moveTo(0,0);z.resizeTo(screen.availWidth,screen.availHeight);z.focus()}}return p}p={rep:HandleMemoStr(y.col.rows[y.col_idx].refrepid,false),para:""};if(y.col.rows[y.col_idx].refrepcond!=""){var q=y.col.rows[y.col_idx].refrepcond.split("|");var B=q[0];p.para=HandleMemoStr(B,false);var G=p.para.indexOf("\u672c\u62a5\u8868.");while(G!=-1){G=p.para.indexOf("{",G);var t=p.para.indexOf("}",G);var C=p.para.substring(G,t+1);y=this.getAColSchema(C);var w=rectNameToIndex(y.col.rows[y.col_idx].cellspan);var D=this.rows[y.row_idx];if(D.tabletype=="\u660e\u7ec6\u8868"&&v>0){w[0].y+=(w[1].y-w[0].y+1)*v}var E=crsReport.crsCommon.get_cell_value(0,w[0].x,w[0].y);if(y.datatype=="\u65e5\u671f\u578b"){if(E!=""){E=E.replace(".","-");if(y.displaystyle=="yyyy\u5e74"){E+="-00-00"}else{if(y.displaystyle=="yyyy\u5e74mm\u6708"||y.displaystyle=="yyyy.mm"){E+="-00"}}}}p.para=p.para.replaceAll("\u672c\u62a5\u8868."+C,E).replaceAll('"',"");G=p.para.indexOf("\u672c\u62a5\u8868.")}}}}return p};TCRSTableIndex.prototype.is_invalid=function(d,e){var f=false;return f};TCRSTableIndex.prototype.free=function(){var b="";return this.crsDataSet.free_me(b)};TCRSTableIndex.prototype.clear_data_item_id=function(){if(this.obj_loaded_row_kid!=null){for(s_key in this.obj_loaded_row_kid){this.obj_loaded_row_kid[s_key]=null}this.obj_loaded_row_kid=null}};TCRSTableIndex.prototype.get_auto_code=function(){var f="";if(!this.isEmpty()){var h=this.first();while(!this.EOF()){if(h.tabletype=="\u4e3b\u8868"){var g=this.getColumn(h.id);if(g!=null){if(!g.isEmpty()){var l=g.first();while(!g.EOF()){if(l.datatype=="\u81ea\u52a8\u7f16\u53f7"||l.iskey=="\u662f"||l.isonly=="\u662f"){var k=g.get_cell_value(l.id,1,true,h,true);if(k!=""&&f.indexOf(k)==-1){if(f!=""){f+="/"}f+=k}}l=g.next()}}}}h=this.next()}}if(f==""){f=crsReport.s_title}return f};TCRSTableIndex.prototype.set_hidden_cell_value=function(m,f,n,l){if(l==undefined){l=false}var k=false;var g=this.getAColSchema(m);if(this.arr_hidden_rows==null||this.arr_hidden_rows[g.tableid]==undefined){return}var h=0;for(s_k in this.arr_hidden_rows[g.tableid]["dat"]){if(typeof this.arr_hidden_rows[g.tableid]["dat"][s_k]=="function"){break}if(h==f-1){if(this.arr_hidden_rows[g.tableid]["dat"][s_k][m]==undefined){this.arr_hidden_rows[g.tableid]["dat"][s_k][m]={val:"",pval:""}}if(l){if(this.arr_hidden_rows[g.tableid]["dat"][s_k][m]["pval"]!=n){k=true}this.arr_hidden_rows[g.tableid]["dat"][s_k][m]["pval"]=n}else{if(this.arr_hidden_rows[g.tableid]["dat"][s_k][m]["val"]!=n){k=true}this.arr_hidden_rows[g.tableid]["dat"][s_k][m]["val"]=n}break}h++}return k};TCRSTableIndex.prototype.get_hidden_cell_value=function(c,d){var f=this.getAColSchema(c);var e=0;for(s_k in this.arr_hidden_rows[f.tableid]["dat"]){if(typeof this.arr_hidden_rows[f.tableid]["dat"][s_k]=="function"){break}if(e==d-1){if(this.arr_hidden_rows[f.tableid]["dat"][s_k][c]==undefined){this.arr_hidden_rows[f.tableid]["dat"][s_k][c]={val:"",pval:""}}return this.arr_hidden_rows[f.tableid]["dat"][s_k][c]["val"];break}e++}return""};TCRSTableIndex.prototype.clear_hidden_cell_value=function(c,d){var f=this.getAColSchema(c);var e=0;for(s_k in this.arr_hidden_rows[f.tableid]["dat"]){if(typeof this.arr_hidden_rows[f.tableid]["dat"][s_k]=="function"){break}if(e==d-1){if(this.arr_hidden_rows[f.tableid]["dat"][s_k][c]==undefined){this.arr_hidden_rows[f.tableid]["dat"][s_k][c]={val:"",pval:""}}this.arr_hidden_rows[f.tableid]["dat"][s_k][c]["val"]="";break}e++}};TCRSTableIndex.prototype.delete_hidden_row=function(g,h){var b=this.getAColSchema(g);var f=0;var c="";for(s_k in this.arr_hidden_rows[b.tableid]["dat"]){if(typeof this.arr_hidden_rows[b.tableid]["dat"][s_k]=="function"){break}if(f==h-1){this.arr_hidden_rows[b.tableid]["dat"].splice(f,1);c=s_k;break}f++}return c};TCRSTableIndex.prototype.can_append=function(b){if(crsReport.s_noappend_tab!=""&&(","+crsReport.s_noappend_tab).indexOf(","+b+",")!=-1){return false}if(typeof plugin_can_append=="function"){return plugin_can_append(b)}if(crsReport.writeColList!=null){var d=this.getColumn(b);var c=d.cursor;if(!d.isEmpty()){var a=d.first();while(!d.EOF()){if(crsReport.writeColList.indexOf(a.kid)!=-1){d.cursor=c;return true}a=d.next()}}d.cursor=c;return false}return true};TCRSTableIndex.prototype.can_delete=function(b){if(crsReport.s_nodelete_tab!=""&&(","+crsReport.s_nodelete_tab).indexOf(","+b+",")!=-1){return false}if(typeof plugin_can_delete=="function"){return plugin_can_delete(b)}if(crsReport.writeColList!=null){var d=this.getColumn(b);var c=d.cursor;if(!d.isEmpty()){var a=d.first();while(!d.EOF()){if(crsReport.writeColList.indexOf(a.kid)!=-1){d.cursor=c;return true}a=d.next()}}d.cursor=c;return false}return true};TCRSTableIndex.prototype.can_insert=function(b){if(crsReport.s_noinsert_tab!=""&&(","+crsReport.s_noinsert_tab).indexOf(","+b+",")!=-1){return false}if(typeof plugin_can_insert=="function"){return plugin_can_insert(b)}if(crsReport.writeColList!=null){var d=this.getColumn(b);var c=d.cursor;if(!d.isEmpty()){var a=d.first();while(!d.EOF()){if(crsReport.writeColList.indexOf(a.kid)!=-1){d.cursor=c;return true}a=d.next()}}d.cursor=c;return false}return true};TCRSTableIndex.prototype.get_incalcu_cell=function(){var c=[];if(this.arr_incalcu_cell!=null){for(s_k in this.arr_incalcu_cell){if(typeof this.arr_incalcu_cell[s_k]=="function"){continue}var e=this.colSchemas[this.arr_incalcu_cell[s_k]];var a=this.rows[e.row_idx];c.push({p:a.sheetindex,x:e.display_rect[0].x,y:e.display_rect[0].y});if(a.tabletype=="\u660e\u7ec6\u8868"){if(a.expandtype=="\u6309\u884c\u5411\u4e0b"||a.expandtype=="\u4e0d\u6269\u5c55"){var d=e.display_rect[1].y-e.display_rect[0].y+1;for(var b=1;b<a.initcz;b++){c.push({p:a.sheetindex,x:e.display_rect[0].x,y:b*d+e.display_rect[0].y})}}else{var d=e.display_rect[1].x-e.display_rect[0].x+1;for(var b=1;b<a.initcz;b++){c.push({p:a.sheetindex,x:b*d+e.display_rect[0].x,y:e.display_rect[0].y})}}}}}return c};function TCRSColumnIndex(c,d){this.crsDataSet=c;this.i_tab_id=d;TCRSDataRecord.call(this,this.crsDataSet,"crscell.crs_columnindex","*","tableid='"+d+"'","cellspan");this.obj_data_cache=new TCRSDataCache(this,this.crsDataSet,this.i_tab_id);this.arr_group_column=null;this.arr_merge_column=null;this.b_do_create_cur_table=false;this.i_init_cz=1;this.arr_output_cols=[];this.arr_radio_group=null;this.arr_picture_cols=null;this.arr_hidden_cols=null}TCRSColumnIndex.prototype=new TCRSDataRecord();TCRSColumnIndex.prototype.getRecordCount=function(){return this.obj_data_cache.get_record_count()};TCRSColumnIndex.prototype.getColumnDefRect=function(f){this.loadData("#tablecrs_columnindex"+this.i_tab_id);var h=[{pg:"",x:-1,y:-1},{pg:"",x:-1,y:-1}];if(!this.isEmpty()){var g=this.first();while(!this.EOF()){var e=rectNameToIndex(g.cellspan);if(h[0].x==-1||h[0].x>e[0].x){h[0].x=e[0].x}if(h[0].y==-1||h[0].y>e[0].y){h[0].y=e[0].y}if(h[1].x<e[1].x){h[1].x=e[1].x}if(h[1].y<e[1].y){h[1].y=e[1].y}g=this.next()}}return rectIndexToName(h)};TCRSColumnIndex.prototype.hasColumn=function(c){res=false;this.loadData("#tablecrs_columnindex"+this.i_tab_id);for(var d=0;d<this.rows.length;d++){if(this.rows[d].kid==c){res=true;break}}return res};TCRSColumnIndex.prototype.getWriteCellList=function(o,k){this.loadData("#tablecrs_columnindex"+this.i_tab_id);var p=null;if(!this.isEmpty()){p=[];var l=this.first();while(!this.EOF()){p.push({i_cell_span:l.cellspan,arr_cell_rect:rectNameToIndex(l.cellspan)});var m=HandleMemoStr(l.displaystyle,false);if(m==""){if(l.datatype=="\u6570\u503c\u578b"){m="0"}else{if(l.datatype=="\u6570\u503c\u578b"){m="_($#,##0_) ($#,##0)"}else{if(l.datatype=="\u65e5\u671f\u578b"){m="yyyy.mm.dd"}}}}p.push(m);p.push(o.sheetindex);if(o.tabletype=="\u4ea4\u53c9\u8868"){p.push("\u4e3b\u8868")}else{p.push(o.tabletype)}p.push(o.expandtype);var n=this.getRecordCount();if(n<o.initcz){n=o.initcz}p.push(n);p.push(l.datatype);p.push(l.defaultval);if(l.ishidden!="\u662f"&&o.ishidden=="\u662f"){l.ishidden="\u662f"}p.push(l.ishidden);p.push(l.readonly);var h=true;if(k!=null){if(indexOf(k,l.kid)==-1){h=false}}p.push(h);p.push(l.refrepid);p.push(l.color);p.push(l.kid);p.push(l.id);l=this.next()}}return p};TCRSColumnIndex.prototype.get_id_by_name=function(d){var c=this.search("columnlabel",d);if(c!=null){return c.id}else{return -1}};TCRSColumnIndex.prototype.get_name_by_id=function(d){var c=this.search("id",d);if(c!=null){return c.columnlabel}else{return""}};TCRSColumnIndex.prototype.get_raw_value=function(g,f){var e="";var h=this.getRecordCount();if(h>=f){e=HandleMemoStr(this.obj_data_cache.rows[f-1][this.obj_data_cache.get_nth_by_col_name("col"+g)],false);if(e=="1899-12-30 00:00:00"){e="0000-00-00 00:00:00"}}return e};TCRSColumnIndex.prototype.get_cell_value=function(r,v,q,t,p){var o="",w="";var x=v;if(!q){r=this.get_id_by_name(r)}var s=this.search("id",r);if(s!=null){var n=rectNameToIndex(s.cellspan);var m={};m.x=n[0].x;m.y=n[0].y;if(v==0){v=1}if(v>1){if(t.expandtype=="\u4e0d\u6269\u5c55"||t.expandtype=="\u6309\u884c\u5411\u4e0b"){m.y+=(x-1)*(n[1].y-n[0].y+1)}else{m.x+=(x-1)*(n[1].x-n[0].x+1)}}var u=this.getRecordCount();if(crsReport.writeColList!=null&&crsReport.writeColList.indexOf(s.kid)==-1&&crsReport.readColList!=null&&crsReport.readColList.indexOf(s.kid)==-1){if(u>0&&u>=v){o=this.obj_data_cache.rows[v-1][this.obj_data_cache.get_nth_by_col_name("col"+s.id)]}}else{o=crsReport.crsCommon.get_cell_value(0,m.x,m.y,p);if(o==""&&u>0&&u>=v){o=this.obj_data_cache.rows[v-1][this.obj_data_cache.get_nth_by_col_name("col"+s.id)]}}if(o=="1899-12-30 00:00:00"){o="0000-00-00 00:00:00"}}if(o==null){o=""}return o};TCRSColumnIndex.prototype.get_cur_tab_name=function(){if(this.obj_data_cache==null){this.obj_data_cache=new TCRSDataCache(this,this.crsDataSet,this.i_tab_id)}return this.obj_data_cache.s_cur_tab_name};TCRSColumnIndex.prototype.get_column_list=function(f){this.loadData("#tablecrs_columnindex"+this.i_tab_id);var g,h,e;if(!this.isEmpty()){row=this.first();while(!this.EOF()){f.arr_col_index.push(row.kid);if(f.s_cdef_column_list!=""){f.s_cdef_column_list+=",";f.s_column_list+=";"}g=row.id;f.s_column_list+="col"+g;h=HandleMemoStr(row.displaystyle,false);row.displaystyle=h;if(row.datatype=="\u81ea\u589e\u578b"){f.s_cdef_column_list+="col"+g+" int"}else{if(row.datatype=="\u8d27\u5e01\u578b"){f.s_cdef_column_list+="col"+g+" decimal(12,2)"}else{if(row.datatype=="\u6570\u503c\u578b"){if(row.displaystyle=="0"||row.displaystyle=="#,##0"||row.displaystyle=="(#,##0_) (#,##0)"||row.displaystyle=="(#,##0_) [Red](#,##0)"||row.displaystyle==""){if(row.barcode!=""){f.s_cdef_column_list+="col"+g+" bigint"}else{f.s_cdef_column_list+="col"+g+" int"}}else{f.s_cdef_column_list+="col"+g+" double"}}else{if(row.datatype=="\u65e5\u671f\u578b"){if(row.displaystyle=="yyyy\u5e74mm\u6708dd\u65e5"||row.displaystyle=="yyyy\u5e74mm\u6708"||row.displaystyle=="yyyy\u5e74"||row.displaystyle=="yyyy.mm.dd"||row.displaystyle=="yyyy-mm-dd"||row.displaystyle=="yyyy.mm"||row.displaystyle=="yyyy-mm"||row.displaystyle=="m/d/yy"||row.displaystyle=="dd/mm/yy"||row.displaystyle=="dd.mmmm.yy"||row.displaystyle=="d-mmm-y"||row.displaystyle=="d-mmm"||row.displaystyle=="mmmm-yy"||row.displaystyle==""){f.s_cdef_column_list+="col"+g+" date"}else{if(row.displaystyle=="m/d/yy h:mm"){f.s_cdef_column_list+="col"+g+" datetime"}else{f.s_cdef_column_list+="col"+g+" time"}}}else{f.s_cdef_column_list+="col"+g+" text"}}}}e=row.defaultval;if(e==""&&row.ismust!="\u662f"){if(row.datatype=="\u8d27\u5e01\u578b"||row.datatype=="\u6570\u503c\u578b"||row.datatype=="\u65e5\u671f\u578b"){e=0}}f.s_default_val+=";"+e;row=this.next()}}};TCRSColumnIndex.prototype.update_cell_refer=function(o,r,p,k){this.loadData("#tablecrs_columnindex"+this.i_tab_id);if(!this.isEmpty()){var m=this.first();while(!this.EOF()){var l=crsReport.crsTableIndex.getAColSchema(m.kid);var q=l.display_rect;if(k!="\u6309\u5217\u5411\u53f3"&&q[0].y>o[1].y){var n=o[1].y-o[0].y+1;if(r=="insert"){q[0].y+=(n)*p;q[1].y+=(n)*p}else{q[0].y-=(n)*p;q[1].y-=(n)*p}m.cellspan=rectIndexToName(q)}else{if(k=="\u6309\u5217\u5411\u53f3"&&q[0].x>o[1].x){var n=o[1].x-o[0].x;if(r=="insert"){q[0].x+=(n)*p;q[1].x+=(n)*p}else{q[0].x-=(n)*p;q[1].x-=(n)*p}m.cellspan=rectIndexToName(q)}}m=this.next()}}};TCRSColumnIndex.prototype.get_group_column_list=function(){this.loadData("#tablecrs_columnindex"+this.i_tab_id);var d=this.cursor;var e="";if(!this.isEmpty()){var f=this.first();while(!this.EOF()){if(f.isgroup=="\u662f"){if(this.arr_group_column==null){this.arr_group_column=[]}this.arr_group_column.push("col"+f.id);if(e!=""){e+=","}e+="col"+f.id+" asc"}else{if(f.mergetype!=""&&f.mergetype!="\u4e0d\u6c47\u603b"){if(this.arr_merge_column==null){this.arr_merge_column=[]}this.arr_merge_column.push("col"+f.id);this.arr_merge_column.push(f.mergetype)}}f=this.next()}}this.cursor=d;return e};TCRSColumnIndex.prototype.get_order_column_list=function(){this.loadData("#tablecrs_columnindex"+this.i_tab_id);var d=this.cursor;var e="";if(!this.isEmpty()){var f=this.first();while(!this.EOF()){if(f.ordertype!=""&&f.ordertype!="\u4e0d\u6392\u5e8f"){if(e!=""){e+=","}e+="col"+f.id+" "+((f.ordertype=="\u5347\u5e8f")?"asc":"desc")}f=this.next()}}this.cursor=d;return e};TCRSColumnIndex.prototype.prev_handle_data=function(){};TCRSColumnIndex.prototype.get_first_data_item=function(){var h=null;if(this.obj_data_cache!=null){if(!this.obj_data_cache.isEmpty()){h={};h.data=this.obj_data_cache.first()}}if(h!=null){if(!this.isEmpty()){var f=[];var g=this.first();while(!this.EOF()){var e=rectNameToIndex(g.cellspan);f.push(g.id);f.push(e[0].x);f.push(e[0].y);f.push(g.displaystyle);f.push(g.datatype);f.push(g.refrepid);f.push(g.kid);f.push(this.obj_data_cache.get_nth_by_col_name("col"+g.id));f.push(this.obj_data_cache.get_nth_by_col_name("kid"));f.push(g.color);f.push(g.cellspan);f.push(g.readonly);f.push(g.ishidden);f.push(g.merge_equal);if(g.datatype=="\u4ee3\u7801\u578b"&&g.codeid>0){f[f.length-1]=g.codeid}g=this.next()}h.schema=f}}return h};TCRSColumnIndex.prototype.get_next_data_item=function(){var b=null;if(this.obj_data_cache!=null){if(!this.obj_data_cache.isEmpty()){if(!this.obj_data_cache.EOF()){b=this.obj_data_cache.next()}}}return b};TCRSColumnIndex.prototype.clear_data_item=function(w,q){if(q==null||q.length<=0){return}if(this.obj_data_cache!=null){var A=this.obj_data_cache.get_record_count();if(A<w.initcz){A=w.initcz}if(A>0){var s=parseInt(w.sheetindex)-1;for(var y=0,x=q.length/2;y<x;y++){var B=this.search("columnlabel",q[y*2]);if(B!=null){var v=(q[y*2+1].charAt(0)=="-")?true:false;var z=parseInt(q[y*2+1]);if(z<0){z=-z}var r=rectNameToIndex(B.cellspan);if(w.tabletype=="\u660e\u7ec6\u8868"&&z>0){if(w.expandtype=="\u6309\u5217\u5411\u53f3"||w.expandtype=="\u4e0d\u6269\u5c55\uff08\u6309\u5217\u5411\u53f3\uff09"){var u=r[1].x-r[0].x+1;r[0].x+=u*(z-1);r[1].x+=u*(z-1);crsReport.crsCommon.clear_cell(s,r[0].x,r[0].y)}else{var u=r[1].y-r[0].y+1;r[0].y+=u*(z-1);r[1].y+=u*(z-1);crsReport.crsCommon.clear_cell(s,r[0].x,r[0].y)}}else{if(w.expandtype=="\u6309\u5217\u5411\u53f3"||w.expandtype=="\u4e0d\u6269\u5c55\uff08\u6309\u5217\u5411\u53f3\uff09"){var u=r[1].x-r[0].x+1}else{var u=r[1].y-r[0].y+1;for(var t=0;t<A;t++){crsReport.crsCommon.clear_cell(s,r[0].x,r[0].y+u*t)}if(w.expandtype=="\u6309\u884c\u5411\u4e0b"&&!v&&this.i_init_cz<A){if(crsReport.b_as_form){for(var t=A-1;t>=this.i_init_cz;t--){crsReport.crsCommon.crsForm.delete_record(w,s,r[0].x,r[0].y+u*t)}}else{for(var t=A-1;t>=this.i_init_cz;t--){var D=r[0].y+u*t;var C="row"+D+"column"+r[0].x;crsReport.crsCommon.crsTable.delete_record(undefined,crsReport.obj_cell_maps[s][C])}}A=this.i_init_cz}}}}}}}};TCRSColumnIndex.prototype.reset_cell_color=function(r,n){if(n==null||n.length<=0){return}if(this.obj_data_cache!=null){var v=this.obj_data_cache.get_record_count();if(v<r.initcz){v=r.initcz}if(v>0){var p=parseInt(r.sheetindex)-1;if(r.tabletype=="\u660e\u7ec6\u8868"||n[1]==0){for(var m=1;m<=v;m++){for(var t=0,s=n.length/2;t<s;t++){if(n[t*2].charAt(0)=="{"){var w=this.search("kid",n[t*2])}else{var w=this.search("id",n[t*2])}if(w!=null){var u=m;var o=rectNameToIndex(w.cellspan);if(u>0){if(r.expandtype=="\u6309\u5217\u5411\u53f3"||r.expandtype=="\u4e0d\u6269\u5c55\uff08\u6309\u5217\u5411\u53f3\uff09"){var q=o[1].x-o[0].x+1;o[0].x+=q*(u-1);o[1].x+=q*(u-1)}else{var q=o[1].y-o[0].y+1;o[0].y+=q*(u-1);o[1].y+=q*(u-1)}}crsReport.crsCommon.set_cell_backgroud_color(p,o[0].x,o[0].y)}}}}else{for(var t=0,s=n.length/2;t<s;t++){if(n[t*2].charAt(0)=="{"){var w=this.search("kid",n[t*2])}else{var w=this.search("id",n[t*2])}if(w!=null){var u=n[t*2+1];var o=rectNameToIndex(w.cellspan);if(r.tabletype=="\u660e\u7ec6\u8868"&&u>0){if(r.expandtype=="\u6309\u5217\u5411\u53f3"||r.expandtype=="\u4e0d\u6269\u5c55\uff08\u6309\u5217\u5411\u53f3\uff09"){var q=o[1].x-o[0].x+1;o[0].x+=q*(u-1);o[1].x+=q*(u-1)}else{var q=o[1].y-o[0].y+1;o[0].y+=q*(u-1);o[1].y+=q*(u-1)}}crsReport.crsCommon.set_cell_backgroud_color(p,o[0].x,o[0].y)}}}}}};TCRSColumnIndex.prototype.get_noclear_and_defaultval_column_list=function(d){if(!this.isEmpty()){var c=this.first();while(!this.EOF()){if(c.iskeep=="\u662f"){if(d.arr_noclear==null){d.arr_noclear=[]}d.arr_noclear.push(c.cellspan)}if(c.defaultval!=""){if(d.arr_defaultval==null){d.arr_defaultval=[]}d.arr_defaultval.push(c.cellspan);d.arr_defaultval.push(c.defaultval)}c=this.next()}}};TCRSColumnIndex.prototype.auto_increment=function(p,q){if(!this.isEmpty()){var k=this.first();while(!this.EOF()){if(k.datatype=="\u81ea\u589e\u578b"){var m=rectNameToIndex(k.cellspan);if(q=="\u6309\u884c\u5411\u4e0b"||q=="\u4e0d\u6269\u5c55"){var l=m[1].y-m[0].y+1;var r="row"+m[0].y+"column"+m[0].x;var o=crsReport.obj_cell_maps[p][r];var s=1;while(o!=null&&$(o).attr("cid")==k.kid){crsReport.crsCommon.set_cell_value(o,s);var n=m[0].y+s*l;var r="row"+n+"column"+m[0].x;o=crsReport.obj_cell_maps[p][r];s++}}}k=this.next()}}};TCRSColumnIndex.prototype.free=function(){if(this.obj_data_cache!=null){this.obj_data_cache.free()}};function TCRSDataCache(d,f,e){this.crsDataSet=f;this.i_tab_id=e;this.s_cur_tab_name="crscell.crs_tabledata"+this.i_tab_id+"c";this.s_column_list="";this.s_cdef_column_list="";this.s_default_val="";this.arr_col_index=[];this.arr_col_index.push("displayseq");this.arr_col_index.push("title");this.arr_col_index.push("memo");this.obj_column_cache=d;this.obj_column_cache.get_column_list(this);this.s_cdef_column_list="C"+CRSSep2+this.i_tab_id+CRSSep2+"id int(10) unsigned NOT NULL auto_increment,kid varchar(40),organid int(11) unsigned NOT NULL default '1',userid varchar(20) NOT NULL default 'admin',writetime varchar(25) default '0000-00-00 00:00:00',uploadtime varchar(25) default '0000-00-00 00:00:00',logiccheck varchar(20) NOT NULL default 'unchecked',isfrozen char(2) NOT NULL default 'n',ismerge char(2) NOT NULL default 'n',rkid varchar(40),displayseq int(10),title varchar(255),memo tinytext,"+this.s_cdef_column_list+",PRIMARY KEY  (id),UNIQUE KEY id (id);";this.s_default_val=";;"+crsReport.organId+";"+crsReport.userId+";"+crsReport.writeTime+";;uncheck;n;n;"+crsReport.refKID+";;;"+this.s_default_val;TCRSDataRecord.call(this,this.crsDataSet,"crscell.crs_tabledata"+this.i_tab_id,"id;kid;organid;userid;writetime;uploadtime;logiccheck;isfrozen;ismerge;rkid;displayseq;title;memo;"+this.s_column_list,"userid='"+crsReport.userId+"' and writetime = '"+crsReport.writeTime+"'","displayseq");this.obj_cur_rows=null}TCRSDataCache.prototype=new TCRSDataRecord();TCRSDataCache.prototype.LoadNomarizedData=function(){if(this.doLoaded){return}if(this.isEmpty()){if(crsReport.openMode=="write"){this.doLoaded=true;return}var x=crsReport.s_read_filter;if(x!==""){x=x.replaceAll("and","&");var u=x.split("&");x="";for(var K=0,M=u.length;K<M;K++){var A=u[K].replaceAll("or","|");var w=A.split("|");var J=0,y=w.length;var N="";while(J<y){var D=w[J].indexOf("crscell.crs_tabledata"+this.i_tab_id+"c");if(D!=-1){var v=w[J].indexOf(".",D+8);A=w[J].substring(D,v+1);w[K]=w[J].replaceAll(A,"");if(N!=""){N+=" or "}N+=w[K]}else{}J++}if(N!=""){if(x!=""){x+=" and "}x+="("+N+")"}}}var G=this.obj_column_cache.get_group_column_list();if(G==""){G=this.obj_column_cache.get_order_column_list()}if(G==""){G="displayseq"}if(x!=""){var z=x+" and userid='"+crsReport.userId+"' and writetime='"+crsReport.writeTime+"'"}else{var z="userid='"+crsReport.userId+"' and writetime='"+crsReport.writeTime+"'"}if(crsReport.refKID!=""){z+=" and rkid='"+crsReport.refKID+"'"}this.crsDataSet.execQuery2(this.i_tab_id,this.columnList.replaceAll(";",","),z,G,this.LoadNomarizedDataCB,this,"#tablecrs_tabledata"+this.i_tab_id);if(this.isEmpty()){if(crsReport.s_data_flow==""){crsReport.s_data_flow=crsReport.crsReportState.get_data_flow(crsReport.s_cur_task)}var T=crsReport.s_data_flow;if(T!=""&&T.indexOf("->"+this.i_tab_id+"_{")){var H=T.split("%");for(var O=0,I=H.length;O<I;O++){if(H[O].indexOf("->"+this.i_tab_id+"_{")!=-1){break}}if(O<I){var B=H[O].split(";");for(var O=0,I=B.length;O<I;O++){var E=B[O].split(",");for(var R=0,S=E.length;R<S;R++){var U=E[R].indexOf("->");var A=E[R].indexOf("{",U),C=E[R].indexOf("}",U);var P=E[R].substr(0,U);var Q=E[R].substring(A,C+1);var L=crsReport.crsTableIndex.getAColSchema(Q);if(L!=null){if(R==0){if(crsReport.crsTableIndex.rows[L.row_idx].tabletype=="\u660e\u7ec6\u8868"||this.rows.length==0){var F=crsReport.crsTableIndex.create_row_kid(Q);this.rows.push(this.s_default_val.split(";"));this.rows[this.rows.length-1][1]=F}}this.rows[this.rows.length-1][this.arr_column_list.indexOf("col"+L.col.rows[L.col_idx].id)]=P}}}}}}}};TCRSDataCache.prototype.LoadNomarizedDataCB=function(l,k){k.doLoaded=true;if(l!=""){var m=l.split("\r");if(k.obj_column_cache.arr_group_column!=null&&crsReport.openMode=="read"){}for(var n=0,h=m.length;n<h;n++){m[n]=m[n].replaceAll('"',"\u53cc\u5f15\u53f7");m[n]=m[n].split(";");if(m[n][11]=="null"){m[n][11]=""}if(m[n][12]=="null"){m[n][12]=""}var g=new TCRSRowProperty(k.obj_column_cache,m[n][10],m[n][2],m[n][3],m[n][4],m[n][11],m[n][12]);crsReport.crsTableIndex.update_row_kid(m[n][1],g);if(crsReport.s_title!=HandleMemoStr(m[n][11],false)){crsReport.s_title=HandleMemoStr(m[n][11],false)}if(crsReport.s_memo!=HandleMemoStr(m[n][12],false)){crsReport.s_memo=HandleMemoStr(m[n][12],false)}}k.rows=m;if(k.obj_column_cache.i_init_cz!=m.length){k.obj_column_cache.i_init_cz=m.length}}};TCRSDataCache.prototype.get_record_count=function(){this.LoadNomarizedData();return this.rows.length};TCRSDataCache.prototype.add_cur_col_val=function(m,l,o){if(this.obj_cur_rows==null){this.obj_cur_rows={}}var p="d"+m;if(this.obj_cur_rows[p]==undefined){this.obj_cur_rows[p]=new Array(this.arr_col_index.length);for(var n=0,h=this.arr_col_index.length;n<h;n++){this.obj_cur_rows[p][n]=""}}var k=this.arr_col_index.indexOf(l);this.obj_cur_rows[p][k]=o};TCRSDataCache.prototype.end_add_cur_col_val=function(){this.obj_cur_rows=null};TCRSDataCache.prototype.free=function(){};function TCRSFormulas(k,l,m,q,n,o,r,p){this.s_label=k;this.s_formulas_type=l;this.s_workflow_time=m;this.s_app_time=q;this.s_distinct=n;this.s_recursive=o;this.s_fun_name=r;this.s_fetch_end=p;this.arr_cur_table_ref=null;this.arr_cur_column_ref=null;this.arr_column_ref_back=null;this.arr_column_ref=null;this.arr_fill_expr=null;this.s_sql="";this.s_sql2="";this.b_merged=false;this.b_hasif=false;this.b_has_match=false;this.b_parsed=false;this.b_to_executed=false;this.i_fill_step=7;this.i_cur_seq=0;this.b_do_match=false;this.i_match_value_fill_formulas_index=-1;this.s_cond_sql="";this.s_db_name="";this.s_table_list="";this.s_table_link="";this.s_condition_expr="";this.s_compute_expr="";this.s_target_expr="";this.s_order_expr="";this.s_fill_table="";this.s_fill_expr="";this.s_v_compute_expr="";this.s_dump_sql="";this.s_recursive_cond_expr="";this.s_recursive_expr="";this.s_column_ref_back="";this.arr_merged_formulas_index=null}TCRSFormulas.prototype={constructor:TCRSFormulas,Init:function(p,q,m,r,o,n,l,k){this.s_table_list=p;this.s_table_link=q;this.s_condition_expr=m;this.s_compute_expr=r;this.s_target_expr=o;this.s_order_expr=n;this.s_fill_table=l;this.s_fill_expr=k},set_to_executed:function(p){if(this.b_to_executed==p){return}this.b_to_executed=p;if(this.arr_fill_expr==null){return}if(this.b_to_executed){for(var n=0,l=this.arr_fill_expr.length/this.i_fill_step;n<l;n++){if(this.arr_fill_expr[n*this.i_fill_step+5]=="\u586b\u5165\u503c"){var f=this.arr_fill_expr[n*this.i_fill_step+3];var o=this.arr_fill_expr[n*this.i_fill_step+4];for(var q=0,r=crsReport.crsFormulasCache.arr_formulas.length;q<r;q++){var m=crsReport.crsFormulasCache.arr_formulas[q];if(!m.b_to_executed&&(m.s_app_time.indexOf(CRS_CHANGE_EXEC)!=-1||m.s_app_time=="")){if(m.s_app_time!=""){m.can_execute(f,o,true)}}}}}}},can_execute:function(q,r,n){var o=r;if(this.b_to_executed){return}if(this.s_v_compute_expr!=""){}else{if(this.arr_cur_column_ref==null){return}if(this.s_app_time.indexOf(CRS_CHANGE_EXEC)==-1){return}this.i_cur_seq=0;if(r==""){}else{var m=this.arr_cur_column_ref.indexOf(r);if(!n){q=crsReport.crsTableIndex.get_tab_id_by_col_kid(r);if(m==-1){r=crsReport.crsTableIndex.get_col_id_by_col_kid(r);m=this.arr_cur_column_ref.indexOf(r)}}if(m!=-1&&(this.s_workflow_time==""||this.s_workflow_time=="\u6240\u6709\u4efb\u52a1"||this.s_workflow_time==crsReport.crsFormulasCache.s_workflow)){if(this.s_fill_table=="\u672c\u62a5\u8868."+q||this.s_fill_table.indexOf("\u672c\u62a5\u8868."+o)!=-1||this.s_formulas_type=="\u9a8c\u8bc1\u516c\u5f0f"){this.i_cur_seq=crsReport.crsFormulasCache.i_display_seq}if(!crsReport.crsFormulasCache.b_for_delete||this.arr_fill_expr!=null&&this.arr_fill_expr.indexOf(q)!=-1){var k=crsReport.crsFormulasCache.i_display_seq;crsReport.crsFormulasCache.i_display_seq=this.i_cur_seq;this.set_to_executed(true);crsReport.crsFormulasCache.i_display_seq=k}else{if(this.arr_fill_expr!=null){for(var p=0,l=this.arr_fill_expr.length/this.i_fill_step;p<l;p++){if(this.arr_fill_expr[p*this.i_fill_step+4]==r&&(this.arr_fill_expr[p*this.i_fill_step+5]=="\u5339\u914d"||this.arr_fill_expr[p*this.i_fill_step+5]=="<>"||this.arr_fill_expr[p*this.i_fill_step+5]=="<"||this.arr_fill_expr[p*this.i_fill_step+5]=="<="||this.arr_fill_expr[p*this.i_fill_step+5]==">="||this.arr_fill_expr[p*this.i_fill_step+5]==">")&&!crsReport.crsFormulasCache.b_for_delete&&(this.s_workflow_time==""||this.s_workflow_time=="\u6240\u6709\u4efb\u52a1"||this.s_workflow_time==crsReport.crsFormulasCache.s_workflow)){this.i_cur_seq=crsReport.crsFormulasCache.i_display_seq;this.set_to_executed(true);break}}}}}}}},get_fill_type:function(l,f){var m="\u586b\u5165\u503c";if(this.arr_fill_expr!=null){for(var k=0,g=this.arr_fill_expr.length/this.i_fill_step;k<g;k++){if(this.arr_fill_expr[k*this.i_fill_step+1]==l&&this.arr_fill_expr[k*this.i_fill_step+2]==f){m=this.arr_fill_expr[k*this.i_fill_step+5];break}}}if(m==""){if(this.arr_merged_formulas_index!=null){for(var k=0,g=this.arr_merged_formulas_index.length,h=crsReport.crsFormulasCache.arr_formulas.length;k<g;k++){if(this.arr_merged_formulas_index[k]<h){m=crsReport.crsFormulasCache.arr_formulas[this.arr_merged_formulas_index[k]].get_fill_type(l,f);if(m!=""){break}}}}}return m},has_fill:function(){var b=false;if(this.s_v_compute_expr!=""){b=true}else{if(this.arr_fill_expr!=null){if(this.arr_fill_expr.indexOf("\u586b\u5165\u503c")!=-1){b=true}}else{if(this.s_formulas_type="\u53d6\u6570\u516c\u5f0f"){b=true}}}return b}};function TCRSParseCache(c,d){this.repId=d;this.crsDataSet=c;TCRSDataRecord.call(this,this.crsDataSet,"crscell.crs_parsecache","id,formulasid,cur_table_ref_list,cur_column_ref_list,column_ref_back_list,column_ref_list,fill_expr_list,_sql,_sql2,be_merged,be_hasif,be_hasmatch,recursive_cond_expr,recursive_expr,column_ref_back,cond_sql,db_label,merged_formulas_index_list","repid='"+this.repId+"'","id")}TCRSParseCache.prototype=new TCRSDataRecord();function TCRSFormulasCache(c,d){this.repId=d;this.crsDataSet=c;TCRSDataRecord.call(this,this.crsDataSet,"crscell.crs_formulas","id,label,formulastype,workflowtime,apptime,isdistinct,tablelist,table_link,condition_expr,order_expr,fill_expr,position,funname,fetch_end","repid='"+this.repId+"'","position");this.b_is_locked=false;this.s_exec_time="";this.s_workflow="";this.i_sheet_idx=0;this.s_ref_cell="";this.i_display_seq=0;this.s_exec_formulas="";this.b_for_validate=false;this.b_for_delete=false;this.b_for_pivot=false;this.arr_formulas=null;this.obj_crsParseCache=null;this.s_info="";this.s_temp_table_list="";this.arr_column_readonly=[]}TCRSFormulasCache.prototype=new TCRSDataRecord();TCRSFormulasCache.prototype.init_formulas=function(){arr_tab_id=null;arr_cur_tab_name=null;if(this.arr_formulas!=null){return}if(!this.isEmpty()){if(this.obj_crsParseCache==null){this.obj_crsParseCache=new TCRSParseCache(this.crsDataSet,this.repId);this.obj_crsParseCache.loadData("#tablecrs_parsecache")}this.arr_formulas=[];var m=this.first();var q=0;while(!this.EOF()){var p=new TCRSFormulas(m.label,m.formulastype,m.workflowtime,m.apptime,m.isdistinct,m.isrecusive,m.funname,m.fetch_end);this.arr_formulas.push(p);var l=this.obj_crsParseCache.search("formulasid",m.id);if(l!=null){p.s_db_name=l.db_label;if(l.cur_table_ref_list!=""){p.arr_cur_table_ref=HandleMemoStr(l.cur_table_ref_list,false).split(",")}if(l.cur_column_ref_list!=""){p.arr_cur_column_ref=HandleMemoStr(l.cur_column_ref_list,false).split(",")}if(l.column_ref_back_list!=""){p.s_column_ref_back=HandleMemoStr(l.column_ref_back_list,false);p.arr_column_ref_back=p.s_column_ref_back.split(",");p.s_column_ref_back=p.s_column_ref_back.replaceAll(","," ")}if(l.column_ref_list!=""){p.arr_column_ref=HandleMemoStr(l.column_ref_list,false).replaceAll('"',"").split(",")}var n=HandleMemoStr(l.fill_expr_list,false);if(n!=""){if(m.formulastype!="\u53d6\u6570\u516c\u5f0f"){p.arr_fill_expr=n.split(",")}else{p.arr_fill_expr=[];var f=n.split(",");for(var q=0,k=f.length,o=0,n="";q<k;q++){if(q>0&&f[q]=="\u672c\u62a5\u8868"){p.arr_fill_expr.push(n);n="";o=0}if(o<6){p.arr_fill_expr.push(f[q]);o++}else{n+=f[q]}}p.arr_fill_expr.push(n)}}if(l.be_merged=="Y"){p.b_merged=true}if(l.be_hasif=="Y"){p.b_hasif=true}if(l.be_hasmatch=="Y"){p.b_has_match=true}if(l.merged_formulas_index_list!=""){p.arr_merged_formulas_index=HandleMemoStr(l.merged_formulas_index_list,false).split(",")}p.b_parsed=true}p.Init(HandleMemoStr(m.tablelist,false),HandleMemoStr(m.table_link,false),HandleMemoStr(m.condition_expr,false),HandleMemoStr(m.compute_expr,false),HandleMemoStr(m.target_expr,false),HandleMemoStr(m.order_expr,false),HandleMemoStr(m.fill_table,false),HandleMemoStr(m.fill_expr,false));if(m.formulastype=="\u9a8c\u8bc1\u516c\u5f0f"){p.s_input_hint_caption=HandleMemoStr(m.order_expr,false);p.s_input_hint_content=HandleMemoStr(m.fill_expr,false);p.s_error_hint_content=HandleMemoStr(m.fill_vexpr,false)}p.i_item_index=q++;m=this.next()}}};TCRSFormulasCache.prototype.execute_formulas=function(w,u,v,o,p,m,s,n,q){if(this.b_is_locked){}this.b_is_locked=true;var t=typeof w;if(t!="undefined"&&t!="string"){var k=w;var r=k.length;var l=null;for(s_key in k){if(typeof k[s_key]=="function"){continue}w=k[s_key][0];u=k[s_key][1];v=k[s_key][2];o=k[s_key][3];p=k[s_key][4];m=k[s_key][5];s=k[s_key][6];n=k[s_key][7];n=k[s_key][8];if(w==""){w=crsReport.s_begin_task}this.s_workflow=w;this.s_exec_time=u;this.i_sheet_idx=v;this.s_ref_cell=o;this.i_display_seq=p;this.s_exec_formulas=m;this.b_for_validate=s;this.b_for_delete=n;this.b_for_pivot=q;if(s_key>0){this.end_execute()}this.begin_execute();l=this.execute(s_key!=r-1,l,r)}}else{if(w==""){w=crsReport.s_begin_task}this.s_workflow=w;this.s_exec_time=u;this.i_sheet_idx=v;this.s_ref_cell=o;this.i_display_seq=p;this.s_exec_formulas=m;this.b_for_validate=s;this.b_for_delete=n;this.b_for_pivot=q;this.begin_execute();this.execute()}this.b_is_locked=false};TCRSFormulasCache.prototype.begin_execute=function(){this.loadData("#tablecrs_formulas");this.init_formulas();var h=null;if(typeof this.s_ref_cell=="object"){h=this.s_ref_cell}else{if(this.s_ref_cell!=""){h=this.s_ref_cell.split(",")}}if(this.arr_formulas!=null){for(var n=0,k=this.arr_formulas.length;n<k;n++){if(this.arr_formulas[n].b_to_executed){continue}if(((this.arr_formulas[n].s_app_time.indexOf(this.s_exec_time)!=-1&&(this.s_exec_time!=CRS_MANUL_EXEC||this.s_exec_time==CRS_MANUL_EXEC&&(this.s_exec_formulas!=""&&this.s_exec_formulas.indexOf(this.arr_formulas[n].s_label+",")!=-1||this.s_exec_formulas==this.arr_formulas[n].s_fun_name))||this.b_for_validate)&&(this.arr_formulas[n].s_workflow_time==""||this.arr_formulas[n].s_workflow_time=="\u6240\u6709\u4efb\u52a1"||this.arr_formulas[n].s_workflow_time==this.s_workflow)&&(this.b_for_validate&&this.arr_formulas[n].s_formulas_type=="\u9a8c\u8bc1\u516c\u5f0f"||!this.b_for_validate&&this.arr_formulas[n].s_formulas_type!="\u9a8c\u8bc1\u516c\u5f0f"))||this.b_for_pivot&&this.s_exec_formulas==this.arr_formulas[n].s_label){if(this.s_exec_time==CRS_CHANGE_EXEC){if(h!=null){for(var o=0,p=h.length;o<p;o++){var l="";this.arr_formulas[n].can_execute(l,h[o],false)}}else{var l="",m="";this.arr_formulas[n].can_execute(l,m,false)}}else{this.arr_formulas[n].set_to_executed(true)}}}}};TCRSFormulasCache.prototype.execute=function(p,s,X){if(p==undefined){p=false}if(s==undefined){s=null}var ai="",T="",M="",ad="",am="",ag="",aq="",S="",au=(s==null)?"":s.cur_tab_list,ah=(s==null)?"":s.cur_col_list,Q="";var K=(s==null)?[]:s.func_list,Z=(s==null)?null:s.actions;if(this.arr_formulas!=null){for(var U=0,R=this.arr_formulas.length;U<R;U++){if(this.arr_formulas[U].b_merged&&!this.b_for_pivot){continue}if(this.arr_formulas[U].b_to_executed){if(this.arr_formulas[U].b_do_match){this.arr_formulas[U].b_do_match=false}var al={idx:U,f_type:this.arr_formulas[U].s_formulas_type,r_cond_expr:this.arr_formulas[U].s_recursive_cond_expr,seq:this.arr_formulas[U].i_cur_seq,rep:[],app:[]};aq="";ag="";if(this.arr_formulas[U].arr_fill_expr!=null){for(var Y=0,aj=this.arr_formulas[U].arr_fill_expr.length/this.arr_formulas[U].i_fill_step;Y<aj;Y++){var N=this.arr_formulas[U].arr_fill_expr[Y*this.arr_formulas[U].i_fill_step+5];if(N=="\u5339\u914d"||N=="<>"||N=="<"||N=="<="||N==">="||N==">"){for(var aa=0;aa<U;aa++){if(this.arr_formulas[aa].b_to_executed){if(this.arr_formulas[aa].arr_fill_expr!=null){for(var at=0,ak=this.arr_formulas[aa].arr_fill_expr.length/this.arr_formulas[aa].i_fill_step;at<ak;at++){var ao=this.arr_formulas[aa].arr_fill_expr[at*this.arr_formulas[aa].i_fill_step+5];if(ao=="\u586b\u5165\u503c"||(this.s_exec_time==CRS_CHANGE_EXEC||this.s_exec_time==CRS_MANUL_EXEC)&&(ao=="\u6784\u9020\u4e0b\u62c9\u5217\u8868"||ao=="\u6784\u9020\u4e0b\u62c9\u5217\u8868\uff08\u5141\u8bb8\u5176\u4ed6\u503c\uff09")){if(this.arr_formulas[U].arr_fill_expr[Y*this.arr_formulas[U].i_fill_step+3]==this.arr_formulas[aa].arr_fill_expr[at*this.arr_formulas[aa].i_fill_step+3]&&this.arr_formulas[U].arr_fill_expr[Y*this.arr_formulas[U].i_fill_step+4]==this.arr_formulas[aa].arr_fill_expr[at*this.arr_formulas[aa].i_fill_step+4]){this.arr_formulas[U].i_match_value_fill_formulas_index=aa;this.arr_formulas[U].b_do_match=true;break}}}if(at<ak){break}}}}if(aa>=U){var ap=this.arr_formulas[U].arr_fill_expr[Y*this.arr_formulas[U].i_fill_step+1];var an=this.arr_formulas[U].arr_fill_expr[Y*this.arr_formulas[U].i_fill_step+2];if(this.b_for_pivot){var L=HandleMemoStr(crsReport.crsTableIndex.get_cell_value(ap,an,this.i_display_seq,false),false);al.rep.push("@"+ap+CRSLimiter+an);al.rep.push(L);this.arr_formulas[U].b_do_match=true}else{if(this.arr_formulas[U].i_cur_seq>0){var L=HandleMemoStr(crsReport.crsTableIndex.get_cell_value(ap,an,this.i_display_seq,false),false);al.rep.push("@"+ap+CRSLimiter+an);al.rep.push(L);this.arr_formulas[U].b_do_match=true}else{var L=crsReport.crsTableIndex.get_cur_tab_name(this.arr_formulas[U].arr_fill_expr[Y*this.arr_formulas[U].i_fill_step+3]);if(am.indexOf(L)==-1){am+=L+","}if(crsReport.crsTableIndex.get_tab_type_by_id(this.arr_formulas[U].arr_fill_expr[Y*this.arr_formulas[U].i_fill_step+3])!="\u4ea4\u53c9\u8868"){if(ag==""||ag==L){if(aq!=""){aq+=","}aq+=L+".col"+this.arr_formulas[U].arr_fill_expr[Y*this.arr_formulas[U].i_fill_step+4]+" as `"+ap+CRSLimiter+an+"`";ag=L}}}}}}else{if(N=="\u6784\u9020\u4e0b\u62c9\u5217\u8868"||N=="\u6784\u9020\u4e0b\u62c9\u5217\u8868\uff08\u5141\u8bb8\u5176\u4ed6\u503c\uff09"){crsReport.crsTableIndex.clear_values_on_list(this.arr_formulas[U].arr_fill_expr[Y*this.arr_formulas[U].i_fill_step+1],this.arr_formulas[U].arr_fill_expr[Y*this.arr_formulas[U].i_fill_step+2],this.arr_formulas[U].i_cur_seq)}}}if(ag!=""){if(crsReport.ListKey!=""){var ae=crsReport.ListKey.indexOf(".");var ar=crsReport.ListKey.indexOf(".",ae+1);var ab=crsReport.ListKey.substr(ae+1,ar-ae-1);this.arr_formulas[U].s_dump_sql="select "+aq+" from "+ag+" where displayseq="+ab+" order by displayseq"}else{var V=false;for(i_idx in Z){if(typeof Z[i_idx]=="function"){break}if(Z[i_idx].dump_sql==undefined){continue}if(Z[i_idx].dump_sql.indexOf(ag)!=-1){V=true;if(Z[i_idx].dump_sql.indexOf(aq)==-1){var W=Z[i_idx].dump_sql.indexOf(" from ");var P=Z[i_idx].dump_sql.substr(0,W);Z[i_idx].dump_sql=P+","+aq+Z[i_idx].dump_sql.substr(W)}break}}if(!V){this.arr_formulas[U].s_dump_sql="select "+aq+" from "+ag+" where curlabel='"+crsReport.s_postfix+"'order by displayseq"}}}if(this.arr_formulas[U].b_hasif&&this.arr_formulas[U].i_cur_seq>0){if(this.arr_formulas[U].arr_cur_column_ref!=null&&this.arr_formulas[U].arr_cur_column_ref.length>0){var ab=crsReport.crsTableIndex.get_cur_tab_name(this.arr_formulas[U].arr_cur_table_ref[0]);al.app.push(ab+".displayseq='"+this.arr_formulas[U].i_cur_seq+"'")}}}if(this.arr_formulas[U].arr_cur_column_ref!=null){for(var Y=0,aj=this.arr_formulas[U].arr_cur_column_ref.length;Y<aj;Y++){var ap=crsReport.crsTableIndex.get_cur_tab_name(this.arr_formulas[U].arr_cur_table_ref[Y]);var ab="%%"+ap+".col"+this.arr_formulas[U].arr_cur_column_ref[Y]+"%%";if(T.indexOf(ab)!=-1){L=HandleMemoStr(crsReport.crsTableIndex.get_cell_value(this.arr_formulas[U].arr_cur_table_ref[Y],this.arr_formulas[U].arr_cur_column_ref[Y],true),false);al.rep.push(ab);al.rep.push("'%%"+L+"%%'")}ab="%%"+ap+".col"+this.arr_formulas[U].arr_cur_column_ref[Y];if(T.indexOf(ab)!=-1){L=HandleMemoStr(crsReport.crsTableIndex.get_cell_value(this.arr_formulas[U].arr_cur_table_ref[Y],this.arr_formulas[U].arr_cur_column_ref[Y],true),false);al.rep.push(ab);al.rep.push("'%%"+L+"%%'")}ab=ap+".col"+this.arr_formulas[U].arr_cur_column_ref[Y]+"%%";if(T.indexOf(ab)!=-1){L=HandleMemoStr(crsReport.crsTableIndex.get_cell_value(this.arr_formulas[U].arr_cur_table_ref[Y],this.arr_formulas[U].arr_cur_column_ref[Y],true),false);al.rep.push(ab);al.rep.push("'%%"+L+"%%'")}}}if(this.arr_formulas[U].s_formulas_type=="\u81ea\u5b9a\u4e49\u516c\u5f0f"){}else{if(this.arr_formulas[U].s_dump_sql!=""){al.dump_sql=this.arr_formulas[U].s_dump_sql}K.push(U);if(this.arr_formulas[U].s_column_ref_back!=""){if(M!=""){M+="@"}M+=U+"@"+this.arr_formulas[U].s_column_ref_back;if(this.arr_formulas[U].s_cond_sql!=""){ad+=U+"_"+this.arr_formulas[U].i_cur_seq+";"+this.arr_formulas[U].s_cond_sql+";"}}}S=this.arr_formulas[U].s_db_name;if(Z==null){Z=[]}Z.push(al)}}if(Z!=null){var ac=[],O=[];for(U=0;U<R;U++){if(!this.arr_formulas[U].b_to_executed){continue}if(this.arr_formulas[U].arr_cur_column_ref!=null){for(var Y=0,aj=this.arr_formulas[U].arr_cur_column_ref.length;Y<aj;Y++){if(au==""||au.indexOf("a"+this.arr_formulas[U].arr_cur_table_ref[Y]+"c")==-1){var ab=crsReport.crsTableIndex.get_cur_tab_name(this.arr_formulas[U].arr_cur_table_ref[Y]);if(au!=""){au+=","}au+=ab}if(this.arr_formulas[U].s_formulas_type=="\u9a8c\u8bc1\u516c\u5f0f"){O.push(this.arr_formulas[U].arr_cur_table_ref[Y]);O.push(this.arr_formulas[U].arr_cur_column_ref[Y]);O.push(this.arr_formulas[U].i_cur_seq)}}}if(this.arr_formulas[U].arr_fill_expr!=null){for(var Y=0,aj=this.arr_formulas[U].arr_fill_expr.length/this.arr_formulas[U].i_fill_step;Y<aj;Y++){if(this.arr_formulas[U].arr_fill_expr[Y*this.arr_formulas[U].i_fill_step+5]=="\u586b\u5165\u503c"){if(ah!=""){ah+=","}ah+=this.arr_formulas[U].arr_fill_expr[Y*this.arr_formulas[U].i_fill_step+1]+CRSLimiter+this.arr_formulas[U].arr_fill_expr[Y*this.arr_formulas[U].i_fill_step+2]+","+this.arr_formulas[U].arr_fill_expr[Y*this.arr_formulas[U].i_fill_step+3]+","+this.arr_formulas[U].arr_fill_expr[Y*this.arr_formulas[U].i_fill_step+4];if(this.arr_formulas[U].b_do_match){ac.push(this.arr_formulas[U].arr_fill_expr[Y*this.arr_formulas[U].i_fill_step+1]);ac.push(this.arr_formulas[U].arr_fill_expr[Y*this.arr_formulas[U].i_fill_step+2]);ac.push("-"+this.arr_formulas[U].i_cur_seq)}else{if(this.arr_formulas[U].b_has_match){if(this.arr_formulas[U].i_match_value_fill_formulas_index>=0){ac.push(this.arr_formulas[U].arr_fill_expr[Y*this.arr_formulas[U].i_fill_step+1]);ac.push(this.arr_formulas[U].arr_fill_expr[Y*this.arr_formulas[U].i_fill_step+2]);ac.push("-"+this.arr_formulas[U].i_cur_seq)}else{ac.push(this.arr_formulas[U].arr_fill_expr[Y*this.arr_formulas[U].i_fill_step+1]);ac.push(this.arr_formulas[U].arr_fill_expr[Y*this.arr_formulas[U].i_fill_step+2]);ac.push("-0")}}else{var ae=-1;if(this.arr_formulas[U].s_condition_expr!=""){var af=crsReport.crsTableIndex.get_col_kid_by_id(this.arr_formulas[U].arr_fill_expr[Y*this.arr_formulas[U].i_fill_step+3],this.arr_formulas[U].arr_fill_expr[Y*this.arr_formulas[U].i_fill_step+4]);ae=this.arr_formulas[U].s_condition_expr.indexOf("\u672c\u62a5\u8868."+af)}if(ae==-1){ac.push(this.arr_formulas[U].arr_fill_expr[Y*this.arr_formulas[U].i_fill_step+1]);ac.push(this.arr_formulas[U].arr_fill_expr[Y*this.arr_formulas[U].i_fill_step+2]);ac.push("0")}}}}}}}this.s_temp_table_list="";if(ac.length>0&&!this.b_for_pivot){if(this.s_exec_time!=CRS_WRITE_EXEC){crsReport.crsTableIndex.clear_data_item(ac)}if(!p){if(au!=""){Q=crsReport.crsTableIndex.create_cur_table_data(this.s_exec_time==CRS_DELETE_EXEC)}}}else{if(!p){if(au!=""){Q=crsReport.crsTableIndex.create_cur_table_data(this.s_exec_time==CRS_DELETE_EXEC)}}}if(O.length>0&&!this.b_for_pivot){crsReport.crsTableIndex.reset_cell_color(O)}if(!p){if(this.b_for_pivot){crsReport.crsDataSet.exec_sql_list(S,Z,1,ai,au,ah,M,ad,window.parent.show_pivot_datas,crsReport,K,this.s_temp_table_list,Q)}else{crsReport.crsDataSet.exec_sql_list(S,Z,0,ai,au,ah,M,ad,crsReport.fill_values,crsReport,K,this.s_temp_table_list,Q)}}else{return{actions:Z,cur_tab_list:au,cur_col_list:ah,func_list:K}}}}};TCRSFormulasCache.prototype.end_execute=function(){if(this.arr_formulas!=null){for(var c=0,d=this.arr_formulas.length;c<d;c++){this.arr_formulas[c].b_to_executed=false;if(this.arr_formulas[c].s_dump_sql!=""&&this.arr_formulas[c].s_formulas_type!="\u9a8c\u8bc1\u516c\u5f0f"){this.arr_formulas[c].s_dump_sql=""}}}};TCRSFormulasCache.prototype.get_fill_type=function(d,e,f){return this.arr_formulas[d].get_fill_type(e,f)};TCRSFormulasCache.prototype.is_readonly=function(g){this.loadData("#tablecrs_formulas");if(this.isEmpty()){return false}if(this.arr_column_readonly[g]!=undefined){return this.arr_column_readonly[g]}this.init_formulas();for(var f=0,d=this.arr_formulas.length;f<d;f++){var c=this.arr_formulas[f];if(c.arr_fill_expr!=null){for(var h=0,b=c.arr_fill_expr.length/c.i_fill_step;h<b;h++){if(c.arr_fill_expr[h*c.i_fill_step+4]==g&&c.arr_fill_expr[h*c.i_fill_step+5]=="\u6784\u9020\u4e0b\u62c9\u5217\u8868"){this.arr_column_readonly[g]=true;return true}}}}this.arr_column_readonly[g]=false;return false};TCRSFormulasCache.prototype.can_pivot=function(h){var f={b_can_pivot:false};if(!this.isEmpty()){var g=this.first();while(!this.EOF()){var e=HandleMemoStr(g.fill_expr,false);if(e!=""){if(e.indexOf("(\u586b\u5165\u503c) \u672c\u62a5\u8868."+h)!=-1&&(e.indexOf("\u5408\u8ba1(")!=-1||e.indexOf("\u8ba1\u6570(")!=-1||e.indexOf("\u5747\u503c(")!=-1||e.indexOf("\u6700\u5927\u503c(")!=-1||e.indexOf("\u6700\u5c0f\u503c(")!=-1||e.indexOf("\u6700\u665a(")!=-1||e.indexOf("\u6700\u65e9(")!=-1)){f.b_can_pivot=true;f.s_func=g.label;break}}g=this.next()}}return f};TCRSFormulasCache.prototype.has_manu_exec_func=function(){var f=false;if(!this.isEmpty()){var d=this.first();while(!this.EOF()){var e=HandleMemoStr(d.apptime,false);if(e.indexOf(CRS_MANUL_EXEC)!=-1){f=true;break}d=this.next()}}return f};function TCRSCodeItem(b){this.crsDataSet=b;this.b_tree_clicked=false;TCRSDataRecord.call(this,this.crsDataSet,"crscell.crs_codeitem","id, codeid, code, name, topcode","","codeid, code")}TCRSCodeItem.prototype=new TCRSDataRecord();function TCRSCodeIndex(b){this.crsDataSet=b;TCRSDataRecord.call(this,this.crsDataSet,"crscell.crs_codeindex","id, name, istree, refertype, allowothervalue, isparentselect","","");this.arr_codeitem=new TCRSCodeItem(b);this.obj_select_cache={}}TCRSCodeIndex.prototype=new TCRSDataRecord();TCRSCodeIndex.prototype.get_value_by_display_text=function(l,g){this.loadData("#tablecrs_codeindex");this.arr_codeitem.loadData("#tablecrs_codeitem");var f=g;var k=g.indexOf(".");if(k!=-1){g=g.substr(0,k)}var h=this.arr_codeitem.multi_search(["codeid","name"],[l,g]);if(h!=null){f=h.code}return f};TCRSCodeIndex.prototype.get_display_text_by_value=function(m,n){if(m<=0){return n}this.loadData("#tablecrs_codeindex");this.arr_codeitem.loadData("#tablecrs_codeitem");var g=n;var k=this.arr_codeitem.multi_search(["codeid","code"],[m,n]);if(k!=null){var l=this.search("id",m);var h=HandleMemoStr(l.refertype,false);if(h=="only code"){g=HandleMemoStr(k.code,false)}else{if(h=="only name"){g=HandleMemoStr(k.name,false)}else{g=HandleMemoStr(k.code,false)+"."+HandleMemoStr(k.name,false)}}}return g};TCRSCodeIndex.prototype.get_select=function(x,p){this.loadData("#tablecrs_codeindex");this.arr_codeitem.loadData("#tablecrs_codeitem");p=this.get_value_by_display_text(x,p);if(this.obj_select_cache[x]!=undefined){if(typeof this.obj_select_cache[x]=="object"){return""}var c=this.obj_select_cache[x];c=c.replace(" selected>",">");var w=c.indexOf("<option value='"+p+"'>");if(w!=-1){c=c.replace("<option value='"+p+"'>","<option value='"+p+"' selected>")}return c}else{var q="";var n=this.search("id",x);var v=HandleMemoStr(n.refertype,false);if(n!=null){if(n.istree!="y"){q+="<option value=''></option>";if(n.allowothervalue=="y"){q+="<option value='<\u8f93\u5165...>'><\u8f93\u5165...></option>"}var s=false;if(!this.arr_codeitem.isEmpty()){var u=this.arr_codeitem.first();while(!this.arr_codeitem.EOF()){if(u.codeid==x){var r="";var t=HandleMemoStr(u.code,false);var y=HandleMemoStr(u.name,false);if(v=="only code"){r=t}else{if(v=="only name"){r=y}else{r=t+"."+y}}if(!s&&p==t){s=true}q+="<option value='"+t+"'"+((p==t)?" selected":"")+">"+r+"</option>"}u=this.arr_codeitem.next()}}if(n.allowothervalue=="y"&&!s&&p!=""){q+="<option value='"+p+"' selected>"+p+"</option>"}}else{}}if(q!=""){this.obj_select_cache[x]=q}return q}};TCRSCodeIndex.prototype.get_tree=function(w,r,q,d,t,h,b,s){if(s==undefined){s=crsReport.obj_target_cell}var j=false;var func_set_value="";if(d==1){if(this.obj_select_cache[w]!=undefined){var f=this.obj_select_cache[w].toString();var m=f.indexOf(".set_value('")+12;var a=f.indexOf("'",m);var e=f.substring(m,a);f=f.replaceAll(e,b);if($("#id_select").length>0){$("#id_select").html(f);$("#id_select").css("left",$(s).offset().left);$("#id_select").css("top",$(s).offset().top+$(s).height());$("#id_select").height(200);$("#id_select").show();$(document).bind("click",function(){if(window.event==undefined){return}var c=(window.event.srcElement==undefined)?window.event.target:window.event.srcElement;if(c!=undefined&&$(c).parents("#id_select").length==0){$("#id_select").hide();crsReport.crsCodeIndex.b_tree_clicked=false;$(document).unbind("click")}else{if(c!=undefined&&c.tagName!=undefined){if(c.tagName.toLowerCase()!="div"){crsReport.crsCodeIndex.b_tree_clicked=true}}}});window.event.cancelBubble=true}else{crsReport.crsCommon.crsForm.show_hint(f)}return}else{var g=this.search("id",w);h=HandleMemoStr(g.refertype,false);this.obj_select_cache[w]=new TreeView();this.obj_select_cache[w].setImagePath("/static/modules/reportshop/selecttree/images/");this.obj_select_cache[w].add(d++,t,g.name,"",null);t=1;j=true}}if(!this.arr_codeitem.isEmpty()){if(t!="1"){var s_href=this.obj_select_cache[w].Nodes[t].Href;var i_idx=s_href.indexOf("if(0)");if(i_idx!=-1){func_set_value=s_href.substr(i_idx+5);this.obj_select_cache[w].Nodes[t].Href=func_set_value}}var l=this.arr_codeitem.first();while(!this.arr_codeitem.EOF()){if(l.codeid==w&&l.topcode==q){if(!j){j=true}var i="";var u=HandleMemoStr(l.code,false);var o=HandleMemoStr(l.name,false);if(h=="only code"){i=u}else{if(h=="only name"){i=o}else{i=u+"."+o}}d=getColPlatKId(getGuidGenerator());this.obj_select_cache[w].add(d,t,u+"."+o,"crsReport.crsCodeIndex.get_tree("+w+",'"+r+"',"+l.id+",'','"+d+"','"+h+"','"+b+"');if(0)crsReport.crsCodeIndex.set_value('"+b+"', '"+u+"', '"+i+"');",null)}l=this.arr_codeitem.next()}if(j){if($("#id_select").length>0){$("#id_select").html(this.obj_select_cache[w].toString());if(t==1){$("#id_select").css("left",$(s).offset().left);$("#id_select").css("top",$(s).offset().top+$(s).height());$("#id_select").show()}$(document).bind("click",function(){if(window.event==undefined){return}var c=(window.event.srcElement==undefined)?window.event.target:window.event.srcElement;if(c!=undefined&&$(c).parents("#id_select").length==0){$("#id_select").hide();crsReport.crsCodeIndex.b_tree_clicked=false;$(document).unbind("click")}else{if(c!=undefined&&c.tagName!=undefined){if(c.tagName.toLowerCase()!="div"){crsReport.crsCodeIndex.b_tree_clicked=true}}}});if(window.event!=undefined){window.event.cancelBubble=true}}else{crsReport.crsCommon.crsForm.show_hint(this.obj_select_cache[w].toString())}}else{if(t!="1"&&func_set_value!=""){eval(func_set_value)}}}};TCRSCodeIndex.prototype.set_value=function(e,f,g){$("#"+e).val(f);$("#"+e+"_text").val(g);if($("#id_select").length>0){$("#id_select").html("");$("#id_select").hide()}else{var d=$("#select_page");d.children("div.container").html("");d.removeClass("in");$("#"+d.attr("page")).addClass("in")}$("#"+e).change()};TCRSCodeIndex.prototype.is_readonly=function(d){var c=this.search("id",d);return c.allowothervalue!="y"};function TCRSAutoCode(b){this.crsDataSet=b;TCRSDataRecord.call(this,this.crsDataSet,"crscell.crs_autocode","*","","");this.arr_cur_autocode=null}TCRSAutoCode.prototype=new TCRSDataRecord();TCRSAutoCode.prototype.get_next_autocode=function(e,k){var g="";this.loadData("#tablecrs_autocode");var l=this.search("id",e);if(l!=null){if(l.newpoint=="\u65b0\u5efa\u62a5\u8868"&&k||l.newpoint=="\u4fdd\u5b58\u62a5\u8868"&&!k){var h="",f="";if(l.rule_let!=undefined&&l.rule_let!=""){h=crsReport.crsTableIndex.create_cur_table_data(false)}g=this.crsDataSet.get_next_autocode(e,h,"");if(this.arr_cur_autocode==null){this.arr_cur_autocode=[]}this.arr_cur_autocode.push(e);this.arr_cur_autocode.push(g)}}return g};TCRSAutoCode.prototype.roll_back=function(){if(this.arr_cur_autocode!=null){for(var d=0,e=this.arr_cur_autocode.length/2;d<e;d++){var f=this.search("id",this.arr_cur_autocode[d*2]);if(f!=null){if(f.reusetype!="\u4e0d\u53ef\u91cd\u7528"){this.crsDataSet.roll_back(f.id,this.arr_cur_autocode[d*2+1])}}}}};function TCRSDepartment(c,d){this.crsDataSet=c;TCRSDataRecord.call(this,this.crsDataSet,"department","DEPT_ID,DEPT_NAME,MANAGER,ASSISTANT_ID,LEADER1,LEADER2","DEPT_ID='"+d+"'","")}TCRSDepartment.prototype=new TCRSDataRecord();TCRSDepartment.prototype.get_name_by_id=function(d){this.loadData("#tabledepartment");var c=this.search("DEPT_ID",d);if(c==null&&d!=""){var e=this.crsDataSet.get_dept_by_id(d);if(e.length>0){var f=this;$.each(e,function(a,b){f.rows.push(b)});c=e[0]}}if(c!=null){return c.DEPT_NAME}return d};TCRSDepartment.prototype.get_id_by_name=function(d){this.loadData("#tabledepartment");var c=this.search("DEPT_NAME",d);if(c==null&&d!=""){var e=this.crsDataSet.get_dept_by_name(d);if(e.length>0){var f=this;$.each(e,function(a,b){f.rows.push(b)});c=e[0]}}if(c!=null){return c.DEPT_ID}return d};TCRSDepartment.prototype.get_name_list_by_id=function(h){if(h!=""){var e=h.split(",");h="";for(var g=0,f=e.length;g<f;g++){if(e[g]!=""){h+=this.get_name_by_id(e[g])+","}}}return h};TCRSDepartment.prototype.get_id_list_by_name=function(h){if(h!=""){var e=h.split(",");h="";for(var g=0,f=e.length;g<f;g++){if(e[g]!=""){h+=this.get_id_by_name(e[g])+","}}}return h};TCRSDepartment.prototype.is_dept_manager=function(k,s,n){if(n!=""){var p=this.search("DEPT_ID",s);if(p==null&&s!=""){var m=this.crsDataSet.get_dept_by_id(s);if(m.length>0){var r=this;$.each(m,function(a,b){r.rows.push(b)});p=m[0]}}if(p!=null){p.MANAGER=HandleMemoStr(p.MANAGER,false);p.ASSISTANT_ID=HandleMemoStr(p.ASSISTANT_ID,false);p.LEADER1=HandleMemoStr(p.LEADER1,false);p.LEADER2=HandleMemoStr(p.LEADER2,false);var q=n.split(",");for(var o=0,t=q.length-1;o<t;o++){var l="";switch(q[o]){case"\u90e8\u95e8\u4e3b\u7ba1":l=p.MANAGER;break;case"\u90e8\u95e8\u52a9\u7406":l=p.ASSISTANT_ID;break;case"\u4e0a\u7ea7\u4e3b\u7ba1\u9886\u5bfc":l=p.LEADER1;break;case"\u4e0a\u7ea7\u5206\u7ba1\u9886\u5bfc":l=p.LEADER2;break}if(l!=""){if((","+l).indexOf(","+k+",")!=-1){return true}}}}}return false};TCRSDepartment.prototype.get_dept_manager=function(h,m){var l="";if(m!=""){var o=this.search("DEPT_ID",h);if(o!=null){o.MANAGER=HandleMemoStr(o.MANAGER,false);o.ASSISTANT_ID=HandleMemoStr(o.ASSISTANT_ID,false);o.LEADER1=HandleMemoStr(o.LEADER1,false);o.LEADER2=HandleMemoStr(o.LEADER2,false);var p=m.split(",");for(var n=0,k=p.length-1;n<k;n++){switch(p[n]){case"\u90e8\u95e8\u4e3b\u7ba1":l+=o.MANAGER;break;case"\u90e8\u95e8\u52a9\u7406":l+=o.ASSISTANT_ID;break;case"\u4e0a\u7ea7\u4e3b\u7ba1\u9886\u5bfc":l+=o.LEADER1;break;case"\u4e0a\u7ea7\u5206\u7ba1\u9886\u5bfc":l+=o.LEADER2;break}}}}return l};TCRSDepartment.prototype.get_long_dept_name=function(c){this.loadData("#tabledepartment");var a=this.search("DEPT_ID",c);if(a==null&&c!=""){var d=this.crsDataSet.get_dept_by_id(c);if(d.length>0){var e=this;$.each(d,function(b,f){e.rows.push(f)});a=d[0]}}if(a!=null){if(a.long_dept_name==undefined){a.long_dept_name=this.crsDataSet.get_long_dept_name(c)}return a.long_dept_name}else{return""}};function TCRSChart(c,d){this.i_repid=d;this.crsDataSet=c;TCRSDataRecord.call(this,this.crsDataSet,"crscell.crs_chart","*","repid='"+d+"'","");this.obj_series_ref_col=null;this.arr_colors=["#2f7ed8","#e0522f","#ffcc00","#10cca6","#6bb61d","#f2a21a","#ff7372","#a5e8d2","#9ce810","#fff80a","#1dcfab","#858e54"];this.f_min_val=null;this.f_max_val=null;this.b_rotation=false;this.i_max_len=0;this.obj_geoc=null}TCRSChart.prototype=new TCRSDataRecord();TCRSChart.prototype.get_chart_type=function(c){var d={s_type:"column",b_stacked:false};switch(c){case"\u67f1\u72b6\u56fe":break;case"\u6808\u67f1\u72b6\u56fe":d.b_stacked=true;break;case"\u6761\u5f62\u56fe":d.s_type="bar";break;case"\u6808\u6761\u5f62\u56fe":d.s_type="bar";d.b_stacked=true;break;case"\u6298\u7ebf\u56fe":d.s_type="line";break;case"\u997c\u72b6\u56fe":d.s_type="pie";break;case"\u9762\u79ef\u56fe":d.s_type="area";break;case"\u6808\u9762\u79ef\u56fe":d.s_type="area";d.b_stacked=true;break;case"\u6563\u70b9\u56fe":d.s_type="scatter";break;case"\u6c14\u6ce1\u56fe":d.s_type="bubble";break;case"\u96f7\u8fbe\u56fe":d.s_type="polar";break;case"\u4eea\u8868\u76d8":d.s_type="gauge";break;default:break}return d};TCRSChart.prototype.get_categories=function(m){if(m.xrange==""){if(m.category_name!=""){return m.category_name.split(",")}else{if(m.series_name!=""){return m.series_name.split(",")}return null}}var l=HandleMemoStr(m.xrange,false).split(",");var r=[];var o=0;for(var t=0,q=l.length;t<q;t++){var p=rectNameToIndex(l[t]);if(m.orientation=="toptobottom"){for(var s=p[0].y;s<=p[1].y;s++){var n=crsReport.crsCommon.get_cell_value(m.sheetindex,p[0].x,s);r.push(n);o+=r[r.length-1].length;if(this.i_max_len<r[r.length-1].length){this.i_max_len=r[r.length-1].length}}}else{for(var s=p[0].x;s<=p[1].x;s++){var n=crsReport.crsCommon.get_cell_value(m.sheetindex,s,p[0].x);r.push(n);o+=r[r.length-1].length;if(this.i_max_len<r[r.length-1].length){this.i_max_len=r[r.length-1].length}}}}if(o>50){this.b_rotation=true}return r};TCRSChart.prototype.get_series=function(u){var z=[];if(u.series_name!=""){z=u.series_name.split(",")}var v=this.get_categories(u);if(v==null){v=[]}if(this.obj_series_ref_col==null){this.obj_series_ref_col={}}this.f_max_val=null;this.f_min_val=null;var E=[],w=[{type:"pie",name:z[0]!=""?z[0]:v[0],data:[]}];var t=HandleMemoStr(u.data_range,false).split(",");for(var J=0,C=t.length;J<C;J++){var B=rectNameToIndex(t[J]);var y,F="",G={};if(u.orientation=="toptobottom"){for(var H=B[0].x,A=J;H<=B[1].x;H++,A++){y={name:z.length>A?z[A]:"\u7cfb\u5217 "+A,data:[],dial:{}};var k=y.name.indexOf("|");if(k!=-1){G=this.get_chart_type(y.name.substr(k+1));y.type=G.s_type;y.stacking=G.b_stacked?"normal":"";y.name=y.name.substr(0,k)}for(var I=B[0].y,x=0;I<=B[1].y;I++,x++){F=crsReport.crsCommon.get_cell_value(u.sheetindex,H,I);if(F==""){F=0}if(u.chart_type!="\u4f4d\u7f6e\u8f68\u8ff9"){F=parseFloat(F)}y.data.push(F);w[0].data.push([v[0]!=""&&v.length>x+A?v[x+A]:(z.length>x+A?z[x+A]:"\u7cfb\u5217 "+x+A),F]);if(u.chart_type=="\u4eea\u8868\u76d8"){y.dial.backgroundColor=this.arr_colors[A];if(this.f_min_val==null||this.f_min_val>F){this.f_min_val=F}if(this.f_max_val==null||this.f_max_val<F){this.f_max_val=F}y.dataLabels={enabled:false}}this.obj_series_ref_col[y.name+"_"+x]={};F=crsReport.crsCommon.get_cell_attr(u.sheetindex,H,I,"cid");this.obj_series_ref_col[y.name+"_"+x].col=F;var D=crsReport.crsTableIndex.getAColSchema(this.obj_series_ref_col[y.name+"_"+x].col);if(D!=null){this.obj_series_ref_col[y.name+"_"+x].seq=D.get_display_seq(H,I)-1}}E.push(y)}}else{for(var H=B[0].y,A=J;H<=B[1].y;H++,A++){y={name:z.length>A?z[A]:"\u7cfb\u5217 "+A,data:[],dial:{}};var k=y.name.indexOf("|");if(k!=-1){G=this.get_chart_type(y.name.substr(k+1));y.type=G.s_type;y.stacking=G.b_stacked?"normal":"";y.name=y.name.substr(0,k)}for(var I=B[0].x,x=0;I<=B[1].x;I++,x++){F=crsReport.crsCommon.get_cell_value(u.sheetindex,I,H);if(F==""){F=0}if(u.chart_type!="\u4f4d\u7f6e\u8f68\u8ff9"){F=parseFloat(F)}y.data.push(F);w[0].data.push([v[0]!=""&&v.length>x+A?v[x+A]:(z.length>x+A?z[x+A]:"\u7cfb\u5217 "+x+A),F]);if(u.chart_type=="\u4eea\u8868\u76d8"){y.dial.backgroundColor=this.arr_colors[A];if(this.f_min_val==null||this.f_min_val>F){this.f_min_val=F}if(this.f_max_val==null||this.f_max_val<F){this.f_max_val=F}y.dataLabels={enabled:false}}this.obj_series_ref_col[y.name+"_"+x]={};this.obj_series_ref_col[y.name+"_"+x].col=crsReport.crsCommon.get_cell_attr(u.sheetindex,I,H,"cid");var D=crsReport.crsTableIndex.getAColSchema(this.obj_series_ref_col[y.name+"_"+x].col);if(D!=null){this.obj_series_ref_col[y.name+"_"+x].seq=D.get_display_seq(I,H)-1}}E.push(y)}}}return(u.chart_type=="\u997c\u72b6\u56fe")?w:E};TCRSChart.prototype.draw_chart=function(T){var N=T.label;var O=$("#"+N);if($(O).length<=0){var X="row"+T.ycoordinate+"column"+T.xcoordinate;var S=crsReport.obj_cell_maps[T.sheetindex][X];var C=(T.aright-T.aleft+1)+"px",W=(T.abottom-T.atop+1)+"px";C="99%";W="96%";if(crsReport.i_width>0&&false){var O='<div id="'+N+'" style="min-width:450px;min-height:350px;position: absolute;left:'+$(S).offset().left+"; top:"+$(S).offset().top+";width:"+C+"; height:"+W+';z-index:1002;margin: 0 auto"></div>'}else{var O='<div id="'+N+'" style="min-width:450px;min-height:350px;position: absolute;left:'+$(S).offset().left+"; top:"+$(S).offset().top+";width:"+C+";height:"+W+';z-index:1002;margin: 0 auto"></div>'}if(crsReport.i_width<=0&&crsReport.i_height<=0){$(S).html($(O))}else{$("body").append($(O))}O=$("#"+N);if(T.chart_type=="\u4f4d\u7f6e\u8f68\u8ff9"){var A=new BMap.Map(N);A.centerAndZoom("\u5317\u4eac",12);A.enableScrollWheelZoom(true)}}var D=this.get_chart_type(T.chart_type);if(T.chart_type=="\u4f4d\u7f6e\u8f68\u8ff9"){var A=null;if(O.children().length>0){O.empty()}if(O.children().length<=0){A=new BMap.Map(N);A.centerAndZoom("\u5317\u4eac",12);A.enableScrollWheelZoom(true);if(crsReport.crsCommon.obj_geoc==null){crsReport.crsCommon.obj_geoc=new BMap.Geocoder()}}else{A=O.children()[0]}var p=this.get_series(T);var K=[];var R=0;for(s_k in p){if(typeof p[s_k]=="function"){continue}for(s_k2 in p[s_k]["data"]){if(typeof p[s_k]["data"][s_k2]=="function"){continue}var ab=p[s_k]["data"][s_k2];if(ab!=undefined&&ab!=""){R++}}}for(s_k in p){if(typeof p[s_k]=="function"){continue}for(s_k2 in p[s_k]["data"]){if(typeof p[s_k]["data"][s_k2]=="function"){continue}var ab=p[s_k]["data"][s_k2];if(ab!=undefined&&ab!=""){crsReport.crsCommon.obj_geoc.getPoint(ab,function(a){K.push(a);if(a){A.centerAndZoom(a,16);A.addOverlay(new BMap.Marker(a))}else{}if(K.length==R){var b=new BMapLib.CurveLine(K,{strokeColor:"blue",strokeWeight:3,strokeOpacity:0.5});A.addOverlay(b)}},"")}}}}else{if(D.s_type=="pie"){$(O).highcharts({chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:false,style:{fontFamily:"\u5b8b\u4f53",fontSize:"12px"}},title:{text:T.title,style:{fontFamily:"\u5b8b\u4f53",fontSize:"16px",fontweight:"bold"}},xAxis:{labels:{style:{fontFamily:"\u5b8b\u4f53",fontSize:"12px"}}},plotOptions:{pie:{allowPointSelect:true,cursor:"pointer",point:{events:{click:function(){var a=crsReport.crsTableIndex.get_ref_report(crsReport.crsChartCache.obj_series_ref_col[this.series.name+"_"+this.x].col,crsReport.crsChartCache.obj_series_ref_col[this.series.name+"_"+this.x].seq);if(a!=null){if(typeof window.link_report=="function"){link_report(a)}else{window.parent.link_report(a)}}}}},dataLabels:{enabled:true,formatter:function(){return"<b>"+this.point.name+"</b>: "+this.y}}}},series:this.get_series(T),credits:{enabled:false},colors:this.arr_colors})}else{if(D.s_type=="gauge"){var V=this.get_series(T);var M=[];if(T.color_span!=""){var aa=HandleMemoStr(T.color_span,false).split(",");for(var I=0,H=aa.length;I<H;I++){var P={};var L=aa[I].indexOf("-");P.from=aa[I].substring(1,L);var Y=aa[I].indexOf("]");P.to=aa[I].substring(L+1,Y);var Z=parseInt(aa[I].substr(Y+1));P.color=get_color(Z);M.push(P)}Q=M[0].from;U=M[H-1].to}else{var G=0.5,E=0.5;var U=this.f_max_val*(1+E),Q=this.f_min_val*(1-G),F=U-Q;if(F==0){F=this.f_max_val}F/=3;M.push({from:Q,to:Q+F,color:"#DF5353"});M.push({from:Q+F,to:Q+2*F,color:"#DDDF0D"});M.push({from:Q+2*F,to:U,color:"#55BF3B"})}var J=T.title;if(T.title==""){J=T.series_name}$(O).highcharts({chart:{type:"gauge",plotBackgroundColor:null,plotBackgroundImage:null,plotBorderWidth:0,plotShadow:false,style:{fontFamily:"\u5b8b\u4f53",fontSize:"12px"}},title:{text:J,style:{fontFamily:"\u5b8b\u4f53",fontSize:"16px",fontweight:"bold"}},pane:{startAngle:-120,endAngle:120,background:[{backgroundColor:{linearGradient:{x1:0,y1:0,x2:0,y2:1},stops:[[0,"#FFF"],[1,"#333"]]},borderWidth:0,outerRadius:"109%"},{backgroundColor:{linearGradient:{x1:0,y1:0,x2:0,y2:1},stops:[[0,"#333"],[1,"#FFF"]]},borderWidth:1,outerRadius:"107%"},{},{backgroundColor:"#DDD",borderWidth:0,outerRadius:"105%",innerRadius:"103%"}]},plotOptions:{series:{cursor:"pointer",point:{events:{click:function(){var a=crsReport.crsTableIndex.get_ref_report(crsReport.crsChartCache.obj_series_ref_col[this.series.name+"_"+this.x].col,crsReport.crsChartCache.obj_series_ref_col[this.series.name+"_"+this.x].seq);if(a!=null){if(typeof window.link_report=="function"){link_report(a)}else{window.parent.link_report(a)}}}}},marker:{lineWidth:1},dataLabels:{enabled:true}}},yAxis:{min:Q,max:U,minorTickInterval:"auto",minorTickWidth:1,minorTickLength:10,minorTickPosition:"inside",minorTickColor:"#666",tickPixelInterval:30,tickWidth:2,tickPosition:"inside",tickLength:10,tickColor:"#666",labels:{step:2,rotation:"auto"},plotBands:M},series:V,credits:{enabled:false},colors:this.arr_colors})}else{if(D.s_type=="polar"){var B=this.get_categories(T);var V=this.get_series(T);$(O).highcharts({chart:{polar:true,type:"line",marginRight:130,marginBottom:25,style:{fontFamily:"\u5b8b\u4f53",fontSize:"12px"}},title:{text:T.title,x:-20,style:{fontFamily:"\u5b8b\u4f53",fontSize:"16px",fontweight:"bold"}},xAxis:{categories:B,labels:{style:{fontFamily:"\u5b8b\u4f53",fontSize:"12px"}}},yAxis:{title:{text:""}},plotOptions:{series:{cursor:"pointer",point:{events:{click:function(){var a=crsReport.crsTableIndex.get_ref_report(crsReport.crsChartCache.obj_series_ref_col[this.series.name+"_"+this.x].col,crsReport.crsChartCache.obj_series_ref_col[this.series.name+"_"+this.x].seq);if(a!=null){if(typeof window.link_report=="function"){link_report(a)}else{window.parent.link_report(a)}}}}},marker:{lineWidth:1},dataLabels:{enabled:(B.length*V.length<=10)?true:false}}},legend:{layout:"vertical",align:"right",verticalAlign:"top",x:-10,y:100,borderWidth:0},series:V,credits:{enabled:false},colors:this.arr_colors})}else{var B=this.get_categories(T);var V=this.get_series(T);$(O).highcharts({chart:{type:D.s_type,marginLeft:D.s_type=="bar"?this.i_max_len*13:30,marginBottom:this.b_rotation?this.i_max_len*13:30,style:{fontFamily:"\u5b8b\u4f53",fontSize:"12px"}},title:{text:T.title,x:-20,style:{fontFamily:"\u5b8b\u4f53",fontSize:"16px",fontWeight:"bolder"}},xAxis:{categories:B,labels:{rotation:(this.b_rotation&&D.s_type!="bar")?-40:0,align:"right",style:{fontFamily:"\u5b8b\u4f53",fontSize:"12px"}}},yAxis:{title:{text:""}},plotOptions:{series:{stacking:D.b_stacked?"normal":"",cursor:"pointer",point:{events:{click:function(){var a=crsReport.crsTableIndex.get_ref_report(crsReport.crsChartCache.obj_series_ref_col[this.series.name+"_"+this.x].col,crsReport.crsChartCache.obj_series_ref_col[this.series.name+"_"+this.x].seq);if(a!=null){if(typeof window.link_report=="function"){link_report(a)}else{window.parent.link_report(a)}}}}},marker:{lineWidth:1},dataLabels:{enabled:(B.length*V.length<=10)?true:false}}},legend:{layout:"vertical",align:"right",verticalAlign:"top",x:-10,y:100,borderWidth:0,style:{fontFamily:'"\u5b8b\u4f53"',fontSize:"12px"}},series:V,credits:{enabled:false},colors:this.arr_colors})}}}}};TCRSChart.prototype.load_chart=function(){this.loadData("#tablecrs_chart");if(!crsReport.b_as_form){if(!this.isEmpty()){crsReport.crsCommon.crsTable.crsCellControler.cache_td(0);var b=this.first();while(!this.EOF()){b.label=getColPlatKId(b.label);b.category_name=HandleMemoStr(b.category_name,false);b.series_name=HandleMemoStr(b.series_name,false);this.draw_chart(b);b=this.next()}}}};TCRSChart.prototype.update_ref=function(n,l,g,h,m){if(!this.isEmpty()){var k=this.first();while(!this.EOF()){k.data_range=update_ref(n,l,g,k.data_range,h,m);if(k.xrange!=""){k.xrange=update_ref(n,l,g,k.xrange,h,m)}k=this.next()}}};TCRSChart.prototype.refresh=function(){if(!this.isEmpty()){var b=this.first();while(!this.EOF()){this.draw_chart(b);b=this.next()}}};TCRSChart.prototype.change_type=function(d){if(!this.isEmpty()){var c=this.first();while(!this.EOF()){c.chart_type=d;this.draw_chart(c);c=this.next()}}};TCRSChart.prototype.set_chart_actions=function(){if(!this.isEmpty()){var b=this.first();while(!this.EOF()){crsReport.crsCommon.add_action_maps(["chart",b.chart_type,(b.xrange=="")?b.category_name:b.xrange,b.series_name,b.data_range,b.orientation]);b=this.next()}}};function TCRSUser(b){this.crsDataSet=b;TCRSDataRecord.call(this,this.crsDataSet,"user","UID,USER_ID,USER_NAME,DEPT_ID,DEPT_ID_OTHER,USER_PRIV,USER_PRIV_OTHER","","")}TCRSUser.prototype=new TCRSDataRecord();TCRSUser.prototype.getUserRoleInfo=function(){this.loadData("#tableuser");info=this.first();res=[];if(!this.EOF()){res.push(info.USER_PRIV);res.push(HandleMemoStr(info.USER_PRIV_OTHER,false));res.push(info.DEPT_ID);res.push(HandleMemoStr(info.DEPT_ID_OTHER,false));res.push(this.userId)}return res};TCRSUser.prototype.get_dept_and_priv=function(f){this.loadData("#tableuser");var e={dept:"",priv:"",other_dept:"",other_priv:""};var d=this.search("USER_ID",f);if(d!=null){e.dept=d.DEPT_ID;e.priv=d.USER_PRIV;e.other_dept=HandleMemoStr(d.DEPT_ID_OTHER,false);e.other_priv=HandleMemoStr(d.USER_PRIV_OTHER,false)}return e};TCRSUser.prototype.get_name_by_id=function(c){this.loadData("#tableuser");var d=this.search("USER_ID",c);if(d==null&&c!=""){var e=this.crsDataSet.get_user_by_id(c);if(e.length>0){var f=this;$.each(e,function(a,b){f.rows.push(b)});d=e[0]}}if(d!=null){return d.USER_NAME}else{return c}};TCRSUser.prototype.get_id_by_name=function(d){this.loadData("#tableuser");var c=this.search("USER_NAME",d);if(c==null&&d!=""){var e=this.crsDataSet.get_user_by_name(d);if(e.length>0){var f=this;$.each(e,function(a,b){f.rows.push(b)});c=e[0]}}if(c!=null){return c.USER_ID}else{return d}};TCRSUser.prototype.get_uid_by_name=function(d){this.loadData("#tableuser");var c=this.search("USER_NAME",d);if(c==null&&d!=""){var e=this.crsDataSet.get_user_by_name(d);if(e.length>0){var f=this;$.each(e,function(a,b){f.rows.push(b)});c=e[0]}}if(c!=null){return c.UID}else{return d}};TCRSUser.prototype.get_name_list_by_id=function(h){if(h!=""){var e=h.split(",");h="";for(var g=0,f=e.length;g<f;g++){if(e[g]!=""){h+=this.get_name_by_id(e[g])+","}}}return h};TCRSUser.prototype.get_id_list_by_name=function(h){if(h!=""){var e=h.split(",");h="";for(var g=0,f=e.length;g<f;g++){if(e[g]!=""){if(crsReport.b_mobile){h+=this.get_uid_by_name(e[g])+","}else{h+=this.get_id_by_name(e[g])+","}}}}return h};TCRSUser.prototype.get_user_list_by_priv=function(g){this.loadData("#tableuser");var f={};if(!this.isEmpty()){var h=this.first();while(!this.EOF()){var e=","+HandleMemoStr(h.USER_PRIV_OTHER,false)+h.USER_PRIV+",";if(e.indexOf(","+g+",")!=-1){f[h.USER_ID]=h.USER_NAME}h=this.next()}}return f};TCRSUser.prototype.get_user_list_by_dept=function(n,l){var r={};if(!this.isEmpty()){var m=this.first();while(!this.EOF()){var o=","+HandleMemoStr(m.DEPT_ID_OTHER,false)+m.DEPT_ID+",";var q=","+HandleMemoStr(m.USER_PRIV_OTHER,false)+m.USER_PRIV+",";if((o.indexOf(","+n+",")!=-1&&(l==""||in_assign_role(l,q)))||crsReport.crsDeptCache.is_dept_manager(m.USER_ID,n,l)){r[m.USER_ID]=m.USER_NAME}m=this.next()}}var p=crsReport.crsDeptCache.get_dept_manager(n,l);if(p!=""){var h=p.split(",");for(var g=0,k=h.length;g<k;g++){if(h[g]!=""){if(r[h[g]]==undefined){r[h[g]]=this.get_name_by_id(h[g])}}}}return r};TCRSUser.prototype.get_long_dept_name=function(e){this.loadData("#tableuser");var b=this.search("USER_ID",e);if(b==null&&e!=""){var c=this.crsDataSet.get_user_by_id(e);if(c.length>0){var d=this;$.each(c,function(a,f){d.rows.push(f)});b=c[0]}}if(b!=null){if(b.long_dept_name==undefined){b.long_dept_name=crsReport.crsDeptCache.get_long_dept_name(b.DEPT_ID)}return b.long_dept_name}else{return""}};function TCRSRowProperty(p,m,l,o,r,s,q){this.i_prev_display_seq=m;this.i_display_seq=1;this.obj_col=p;this.obj_col_schema=null;this.s_userid=o;this.s_organid=l;this.s_writetime=r;this.s_title=s;this.s_memo=q;this.b_is_seq_updated=false;this.s_val="";this.arr_col_list=[];this.arr_val_list=[];this.arr_val_pro_list=[];for(var k=0,n=p.rows.length;k<n;k++){this.arr_col_list.push("col"+p.rows[k].id);this.arr_val_list.push("");this.arr_val_pro_list.push("")}}TCRSRowProperty.prototype={constructor:TCRSRowProperty,init:function(){this.b_is_seq_updated=false;this.s_val="";if(this.obj_col_schema==null){this.obj_col_schema=crsReport.crsTableIndex.getAColSchema(this.obj_col.rows[0].kid)}},calc_display_seq:function(l,k,f,h){if(this.b_is_seq_updated){return}if(k==undefined){this.i_display_seq=l}else{var g=rectNameToIndex(l);if(k=="\u4e0d\u6269\u5c55"||k=="\u6309\u884c\u5411\u4e0b"){this.i_display_seq=(h-g[0].y)/(g[1].y-g[0].y+1)+1}else{this.i_display_seq=(f-g[0].x)/(g[1].x-g[0].x+1)+1}}if(!this.b_is_seq_updated){this.b_is_seq_updated=true}if(this.i_prev_display_seq!=0&&this.i_prev_display_seq!=this.i_display_seq){if(this.s_val!=""){this.s_val+=","}this.s_val+="displayseq='"+this.i_display_seq+"'"}this.i_prev_display_seq=this.i_display_seq},add_col_value:function(g,h,e){var f=this.arr_col_list.indexOf(g);if(f!=-1){this.arr_val_list[f]=h;if(e){this.arr_val_pro_list[f]="Y"}}},update_col_value:function(c,d){if(d!=""&&typeof d=="string"){d=d.replaceAll(";",CRSSep)}if(this.s_val!=""){this.s_val+=","}if(d=="null"){this.s_val+=c+"=null"}else{this.s_val+=c+"='"+d+"'"}},get_delimited_text:function(){var f="";for(var d=0,e=this.arr_val_list.length;d<e;d++){if(d>0){f+=","}if(typeof this.arr_val_list[d]=="string"){f+="'"+this.arr_val_list[d].replaceAll(";",CRSSep)+"'"}else{f+="'"+this.arr_val_list[d]+"'"}}return f},is_blank:function(){var f=false;for(var d=0,e=this.arr_val_list.length;d<e;d++){if(this.arr_val_list[d]!=""&&this.arr_val_list[d]!="null"&&this.arr_val_list[d]!="0"&&(this.arr_val_pro_list[d]==""||this.arr_val_pro_list[d]==undefined)){break}}if(d>=e){f=true}return f},set_write_info:function(k,h,l,f,g){if(this.s_organid!=k){this.update_col_value("organid",k);this.s_organid=k}if(this.s_userid!=h){this.update_col_value("userid",h);this.s_userid=h}if(this.s_writetime!=l){this.update_col_value("writetime",l);this.s_writetime=l}if(this.s_title!=f){this.update_col_value("title",f);this.s_title=f}if(this.s_memo!=g){this.update_col_value("memo",g);this.s_memo=g}}};function TCRSTableProperty(){this.s_err_info="";this.arr_key_list=null;this.arr_must_list=null;this.arr_only_list=null;this.arr_val_list=null;this.s_newline=crsReport.b_mobile?"<br>":"\n"}TCRSTableProperty.prototype={constructor:TCRSTableProperty,add_key_col:function(b){if(this.arr_key_list==null){this.arr_key_list=[]}this.arr_key_list.push(b)},add_must_col:function(b){if(this.arr_must_list==null){this.arr_must_list=[]}this.arr_must_list.push(b)},add_only_col:function(b){if(this.arr_only_list==null){this.arr_only_list=[]}this.arr_only_list.push(b)},add_onrepeat_col:function(b){if(this.arr_norepeat_list==null){this.arr_norepeat_list=[]}this.arr_norepeat_list.push(b)},add_row:function(b){if(this.arr_val_list==null){this.arr_val_list=[]}this.arr_val_list.push(b)},do_check:function(L){var I=true;this.s_err_info="";var G=crsReport.crsTableIndex.rows[L];if(G.tabletype=="\u4e3b\u8868"||G.tabletype=="\u4ea4\u53c9\u8868"){if(this.arr_val_list==null){}else{if(this.arr_val_list.length>1){if(this.s_err_info!=""&&crsReport.b_mobile){this.s_err_info+=this.s_newline}this.s_err_info+="\u3010"+G.label+"\u3011\u542b\u591a\u6761\u6570\u636e\uff01"+this.s_newline;I=false;return I}}}if(this.arr_key_list!=null||this.arr_must_list!=null||this.arr_only_list!=null){if(this.arr_val_list!=null){var y=null,w=null;for(var F=0,D=this.arr_val_list.length;F<D;F++){var B=this.arr_val_list[F];if(F==0||!B.is_blank()||G.tabletype=="\u4e3b\u8868"){if(this.arr_must_list!=null){var M=false;var s=false;for(var H=0,J=this.arr_must_list.length;H<J;H++){var C=this.arr_must_list[H];var x=B.arr_col_list.indexOf("col"+C.id);if(!crsReport.crsTableIndex.is_invalid(C.kid,B.i_display_seq)){if((B.arr_val_list[x]==""||B.arr_val_list[x]=="null")){if(crsReport.b_mobile){var t=crsReport.crsTableIndex.getAColSchema(C.kid);var A=t.get_cell_point(B.i_display_seq);var u=crsReport.crsTableIndex.rows[t.row_idx];crsReport.crsCommon.crsForm.set_cell_backgroud_color(u.sheetindex-1,A.x,A.y,"red");this.s_err_info+="\u3010"+G.label+"\u3011\u7b2c\u3010"+B.i_display_seq+"\u3011\u884c\u6216\u5217\u4e4b\u5fc5\u586b\u9879\u3010"+C.columnlabel+"\u3011\uff0c\u672a\u586b \uff01"+this.s_newline;if(!M){M=true}}else{if(!s){s=true;var t=crsReport.crsTableIndex.getAColSchema(C.kid);var A=t.get_cell_point(B.i_display_seq);var u=crsReport.crsTableIndex.rows[t.row_idx];crsReport.crsCommon.set_cell_cursor(u.sheetindex-1,A.x,A.y)}if(this.s_err_info!=""&&crsReport.b_mobile){this.s_err_info+=this.s_newline}this.s_err_info+="\u3010"+G.label+"\u3011\u7b2c\u3010"+B.i_display_seq+"\u3011\u884c\u6216\u5217\u4e4b\u5fc5\u586b\u9879\u3010"+C.columnlabel+"\u3011\uff0c\u672a\u586b \uff01"+this.s_newline}}else{if(crsReport.b_mobile){var t=crsReport.crsTableIndex.getAColSchema(C.kid);var A=t.get_cell_point(B.i_display_seq);var u=crsReport.crsTableIndex.rows[t.row_idx];crsReport.crsCommon.crsForm.set_cell_backgroud_color(u.sheetindex-1,A.x,A.y)}}}}if(M){this.s_err_info+="\u6807\u7ea2\u533a\u57df\u4e3a\u5fc5\u586b\uff0c\u8bf7\u586b\u5199\uff01"}}if(this.s_err_info!=""){I=false;return I}if(this.arr_key_list!=null){var E="",v="",z="";for(var H=0,J=this.arr_key_list.length;H<J;H++){var C=this.arr_key_list[H];if(z!=""){z+=","}z+=C.columnlabel;var x=B.arr_col_list.indexOf("col"+C.id);if(!crsReport.crsTableIndex.is_invalid(C.kid,B.i_display_seq)){if(E!=""){E+=" and "}if(B.arr_val_list[x]!="null"){v+=B.arr_val_list[x]+",";E+=B.arr_col_list[x]+"='"+B.arr_val_list[x]+"'"}else{E+=B.arr_col_list[x]+" is null"}}}if(y==null||y.indexOf(v)==-1){if(crsReport.crsDataSet.is_exist_key(G.id,E,crsReport.userId,crsReport.writeTime)){if(this.s_err_info!=""&&crsReport.b_mobile){this.s_err_info+=this.s_newline}this.s_err_info+="\u3010"+G.label+"\u3011\u7b2c\u3010"+B.i_display_seq+"\u3011\u884c\u6216\u5217\u4e4b\u4e3b\u952e\u3010"+z+"\u3011\u503c\u4e3a\u3010"+v+"\u3011\u5df2\u5b58\u5728\uff0c\u4e0d\u5141\u8bb8\u518d\u6b21\u586b\u5199 \uff01"+this.s_newline}}if(y!=null&&y.indexOf(v)!=-1){if(this.s_err_info!=""&&crsReport.b_mobile){this.s_err_info+=this.s_newline}this.s_err_info+="\u3010"+G.label+"\u3011\u7b2c\u3010"+B.i_display_seq+"\u3011\u884c\u6216\u5217\u4e4b\u4e3b\u952e\u3010"+z+"\u3011\u503c\u4e3a\u3010"+v+"\u3011\uff0c\u91cd\u590d\u586b\u5199 \uff01"+this.s_newline}else{if(y==null){y=[]}y.push(v)}}if(this.s_err_info!=""){I=false;return I}if(this.arr_only_list!=null){var v="",K="";for(var H=0,J=this.arr_only_list.length;H<J;H++){var C=this.arr_only_list[H];if(K!=""){K+=","}K+=C.columnlabel;var x=B.arr_col_list.indexOf("col"+C.id);if(!crsReport.crsTableIndex.is_invalid(C.kid,B.i_display_seq)){if(B.arr_val_list[x]!="null"){v+=B.arr_val_list[x]+","}}}if(w!=null&&w.indexOf(v)!=-1){if(this.s_err_info!=""&&crsReport.b_mobile){this.s_err_info+=this.s_newline}this.s_err_info+="\u3010"+G.label+"\u3011\u7b2c\u3010"+B.i_display_seq+"\u3011\u884c\u6216\u5217\u4e4b\u4e0d\u91cd\u590d\u9879\u3010"+K+"\u3011\u503c\u4e3a\u3010"+v+"\u3011\uff0c\u91cd\u590d\u586b\u5199 \uff01"+this.s_newline}else{if(w==null){w=[]}w.push(v)}}if(this.s_err_info!=""){I=false;return I}}}}}if(this.s_err_info!=""){I=false}return I},init:function(){this.arr_val_list=null}};function TCRSWorkflow(c,d){this.crsDataSet=c;this.i_repid=d;this.arr_included_user=null;TCRSDataRecord.call(this,this.crsDataSet,"crscell.crs_workflow","*","repid='"+d+"'","id")}TCRSWorkflow.prototype=new TCRSDataRecord();TCRSWorkflow.prototype.get_begin_task=function(){this.loadData("#tablecrs_workflow");var d="";var e=this.get_valid_task(crsReport.s_cur_task);if(!this.isEmpty()){var f=this.first();while(!this.EOF()){if(f.is_begin=="\u662f"){d=f.label}if(f.is_end=="\u662f"){if(e==f.label||e==""&&f.is_begin=="\u662f"){crsReport.b_is_endtask=true}}if(d!=""&&crsReport.b_is_endtask){break}f=this.next()}}return d};TCRSWorkflow.prototype.get_valid_task=function(d){var c=d.indexOf("(");if(c!=-1){return d.substr(0,c)}else{return d}};TCRSWorkflow.prototype.getColumnList=function(L,N,I,D,G,K){var O=crsReport.get_valid_cur_task();var J=this.search("label",O);if(J!=null){var v="",M="";var I=","+I+N+",";var G=","+G+D+",";if(J.column_list!=""){var A=5;var H=HandleMemoStr(J.column_list,false);if(H.charAt(0)=="A"){A=6;H=H.substr(1)}else{if(H.charAt(0)=="B"){A=8;H=H.substr(1)}else{if(H.charAt(0)=="C"){A=9;H=H.substr(1)}}}var P=H.split("|");if(P.length%5!=0&&A==5){A=6}var w=crsReport.crsReportState.get_prev_writer(crsReport.s_cur_task);for(var B=0,z=P.length/A;B<z;B++){var y=P[B*A],C=P[B*A+1];if(y=="0"){y=crsReport.crsUserCache.get_dept_and_priv(w).dept}if(C=="\u6d41\u7a0b\u53d1\u8d77\u4eba"&&crsReport.s_writer==crsReport.userId){if(P[B*A+4]!=""){if(crsReport.s_read_filter!=""){crsReport.s_read_filter+=" or "}crsReport.s_read_filter+=P[B*A+4]}if(A>=8){crsReport.s_noappend_tab+=HandleMemoStr(P[B*A+6],false);crsReport.s_nodelete_tab+=HandleMemoStr(P[B*A+7],false)}if(A>=9){crsReport.s_noinsert_tab+=HandleMemoStr(P[B*A+8],false)}var x=P[B*A+3];if(x!=""&&x!="--\u5b57\u6bb5\u5217\u8868--"){if(v!=""){v+=","}v+=x}var x=P[B*A+2];if(x!=""&&x!="--\u5b57\u6bb5\u5217\u8868--"){if(M!=""){M+=","}M+=x}}if(C=="\u4e0a\u4e00\u6b65\u6267\u884c\u4eba"){if(w==crsReport.s_writer){if(P[B*A+4]!=""){if(crsReport.s_read_filter!=""){crsReport.s_read_filter+=" or "}crsReport.s_read_filter+=P[B*A+4]}if(A>=8){crsReport.s_noappend_tab+=HandleMemoStr(P[B*A+6],false);crsReport.s_nodelete_tab+=HandleMemoStr(P[B*A+7],false)}if(A>=9){crsReport.s_noinsert_tab+=HandleMemoStr(P[B*A+8],false)}var x=P[B*A+3];if(x!=""&&x!="--\u5b57\u6bb5\u5217\u8868--"){if(v!=""){v+=","}v+=x}var x=P[B*A+2];if(x!=""&&x!="--\u5b57\u6bb5\u5217\u8868--"){if(M!=""){M+=","}M+=x}}}if(C==L+"."||I.indexOf(","+y+",")!=-1||G.indexOf(","+C+",")!=-1||in_assign_user(y,C,crsReport.s_assign_user)||crsReport.crsDeptCache.is_dept_manager(L,y,C)){if(C==""||y==""||in_assign_role(C,G)||crsReport.crsDeptCache.is_dept_manager(L,y,C)){if(P[B*A+4]!=""){if(crsReport.s_read_filter!=""){crsReport.s_read_filter+=" or "}crsReport.s_read_filter+=P[B*A+4]}if(A>=8){crsReport.s_noappend_tab+=HandleMemoStr(P[B*A+6],false);crsReport.s_nodelete_tab+=HandleMemoStr(P[B*A+7],false)}if(A>=9){crsReport.s_noinsert_tab+=HandleMemoStr(P[B*A+8],false)}var x=P[B*A+3];if(x!=""&&x!="--\u5b57\u6bb5\u5217\u8868--"){if(v!=""){v+=","}v+=x}var x=P[B*A+2];if(x!=""&&x!="--\u5b57\u6bb5\u5217\u8868--"){if(M!=""){M+=","}M+=x}}}if(is_ref_cell(C)){var F=crsReport.crsTableIndex.get_cell_value(C,1);F=crsReport.crsUserCache.get_id_list_by_name(F);var E=F.split(",");if(E.indexOf(crsReport.s_writer)!=-1||E.indexOf(crsReport.s_assign_user)!=-1){if(P[B*A+4]!=""){if(crsReport.s_read_filter!=""){crsReport.s_read_filter+=" or "}crsReport.s_read_filter+=P[B*A+4]}if(A>=8){crsReport.s_noappend_tab+=HandleMemoStr(P[B*A+6],false);crsReport.s_nodelete_tab+=HandleMemoStr(P[B*A+7],false)}if(A>=9){crsReport.s_noinsert_tab+=HandleMemoStr(P[B*A+8],false)}var x=P[B*A+3];if(x!=""&&x!="--\u5b57\u6bb5\u5217\u8868--"){if(v!=""){v+=","}v+=x}var x=P[B*A+2];if(x!=""&&x!="--\u5b57\u6bb5\u5217\u8868--"){if(M!=""){M+=","}M+=x}}}}}if(M!=""){crsReport.writeColList=M.split(",")}else{crsReport.writeColList=[]}if(v!=""){crsReport.readColList=v.split(",")}}};TCRSWorkflow.prototype.get_role_list_by_organ=function(p,o){var m=this.search("label",p);if(m!=null){if(m.column_list!=""){var h=5;var l=HandleMemoStr(m.column_list,false);if(l.charAt(0)=="A"){h=6;l=l.substr(1)}else{if(l.charAt(0)=="B"){h=8;l=l.substr(1)}else{if(l.charAt(0)=="C"){h=9;l=l.substr(1)}}}var g=l.split("|");if(g.length%5!=0&&h==5){h=6}for(var n=0,k=g.length/h;n<k;n++){if(g[n*h]==o){return g[n*h+1]}}}}return""};TCRSWorkflow.prototype.get_task_candidate=function(C){var w=this.search("label",C);var v=[],D=[];var L=false;var F=5;var u=null;if(w==null||w.is_begin=="\u662f"){var x=null;L=true;if(crsReport.s_can_roll_back!="y"){x=crsReport.crsReportState.get_writer_list("")}if(x!=null){D=x.arr_userid;for(var I=0,E=D.length;I<E;I++){if(D[I].indexOf(".")==-1){D[I]+="."+crsReport.crsUserCache.get_name_by_id(D[I])}}}else{if(crsReport.s_write_mode!=""){v=HandleMemoStr(crsReport.s_write_organ,false).split(";");D=HandleMemoStr(crsReport.s_write_role,false).split(";")}}}else{var x=null;if(crsReport.s_can_roll_back!="y"){x=crsReport.crsReportState.get_writer_list(C)}if(x!=null){D=x.arr_userid;for(var I=0,E=D.length;I<E;I++){if(D[I].indexOf(".")==-1){D[I]+="."+crsReport.crsUserCache.get_name_by_id(D[I])}}}else{v=HandleMemoStr(w.priv_organ,false).split(",");D=HandleMemoStr(w.priv_role,false).split(",");var H=HandleMemoStr(w.column_list,false);if(H.charAt(0)=="A"){F=6;H=H.substr(1)}else{if(H.charAt(0)=="B"){F=8;H=H.substr(1)}else{if(H.charAt(0)=="C"){F=9;H=H.substr(1)}}}u=HandleMemoStr(H,false).split("|");if(F==5&&u.length()%5!=0){F=6}}}var A={};if(D.indexOf("\u4e0a\u4e00\u6b65\u6267\u884c\u4eba")!=-1){A[crsReport.s_writer]=crsReport.crsUserCache.get_name_by_id(crsReport.s_writer);if(!this.is_excluded(u,"","\u4e0a\u4e00\u6b65\u6267\u884c\u4eba",F)){this.add_included_user(C,crsReport.s_writer)}}if(D.indexOf("\u6d41\u7a0b\u53d1\u8d77\u4eba")!=-1){if(A[crsReport.userId]==undefined){A[crsReport.userId]=crsReport.crsUserCache.get_name_by_id(crsReport.userId)}if(!this.is_excluded(u,"","\u6d41\u7a0b\u53d1\u8d77\u4eba",F)){this.add_included_user(C,crsReport.userId)}}for(var I=0,E=D.length;I<E;I++){var B=this.is_excluded(u,"",D[I],F);var O=D[I].indexOf(".");if(O!=-1){var y=D[I].substr(0,O);if(A[y]==undefined){A[y]=crsReport.crsUserCache.get_name_by_id(y)}if(!B){this.add_included_user(C,y)}}else{if(is_ref_cell(D[I])){var M=crsReport.crsTableIndex.getAColSchema(D[I]);var z=rectNameToIndex(M.col.rows[M.col_idx].cellspan);var J=crsReport.crsCommon.get_cell_value(0,z[0].x,z[0].y);if(J!=""){if(J.charAt(J.length-1)!=","){var y=crsReport.crsUserCache.get_id_by_name(J);if(A[y]==undefined){A[y]=J}if(!B){this.add_included_user(C,y)}}else{var G=J.split(",");for(var p=0,t=G.length-1;p<t;p++){if(A[G[p]]==undefined){A[G[p]]=crsReport.crsUserCache.get_name_by_id(G[p])}if(!B){this.add_included_user(C,G[p])}}}}}else{var K=crsReport.crsUserCache.get_user_list_by_priv(D[I]);for(s_key in K){if(A[s_key]==undefined){A[s_key]=K[s_key]}if(!B){this.add_included_user(C,s_key)}}}}}for(var I=0,E=v.length;I<E;I++){var N="";if(L){N=crsReport.crsPrivCache.get_role_list_by_organ(v[I])}else{N=this.get_role_list_by_organ(C,v[I])}var B=this.is_excluded(u,v[I],N,F);var K=null;if(v[I]=="0"){K=crsReport.crsUserCache.get_user_list_by_dept(crsReport.s_writer_organid,N)}else{K=crsReport.crsUserCache.get_user_list_by_dept(v[I],N)}for(s_key in K){if(A[s_key]==undefined){A[s_key]=K[s_key]}if(!B){this.add_included_user(C,s_key)}}}return A};TCRSWorkflow.prototype.get_schedule=function(d){var f="\u62a2\u5148\u5f0f";this.loadData("#tablecrs_workflow");if(d==""){d=crsReport.s_begin_task}else{d=this.get_valid_task(d)}var e=this.search("label",d);if(e!=null){f=e.schedulemode;if(e.is_begin=="\u662f"){if(crsReport.s_write_mode=="y"){f="\u5e76\u5217\u5f0f"}else{if(crsReport.s_write_mode=="2"){f="\u8865\u5145\u5f0f"}}}}return f};TCRSWorkflow.prototype.get_next_task=function(d){var c=null;var b=crsReport.s_cur_task;if(crsReport.s_cur_task==""){var e=crsReport.crsReportState.get_task_state(crsReport.s_cur_task,crsReport.s_writer);if(e!="done"&&crsReport.s_write_mode!=""){if(crsReport.s_write_mode=="y"){if(e=="unknown"){if(crsReport.s_begin_writer.indexOf(",")!=-1){return c}}else{return c}}}}else{this.loadData("#tablecrs_workflow");b=this.get_valid_task(b);var g=this.search("label",b);if(g!=null){if(g.schedulemode=="\u4f1a\u7b7e\u5f0f"||g.schedulemode=="\u5e76\u5217\u5f0f"||(g.is_begin=="\u662f"&&crsReport.s_write_mode=="y")){var e=crsReport.crsReportState.get_task_state(crsReport.s_cur_task,crsReport.s_writer);if(e==""){return c}}}}if(b==""){b=crsReport.s_begin_task}var f=crsReport.crsTableIndex.create_cur_table_data(false);var a=crsReport.crsDataSet.get_next_task(b,f);if(a.res=="+OK"){return a.next_task}return c};TCRSWorkflow.prototype.get_cowrite_time=function(l,g){this.loadData("#tablecrs_workflow");var b=5,a="",e=false;if(!this.isEmpty()){var n=this.first();while(!this.EOF()){if((n.schedulemode=="\u5e76\u5217\u5f0f"||n.schedulemode=="\u8865\u5145\u5f0f")&&n.is_link!="\u662f"){var c=HandleMemoStr(n.column_list,false);if(c!=""){if(c.charAt(0)=="A"){b=6;c=c.substr(1)}else{if(c.charAt(0)=="B"){b=8;c=c.substr(1)}else{if(c.charAt(0)=="C"){b=9;c=c.substr(1)}}}var m=c.split("|");if(m.length%5!=0&&b==5){b=6}for(var d=0,h=m.length/b;d<h;d++){if(m[d*b+2].indexOf(l)!=-1){break}}if(d<m.length/b){a=n.label;e=n.is_begin=="\u662f";break}}}n=this.next()}}if(a==""){if(crsReport.s_write_mode=="y"||crsReport.s_write_mode=="2"){a=this.get_begin_task;e=true}}crsReport.crsReportState.loadData("#tablecrs_reportstate");if(!crsReport.crsReportState.isEmpty()){var n=crsReport.crsReportState.first();while(!crsReport.crsReportState.EOF()){if(n.workflow.indexOf(a)!=-1||(e&&n.workflow=="")){var k=HandleMemoStr(n.useridlist,false).split(","),p=HandleMemoStr(n.writetimelist,false).split(","),f=HandleMemoStr(n.finishtimelist,false).split(",");var o=k.indexOf(g);if(o!=-1){if(o<f.length&&f[o]!=""){return f[o]}else{if(d<p.length){return p[o]}}}}n=crsReport.crsReportState.next()}}return""};TCRSWorkflow.prototype.is_excluded=function(e,c,f,b){if(b==undefined){b=5}if(e!=null){if(b==5&&e.length%5!=0){b=6}for(var d=0,a=Math.floor(e.length/b);d<a;d++){if(e[d*b]==c&&e[d*b+1]==f){return e[d*b+5]=="\u221a"}}}return false};TCRSWorkflow.prototype.add_included_user=function(b,a){if(this.arr_included_user==null){this.arr_included_user={}}if(this.arr_included_user[b]==undefined){this.arr_included_user[b]=[]}if(this.arr_included_user[b].indexOf(a)==-1){this.arr_included_user[b].push(a)}};TCRSWorkflow.prototype.is_excluded_user=function(b,a){if(this.arr_included_user!=null&&this.arr_included_user[b]!=undefined){return this.arr_included_user[b].indexOf(a)==-1}return false};TCRSWorkflow.prototype.must_submit=function(){var c=crsReport.s_valid_cur_task;var a=this.get_schedule(c);var d=true;switch(a){case"\u5e76\u5217\u5f0f":var b=crsReport.crsReportState.get_task_state(crsReport.s_cur_task,crsReport.s_writer);d=b=="done";break;default:}return d};function TCRSReportState(g,f,h,e){this.crsDataSet=g;this.i_repid=f;TCRSDataRecord.call(this,this.crsDataSet,"crscell.crs_reportstate","workflow, organidlist, useridlist, writetimelist, finishtimelist, dataflow, prevtask, prevwriter","repid='"+f+"' and userid='"+h+"' and writetime='"+e+"'","id")}TCRSReportState.prototype=new TCRSDataRecord();TCRSReportState.prototype.get_prev_writer=function(e){this.loadData("#tablecrs_reportstate");var d="";var f=this.search("workflow",e);if(f!=null){d=f.prevwriter}return d};TCRSReportState.prototype.get_task_state=function(r,k){this.empty();this.loadData("#tablecrs_reportstate");var q="done";var n=this.search("workflow",r);if(n!=null){if(n.useridlist!=""){var m=HandleMemoStr(n.useridlist,false).split(",");var p=HandleMemoStr(n.finishtimelist,false).split(",");if(m.length>p.length){q=""}else{for(var o=0,l=m.length;o<l;o++){if(k!=""&&m[o]==k){continue}if(p[o]==""){q="";break}}}}}else{q="unknown"}return q};TCRSReportState.prototype.get_writer_list=function(d){var e=null;var f=this.search("workflow",d);if(f!=null){e={};e.arr_organid=HandleMemoStr(f.organidlist,false).split(",");e.arr_userid=HandleMemoStr(f.useridlist,false).split(",");e.arr_finishtime=HandleMemoStr(f.finishtimelist,false).split(",")}return e};TCRSReportState.prototype.get_done_task=function(){if(!this.doLoaded&&!crsReport.has_workflow()){this.doLoaded=true}this.loadData("#tablecrs_reportstate");var k=[];if(!this.isEmpty()){var l=this.first();while(!this.EOF()){var n=l.workflow;n=crsReport.crsWorkflow.get_valid_task(n);if(n==crsReport.s_begin_task){n=""}if(k.indexOf(n)==-1){var m=l.useridlist.split(",");var q=l.finishtimelist.split(",");var p=m.length_without_null,r=q.length_without_null;if(n==""){if(crsReport.s_write_mode=="y"){if(p<=r){k.push(n)}}else{if(r>0){k.push(n)}}}else{var o=crsReport.crsWorkflow.get_schedule(n);if(o!="\u62a2\u5148\u5f0f"){if(p<=r){k.push(n)}}else{if(r>0){k.push(n)}}}}l=this.next()}}return(k.length_without_null()<=0)?null:k};TCRSReportState.prototype.get_data_flow=function(c){this.loadData("#tablecrs_reportstate");var d=this.search("workflow",c);if(d!=null){return HandleMemoStr(d.dataflow,false).replaceAll("&gt;",">")}return""};TCRSReportState.prototype.get_prev_tasks=function(e,a){this.loadData("#tablecrs_reportstate");var b=false;if(a==undefined){a="";b=true}if(a==""){a=crsReport.s_cur_task}var d=this.search("workflow",a);if(d!=null){if(d.prevtask==""&&d.workflow!=""){if(crsReport.b_mobile){$(e).append("<div class='reportBlock'><div class='read_detail clearfix '><em><input type='radio' style='display:;' name='ROLL_BACK' "+(b?"checked":"")+"/>"+crsReport.s_begin_task+"<\u521d\u59cb\u586b\u62a5></em></div></div>")}else{$(e).append("<li onclick='rollback_report(this)'><a href='#'>"+crsReport.s_begin_task+"<\u521d\u59cb\u586b\u62a5></a></li>")}}else{var f=d.prevtask.indexOf("(");var c=false;if(f==-1){c=crsReport.s_begin_task==d.prevtask}if(!c&&f==-1){if(crsReport.b_mobile){$(e).append("<div class='reportBlock'><div class='read_detail clearfix '><em><input type='radio' style='display:;' name='ROLL_BACK' "+(b?"checked":"")+"/>"+d.prevtask+"</em></div></div>")}else{$(e).append("<li onclick='rollback_report(this)'><a href='#'>"+d.prevtask+"</a></li>")}}this.get_prev_tasks(e,d.prevtask)}}};TCRSReportState.prototype.get_write_list=function(d){var e="";var c={};var b=this.search("workflow",d);if(b!=null){c.u=b.useridlist.split(",");c.t=b.finishtimelist.split(",");for(var f=0,a=c.t.length;f<a;f++){if(c.t[f]!=""){e+=c.u[f]+","}}}return e};var CRSAt="#0040`";var CRSDQuote="#0022`";var CRSQuote="#0027`";var CRSSep="#FE54`";var CRSPercent="#0025`";var CRSBlank="#0000`";var CRSLimiter="#_#";var CRSNewLine="#0010`";var CRSEComma="#002C`";var CRSESemiColon="#003B`";var CRSColon="#002E`";var CRSSubSign="#002D`";var CRSGreaterSign="#003E`";var CRSUpRight="#007C`";var CRSUpRight1="#XX7C`";var CRSAnd="#0026`";var CRSLess="#003C`";var CRSSep2="\u2522\u2527";var CRSSlash="#002F`";var CRSDataSetLabel="\u6570\u636e\u6e90_";var CRS_WRITE_EXEC="\u521d\u59cb\u586b\u62a5\u65f6\u81ea\u52a8\u6267\u884c";var CRS_EDIT_EXEC="\u4fee\u6539\u62a5\u8868\u65f6\u81ea\u52a8\u6267\u884c";var CRS_READ_EXEC="\u67e5\u9605\u62a5\u8868\u65f6\u81ea\u52a8\u6267\u884c";var CRS_CHANGE_EXEC="\u7b5b\u9009\u6761\u4ef6\u6539\u53d8\u540e\u81ea\u52a8\u6267\u884c";var CRS_SAVE_EXEC="\u4fdd\u5b58\u65f6\u81ea\u52a8\u6267\u884c";var CRS_SAVE_EXEC2="\u4fdd\u5b58\u65f6";var CRS_MANUL_EXEC="\u624b\u52a8\u6267\u884c";var CRS_DELETE_EXEC="\u5220\u9664\u65f6";var CRSSelect="LadbvmasSvo";var CRSInsert="NNvc3MeTEOE";var CRSUpdate="fZ7fKKYSyO.";var CRSDelete="0QizsF99v8.";var CRSDrop="BVX1unO7ESA";var CRSCreate="ST9zt7043Pk";String.prototype.replaceAll=stringReplaceAll;var arr_kid_map=[];function stringReplaceAll(f,e){if(this==undefined||this==null||this==""){return this}var d=new RegExp(f.replace(/([\(\)\[\]\{\}\^\$\+\-\*\?\.\"\'\|\/\\])/g,"\\$1"),"ig");return this.replace(d,e)}String.prototype.trim=function(){return(this.replace(/^(( )|(\u3000)|\r|\n|\t)*/g,"")).replace(/(( )|(\u3000)|\r|\n|\t)*$/g,"")};Array.prototype.length_without_null=length_without_null;function length_without_null(){var f=0;for(var d=0,e=this.length;d<e;d++){if(this[d]!=undefined&&this[d]!=null&&this[d]!=""){f++}}return f}function HandleMemoStr(d,c){if(c==undefined){c=true}if(d==null||d==""||typeof d!="string"){return d}if(c){d=d.replaceAll("@",CRSAt);d=d.replaceAll(" ",CRSBlank);d=d.replaceAll('"',CRSDQuote);d=d.replaceAll("'",CRSQuote);d=d.replaceAll("&",CRSAnd);d=d.replaceAll(";",CRSSep);d=d.replaceAll(".",CRSColon);d=d.replaceAll("%",CRSPercent);d=d.replaceAll("\r",CRSNewLine);d=d.replaceAll("\n",CRSNewLine);d=d.replaceAll(",",CRSEComma);d=d.replaceAll("->",CRSSubSign+CRSGreaterSign);d=d.replaceAll(">",CRSGreaterSign);d=d.replaceAll("<",CRSLess)}else{d=d.replaceAll(CRSAt,"@");d=d.replaceAll(CRSBlank," ");d=d.replaceAll(CRSDQuote,'"');d=d.replaceAll(CRSQuote,"'");d=d.replaceAll(CRSAnd,"&");d=d.replaceAll(CRSSep,";");d=d.replaceAll(CRSColon,".");d=d.replaceAll(CRSPercent,"%");d=d.replaceAll(CRSNewLine,"\r");d=d.replaceAll(CRSNewLine,"\n");d=d.replaceAll(CRSEComma,",");d=d.replaceAll(CRSSubSign+CRSGreaterSign,"->");d=d.replaceAll(CRSGreaterSign,">");d=d.replaceAll(CRSLess,"<");d=d.replaceAll("&gt;",">");d=d.replaceAll("&lt;","<");d=d.replaceAll(CRSSubSign,"-")}return d}function HandleMemoStr2(d,c){if(c==undefined){c=true}if(d==null||d==""){return d}if(c){d=d.replaceAll(">",CRSGreaterSign);d=d.replaceAll("<",CRSLess)}else{d=d.replaceAll(CRSGreaterSign,">");d=d.replaceAll(CRSLess,"<");d=d.replaceAll("&gt;",">");d=d.replaceAll("&lt;","<")}return d}function indexOf(h,g){for(var e=0,f=h.length;e<f;e++){if(h[e]==g){return e}}return -1}function indexOfLetter(d){var c="ABCDEFGHIJKLMNOPQRSTUVWXYZ";return c.indexOf(d)}function intPower(g,h){var e=1;for(var f=1;f<=h;f++){e*=g}return e}function columnIndexByName(f){var d=0;for(var e=f.length;e>=1;e--){d+=intPower(26,f.length-e)*(indexOfLetter(f.charAt(e-1))-indexOfLetter("A")+1)}return --d}function convert_digit(a){return"ABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(a)}function columnNameByIndex(b){var c="",e=b+1;do{var d=(e-1)%26;c=convert_digit(d)+c;e=Math.floor((e-1)/26)}while(e!=0);return c}function cellNameToIndex(g){g=g.toUpperCase();var e={pg:"",x:-1,y:-1};var f=0;var h=g.indexOf("!");if(h!=-1){e.pg=g.substr(0,h);g=g.substring(h+1,g.length)}while(f<g.length&&g.charAt(f)>="A"&&g.charAt(f)<="Z"){f++}e.x=columnIndexByName(g.substr(0,f));e.y=parseInt(g.substr(f,g.length-f))-1;return e}function cellIndexToName(f){var d=columnNameByIndex(f.x);var e=f.y+1;return d+e}function rectNameToIndex(f){if(f.indexOf(":")==-1){f+=":"+f}var e=f.split(":");var d=[];d.push(cellNameToIndex(e[0]));d.push(cellNameToIndex(e[1]));return d}function rectIndexToName(b){return cellIndexToName(b[0])+":"+cellIndexToName(b[1])}function getColPlatKId(b){return String(b).replaceAll("{","").replaceAll("}","").replaceAll("-","")}function getColRealKId(b){return"{"+b.substr(0,8)+"-"+b.substr(8,4)+"-"+b.substr(12,4)+"-"+b.substr(16,4)+"-"+b.substr(20)+"}"}function format_text(e,d){if(e==undefined){return""}if(e==undefined||d==""){return d}if(typeof crsReport!="undefined"){var f=crsReport.crsTableIndex.getAColSchema(e)}else{var f=d.colModel.formatoptions;d=e}if(f.datatype=="\u65e5\u671f\u578b"&&f.displaystyle.length>0){d=format_text_date(d,f)}if(f.datatype=="\u6570\u503c\u578b"&&f.displaystyle.length>0){d=format_text_number(d,f)}if(f.datatype=="\u8d27\u5e01\u578b"&&f.displaystyle.length>0){d=format_text_money(d,f)}if(f.datatype=="\u5b57\u7b26\u578b"&&f.displaystyle.length>0){d=d.trim()}else{if(f.datatype=="\u5b57\u7b26\u578b"){d=d.replaceAll("\n","<br>")}}return d}function format_text_money(h,g){if(h==undefined){return""}if(g==undefined){return h}if(g.colModel!=undefined){g=g.colModel.formatoptions}var e="";switch(HandleMemoStr(g.displaystyle,false)){case"_($#,##0_) ($#,##0)":var f=(h>0)?number_format(h):"("+number_format(h.replaceAll("-",""))+")";e="\uffe5"+f;break;case"_($#,##0_) [Red]($#,##0)":var f=(h>0)?number_format(h):"("+number_format(h.replaceAll("-",""))+")";e="\uffe5"+f;break;case"_($#,##0.00_) ($#,##0.00)":var f=(h>0)?number_format(h,2,".",","):"("+number_format(h.replaceAll("-",""),2,".",",")+")";e="\uffe5"+f;break;case"_($#,##0.00_) [Red]($#,##0.00)":var f=(h>0)?number_format(h,2,".",","):"("+number_format(h.replaceAll("-",""),2,".",",")+")";e="\uffe5"+f;break;case'_($* #,##0_) _($* (#,##0) _($* "-"_) _(@_)':var f=(h>0)?number_format(h):"("+number_format(h.replaceAll("-",""))+")";e="\uffe5"+f;break;case'_(* #,##0.00_) _(* (#,##0.00) _(* "-"??_) _(@_)':var f=(h>0)?number_format(h,2,".",","):"("+number_format(h.replaceAll("-",""),2,".",",")+")";e=f;break;case'_($* #,##0.00_) _($* (#,##0.00) _($* "-"??_) _(@_)':var f=(h>0)?number_format(h,2,".",","):"("+number_format(h.replaceAll("-",""),2,".",",")+")";e="\uffe5"+f;break;case"\u5927\u5199":e=(h==0)?"\u96f6\u5706\u6574":numToCny(h);break;default:e=h}return e}function format_text_char(d,c){if(HandleMemoStr(c.displaystyle,false)&&is_blank_char(d)){d=d.replace(/\s/g,"");d=d.replace(/<\/?.+?>/g,"");d=d.replace(/[\r\n]/g,"")}return d}function format_text_date(v,q){if(v==undefined){return""}if(q==undefined){return v}if(q.colModel!=undefined){q=q.colModel.formatoptions}var u="";var t="";var d="";var z="";if(v.indexOf(":")!=-1){if(v.indexOf(" ")==-1){v="0000-00-00 "+v}var h=v.split(" ");var A=h[0].split("-");var w=h[1].split(":");var x=w.length;u=w[0];if(x>1){t=w[1]}if(x>2){d=w[2]}if(x>3){z=w[3]}}else{if(v.indexOf("-")!=-1){var A=v.split("-")}else{if(v.indexOf(".")!=-1){var A=v.split(".")}else{return v}}}var m=A[0];var y=A[1];var r=A[2];if(y==undefined){y=0}if(r==undefined){r=0}switch(HandleMemoStr(q.displaystyle,false).toLowerCase()){case"yyyy\u5e74":v=m;break;case"yyyy\u5e74mm\u6708dd\u65e5":v=m+"\u5e74"+y+"\u6708"+r+"\u65e5";break;case"yyyy\u5e74mm\u6708":v=m+"\u5e74"+y+"\u6708";break;case"yyyy.mm.dd":v=m+"."+y+"."+r;break;case"yyyy.mm":v=m+"."+y;break;case"mm:ss:ms":v=t+"."+d+"."+z;break;case"m/d/yy":y=y>9?y:y.substr(1);r=r>9?r:r.substr(1);m=m.substr(2,3);v=y+"/"+r+"/"+m;break;case"dd/mm/yy":m=m.substr(2,3);v=y+"/"+r+"/"+m;break;case"dd.mmmm.yy":y=is_date_month_str(y);m=m.substr(2,3);v=r+"."+y+"."+m;break;case"d-mmm-y":y=is_date_month_str(y,1);r=r>9?r:r.substr(1);m=m.substr(3);v=r+"-"+y+"-"+m;break;case"d-mmm":y=is_date_month_str(y,1);r=r>9?r:r.substr(1);v=r+"-"+y;break;case"mmmm-yy":y=is_date_month_str(y);m=m.substr(2,3);v=y+"-"+m;break;case"h:mm AM/PM":u=u>9?u:u.substr(1);var s=u<12?"AM":"PM";v=u+":"+t+" "+s;break;case"h:mm:ss AM/PM":u=u>9?u:u.substr(1);var s=u<12?"AM":"PM";v=u+":"+t+":"+d+" "+s;break;case"h:mm":u=u>9?u:u.substr(1);v=u+":"+t;break;case"h:mm:ss":u=u>9?u:u.substr(1);v=u+":"+t+":"+d;break;case"m/d/y h:mm":r=r>9?r:r.substr(1);u=u>9?u:u.substr(1);m=m.substr(3);v=y+"/"+r+"/"+m+" "+u+":"+t+":"+d;break;case"mm:ss":v=t+":"+d;break;case"[h]:mm:ss":u=u>9?u:u.substr(1);v="["+u+"]:"+t+":"+d;break;case"mm:ss.ms":v=t+":"+d+":"+z;break}return v}function format_text_number(m,l){if(m==undefined){return""}if(l==undefined){return m}if(l.colModel!=undefined){l=l.colModel.formatoptions}var n="";switch(HandleMemoStr(l.displaystyle,false)){case"0":n=number_format(m,0,".","");break;case"0.0":n=number_format(m,1,".","");break;case"0.00":n=number_format(m,2,".","");break;case"0.000":n=number_format(m,3,".","");break;case"0.0000":n=number_format(m,4,".","");break;case"0.00000":n=number_format(m,5,".","");break;case"0.000000":n=number_format(m,6);break;case"#,##0":n=number_format(m);break;case"#,##0.0":n=number_format(m,1);break;case"#,##0.00":n=number_format(m,2);break;case"#,##0.000":n=number_format(m,3);break;case"#,##0.0000":n=number_format(m,4);break;case"#,##0.00000":n=number_format(m,5);break;case"#,##0.000000":n=number_format(m,6);break;case"0%":n=number_format(m*100,0,".","")+"%";break;case"0.0%":n=number_format(m*100,1,".","")+"%";break;case"0.00%":n=number_format(m*100,2,".","")+"%";break;case"0.00E+00":if(m<0){return""}var p=m.split(".");var k=p[0].length;if(k>3){if(p[0].substr(3,1)>4){var h=p[0].substr(1,1)+(parseInt(p[0].substr(2,1))+1)}else{var h=p[0].substr(1,2)}}else{var h=p[0].substr(1,2)}var o=k-1>10?k-1:"0"+k-1;n=p[0].substr(0,1)+"."+h+"E"+o;break;case"# ?/?":n=m;break;case"# ??/??":n=m;break;case"(#,##0_) (#,##0)":n=(m>0)?number_format(m):"("+number_format(m.replaceAll("-",""))+")";break;case"(#,##0_) [Red](#,##0)":n=(m>0)?number_format(m):'<font color="red">('+number_format(m.replaceAll("-",""))+")</font>";break;case"(#,##0.00_) (#,##0.00)":n=(m>0)?number_format(m,2,".",","):"("+number_format(m.replaceAll("-",""),2,".",",")+")";break;case"(#,##0.00_) [Red](#,##0.00)":n=(m>0)?number_format(m,2,".",","):'<font color="red">('+number_format(m.replaceAll("-",""),2,".",",")+")</font>";break;case'_(* #,##0_) _(* (#,##0) _(* "-"_) _(@_)':n=(m>0)?number_format(m):"("+number_format(m.replaceAll("-",""))+")";break;case"# #0.0E+0":if(m<0){return""}var p=m.split(".");var k=p[0].length;if(k>3){if(p[0].substr(3,1)>4){var h=p[0].substr(1,1)+(parseInt(p[0].substr(2,1))+1)}else{var h=p[0].substr(1,2)}}else{var h=p[0].substr(1,2)}var o=k-1>10?k-1:"0"+k-1;n=number_format(p[0])+"."+h+"E"+o;break;default:n=m}return n}function is_digit_char(b){if(b>="0"&&b<="9"){return true}else{return false}}function is_letter_char(b){if(b.toUpperCase()>="A"&&b.toUpperCase()>="Z"){return true}else{return false}}function is_han_char(b){if(b.charCodeAt(0)>=128){return true}else{return false}}function is_blank_char(b){if(b==" "||b=="\t"||b=="\r"){return true}else{return false}}function is_id_start_char(b){if(is_letter_char(b)||is_han_char(b)||b=="@"){return true}else{return false}}function is_id_other_char(b){if(is_id_start_char(b)||IsDigitChar(b)||b=="_"){return true}else{return false}}function in_assign_user(l,p,t){var m=false;if(t!=""){var q=t.split(",");for(var d=0,o=q.length;d<o;d++){if(q[d]+"."+p){m=true;break}else{var r=crsReport.userCache.get_dept_and_priv(q[d]);var n=","+r.other_dept+r.dept+",",s=","+r.other_priv+r.priv+",";if(n.indexOf(","+l+",")!=-1||s.indexOf(","+p+",")!=-1){m=true;break}}}}return m}function in_assign_role(l,k){var m=false;if(l!=""){var n=l.split(",");for(var g=0,h=n.length;g<h;g++){if(n[g]!=""&&k.indexOf(","+n[g]+",")!=-1){m=true;break}}}return m}function is_ref_cell(b){if(b!=""&&b.charAt(0)=="{"){return true}else{return false}}function is_date_month_str(f,g){var h=["January","February","March","April","May","June","July","August","September","October","November","December"];var e=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return g?e[f-1]:h[f-1]}function is_color_position(d){var c=["#000000","#FFFFFF","#FF0000","#00FF00","#0000FF","#FFFF00","#00FFFF","#FF00FF","#008000","#800000","#000080","#808000","#008080","#800080","#C0C0C0","#808080","#9999FF","#339966","#FFFFCC","#FFCCFF","#006666","#80FF80","#6600CC","#CCCCFF","#000080","#00FFFF","#FFFF00","#FF00FF","#008080","#008000","#800080","#0000FF","#CC00FF","#FFCCFF","#FFCCCC","#FFFF99","#CC99FF","#99FFCC","#99CCFF","#CCFF99","#6633FF","#CC33CC","#CC9900","#CCFF00","#99FF00","#66FF00","#666699","#969696","#330066","#993366","#330000","#333300","#339900","#339966","#333399","#333333"];return d<c.length?c[d]:"#FFFFFF"}function number_format(o,r,m,p){o=(o+"").replace(/[^0-9+\-Ee.]/g,"");var s=!isFinite(+o)?0:+o,t=!isFinite(+r)?0:Math.abs(r),k=(typeof p==="undefined")?",":p,q=(typeof m==="undefined")?".":m,l="",n=function(c,a){var b=Math.pow(10,a);return""+Math.round(c*b)/b};l=(t?n(s,t):""+Math.round(s)).split(".");if(l[0].length>3){l[0]=l[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,k)}if((l[1]||"").length<t){l[1]=l[1]||"";l[1]+=new Array(t-l[1].length+1).join("0")}return l.join(q)}function numToCny(g){var a="";var p=["\u4e07","\u4ebf","\u4e07","\u5143",""];var l={2:["\u89d2","\u5206",""],4:["\u4edf","\u4f70","\u62fe",""]};var c=["\u96f6","\u58f9","\u8d30","\u53c1","\u8086","\u4f0d","\u9646","\u67d2","\u634c","\u7396"];if(((g.toString()).indexOf(".")>16)||(isNaN(g))){return""}g=((Math.round(g*100)).toString()).split(".");g=(g[0]).substring(0,(g[0]).length-2)+"."+(g[0]).substring((g[0]).length-2,(g[0]).length);g=((Math.pow(10,19-g.length)).toString()).substring(1)+g;var f,m,e,a,d,b,h,o,n=[];for(f=0,m="";f<5;f++,e=f*4+Math.floor(f/4)){a=g.substring(e,e+4);for(d=0,b="",h=a.length;((d<h)&&(parseInt(a.substring(d),10)!=0));d++){n[d%2]=c[a.charAt(d)]+((a.charAt(d)==0)?"":l[h][d]);if(!((n[0]==n[1])&&(n[0]==c[0]))){if(!((n[d%2]==c[0])&&(b=="")&&(m==""))){b+=n[d%2]}}}o=b+((b=="")?"":p[f]);if(!((o==c[0])&&(m==""))){m+=o}}m=(m=="")?c[0]+p[3]:m;if(m!=""){if(m.substr(m.length-1)=="\u4e07"||m.substr(m.length-1)=="\u4ebf"){m+="\u5143"}if(m.substr(m.length-1)!="\u5206"){m+="\u6574"}}return m}function getGuidGenerator(){var b=function(){return(((1+Math.random())*65536)|0).toString(16).substring(1)};return"{"+(b()+b()+"-"+b()+"-"+b()+"-"+b()+"-"+b()+b()+b()).toUpperCase()+"}"}function update_ref(t,A,q,r,z,y){var o="";var w=r.split(",");for(var x=0,u=w.length;x<u;x++){var s=rectNameToIndex(w[x]);if(!y){var p="y"}else{var p="x"}if(z=="ins"){if(s[0][p]>=A){s[0][p]+=q;s[1][p]+=q}else{if(s[1][p]>=A){s[1][p]+=q}}if(o!=""){o+=","}o+=rectIndexToName(s)}else{if(z=="app"){if(s[0][p]>A){s[0][p]+=q;s[1][p]+=q}else{if(s[1][p]>=A){s[1][p]+=q}}if(o!=""){o+=","}o+=rectIndexToName(s)}else{if(z=="del"){if(s[1][p]<A){if(o!=""){o+=","}o+=rectIndexToName(s)}else{if(s[0][p]<A&&s[1][p]<=(A+q-1)){s[1][p]=A-1;if(o!=""){o+=","}o+=rectIndexToName(s)}else{if(s[0][p]<A&&s[1][p]>(A+q-1)){var v=s[1][p];s[1][p]=A-1;if(o!=""){o+=","}o+=rectIndexToName(s);s[1][p]=v;s[0][p]=A+q;s[0][p]-=q;s[1][p]-=q;if(o!=""){o+=","}o+=rectIndexToName(s)}else{if(s[0][p]<=A+q-1&&s[1][p]>(A+q-1)){s[0][p]=A+q;s[0][p]-=q;s[1][p]-=q;if(o!=""){o+=","}o+=rectIndexToName(s)}else{if(s[0][p]>A+q-1){s[0][p]-=q;s[1][p]-=q;if(o!=""){o+=","}o+=rectIndexToName(s)}}}}}}}}}return o}function obj_length(c){var d=0;for(s_key in c){if(c[s_key]!=undefined){d++}}return d}function get_delimiter_key(g,h){var e=0,f="";for(s_key in g){if(typeof g[s_key]=="function"){continue}if(e>0){f+=h}f+=s_key;e++}return f}var b_showing=false;function show_hint(b){if(b_showing){return}b_showing=true;if(crsReport.b_mobile){showLoading(b)}else{$("#loading").show()}}function hide_hint(){if(!b_showing){return}b_showing=false;if(crsReport.b_mobile){hideLoading()}else{$("#loading").hide()}}function ajaxFileUpload(f,k,h,e,g){$("#loading").ajaxStart(function(){$(this).show()}).ajaxComplete(function(){$(this).hide()});$.ajaxFileUpload({url:"/general/reportshop/utils/upload.php",secureuri:false,fileElementId:f,dataType:"json",data:{action:"upload",fileid:f,filetype:k,json:1,newid:g},success:function(a,b){if(a.error=="true"||a.error==true){h(a.new_name,e)}else{crsReport.show_hint("\u9644\u4ef6\u4e0a\u4f20\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5\uff01")}},error:function(b,c,a){crsReport.show_hint(a)},async:false});return false}function MapKey(b){return b}function get_color(h){var g=(h&parseInt("0x0000FF")).toString(16);if(g.length<2){g="0"+g}var e=((h&parseInt("0x00FF00"))>>8).toString(16);if(e.length<2){e="0"+e}var f=((h&parseInt("0xFF0000"))>>16).toString(16);if(f.length<2){f="0"+f}return"#"+g+e+f}function crs_decode(b){var c=base64decode(b);var h=zip_inflate(c);var a=unescape(h);return a}function crs_encode(b){var c=escape(b);var h=zip_deflate(c);var a=base64encode(h);return a}function set_statis(c,d){$.ajax({url:"/general/reportshop/utils/set_statis.php",type:"post",data:{cur_rep:crsReport.s_postfix,begin_time:c,end_time:d,repid:crsReport.repId,userid:crsReport.userId,writetime:crsReport.writeTime,openmode:crsReport.openMode,P:crsReport.s_P},success:function(a){if(1){$("#load_time",window.parent.document).html(a)}},async:true})}function getCursorPos(k){k.focus();var g=document.selection.createRange();var f=g.duplicate();k.select();var l=document.selection.createRange();var h=0;while(f.compareEndPoints("StartToStart",l)>0){f.moveStart("character",-1);h++}g.select();return h}function setCursorPos(d,f){var e=d.createTextRange();e.moveStart("character",f);e.collapse(true);e.select()}function my_md5(a){return $.md5(a)}var userAgent=navigator.userAgent.toLowerCase();var is_opera=userAgent.indexOf("opera")!=-1&&opera.version();var is_moz=(navigator.product=="Gecko")&&userAgent.substr(userAgent.indexOf("firefox")+8,3);var ua_match=/(trident)(?:.*rv:([\w.]+))?/.exec(userAgent)||/(msie) ([\w.]+)/.exec(userAgent);var is_ie=ua_match&&(ua_match[1]=="trident"||ua_match[1]=="msie")?true:false;function LoadDialogWindow(b,d,f,e,c,a){if(is_ie){window.showModalDialog(b,d,"edge:raised;scroll:1;status:0;help:0;resizable:1;dialogWidth:"+c+"px;dialogHeight:"+a+"px;dialogTop:"+e+"px;dialogLeft:"+f+"px",true)}else{window.open(b,d,"height="+a+",width="+c+",status=0,toolbar=no,menubar=no,location=no,scrollbars=yes,top="+e+",left="+f+",resizable=yes,modal=yes,dependent=yes,dialog=yes,minimizable=no",true)}}function show_seal(b,c){var a="/module/sel_seal/?ITEM="+b+"&callback="+c;loc_y=loc_x=200;if(is_ie){loc_x=document.body.scrollLeft+event.clientX-100;loc_y=document.body.scrollTop+event.clientY+170}LoadDialogWindow(a,self,loc_x,loc_y,300,350)}function addSeal2(d,c){if(!has_usb_key()){alert("\u7b7e\u7ae0\u524d\uff0c\u8bf7\u60a8\u5728\u5ba2\u6237\u673a\u4e0a\u63d2\u5165\u6709\u6548\u7684USB KEY\u3002");return}try{if(crsReport.DWebSignSeal.FindSeal(d+"_hw",2)!=""){alert("\u60a8\u5df2\u7ecf\u7b7e\u7ae0\uff0c\u8bf7\u5148\u5220\u9664\u5df2\u6709\u7b7e\u7ae0\uff01");return}var k=SetStore(d);crsReport.DWebSignSeal.SetPosition(0,0,"SIGN_POS_"+d);if(typeof c=="undefined"){show_seal(d,"addSeal2")}else{var g=location.href;var h=g.indexOf("/",8);g=g.substring(0,h);var a=g+"/module/sel_seal/get.php?ID="+c;var b=crsReport.DWebSignSeal.AddSeal(a,d+"_hw")}DWebSignSeal.SetSealSignData(d+"_hw",k);DWebSignSeal.SetMenuItem(d+"_hw",261)}catch(f){}}function addSeal(d,e){try{crsReport.DWebSignSeal.SetCurrUser(crsReport.s_writer+"["+crsReport.crsUserCache.get_name_by_id(crsReport.s_writer)+"]")}catch(f){crsReport.show_hint("\u7b7e\u7ae0\u52a0\u8f7d\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5\u63a7\u4ef6\u662f\u5426\u6b63\u786e\u5b89\u88c5\uff01")}try{if(crsReport.DWebSignSeal.FindSeal(d+"_seal",2)!=""){crsReport.show_hint("\u60a8\u5df2\u7ecf\u7b7e\u7ae0\uff0c\u8bf7\u5148\u5220\u9664\u5df2\u6709\u7b7e\u7ae0\uff01");return}SetStore();crsReport.DWebSignSeal.SetPosition(200,200,"SIGN_POS_"+d);crsReport.DWebSignSeal.addSeal("",d+"_seal");crsReport.DWebSignSeal.SetSealSignData(d+"_seal",str);crsReport.DWebSignSeal.SetMenuItem(d+"_seal",261)}catch(f){crsReport.show_hint("\u7b7e\u7ae0\u52a0\u8f7d\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5\u63a7\u4ef6\u662f\u5426\u6b63\u786e\u5b89\u88c5\uff01")}}function handWrite(e,f){if(!has_usb_key()){alert("\u7b7e\u7ae0\u524d\uff0c\u8bf7\u60a8\u5728\u5ba2\u6237\u673a\u4e0a\u63d2\u5165\u6709\u6548\u7684USB KEY\u3002");return}try{if(typeof(f)=="string"){f=Number(f)}if(crsReport.DWebSignSeal.FindSeal(e+"_hw",2)!=""){crsReport.show_hint("\u60a8\u5df2\u7ecf\u7b7e\u7ae0\uff0c\u8bf7\u5148\u5220\u9664\u5df2\u6709\u7b7e\u7ae0\uff01");return}var g=SetStore(e);crsReport.DWebSignSeal.SetPosition(0,0,"SIGN_POS_"+e);crsReport.DWebSignSeal.HandWrite(0,f,e+"_hw");crsReport.DWebSignSeal.SetSealSignData(e+"_hw",g);crsReport.DWebSignSeal.SetMenuItem(e+"_hw",261)}catch(h){crsReport.show_hint("\u7b7e\u7ae0\u52a0\u8f7d\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5\u63a7\u4ef6\u662f\u5426\u6b63\u786e\u5b89\u88c5\uff01")}}function GetDataStr(n){var q="";var m=$("#SIGN_POS_"+n);var r=$(m).attr("sign_check");if(r!=""){var k=r.split(",");for(var p=0,l=k.length;p<l;p++){if(k[p]!=""){var o=crsReport.crsCommon.get_row_seq($(m).parent("td"));q+=crsReport.crsCommon.get_cell_value(k[p],o)+"\u2522"}}}return q}function SetStore(e){try{var f=GetDataStr(e);crsReport.DWebSignSeal.SetSignData("-");crsReport.DWebSignSeal.SetSignData("+DATA:"+f)}catch(d){}return f}function has_usb_key(){var c=true;var a=$("#tdPass");if(a.length>0){c=OpenDevice(a[0]);if(c){var b=READ_KEYUSER(a[0]);if(b!=crsReport.s_writer){c=false}}}return c}function TCRSCommon(b,c){this.b_as_form=b;this.b_mobile=c;this.obj_cur_editor=null;this.arr_action_maps=null;if(this.b_mobile){this.crsForm=new TCRSMobileView()}else{if(this.b_as_form){this.crsForm=new TCRSFormView()}else{this.crsTable=new TCRSTableView()}}this.b_has_excel_func=true;this.b_set_chart_actions=false;this.obj_sign_seals={};this.arr_reportinfo={};this.obj_map=null;this.obj_geoc=null;this.arr_cur_position_cell=null;this.s_cur_id=""}TCRSCommon.prototype={constructor:TCRSCommon,_textarea_auto_height:function(c,d,h){if(!crsReport.b_autoheight||crsReport.b_mobile){return}d=d||0;var a=!!document.getBoxObjectFor||"mozInnerScreenX" in window,b=!!window.opera&&!!window.opera.toString().indexOf("Opera"),e=function(l,m){c.addEventListener?c.addEventListener(l,m,false):c.attachEvent("on"+l,m)},f=c.currentStyle?function(l){var n=c.currentStyle[l];if(l==="height"&&n.search(/px/i)!==1){var m=c.getBoundingClientRect();return m.bottom-m.top-parseFloat(f("paddingTop"))-parseFloat(f("paddingBottom"))+"px"}return n}:function(l){return getComputedStyle(c,null)[l]},k=parseFloat(f("height"));c.style.resize="none";var g=function(){var o,l,n=0,m=c.style;if(c._length===c.value.length){return}c._length=c.value.length;if(!a&&!b){n=parseInt(f("paddingTop"))+parseInt(f("paddingBottom"))}o=document.body.scrollTop||document.documentElement.scrollTop;c.style.height=k+"px";if(c.scrollHeight>k){if(h&&c.scrollHeight>h){l=h-n;m.overflowY="auto"}else{l=c.scrollHeight-n;m.overflowY="hidden"}m.height=l+d+"px";o+=parseInt(m.height)-c.currHeight;document.body.scrollTop=o;document.documentElement.scrollTop=o;c.currHeight=parseInt(m.height)}};e("propertychange",g);e("input",g);e("focus",g);g()},_get_container_height:function(d){var c=crsReport.crsTableIndex.rows[d.row_idx];var b=d.get_cell_rect(1);var a="sheet"+(parseInt(c.sheetindex)-1);var f=0;for(var e=b[0].y;e<=b[1].y;e++){f+=$("#"+a).find("tr:eq("+(e)+")").height()}return 1},refresh:function(){if(crsReport.b_has_inline_calcu&&crsReport.b_calculate_in_time){this.begin_update();this.end_update()}},add_action_maps:function(b){if(this.arr_action_maps==null){this.arr_action_maps=b}else{this.arr_action_maps=this.arr_action_maps.concat(b)}if(crsReport.b_has_inline_calcu&&crsReport.b_calculate_in_time&&b[0]!="app"&&b[0]!="ins"&&b[0]!="del"){this.begin_update();this.end_update()}},draw:function(f){if(crsReport.b_has_sign_seal&&navigator.appName=="Microsoft Internet Explorer"){$('<object classid="CLSID:77709A87-71F9-41AE-904F-886976F99E3E" style="position:absolute;width:0px;height:0px;left:0px;top:0px;display:none;" codebase="/module/websign/WebSign_trial.dll#version=4,5,0,0"></object>').appendTo($("body"));crsReport.DWebSignSeal=$("object[classid='CLSID:77709A87-71F9-41AE-904F-886976F99E3E']")[0];crsReport.DWebSignSeal.SetCurrUser(crsReport.s_writer+"["+crsReport.crsUserCache.get_name_by_id(crsReport.s_writer)+"]")}if(this.b_as_form){this.crsForm.draw_form(f);if(crsReport.arr_schema["#fetch_res"]!=undefined){crsReport.crsFormulasCache.loadData("#tablecrs_formulas");crsReport.crsFormulasCache.init_formulas();if(crsReport.b_crs_gz){crsReport.arr_schema["#fetch_res"]=crs_decode(crsReport.arr_schema["#fetch_res"])}crsReport.fill_values(crsReport.arr_schema["#fetch_res"],crsReport,crsReport.arr_schema["#fetch_idx"])}if(crsReport.b_has_sign_seal&&navigator.appName=="Microsoft Internet Explorer"){for(s_k in this.obj_sign_seals){crsReport.DWebSignSeal.SetStoreData(this.obj_sign_seals[s_k]["v"])}crsReport.DWebSignSeal.ShowWebSeals();var g=crsReport.DWebSignSeal.FindSeal("",0);while(g!=""){var e="";if(g.indexOf("_hw")>0){e=g.substring(0,g.indexOf("_hw"))}else{if(g.indexOf("_seal")>0){e=g.substring(0,g.indexOf("_seal"))}}if(e!=""){var h=GetDataStr(e);crsReport.DWebSignSeal.SetSealSignData(g,h);if($("#SIGN_POS_"+e).find("input[type='button']").length==0){crsReport.DWebSignSeal.SetMenuItem(g,4)}else{crsReport.DWebSignSeal.SetMenuItem(g,261)}}g=crsReport.DWebSignSeal.FindSeal(g,0)}}if(crsReport.b_autoheight){$("textarea").each(function(){crsReport.crsCommon._textarea_auto_height(this)})}}else{this.crsTable.loadData(f);if(crsReport.b_has_sign_seal&&navigator.appName=="Microsoft Internet Explorer"){for(s_k in this.obj_sign_seals){crsReport.DWebSignSeal.SetStoreData(this.obj_sign_seals[s_k]["v"])}crsReport.DWebSignSeal.ShowWebSeals();var g=crsReport.DWebSignSeal.FindSeal("",0);while(g!=""){var e="";if(g.indexOf("_hw")>0){e=g.substring(0,g.indexOf("_hw"))}else{if(g.indexOf("_seal")>0){e=g.substring(0,g.indexOf("_seal"))}}if(e!=""){var h=GetDataStr(e);crsReport.DWebSignSeal.SetSealSignData(g,h);if($("#SIGN_POS_"+e).find("input[type='button']").length==0){crsReport.DWebSignSeal.SetMenuItem(g,4)}else{crsReport.DWebSignSeal.SetMenuItem(g,261)}}g=crsReport.DWebSignSeal.FindSeal(g,0)}}}},get_row_seq:function(f){var h=1;if(this.b_as_form){if(crsReport.b_mobile){h=this.crsForm._get_row_seq($(f).parent("div"))}else{h=this.crsForm._get_row_seq($(f).parent("tr"))}}else{var g=this.crsTable.crsCellControler.get_cell_point(f);var e=crsReport.crsTableIndex.getAColSchema($(f).attr("cid"));h=e.get_display_seq(g.x,g.y)}return h},get_cell_attr:function(l,g,k,h){var f="";if(this.b_as_form){f=this.crsForm.get_cell_attr(l,g,k,h)}else{f=this.crsTable.crsCellControler.get_cell_attr(l,g,k,h)}return f},get_cell_value:function(q,n,r,s){if(s==undefined){s=false}if(r!=undefined){if(this.b_as_form){var o=this.crsForm._get_td_and_schema_by_coord(q,n,r);var l=o.td}else{var l=crsReport.crsCommon.crsTable.crsCellControler.get_cell(q,n,r)}}else{if(n!=undefined){var m=crsReport.crsTableIndex.getAColSchema(q);var k=m.get_cell_point(n);return this.get_cell_value(0,k.x,k.y)}else{var l=q}}if(l!=undefined){if(s){if($(l).children().length<=0){var p=$(l).attr("val");if(p==undefined){p=$(l).attr("val2")}}else{if($(l).children(":eq(0)").attr("type")!="hidden"){var p=$(l).children(":eq(0)").val()}else{var p=$(l).children(":eq(1)").val()}}if(p==""){p=$(l).attr("val");if(p==undefined){p=$(l).attr("val2")}}}else{var p=$(l).attr("val");if(p==undefined){p=$(l).attr("val2")}}}else{if(n!=undefined){var t=o.schema.get_display_seq(n,r);p=crsReport.crsTableIndex.get_hidden_cell_value(o.schema.kid,t)}}return p!=undefined?p:""},set_cell_value:function(G,C,E,F,y){var B={},H=false;var n=false;if(E==undefined){B=G;F=C;if(this.b_as_form){y=crsReport.crsTableIndex.getAColSchema(this.crsForm._get_cid_by_td(G));H=y.col.rows[y.col_idx].has_inline_calcu=="y"}else{if(y==undefined){y=crsReport.crsTableIndex.getAColSchema($(B).attr("cid"))}H=$(B).attr("func")!=undefined}G=parseInt(crsReport.crsTableIndex.rows[y.row_idx].sheetindex)-1;var u=this.get_row_seq(B);var w=y.get_cell_point(u);C=w.x;E=w.y}else{if(this.b_as_form){B=this.crsForm._get_td_and_schema_by_coord(G,C,E);if(B.schema==undefined){return}if(y==undefined){y=B.schema}B=B.td;H=y.col.rows[y.col_idx].has_inline_calcu=="y"}else{B=crsReport.crsCommon.crsTable.crsCellControler.get_cell(G,C,E);if(y==undefined){if($(B).attr("cid")==undefined){$(B).text(F);return}y=crsReport.crsTableIndex.getAColSchema($(B).attr("cid"))}H=$(B).attr("func")!=undefined}}if(y.datatype=="\u65e5\u671f\u578b"&&(F=="0000-00-00"||F=="00:00:00"||F=="0000-00-00 00:00:00")){F=""}else{if(y.datatype=="\u6570\u503c\u578b"&&Math.abs(F)<1e-9){F=0}}if($(B).length>0){if(crsReport.crsTableIndex.rows[y.row_idx].tabletype=="\u660e\u7ec6\u8868"&&crsReport.b_mobile){if($(B).parent().hasClass("hide")){$(B).parent().removeClass("hide")}}var r=false;if(crsReport.b_mobile&&($("#page2").hasClass("in")||($("#select_page").hasClass("in")&&$("#select_page").attr("page")=="page2"))){r=true}var m=F,o=F;if(F!=""&&y.datatype=="\u4ee3\u7801\u578b"){if(y.codeid==-10){if(F!=""&&F.charAt(F.length-1)!=","){m=crsReport.crsDeptCache.get_id_by_name(F)+",";F=m;o+=","}else{o=crsReport.crsDeptCache.get_name_list_by_id(F)}if($(B).children().eq(0).val()!=F){if(y.canread&&y.canwrite){if(crsReport.b_mobile){$(B).children().eq(1).text(o)}else{$(B).children().eq(1).val(o)}}else{}}}else{if(y.codeid==-11){if(F!=""&&F.charAt(F.length-1)!=","){F=crsReport.crsUserCache.get_id_list_by_name(F);m=F;o+=","}else{o=crsReport.crsUserCache.get_name_list_by_id(F)}if($(B).children().eq(0).val()!=F){if(y.canread&&y.canwrite){if(crsReport.b_mobile){$(B).children().eq(1).text(o)}else{$(B).children().eq(1).val(o)}}else{}}}else{o=crsReport.crsCodeIndex.get_display_text_by_value(y.codeid,F);if(!y.canwrite){F=o}}}}else{if(F!=""&&y.datatype=="\u56fe\u7247\u578b"){var l=F.split(" ");var p=parseInt(l[4])-parseInt(l[2]),F=parseInt(l[5])-parseInt(l[3]);if(crsReport.openMode!="read"){p-=20}if(p>400||p<0){p=400}if(F>60||F<0){F=60}$(B).empty();if(this.b_mobile){$(B).append('<img id="'+C+'" class="uploadimg" src="/attachment/reportshop/images/'+l[0]+'" width="50" height="30"><button type="button" action="addimg">\u4e0a\u4f20\u56fe\u7247</button>')}else{$(B).append("<img src='/attachment/reportshop/images/"+l[0]+"' width='"+p+"' height='"+F+"' ondblclick='window.parent.float_image(this)' title='\u53cc\u51fb\u653e\u5927\u9884\u89c8' onmouseover='crsReport.show_delete(this)' />")}F=l[0]}else{if(F!=""&&y.datatype=="\u9644\u4ef6\u578b"){var A=this.get_rid_by_td(B),t=this.get_cid_by_td(B);crsReport.crsDataSet.copy_attach(F,A,t);var k=F.indexOf("_");var v=F.substr(k+1);F="{"+getColPlatKId(A+t)+"}_"+v;if(crsReport.arr_upload_files.indexOf(F)==-1){crsReport.arr_upload_files.push(F)}$(B).empty();if(this.b_mobile){$(B).append("<a id='"+C+"' href='/attachment/reportshop/attachment/"+F+"' target='_blank' title='\u5355\u51fb\u6253\u5f00\u9644\u4ef6'>"+v+'</a><button type="button" action="addfile">\u4e0a\u4f20\u9644\u4ef6</button>')}else{$(B).append("<a href='/attachment/reportshop/attachment/"+F+"' target='_blank' title='\u5355\u51fb\u6253\u5f00\u9644\u4ef6' onmouseover='crsReport.show_delete(this)' >"+v+"</a>")}var q=F;F=v}}}if(y.canread){if($(B).attr("val")!=F){n=true}$(B).attr("val",F)}else{if($(B).attr("val2")!=F){n=true}$(B).attr("val2",F)}if(crsReport.b_mobile&&$(B).find("select").length>0){$(B).find("select").eq(0).val(format_text(y.kid,F))}else{if($(B).children().eq(0).attr("type")=="radio"){if(F=="\u221a"){$(B).children()[0].checked=true}else{$(B).children()[0].checked=false}}else{$(B).children().eq(0).val(format_text(y.kid,F))}}if(y.canread){var D=y.col.rows[y.col_idx].refrepid;if(crsReport.b_mobile&&crsReport.crsTableIndex.rows[y.row_idx].tabletype=="\u660e\u7ec6\u8868"){if(!r){var s=$(B).parent().find("em[cid='"+y.kid+"']");if(F!=""&&D!=""&&D!="0"){if(y.datatype=="\u9644\u4ef6\u578b"){s.html("<a href='/attachment/reportshop/attachment/"+q+"' target='_blank' title='\u5355\u51fb\u6253\u5f00\u9644\u4ef6'>"+v+"</a>")}else{if(y.datatype=="\u56fe\u7247\u578b"){s.html("<img src='/attachment/reportshop/images/"+l[0]+"' width='50' height='30' title='\u53cc\u51fb\u653e\u5927\u9884\u89c8'/>")}else{var z="";if(!y.canwrite){z="return;"}s.html(($(s).parent()[0].tagName.toLowerCase()=="h6"?"":y.col.rows[y.col_idx].columnlabel+"\uff1a")+"<a href='javascript:' target='_blank' onclick='crsReport.on_dblclick(event); return false;' style='text-decoration: underline' onmouseover='"+z+"crsReport.show_edit(this)'>"+format_text(y.kid,o)+"</a>")}}}else{s.text(($(s).parent()[0].tagName.toLowerCase()=="h6"?"":y.col.rows[y.col_idx].columnlabel+"\uff1a")+format_text(y.kid,o))}}}else{if(F!=""&&D!=""&&D!="0"){var z="";if(!y.canwrite){z="return;"}$(B).html("<a href='javascript:' target='_blank' onclick='crsReport.on_dblclick(event); return false;' style='text-decoration: underline' onmouseover='"+z+"crsReport.show_edit(this)'>"+format_text(y.kid,o)+"</a><i style='display:none;'>"+$(B).html()+"</i>")}else{if(!y.canwrite){if(crsReport.b_mobile&&$(B).find("select").length>0){$(B).find("select").eq(0).val(format_text(y.kid,o))}else{$(B).children().eq(0).val(format_text(y.kid,o))}}else{if(y.datatype=="\u4ee3\u7801\u578b"){$(B).children("input").eq(1).val(format_text(y.kid,o))}}}}}else{}if(!H){if(!r){this.add_action_maps(["set",G,C,E,F])}}if(!r){$(B).children().each(function(){if($(this).attr("title")!=undefined){if(y.col.rows[y.col_idx].info==""){$(this).attr("title",y.col.rows[y.col_idx].columnlabel+"\uff1a"+F)}else{$(this).attr("title",y.col.rows[y.col_idx].columnlabel+"\uff1a"+F+"\uff0c"+y.col.rows[y.col_idx].info)}}})}if(r){var I=$("#page2 div[rid='"+$(B).parent().attr("rid")+"'] > div[cid='"+y.kid+"']");$(I).attr("val",m);if($(I).find("select").length>0){$(I).find("select").eq(0).val(m)}else{if($(I).children().length>1){$(I).children().eq(0).val(m);$(I).children().eq(1).val(format_text(y.kid,o))}else{if($(I).children().length==1){$(I).children().eq(0).val(format_text(y.kid,o))}}}$(I).children().each(function(){if($(this).attr("title")!=undefined){if(y.col.rows[y.col_idx].info==""){$(this).attr("title",y.col.rows[y.col_idx].columnlabel+"\uff1a"+F)}else{$(this).attr("title",y.col.rows[y.col_idx].columnlabel+"\uff1a"+F+"\uff0c"+y.col.rows[y.col_idx].info)}}})}if(y.datatype=="\u6587\u672c\u578b"){this._textarea_auto_height($(B).children()[0])}}else{this.add_action_maps(["set",G,C,E,F]);n=this.crsForm.set_hidden_cell_value(G,C,E,F)}if(n&&typeof plugin_cell_value_changed=="function"){var u=y.get_display_seq(C,E);plugin_cell_value_changed(getColPlatKId(y.kid),u,F)}},set_cell_pvalue:function(e,g,f,h){if(this.b_as_form){this.crsForm.set_cell_pvalue(e,g,f,h)}else{this.crsTable.crsCellControler.set_cell_pvalue(e,g,f,h)}},set_hidden_cell_value:function(g,h,f,e){},set_hidden_cell_pvalue:function(g,h,f,e){},set_cell_backgroud_color:function(l,n,g,k,m){if(this.b_as_form){var h=this.crsForm._get_td_by_coord(l,n,g)}else{var h=crsReport.crsCommon.crsTable.crsCellControler.get_cell(l,n,g)}if($(h).length>0){if($(h).hasClass("hide")){$(h).parent().find("em[cid='"+$(h).attr("cid")+"']").css("background-color",k!=undefined?k:"")}else{if(k!=undefined){$(h).children().css("background-color",k)}else{$(h).children().css("background-color","")}}}},set_cell_cursor:function(d,c,e){if(this.b_as_form){var b=this.crsForm._get_td_by_coord(d,c,e)}else{var b=crsReport.crsCommon.crsTable.crsCellControler.get_cell(d,c,e)}if($(b).length>0){if($(b).hasClass("hide")){$(b).parent().find("em[cid='"+$(b).attr("cid")+"']")[0].focus()}else{$(b).children()[0].focus()}}},set_cell_disable:function(e,c,b){var g=crsReport.crsTableIndex.getAColSchema(e);var d=g.get_cell_point(c);if(this.b_as_form){var a=this.crsForm._get_td_by_coord(parseInt(crsReport.crsTableIndex.rows[g.row_idx].sheetindex)-1,d.x,d.y)}else{var a=crsReport.crsCommon.crsTable.crsCellControler.get_cell(parseInt(crsReport.crsTableIndex.rows[g.row_idx].sheetindex)-1,d.x,d.y)}if($(a).length>0){if(g.datatype=="\u4ee3\u7801\u578b"){var f=$(a).children("select");if($(f).length==0){f=$(a).children(":eq(0)").children("select")}if($(f).length==0){f=$(a).children("button")}if($(f).length>0){if(b){$(f).attr("disabled",b)}else{$(f).removeAttr("disabled")}}else{f=$(a).children("input[type='text']");if(b){$(f).removeClass("edited").attr("disabled",b)}else{$(f).addClass("edited").removeAttr("disabled")}}}else{if(g.datatype=="\u9644\u4ef6\u578b"||g.datatype=="\u56fe\u7247\u578b"){var f=$(a).children("button");if($(f).length>0){if(b){$(f).attr("disabled",b)}else{$(f).removeAttr("disabled")}}else{f=$(a).children("a[href],img");if($(f).length>0){if(b){$(f).removeAttr("onmouseover")}else{$(f).attr("onmouseover","crsReport.show_delete(this)")}}else{f=$(a).children.children("input");if(b){$(f).attr("disabled",b)}else{$(f).removeAttr("disabled")}}}}else{f=$(a).children("a");if($(f).length>0){if(b){$(f).attr("onclick","return false;");$(f).removeAttr("onmouseover")}else{$(f).attr("onclick","crsReport.on_dblclick(event);return false;");$(f).attr("onmouseover","crsReport.show_edit(this)")}}else{var f=$(a).children("input,text");if(b){$(f).removeClass("edited").attr("disabled",b)}else{$(f).addClass("edited").removeAttr("disabled")}}}}}},clear_cell:function(f,d,e){if(this.b_as_form){this.crsForm.clear_cell(f,d,e)}else{this.crsTable.crsCellControler.clear_cell(f,d,e)}},add_option:function(c,d){this._add_option(c,d)},blur_handler:function(b){$(document).triggerHandler("click")},calculate:function(d,c){if(d==undefined){d=false}if(c==undefined){c=false}if(!c&&!crsReport.b_has_inline_calcu){return}if(this.arr_action_maps==null){return}crsReport.crsDataSet.calculate(this.arr_action_maps,crsReport.crsTableIndex.get_incalcu_cell(),this.fill_calculate_val,this,!d,c);this.arr_action_maps=null},fill_calculate_val:function(d,f,e){f.arr_action_maps=null;if(e!=undefined&&e){crsReport.crsDataSet.save_as_excel(crsReport.s_repname)}$.each(d,function(b,a){if(a!=undefined){f.set_cell_value(a.pg,a.x,a.y,a.val)}})},save_as_excel:function(){if(!this.b_set_chart_actions){this.b_set_chart_actions=true;if(crsReport.has_chart()){}}if(this.arr_action_maps==null){crsReport.crsDataSet.save_as_excel(crsReport.s_repname)}else{this.calculate(false,true)}},begin_update:function(){},end_update:function(){this.calculate();crsReport.crsChartCache.refresh();if(typeof plugin_end_update=="function"){plugin_end_update()}this._get_current_position(true)},resize:function(){if(this.b_as_form){this.crsForm.resize()}},get_cid_by_td:function(c){var d="";if(this.b_as_form){d=this.crsForm._get_cid_by_td(c)}else{d=$(c).attr("cid")}return d},get_rid_by_td:function(c){var d="";if(this.b_as_form){d=this.crsForm._get_rid_by_td(c)}else{d=$(c).attr("rid");if(d==undefined){d=$(c).parent("tr").attr("rid")}}return d},get_rid_and_cid:function(f){var e="";if(this.b_as_form){e=this.crsForm._get_rid_by_td(f)+this.crsForm._get_cid_by_td(f)}else{var d=$(f).attr("rid");if(d==undefined){d=$(f).parent("tr").attr("rid")}e=d+$(f).attr("cid")}return getColPlatKId(e)},_id:function(n){if($(n).attr("id")==undefined){return}var h="td";if(crsReport.b_mobile){h="div"}var o=$(n).parent(h);if(o.length<1){o=$(n).parent().parent(h)}var g=getColPlatKId(this.get_rid_by_td(o));var f=this.get_rid_and_cid(o);var k=getColPlatKId(f);var p=my_md5(f);var m=$(n).attr("id");var l=m.indexOf("_t");if(l!=-1){m=m.substr(0,l)}else{l=m.indexOf("S_");if(l!=-1){m=m.substr(l+2)}}if(m!=p){$(o).children().each(function(){if($(this).attr("id")!=undefined){$(this).attr("id",$(this).attr("id").replaceAll(m,p))}if($(this).attr("name")!=undefined){$(this).attr("name",$(this).attr("name").replaceAll(m,p))}if($(this).attr("onclick")!=undefined){$(this).attr("onclick",$(this).attr("onclick").replaceAll(m,p))}if($(this).attr("href")!=undefined){$(this).attr("href",$(this).attr("href").replaceAll(m,p))}if($(this).attr("src")!=undefined){$(this).attr("src",$(this).attr("src").replaceAll(m,p))}if($(this).attr("onchange")!=undefined){$(this).attr("onchange",$(this).attr("onchange").replaceAll(m,p));$(this).attr("onchange",$(this).attr("onchange").replaceAll("undefined",g));$(this).attr("onchange",$(this).attr("onchange").replace(/\w{64}/,k))}$(this).children().each(function(){if($(this).attr("id")!=undefined){$(this).attr("id",$(this).attr("id").replaceAll(m,p))}if($(this).attr("name")!=undefined){$(this).attr("name",$(this).attr("name").replaceAll(m,p))}if($(this).attr("onclick")!=undefined){$(this).attr("onclick",$(this).attr("onclick").replaceAll(m,p))}if($(this).attr("href")!=undefined){$(this).attr("href",$(this).attr("href").replaceAll(m,p))}if($(this).attr("src")!=undefined){$(this).attr("src",$(this).attr("src").replaceAll(m,p))}if($(this).attr("onchange")!=undefined){$(this).attr("onchange",$(this).attr("onchange").replaceAll(m,p));$(this).attr("onchange",$(this).attr("onchange").replaceAll("undefined",g));$(this).attr("onchange",$(this).attr("onchange").replace(/\w{64}/,k))}})})}},_change_children:function(c,f,b){var e=this;$(c).children().each(function(){if($(this).attr("id")!=undefined){$(this).attr("id",$(this).attr("id").replaceAll(f,b))}if($(this).attr("name")!=undefined){$(this).attr("name",$(this).attr("name").replaceAll(f,b))}if($(this).attr("onclick")!=undefined){$(this).attr("onclick",$(this).attr("onclick").replaceAll(f,b))}if($(this).attr("href")!=undefined){$(this).attr("href",$(this).attr("href").replaceAll(f,b))}if($(this).attr("src")!=undefined){$(this).attr("src",$(this).attr("src").replaceAll(f,b))}if($(this).attr("onchange")!=undefined){$(this).attr("onchange",$(this).attr("onchange").replaceAll(f,b))}e._change_children(this,f,b)})},_get_editor:function(W,D,J,F,ab){if(J==undefined){J={val:""}}if(crsReport.openMode=="copynew"&&D.datatype=="\u81ea\u52a8\u7f16\u53f7"){J.val=""}var R=D.col.rows[D.col_idx];if(!D.canwrite&&!D.canread){if(R.datatype=="\u81ea\u52a8\u7f16\u53f7"){if(J!=undefined&&J.val==""){J.val=crsReport.crsAutoCode.get_next_autocode(R.codeid,true)}}if(R.codeid=="-10"){if(J.val!=""){if(J.val.charAt(J.val.length-1)==","){}else{J.val+=",";J.val=crsReport.crsDeptCache.get_id_list_by_name(J.val)}}}else{if(R.codeid=="-11"){if(J.val!=""){if(J.val.charAt(J.val.length-1)==","){}else{J.val+=",";J.val=crsReport.crsUserCache.get_id_list_by_name(J.val)}}}}return""}var C="";if(D.canread&&J!=undefined){C=J.val;if(C!=""){C=format_text(R.kid,C)}}C=this._hande_val(R.kid,C,"read");if(R.info!=""){var N=R.info}else{var N=(C==""?R.columnlabel:R.columnlabel+"\uff1a"+C)}var Z="";var X=my_md5(getColPlatKId(W+R.kid));var ae=R.datatype.charAt(0).toLowerCase();if(C==""&&ae>="a"&&ae<="z"){if(R.refrepid==""){R.refrepid=R.datatype}C=this._get_repname_by_no(R.datatype)}if(D.canwrite){var B=crsReport.crsFormulasCache.is_readonly(R.id);var Q=false;if(!Q&&typeof plugin_is_disable=="function"){Q=plugin_is_disable(getColPlatKId(R.kid),F,ab);if(Q==undefined){Q=false}}if(R.datatype=="\u65e5\u671f\u578b"){var P="yyyy-MM-dd";if(R.displaystyle=="yyyy\u5e74mm\u6708dd\u65e5"||R.displaystyle=="yyyy-mm-dd"||R.displaystyle=="yyyy.mm.dd"){}else{if(R.displaystyle=="yyyy\u5e74mm\u6708"||R.displaystyle=="yyyy-mm"||R.displaystyle=="yyyy.mm"){P="yyyy-MM"}else{if(R.displaystyle=="yyyy\u5e74"){P="yyyy"}else{if(R.displaystyle=="h:mm:ss"){P="HH:mm:ss"}else{if(R.displaystyle=="mm"){P="MM"}else{if(R.displaystyle=="dd"){P="dd"}else{P="yyyy-MM-dd HH:mm:ss"}}}}}}var U="";if(this.b_mobile){U="readonly"}Z+='<input title="'+N+'" class="InputField Width90 dateField '+(!Q?"edited":"")+'" onclick="if(crsReport.crsCommon._do_editor_active2(this)){WdatePicker({dateFmt:\''+P+"'});WdatePicker({dateFmt:'"+P+'\'});}" onfocus="$(this).addClass(\'InputFocus\');" onblur="$(this).removeClass(\'InputFocus\');" type="text" value="'+C+'" '+(D.ismust?'placeholder="\u5fc5\u586b"':"")+(Q?" disabled ":" ")+U+">"}else{if(R.datatype=="\u4ee3\u7801\u578b"){if(R.codeid=="-10"){if(C!=""){if(C.charAt(C.length-1)==","){C=crsReport.crsDeptCache.get_name_list_by_id(C)}else{C+=",";J.val=crsReport.crsDeptCache.get_id_list_by_name(C)}}if(this.b_mobile){Z+='<input value="'+J.val+'" name="'+X+'" type="hidden" id="'+X+'" onchange="crsReport.crsCommon._do_editor_deactive(this);"/><textarea id="'+X+'_text" rows="2" readonly>'+C+'</textarea><span></span><button type="button" action="selectdept" '+(Q?" disabled":"")+">\u9009\u62e9</button>"}else{Z+='<input type="hidden" name="'+X+'" id="'+X+'" value="'+J.val+'" onchange="crsReport.crsCommon._do_editor_deactive(this);"/><input type="text" name="'+X+'_text" id="'+X+'_text" value="'+C+'" class="InputField Width90 userField '+(!Q?"edited":"")+"\" onmouseenter=\"crsReport.crsCommon._id(this);\"onfocus=\"$(this).addClass('InputFocus');\" onblur=\"$(this).removeClass('InputFocus');$(this).parent('td').children().eq(0).change();\"onclick=\"SelectDept('', '"+X+"', '"+X+"_text', '', this.form.name);\" title=\""+N+'" readonly '+(D.ismust?'placeholder="\u5fc5\u586b"':"")+(Q?" disabled":"")+'><a href="javascript:" onclick="document.getElementById(\''+X+"').value = '';document.getElementById('"+X+"_text').value='';$(this).parent('td').children().eq(0).change();return false;\" class=\"ref-delete-handle inline-block\"></a>"}}else{if(R.codeid=="-11"){if(C!=""){if(C.charAt(C.length-1)==","){C=crsReport.crsUserCache.get_name_list_by_id(C)}else{C+=",";J.val=crsReport.crsUserCache.get_id_list_by_name(C)}}if(this.b_mobile){Z+='<input value="'+J.val+'" name="'+X+'" type="hidden" id="'+X+'" onchange="crsReport.crsCommon._do_editor_deactive(this);"/><textarea id="'+X+'_text" rows="2" readonly>'+C+'</textarea><span></span><button type="button" action="selectuser" '+(Q?" disabled":"")+">\u9009\u62e9</button>"}else{Z+='<input type="hidden" name="'+X+'" id="'+X+'" value="'+J.val+'" onchange="crsReport.crsCommon._do_editor_deactive(this);"/><input type="text" name="'+X+'_text" id="'+X+'_text" value="'+C+'" class="InputField Width90 userField '+(!Q?"edited":"")+"\" onmouseenter=\"crsReport.crsCommon._id(this);\"onfocus=\"$(this).addClass('InputFocus');\" onblur=\"$(this).removeClass('InputFocus');$(this).parent('td').children().eq(0).change();\"onclick=\"SelectUser('', '', '"+X+"', '"+X+"_text', '', this.form.name);\" title=\""+N+'" readonly '+(D.ismust?'placeholder="\u5fc5\u586b"':"")+(Q?" disabled":"")+'><a href="javascript:" onclick="document.getElementById(\''+X+"').value = '';document.getElementById('"+X+"_text').value='';$(this).parent('td').children().eq(0).change();return false;\" class=\"ref-delete-handle inline-block\" ></a>"}}else{if(parseInt(R.codeid)>0&&R.codeid.indexOf("|")==-1){var I=crsReport.crsCodeIndex.get_select(R.codeid,C);if(I==""){var S="";if(crsReport.crsCodeIndex.is_readonly(R.codeid)){S="readOnly"}var O=crsReport.crsCodeIndex.get_display_text_by_value(R.codeid,C);Z+='<input type="hidden" name="'+X+'" id="'+X+'" value="'+C+'" onchange="crsReport.crsCommon._do_editor_deactive(this);"/><input type="text" class="InputField Width90 userField '+(!Q?"edited":"")+'" onmouseenter="crsReport.crsCommon._id(this);" onfocus="$(this).addClass(\'InputFocus\');" onblur="$(this).removeClass(\'InputFocus\');"'+S+' id="'+X+'_text" name="" size="20" class="BigInput" value="'+O+'" onclick="crsReport.crsCodeIndex.get_tree('+R.codeid+", '', 0, 1, 0, '', '"+X+"', this);\" onchange=\"$(this).parent('td').children().eq(0).val($(this).val());$(this).parent('td').children().eq(0).change();\" "+(D.ismust?'placeholder="\u5fc5\u586b"':"")+(Q?" disabled":"")+'><a href="javascript:" onclick="$(\'#'+X+"').val('');$('#"+X+"_text').val('');$(this).parent('td').children().eq(0).change();\" class=\"ref-delete-handle inline-block\" ></a>"}else{if(this.b_mobile){Z+='<div class="select_arrow"><select onchange="crsReport.crsCommon._do_editor_deactive(this);" '+(Q?" disabled":"")+">"+I+'</select><span class="caret"></span></div>'}else{Z+='<select onchange="crsReport.crsCommon._do_editor_deactive(this);" '+(Q?" disabled":"")+">"+I+"</select>"}}}else{if(R.codeid!=""){var ac=HandleMemoStr(R.codeid,false).split("|");var V="";var H=false;for(var T=0,K=ac.length;T<K;T++){if(T==0&&ac[0]!=""){V+="<option value=''></option><option value='<\u8f93\u5165...>'><\u8f93\u5165...></option>"}var S=HandleMemoStr(ac[T],false);if(S==C){if(!H){H=true}V+="<option value='"+S+"' selected>"+S+"</option>"}else{V+="<option value='"+S+"'>"+S+"</option>"}}if(!H&&C!=""){V+="<option value='"+C+"' selected>"+C+"</option>"}if(this.b_mobile){Z+='<div class="select_arrow"><select onchange="crsReport.crsCommon._do_editor_deactive(this);" '+(Q?" disabled":"")+">"+V+'</select><span class="caret"></span></div>'}else{Z+='<select onchange="crsReport.crsCommon._do_editor_deactive(this);" '+(Q?" disabled":"")+">"+V+"</select>"}}else{Z+='<select onchange="crsReport.crsCommon._do_editor_deactive(this);" '+(Q?" disabled":"")+"></select>"}}}}}else{if(R.datatype=="\u903b\u8f91\u578b"){var Y="";if(D.col.arr_radio_group!=undefined){for(var M=0,K=D.col.arr_radio_group.length;M<K;M++){if(D.col.arr_radio_group[M].indexOf(R.kid)!=-1){Y=D.col.arr_radio_group[M];break}}}if(Y!=""){Z+='<input type="radio" name="'+W+Y+'" title="'+R.columnlabel+'" id="'+X+'" '+((C=="\u221a")?"checked":"")+' onchange="crsReport.crsCommon._do_editor_deactive(this)" '+(Q?" disabled":"")+"></input>"}else{Z+='<input type="checkbox" title="'+R.columnlabel+'" id="'+X+'" '+((C=="\u221a")?"checked":"")+' onchange="crsReport.crsCommon._do_editor_deactive(this)" '+(Q?" disabled":"")+"></input>"}}else{if(R.datatype=="\u81ea\u52a8\u7f16\u53f7"){if(J.val==""){J.val=crsReport.crsAutoCode.get_next_autocode(R.codeid,true);if(D.canread){C=J.val}}Z+='<input title="'+N+'" class="InputField Width90 '+(!Q?"edited":"")+'" onfocus="$(this).addClass(\'InputFocus\')" type="text" maxlength="100" onblur="$(this).removeClass(\'InputFocus\');" readonly value=\''+C+"'>"}else{if(R.datatype=="\u9644\u4ef6\u578b"){if(C!=""){var s=C.indexOf("_");var L=C.substr(s+1);J.val=L;if(this.b_mobile){var A=L;if(A.length>20){A=A.substr(0,20)+"..."}if(1&&crsReport.b_mobile&&crsReport.mobilestyle==2){Z+="<a id='"+X+"' href='javascript:' target='_blank' title='\u5355\u51fb\u6253\u5f00\u9644\u4ef6' onclick='view_attachment(\"/attachment/reportshop/attachment/"+C+"\")'>"+L+'</a><button type="button" action="addfile">\u4e0a\u4f20\u9644\u4ef6</button>'}else{Z+='<a id="'+X+'" href="/attachment/reportshop/attachment/'+C+'" target="_blank" title="\u5355\u51fb\u6253\u5f00\u9644\u4ef6">'+A+'</a><button type="button" action="addfile" '+(Q?" disabled":"")+">\u4e0a\u4f20\u9644\u4ef6</button>"}}else{Z+='<a href="/attachment/reportshop/attachment/'+C+'" target="_blank" title="\u5355\u51fb\u6253\u5f00\u9644\u4ef6" onmouseover="'+(Q?"return false;":"")+'crsReport.show_delete(this)">'+L+"</a>"}}else{if(this.b_mobile){Z+='<a id="'+X+'" href="javascript:" target="_blank"></a><button type="button" action="addfile" '+(Q?"disabled":"")+">\u4e0a\u4f20\u9644\u4ef6</button>"}else{Z+='<a class="addfile" href="javascript:;">\u9009\u62e9\u9644\u4ef6<input title="\u6ce8\u610f\uff1a\u4e0a\u4f20\u7684\u9644\u4ef6\u8bf7\u4e0d\u8981\u8bbe\u7f6e\u4e3a\u53ea\u8bfb\uff01" class="addfile" hidefocus="true" type="file" size="1" id="'+X+'" name="'+X+'" onchange="crsReport.crsCommon._id(this);crsReport.submit_attach(\''+X+"', $(this).parent().parent(), '"+getColPlatKId(W+R.kid)+'\');" onclick="crsReport.crsCommon._id(this);" '+(Q?"disabled":"")+"></a>"}}}else{if(R.datatype=="\u56fe\u7247\u578b"){if(C!=""){var ad=C.split(" ");var E=parseInt(ad[4])-parseInt(ad[2]),aa=parseInt(ad[5])-parseInt(ad[3]);if(crsReport.openMode!="read"){E-=20}if(E>400||E<0){E=400}if(aa>60||aa<0){aa=60}if(this.b_mobile){Z+='<img id="'+X+'" class="uploadimg" src="/attachment/reportshop/images/'+ad[0]+'" width="50" height="30"><button type="button" action="addimg" '+(Q?"disabled":"")+">\u4e0a\u4f20\u56fe\u7247</button>"}else{Z+='<img src="/attachment/reportshop/images/'+ad[0]+'" width="'+E+'" height="'+aa+'" ondblclick="window.parent.float_image(this)" title="\u53cc\u51fb\u653e\u5927\u9884\u89c8" onmouseover="'+(Q?"return false;":"")+'crsReport.show_delete(this)"/>'}J.val=ad[0]}else{if(this.b_mobile){Z+='<img id="'+X+'" class="uploadimg"><button type="button" action="addimg" '+(Q?"disabled":"")+">\u4e0a\u4f20\u56fe\u7247</button>"}else{Z+='<a class="addfile" href="javascript:;">\u9009\u62e9\u56fe\u7247<input class="addfile" hidefocus="true" type="file" size="1" id="'+X+'" name="'+X+'" accept="image/*" onchange="crsReport.crsCommon._id(this);crsReport.submit_picture(\''+X+'\', $(this).parent().parent());" onclick="crsReport.crsCommon._id(this);" '+(Q?"disabled":"")+"></a>"}}}else{if(R.datatype=="\u624b\u5199\u7b7e\u7ae0"){Z+=this._get_sign_seal(X,HandleMemoStr(R.radiogroup,false),D.canwrite);if(C!=""){this.obj_sign_seals[X]={v:C,k:getColPlatKId(W+R.kid)}}}else{if(R.datatype=="\u5730\u7406\u4f4d\u7f6e"){Z+='<input type="text" name="'+X+'" id="'+X+'" value="'+C+'" class="InputField Width90 userField '+(!Q?"edited":"")+'" onmouseenter="crsReport.crsCommon._id(this);"onfocus="$(this).addClass(\'InputFocus\');" onblur="$(this).removeClass(\'InputFocus\');crsReport.crsCommon._do_editor_deactive(this);"onclick="crsReport.crsCommon._get_map_address(event, \''+X+'\', this.form.name, 1);" title="'+N+'" readonly '+(D.ismust?'placeholder="\u5fc5\u586b"':"")+(Q?" disabled":"")+'><a href="javascript:" onclick="document.getElementById(\''+X+"').value = '';$(this).parent('td').children().eq(0).change();return false;\" class=\"ref-delete-handle inline-block\"></a>"}else{var G=R.refrepid;if(C!=""&&G!=""&&G!="0"){Z+='<a href="javascript:" target="_blank" onclick="'+(Q?"return false;":"")+'crsReport.on_dblclick(event); return false;" style="text-decoration: underline" onmouseover="'+(Q?"return false;":"")+'crsReport.show_edit(this)">'+C+"</a>"}else{if(R.datatype=="\u6587\u672c\u578b"||crsReport.arr_colwrite_cols.indexOf(R.kid)!=-1){var t=this._get_container_height(D);t=Math.floor(t/15);if(t<2){t=2}Z+='<textarea title="'+N+'" class="InputField Width90 '+(!Q?"edited":"")+'" onfocus="$(this).addClass(\'InputFocus\');crsReport.crsCommon._do_editor_active(this);"onblur="$(this).removeClass(\'InputFocus\');crsReport.crsCommon._do_editor_deactive(this);" rows='+t+" "+(Q?"disabled":"")+">"+C+"</textarea>"}else{Z+='<input title="'+N+'" class="InputField Width90 '+(!Q&&!B?"edited":"")+'" onfocus="$(this).addClass(\'InputFocus\');crsReport.crsCommon._do_editor_active(this);" type="text" maxlength="100" value="'+C+'" onblur="$(this).removeClass(\'InputFocus\');crsReport.crsCommon._do_editor_deactive(this);" '+(D.ismust?'placeholder="\u5fc5\u586b"':"")+(Q?" disabled":"")+(B?" readonly":"")+">"}}}}}}}}}}}else{if(R.datatype=="\u81ea\u52a8\u7f16\u53f7"&&J!=undefined&&J.val==""){J.val=crsReport.crsAutoCode.get_next_autocode(R.codeid,true);if(D.canread){C=J.val}}if(R.datatype=="\u5730\u7406\u4f4d\u7f6e"){Z+='<input type="text" name="'+X+'" id="'+X+'" value="'+C+'" class="InputField Width90 userField "onclick="crsReport.crsCommon._get_map_address(event, \''+X+'\', this.form.name, 0);" title="'+N+'" readonly>'}else{if(R.datatype=="\u903b\u8f91\u578b"){Z+='<input type="checkbox" title="'+R.columnlabel+'" '+(this.b_mobile?'style="border-bottom:0px;padding-top:6px;"':"")+((C=="\u221a")?"checked":"")+" disabled></input>"}else{if(C!=""){if(R.datatype=="\u9644\u4ef6\u578b"){var s=C.indexOf("_");var L=C.substr(s+1);J.val=L;if(1&&crsReport.b_mobile&&crsReport.mobilestyle==2){Z+="<a href='javascript:' target='_blank' title='\u5355\u51fb\u6253\u5f00\u9644\u4ef6' onclick='view_attachment(\"/attachment/reportshop/attachment/"+C+"\")'>"+L+"</a>"}else{var A=L;if(crsReport.b_mobile&&A.length>20){A=A.substr(0,20)+"..."}Z+="<a href='/attachment/reportshop/attachment/"+C+"' target='_blank' title='\u5355\u51fb\u6253\u5f00\u9644\u4ef6'>"+A+"</a>"}}else{if(R.datatype=="\u56fe\u7247\u578b"){var ad=C.split(" ");var E=parseInt(ad[4])-parseInt(ad[2]),aa=parseInt(ad[5])-parseInt(ad[3]);J.val=ad[0];if(E>400||E<0){E=400}if(aa>60||aa<0){aa=60}if(this.b_mobile){Z+="<img src='/attachment/reportshop/images/"+ad[0]+"' width='50' height='30'/>"}else{Z+="<img src='/attachment/reportshop/images/"+ad[0]+"' width='"+E+"' height='"+aa+"' ondblclick='window.parent.float_image(this)' title='\u53cc\u51fb\u653e\u5927\u9884\u89c8'/>"}}else{if(R.datatype=="\u624b\u5199\u7b7e\u7ae0"){Z+=this._get_sign_seal(X,HandleMemoStr(R.radiogroup,false),D.canwrite);this.obj_sign_seals[X]={v:C,k:getColPlatKId(W+R.kid)}}else{if(R.datatype=="\u4ee3\u7801\u578b"){if(R.codeid=="-10"){if(C!=""){if(C.charAt(C.length-1)==","){C=crsReport.crsDeptCache.get_name_list_by_id(C)}else{C+=",";J.val=crsReport.crsDeptCache.get_id_list_by_name(C)}}}else{if(R.codeid=="-11"){if(C.charAt(C.length-1)==","){C=crsReport.crsUserCache.get_name_list_by_id(C)}else{C+=",";J.val=crsReport.crsUserCache.get_id_list_by_name(C)}}else{if(parseInt(R.codeid)>0){C=crsReport.crsCodeIndex.get_display_text_by_value(R.codeid,C)}}}Z+='<input title="'+N+'" class="InputField Width90 " type="text" maxlength="100" value="'+C+'"  readOnly '+(this.b_mobile?'style="border-bottom:0px;padding-top:6px;"':"")+">"}else{var G=R.refrepid;if(C!=""&&G!=""&&G!="0"){if(typeof plugin_is_disable=="function"){Q=plugin_is_disable(getColPlatKId(R.kid),F,ab)}Z+='<a href="javascript:" target="_blank" onclick="'+(Q?"return false;":"")+'crsReport.on_dblclick(event); return false;" style="text-decoration: underline">'+C+"</a>"}else{if(R.datatype=="\u6587\u672c\u578b"||crsReport.arr_colwrite_cols.indexOf(R.kid)!=-1){var t=this._get_container_height(D);t=Math.floor(t/15);if(t<2){t=2}Z+='<textarea title="'+N+'" class="InputField Width90" rows='+t+" readonly>"+C+"</textarea>"}else{Z+='<input title="'+N+'" class="InputField Width90" type="text" maxlength="100" value="'+C+'"  readOnly '+(this.b_mobile?'style="border-bottom:0px;padding-top:6px;"':"")+">"}}}}}}}else{if(R.datatype=="\u6587\u672c\u578b"){var t=this._get_container_height(D);t=Math.floor(t/15);if(t<2){t=2}Z+='<textarea title="'+N+'" class="InputField Width90" rows='+t+" readonly>"+C+"</textarea>"}else{Z+='<input title="'+N+'" class="InputField Width90 " type="text" maxlength="100" readOnly '+(this.b_mobile?'style="border-bottom:0px;padding-top:6px;"':"")+">"}}}}}return Z},_add_option:function(l,h,m){if(m==undefined){m=false}var k=false;var g=0;$(l).children().each(function(){if($(this).text()==h){k=true;return false}g++});if(!k){var n="<option value='"+h+"'>"+h+"</option>";$(l).append(n);if(m){$(l)[0].selectedIndex=$(l).children().length-1}}},_do_editor_active2:function(b){if(b.tagName!=undefined&&b.tagName.toLowerCase()=="input"){this._do_editor_active(b);this.obj_cur_editor=b;$(document).one("click",function(a){crsReport.crsCommon._do_editor_deactive(crsReport.crsCommon.obj_cur_editor);crsReport.crsCommon.obj_cur_editor=null});window.event.cancelBubble=true;return true}},_do_editor_deactive2:function(b){},_do_editor_active:function(f){if(null!=this.obj_cur_editor&&f!=this.obj_cur_editor){$(document).triggerHandler("click")}var a=$(f).parent();var d=this.get_cid_by_td(a);if(crsReport.arr_colwrite_cols.indexOf(d)!=-1){if($(a).attr("pval")!=undefined&&$(a).attr("pval").indexOf(CRSUpRight)!=-1){var e=this._hande_val(d,$(a).attr("pval"),"edit");$(f).val(e).text(e)}return}if($(a).attr("val")!=undefined){if($(a).attr("val")!=$(f).val()){$(f).val($(a).attr("val"))}else{}}},_do_editor_deactive:function(q){if(q==undefined){return}var v="input";if(typeof q=="string"){}else{if(q.tagName!=undefined){v=q.tagName.toLowerCase()}}var A=$(q).parent();if(v=="select"&&crsReport.b_mobile){A=$(A).parent()}var E=this.get_cid_by_td(A);if(crsReport.arr_colwrite_cols.indexOf(E)!=-1){$(A).attr("val",$(q).val());return}var w=$(A).parent();if(v=="input"||v=="select"||v=="textarea"){var y="";if(typeof q=="string"){y=q}else{if($(q).attr("type")=="radio"||$(q).attr("type")=="checkbox"){y=q.checked?"\u221a":""}else{if(v=="textarea"){y=$(q).val()}else{y=$(q).val();if(y==""){y=$(q).attr("val");if(y==undefined){y=""}}}}if(y=="<\u8f93\u5165...>"){$(q).hide();var p='<input class="InputField Width90" onfocus="this.className=\'InputFocus Width90\'" onblur="this.className=\'InputField Width90\';crsReport.crsCommon._do_editor_deactive(this);crsReport.crsCommon._add_option($(this).parent(\'td,div\').children().eq(0), $(this).val(), true);$(this).parent(\'td,div\').children().eq(0).show();$(this).remove();" size="20" class="BigInput" value="'+(($(A).attr("val")==undefined)?"":$(A).attr("val"))+'">';$(A).append(p);return}}var t=$(A).attr("cid");if(t==undefined){t=$(A).attr("aria-describedby");if(t!=undefined){var B=t.indexOf("{");if(B==-1){}t=t.substr(B)}}var r=crsReport.crsTableIndex.getAColSchema(t);var u=r.check_value(y);if(u!=""){crsReport.show_hint(u);return}var z=false;if($(A).attr("val")==undefined||$(A).attr("val")!=y){z=true}var x=crsReport.crsTableIndex.rows[r.row_idx];var s=format_text(t,y);$(q).val(s);if($(q).attr("title")!=undefined){if(r.col.rows[r.col_idx].info==""){$(q).attr("title",r.col.rows[r.col_idx].columnlabel+"\uff1a"+s)}else{$(q).attr("title",r.col.rows[r.col_idx].columnlabel+"\uff1a"+s+"\uff0c"+r.col.rows[r.col_idx].info)}}if(crsReport.b_mobile&&$(q).parents("#page2").length>0){$(A).attr("val",y);w=$("#page1 #"+$(w).parent().attr("id")+" > div[rid='"+$(w).attr("rid")+"']")}if(crsReport.b_as_form){var C=crsReport.crsCommon.crsForm._get_row_seq(w);var D=r.get_cell_point(C)}else{var D=crsReport.crsCommon.crsTable.crsCellControler.get_cell_point(A);var C=r.get_display_seq(D.x,D.y)}this.set_cell_value(parseInt(x.sheetindex)-1,D.x,D.y,y);if($(q).attr("type")=="radio"){$("input[name='"+$(q).attr("name")+"']").each(function(){if($(this).attr("id")!=$(q).attr("id")){var a=$(this).parent();if($(a).attr("val")==undefined||$(a).attr("val")==""){return true}var f=crsReport.crsCommon.get_cid_by_td(a);var e=$(a).parent();var d=crsReport.crsTableIndex.getAColSchema(f);if(crsReport.b_as_form){var c=crsReport.crsCommon.crsForm._get_row_seq(e);var b=d.get_cell_point(c)}else{var b=crsReport.crsCommon.crsTable.crsCellControler.get_cell_point(a)}crsReport.crsCommon.set_cell_value(parseInt(crsReport.crsTableIndex.rows[d.row_idx].sheetindex)-1,b.x,b.y,"")}})}if(z){crsReport.crsFormulasCache.execute_formulas(crsReport.get_valid_cur_task(),CRS_CHANGE_EXEC,0,t,C,"",false,false,false);crsReport.crsFormulasCache.execute_formulas(crsReport.get_valid_cur_task(),CRS_CHANGE_EXEC,0,t,C,"",true,false,false);if(typeof plugin_action=="function"){plugin_action(crsReport.openMode,getColPlatKId(t),C,y)}}}},_get_sign_seal:function(f,d,e){if(e){return'<div class="websign" id="SIGN_POS_'+f+'" sign_check="'+d+'" onmouseenter="crsReport.crsCommon._id(this)"><textarea class="BigStatic Width90" wrap="yes" readonly style="vertical-align:middle;"></textarea>&nbsp;<input class="SmallButtonA" onclick="addSeal2(\''+f+'\');" type="button" value="\u76d6\u7ae0"><input class="SmallButtonA" onclick="handWrite(\''+f+'\',\'0x000000\');" type="button" value="\u624b\u5199"></div>'}else{return'<div class="websign" id="SIGN_POS_'+f+'" sign_check="'+d+'" onmouseenter="crsReport.crsCommon._id(this)"><textarea class="BigStatic Width90" wrap="yes" readonly style="vertical-align:middle;"></textarea></div>'}},_hande_val:function(f,d,k){if(d=="null"){d=""}if(crsReport.arr_colwrite_cols.length<1){return d}if(k==undefined){k=crsReport.openMode}if(d!=""){if(crsReport.arr_colwrite_cols.indexOf(f)!=-1){d=d.replaceAll("|",CRSUpRight1);d=d.replaceAll("\n",CRSNewLine);d=d.replaceAll(CRSUpRight,"|");var h=d.split("|");if(h.length<3){return d}d="";if(k=="read"){for(var b=0,e=h.length/3;b<e;b++){h[b*3+2]=h[b*3+2].replaceAll(CRSUpRight1,"|");h[b*3+2]=h[b*3+2].replaceAll(CRSNewLine,"\n");if(h[b*3+2]!=""){if(b>0){d+="\n"}var c=crsReport.crsUserCache.get_dept_and_priv(h[b*3+1]);c=c.dept;var a=crsReport.crsWorkflow.get_cowrite_time(f,h[b*3+1]);d+=h[b*3+2]+"/"+crsReport.crsUserCache.get_name_by_id(h[b*3+1])+"/"+a}}}else{var g=h.indexOf(crsReport.s_writer);if(g!=-1){h[g+1]=h[g+1].replaceAll(CRSUpRight1,"|");h[g+1]=h[g+1].replaceAll(CRSNewLine,"\n");d=h[g+1].replaceAll(CRSUpRight,"|")}}}}return d},_get_repname_by_no:function(a){if(this.arr_reportinfo[a]==undefined){this.arr_reportinfo[a]=crsReport.crsDataSet.get_repname_by_no(a)}return this.arr_reportinfo[a]},_push_curposition_cell:function(a){if(this.arr_cur_position_cell==null){this.arr_cur_position_cell=[]}this.arr_cur_position_cell.push(a)},_get_map_position:function(){if(this.obj_map==null){this.obj_map=new BMap.Map("_all_map");this.obj_map.centerAndZoom("\u5317\u4eac",12);this.obj_map.addEventListener("click",function(a){return a})}$("#_all_map").show();$("#close_map").show()},_create_map:function(){var a=this;if(this.obj_map==null){this.obj_map=new BMap.Map("_all_map");this.obj_map.centerAndZoom("\u5317\u4eac",12);this.obj_map.enableScrollWheelZoom(true);if(this.obj_geoc==null){this.obj_geoc=new BMap.Geocoder()}this.obj_map.addEventListener("click",function(c){var b=c.point;a.obj_geoc.getLocation(b,function(e){var d=a.s_cur_id;if(d!=""){$("#"+d).val(e.address);crsReport.crsCommon._do_editor_deactive($("#"+d))}$("#_all_map").hide();$("#close_map").hide()})})}},_get_current_position:function(c){if(this.arr_cur_position_cell==null){return}var b=this;this._create_map();if(c==undefined){c=false}var a=new BMap.Geolocation();a.getCurrentPosition(function(e){if(this.getStatus()==BMAP_STATUS_SUCCESS){if(c){b.obj_geoc.getLocation(e.point,function(f){if(b.arr_cur_position_cell!=null){for(i in b.arr_cur_position_cell){if(typeof b.arr_cur_position_cell[i]=="function"){continue}crsReport.crsCommon.set_cell_value(b.arr_cur_position_cell[i][0],b.arr_cur_position_cell[i][1],b.arr_cur_position_cell[i][2],f.address,b.arr_cur_position_cell[i][3])}b.arr_cur_position_cell=null}})}else{var d=new BMap.Marker(e.point);b.obj_map.addOverlay(d);b.obj_map.panTo(e.point)}}else{}},{enableHighAccuracy:true})},_set_position:function(c){var a=this;var b=c.point;a.obj_geoc.getLocation(b,function(d){$("#"+a.s_cur_id).val(d.address);crsReport.crsCommon._do_editor_deactive($("#"+a.s_cur_id));$("#_all_map").hide();$("#close_map").hide()})},_get_map_address:function(d,f,b,a){var c=this;this.s_cur_id="";this._create_map();if(a){this.s_cur_id=f}var e=$("#"+f).val();if(e!=undefined&&e!=""){this.obj_geoc.getPoint(e,function(g){if(g){c.obj_map.centerAndZoom(g,16);c.obj_map.addOverlay(new BMap.Marker(g))}else{}},"")}else{this._get_current_position()}if($("#close_map").length>0){$("#close_map").bind("click",function(g){var g=g||window.event;if(g==undefined){return}var h=(g.srcElement==undefined)?g.target:g.srcElement;if(h!=undefined&&$(h).parents("#_all_map").length==0){$("#_all_map").hide();$("#close_map").hide();$("#select_page").unbind("click")}else{}})}else{$(document).bind("click",function(g){var g=g||window.event;if(g==undefined){return}var h=(g.srcElement==undefined)?g.target:g.srcElement;if(h!=undefined&&$(h).parents("#_all_map").length==0){$("#_all_map").hide();$("#close_map").hide();$(document).unbind("click")}else{}})}var d=d||window.event;if(d!=undefined){d.cancelBubble=true}if($("#_all_map").is(":visible")){$("#_all_map").hide();$("#close_map").hide()}else{$("#_all_map").show();$("#close_map").show()}},};function TCRSMobileView(b){this.obj_detail_dump_row={};this.arr_action_maps=null;this.obj_coord_to_kid_map=null;this.obj_cur_editor=null;this.i_default_height=200;this.obj_next=null;this.arr_div_position=[]}TCRSMobileView.prototype={constructor:TCRSMobileView,set_coord_to_kid_map:function(){this.obj_coord_to_kid_map={};if(!crsReport.crsTableIndex.isEmpty()){var l=crsReport.crsTableIndex.first();while(!crsReport.crsTableIndex.EOF()){if(this.obj_coord_to_kid_map[l.sheetindex-1]==undefined){this.obj_coord_to_kid_map[l.sheetindex-1]={}}var o=crsReport.crsTableIndex.getColumn(l.id);if(l.tabletype=="\u4e3b\u8868"){if(this.obj_coord_to_kid_map[l.sheetindex-1]["m"]==undefined){this.obj_coord_to_kid_map[l.sheetindex-1]["m"]={}}if(!o.isEmpty()){var k=o.first();while(!o.EOF()){var p=crsReport.crsTableIndex.getAColSchema(k.kid);var m=p.display_rect;this.obj_coord_to_kid_map[l.sheetindex-1]["m"][m[0].x+"_"+m[0].y]=p;k=o.next()}}}else{if(l.tabletype=="\u660e\u7ec6\u8868"){if(this.obj_coord_to_kid_map[l.sheetindex-1]["d"]==undefined){this.obj_coord_to_kid_map[l.sheetindex-1]["d"]=[]}if(!o.isEmpty()){var k=o.first();while(!o.EOF()){var p=crsReport.crsTableIndex.getAColSchema(k.kid);var m=p.display_rect;var h={};if(l.expandtype=="\u6309\u884c\u5411\u4e0b"||l.expandtype=="\u4e0d\u6269\u5c55"){var n=m[1].y-m[0].y+1;h={x1:m[0].x,y1:m[0].y,x2:m[1].x,y2:m[1].y+(l.initcz-1)*n,col:p}}this.obj_coord_to_kid_map[l.sheetindex-1]["d"].push(h);k=o.next()}}this.auto_increment(l,o)}}l=crsReport.crsTableIndex.next()}}},_get_td_by_coord:function(s,o,p,v){var n=null,q=null;if(v==undefined){v=false}if(this.obj_coord_to_kid_map!=undefined){if(this.obj_coord_to_kid_map[s]!=undefined){if(this.obj_coord_to_kid_map[s]["m"]!=undefined){q=this.obj_coord_to_kid_map[s]["m"][o+"_"+p];if(q!=undefined){if(v){return q}var r=crsReport.crsTableIndex.rows[q.row_idx];n=$("#main_tab_"+r.id+" div[cid='"+q.kid+"']")}}if(n==null){if(this.obj_coord_to_kid_map[s]["d"]!=undefined){for(var u=0,t=this.obj_coord_to_kid_map[s]["d"].length;u<t;u++){var w=this.obj_coord_to_kid_map[s]["d"][u];if(w.x1<=o&&w.x2>=o&&w.y1<=p&&w.y2>=p){q=w.col;if(v){return q}var y=q.get_display_seq(o,p);var r=crsReport.crsTableIndex.rows[q.row_idx];var x=$("#detail_tab_"+r.id).children("div.tag-RListField").eq(y-1);n=$(x).children("div[cid='"+q.kid+"']");break}}}}}}return n},_get_td_and_schema_by_coord:function(q,m,n){var k={};if(this.obj_coord_to_kid_map!=undefined){if(this.obj_coord_to_kid_map[q]!=undefined){if(this.obj_coord_to_kid_map[q]["m"]!=undefined){k.schema=this.obj_coord_to_kid_map[q]["m"][m+"_"+n];if(k.schema!=undefined){var p=crsReport.crsTableIndex.rows[k.schema.row_idx];k.td=$("#main_tab_"+p.id+" div[cid='"+k.schema.kid+"']")}}if(k.schema==undefined){if(this.obj_coord_to_kid_map[q]["d"]!=undefined){for(var r=0,o=this.obj_coord_to_kid_map[q]["d"].length;r<o;r++){var s=this.obj_coord_to_kid_map[q]["d"][r];if(s.x1<=m&&s.x2>=m&&s.y1<=n&&s.y2>=n){k.schema=s.col;var u=k.schema.get_display_seq(m,n);var p=crsReport.crsTableIndex.rows[k.schema.row_idx];var t=$("#page1 #detail_tab_"+p.id).children("div.tag-RListField").eq(u-1);k.td=$(t).children("div[cid='"+s.col.kid+"']");break}}}}}}if(k.td!=undefined&&k.td.length<1){k.td=undefined}return k},_add_action_maps:function(b){if(!crsReport.b_has_inline_calcu){return}if(this.arr_action_maps==null){this.arr_action_maps=b}else{this.arr_action_maps=this.arr_action_maps.concat(b)}},calculate:function(d,c){if(d==undefined){d=false}if(this.arr_action_maps==null){return}d=!d;crsReport.crsDataSet.calculate(this.arr_action_maps,crsReport.crsTableIndex.get_incalcu_cell(),this._fill_calculate_val,this,d,c);this.arr_action_maps=null},_fill_calculate_val:function(d,f,e){f.arr_action_maps=null;if(e!=undefined&&e){crsReport.crsDataSet.save_as_excel(crsReport.s_repname)}$.each(d,function(b,a){if(a!=undefined){f._set_cell_value(a.pg,a.x,a.y,a.val,true)}})},_set_cell_value:function(q,l,n,o,p){var s=this._get_td_and_schema_by_coord(q,l,n);var k=s.td;if($(k).length>0){if(o!=""&&s.schema.datatype=="\u4ee3\u7801\u578b"){if(s.schema.codeid==-11){var r=crsReport.crsUserCache.get_id_by_name(o);$(k).children().eq(1).val(o);o=r}}var m=s.schema.col.rows[s.schema.col_idx].refrepid;if(o!=""&&m!=""&&m!="0"){$(k).html("<a href='javascript:' target='_blank' onclick='crsReport.on_dblclick(event); return false;' style='text-decoration: underline'>"+format_text(s.schema.kid,o)+"</a>")}else{$(k).children().eq(0).val(format_text(s.schema.kid,o))}this.set_cell_value(q,l,n,o,k,s.schema.kid,p)}},set_cell_pvalue:function(l,h,f,k){var g=this._get_td_by_coord(l,h,f);if($(g).length>0){$(g).attr("pval",k)}},get_cell:function(d,e,f){return this._get_td_by_coord(d,e,f)},get_cell_attr:function(k,l,n,m){var o=this._get_td_and_schema_by_coord(k,l,n);var r=o.td;var q="";if(r!=undefined){q=$(r).attr(m);if(q==undefined&&m=="cid"){q=$(r).attr("aria-describedby");if(q!=undefined){var p=q.indexOf("{");if(p==-1){}q=q.substr(p)}}}else{if(m=="cid"){q=o.schema.kid}}return q!=undefined?q:""},get_cell_value:function(q,n,r){if(r!=undefined){var p=this._get_td_and_schema_by_coord(q,n,r);var l=p.td}else{if(n!=undefined){var m=crsReport.crsTableIndex.getAColSchema(q);var k=m.get_cell_point(n);return this.get_cell_value(0,k.x,k.y)}else{var l=q}}if(l!=undefined){var o=$(l).attr("val");if(o==undefined){o=$(l).attr("val2")}}else{if(n!=undefined){var s=p.schema.get_display_seq(n,r);o=crsReport.crsTableIndex.get_hidden_cell_value(p.schema.kid,s)}}return o!=undefined?o:""},set_cell_value:function(p,m,h,n,o,l,k){if(o==undefined){o=this._get_td_by_coord(p,m,h)}if(k==undefined){k=false}if($(o).attr("val")!=n){$(o).attr("val",n);if(!k){crsReport.crsCommon.add_action_maps(["set",p,m,h,n])}}},set_cell_value2:function(p,m,h,n,o,l,k){if(o==undefined){o=this._get_td_by_coord(p,m,h)}if(k==undefined){k=false}if($(o).attr("val2")!=n){$(o).attr("val2",n);if(!k){crsReport.crsCommon.add_action_maps(["set",p,m,h,n])}}},set_hidden_cell_value:function(g,k,h,l){var m=this._get_td_by_coord(g,k,h,true);var n=m.get_display_seq(k,h);return crsReport.crsTableIndex.set_hidden_cell_value(m.kid,n,l)},set_hidden_cell_pvalue:function(g,k,h,l){var m=this._get_td_by_coord(g,k,h,true);var n=m.get_display_seq(k,h);crsReport.crsTableIndex.set_hidden_cell_value(m.kid,n,l,true)},_get_cid:function(b){return $(b).attr("id")},_get_rid:function(d){var c=$(d).parent().siblings().eq(0);c=$(c).text();return c},_get_cid_by_td:function(e){var f=$(e).attr("cid");if(f==undefined){f=$(e).attr("aria-describedby");var d=f.indexOf("{");if(d==-1){return""}f=f.substr(d)}return f},_get_rid_by_td:function(d){var c=$(d).parent();return c.attr("rid")},_get_row_seq:function(m){var n=$(m).parent().children("div.read_detail");var g=$(m).attr("rid");var l=1;for(var h=n.length;l<=h;l++){var k=$(n[l-1]).attr("rid");if(k==g){break}}return l},_add_row:function(l,g,h,n){if(h==undefined){h=false}if(n==undefined){n=false}var k=this;if(l.data!=undefined){l.stopPropagation();k=l.data.me;l=l.data.tabid}var m=crsReport.crsTableIndex.getColumn(l);var e=crsReport.crsTableIndex.create_row_kid(m.rows[0].kid);var f=crsReport.crsTableIndex.search("id",l);if(crsReport.crsTableIndex.arr_hidden_rows!=null&&crsReport.crsTableIndex.arr_hidden_rows[f.id]!=undefined){if(crsReport.crsTableIndex.arr_hidden_rows[f.id]["dat"][e]==undefined){crsReport.crsTableIndex.arr_hidden_rows[f.id]["dat"][e]=[]}}if(f.canwrite==undefined&&f.canread==undefined){return""}var o='<div class="read_detail clearfix tag-RListField'+(n?" hide":"")+'" rid="'+e+'"';if(crsReport.openMode!="read"&&!crsReport.b_is_query){if(f!=undefined&&f.canwrite!=undefined){o+=' onclick="crsReport.crsCommon.crsForm._draw_detail('+l+', this)"'}}o+=">";if(!h){o+=this.obj_detail_dump_row["tab_"+l][0]}o+="</div>";if($("#page1 #detail_tab_"+l).length<1){return o}if(g!=undefined){$(o).insertBefore($("#page1 #detail_tab_"+l).children("div.read_detail").eq(g-1))}else{$(o).appendTo($("#page1 #detail_tab_"+l))}setTimeout(function(){if(crsReport.openMode!="read"&&!crsReport.b_is_query&&f.canwrite!=undefined){Swiped.init({query:"#content .list-item",list:true,right:120})}},500)},_delete_row:function(c,k){window.event.stopPropagation();var h=crsReport.crsTableIndex.search("id",c);if(h.initcz==1){crsReport.show_hint("\u660e\u7ec6\u8868\u6700\u540e\u4e00\u6761\u8bb0\u5f55\u4e0d\u80fd\u5220\u9664\uff01");return}var e=$(k).parent().parent();var m=this._get_row_seq(e);var l=$(e).children("div.hide:eq(0)").attr("cid");crsReport.crsTableIndex.delete_row_kid($(e).attr("rid"));this._update_cell_refer(l,m,"del");$(e).remove();h.initcz=parseInt(h.initcz)-1;this.set_coord_to_kid_map()},_get_real_row_size:function(a){var b=$("#detail_tab_"+a).children("div.read_detail").length},_insert_row:function(e,l,c){if(c==undefined){c=false}var k=$(l);var n=this._get_row_seq(k);var m=$(k).children("div.hide:eq(0)").attr("cid");var h=crsReport.crsTableIndex.search("id",e);this._update_cell_refer(m,n,"ins");this._add_row(e,n,c);h.initcz=parseInt(h.initcz)+1;this.set_coord_to_kid_map()},_get_position:function(e,f){var h=crsReport.crsTableIndex.getAColSchema(e);var g=h.get_cell_rect(f);return g},_update_cell_refer:function(l,r,k,o){if(o==undefined){o=1}var n=crsReport.crsTableIndex.getAColSchema(l);var q=crsReport.crsTableIndex.rows[n.row_idx];var p=n.col.rows[n.col_idx];var s=n.get_cell_rect(r);var m=s[1].y-s[0].y+1;if(k=="ins"||k=="app"){crsReport.crsCommon.add_action_maps([k,parseInt(q.sheetindex)-1,s[0].y,o*m,m])}else{crsReport.crsCommon.add_action_maps([k,parseInt(q.sheetindex)-1,s[0].y,o*m])}crsReport.crsChartCache.update_ref(parseInt(q.sheetindex),s[0].y,o*m,k,false);crsReport.crsTableIndex.update_cell_refer(parseInt(q.sheetindex),q.expandtype,s,o,k=="ins"||k=="app")},auto_increment:function(l,n){if(l.tabletype=="\u660e\u7ec6\u8868"){var o=parseInt(l.sheetindex)-1;if(!n.isEmpty()){var m=n.first();while(!n.EOF()){if(m.datatype=="\u81ea\u589e\u578b"){var k=rectNameToIndex(m.cellspan);if(l.expandtype=="\u6309\u884c\u5411\u4e0b"||l.expandtype=="\u4e0d\u6269\u5c55"){var p=k[1].y-k[0].y+1;for(var h=0;h<l.initcz;h++){crsReport.crsCommon.set_cell_value(o,k[0].x,k[1].y+h*p,h+1)}}}m=n.next()}}}},append_record:function(m,o,k,h){if(h==undefined){h=false}var p=this;if(m.data!=undefined){m.stopPropagation();p=m.data.me;o=m.data.obj_col;m=m.data.obj_tab}if(k==undefined){k=1}if(m.expandtype=="\u6309\u884c\u5411\u4e0b"){var q=o.get_cell_rect(m.initcz);var n=q[1].y-q[0].y+1;p._update_cell_refer(o.kid,m.initcz,"app",k);for(var l=0;l<k;l++){p._add_row(m.id,undefined,h)}m.initcz=parseInt(m.initcz)+k;p.set_coord_to_kid_map()}},is_editing:function(){return $("#page2").hasClass("in")||($("#select_page").hasClass("in")&&$("#select_page").attr("page")=="page2")},clear_cell:function(p,n,q){var o=this._get_td_and_schema_by_coord(p,n,q);var k=o.td;if(k!=undefined){var h=o.schema;var m=crsReport.crsTableIndex.rows[h.row_idx];if(m.tabletype=="\u660e\u7ec6\u8868"){var l=$(k).parent();if(!this.is_editing()){$(l).find("em[cid='"+h.kid+"']").text("")}$(k).attr("val","").attr("pval","")}else{$(k).attr("val2","");$(k).attr("val","");$(k).empty();if($(k).html().indexOf("</select>")!=-1){$($(k).html()).attr("selectedIndex",0)}else{$(k).html(crsReport.crsCommon._get_editor(this._get_rid_by_td(k),h))}}}else{var r=o.schema.get_display_seq(n,q);crsReport.crsTableIndex.clear_hidden_cell_value(o.schema.kid,r)}crsReport.crsCommon.add_action_maps(["set",p,n,q,""])},delete_record:function(o,q,n,r){var p=this._get_td_and_schema_by_coord(q,n,r);var l=p.td,m=p.schema.kid,s;var k;if(l!=undefined){s=this._get_row_seq($(l).parent("div"));k=$(l).parent("div").attr("rid");$($(l).parent()).remove()}else{s=p.schema.get_display_seq(n,r);k=crsReport.crsTableIndex.delete_hidden_row(m,s)}this._update_cell_refer(m,s,"del");crsReport.crsTableIndex.delete_row_kid(k);o.initcz=parseInt(o.initcz)-1;this.set_coord_to_kid_map()},set_cell_backgroud_color:function(m,f,l,k){var h=this._get_td_and_schema_by_coord(m,f,l);var g=h.td;if($(g).hasClass("hide")){$(g).parent().find("em[cid='"+h.schema.kid+"']").css("background-color",k)}else{$(g).children("").each(function(){if(k!=undefined){$(this).css("background-color",k)}else{$(this).css("background-color","")}})}},_draw_a_td:function(v,s,x,o,r,q,z){if(o.ismust){var u="Red"}else{var u=""}var t="";if(v&&z!=undefined){var y=o.col.obj_data_cache.get_nth_by_col_name("col"+q.id);t=HandleMemoStr(z[y],false);if(t=="null"){t=""}if((q.datatype=="\u8d27\u5e01\u578b"||q.datatype=="\u6570\u503c\u578b")&&parseFloat(t)==0||q.datatype=="\u65e5\u671f\u578b"&&(t=="0"||t=="0000-00-00 00:00:00"||t=="0000-00-00"||t=="00:00:00")){if(!crsReport.showZeroValue){t=""}}}else{t=crsReport.get_val_from_para(o.kid);if(t==""&&typeof q.datas_from_template=="object"){t=q.datas_from_template[0]}if(t==""){t=q.defaultval}}var p={val:""};if(o.canread){p.val=t}var n=crsReport.crsCommon._get_editor(x,o,p);if(p.val!=t){t=p.val}if(q.has_inline_calcu!="y"){var m=rectNameToIndex(q.cellspan);crsReport.crsCommon.add_action_maps(["set",parseInt(r.sheetindex)-1,m[0].x,m[0].y,t])}var w=" tag-RTextField";if(q.datatype=="\u4ee3\u7801\u578b"){if(q.codeid=="-10"){w=" tag-RDeptField"}else{if(q.codeid=="-11"){w=" tag-RUserField"}else{w=" tag-RSelectField"}}}s+='<div class="read_detail clearfix'+w+(o.canwrite?(o.ismust?" field-must":" field-editable"):"")+'" rid="'+x+'"><em>'+q.columnlabel+'</em><div class="field" style="height:auto;" cid="'+q.kid+'"'+((v)?(' pval="'+t+'"'):"")+' val="'+t+'">'+n+"</div></div>";return s},draw_form:function(ap){if(ap){var ak=crsReport.crsTableIndex.getFirstTable();while(ak!=null){var av=ak[1]-1;var ao=rectNameToIndex(ak[5]);if(ak[3]<1){ak[3]=1}if(ak[0]=="\u660e\u7ec6\u8868"){if(ak[2]=="\u6309\u884c\u5411\u4e0b"){if(ak[4]>ak[3]){crsReport.crsTableIndex.update_cell_refer(parseInt(av)+1,ak[2],ao,ak[4]-ak[3],true);crsReport.crsChartCache.update_ref(parseInt(av)+1,ao[0].y,ak[4]-ak[3],"app",false);crsReport.crsCommon.add_action_maps(["app",av,ao[0].y,(ak[4]-ak[3])*(ao[1].y-ao[0].y+1),(ao[1].y-ao[0].y+1)])}}else{if(ak[2]=="\u6309\u5217\u5411\u53f3"){if(ak[4]>ak[3]){crsReport.crsTableIndex.update_cell_refer(parseInt(av)+1,ak[2],ao,ak[4]-ak[3],true);crsReport.crsChartCache.update_ref(parseInt(av)+1,ao[0].x,ak[4]-ak[3],"app",true);crsReport.crsCommon.add_action_maps(["app",av,ao[0].x,(ak[4]-ak[3])*(ao[1].x-ao[0].x+1),(ao[1].x-ao[0].x+1)])}}}}ak=crsReport.crsTableIndex.getNextTable()}}$('<div id="page1" class="page in"><form name="my_form" method="post" enctype="multipart/form-data" action="" target=""><div id="content"></div></form></div>').appendTo($("body:first"));var al=this;if(!crsReport.crsTableIndex.isEmpty()){var G=3;var af,aw;var K=crsReport.crsTableIndex.first();while(!crsReport.crsTableIndex.EOF()){var ar=crsReport.crsTableIndex.getColumn(K.id);var ad,at,U;if(K.tabletype=="\u4e3b\u8868"&&ar.length()>0){var r="";var T=0,Q=0;var ax="",am=ar.arr_output_cols.length,t=0;if(ap){U=ar.obj_data_cache.rows[0];ad=ar.obj_data_cache.get_nth_by_col_name("kid");ax=U[ad]}else{ax=crsReport.crsTableIndex.create_row_kid(ar.rows[0].kid)}if(!ar.isEmpty()){if(K.canwrite!=undefined||K.canread!=undefined){r='<div id="main_tab_'+K.id+'" class="reportBlock report-block-header clearfix"><h3>'+(ap&&crsReport.crsTableIndex.cursor==0&&crsReport.s_title!=""?crsReport.s_title:K.label)+"</h3>"}var k=ar.first();while(!ar.EOF()){var e=crsReport.crsTableIndex.getAColSchema(k.kid);if(!e.canwrite&&!e.canread){if(crsReport.crsTableIndex.arr_hidden_rows[K.id]["dat"][ax]==undefined){crsReport.crsTableIndex.arr_hidden_rows[K.id]["dat"][ax]=[]}if(ap){ad=ar.obj_data_cache.get_nth_by_col_name("col"+k.id);at=HandleMemoStr(U[ad],false);crsReport.crsTableIndex.arr_hidden_rows[K.id]["dat"][ax][k.kid]={val:at,pval:at};if(k.has_inline_calcu!="y"){var V=e.get_cell_rect(1);crsReport.crsCommon.add_action_maps(["set",parseInt(K.sheetindex)-1,V[0].x,V[0].y,at])}}else{crsReport.crsTableIndex.arr_hidden_rows[K.id]["dat"][ax][k.kid]={val:"",pval:""}}}else{r=this._draw_a_td(ap,r,ax,e,K,k,U)}k=ar.next()}if(r!=""){r+="</div>"}}if(r!=""){$(r).appendTo($("body:first form:last > div"))}}else{if(K.tabletype=="\u660e\u7ec6\u8868"){if(!ar.isEmpty()){var o,o,J="",S="";aw=ar.first();var R="",ab="",Y="";while(!ar.EOF()){af=crsReport.crsTableIndex.getAColSchema(aw.kid);if(!af.canwrite&&!af.canread){}else{if(J==""){J='<div id="detail_tab_'+K.id+'" class="reportBlock report-block-header clearfix deletePriv"><h3>'+(ap&&crsReport.crsTableIndex.cursor==0&&crsReport.s_title!=""?crsReport.s_title:K.label)+"</h3>"+(crsReport.openMode!="read"&&!crsReport.b_is_query&&K.canwrite!=undefined?'<div class="report-block-header-op"><a class="report-list-icon-create" href="javascript:void(0);" onclick="crsReport.crsCommon.crsForm._draw_detail('+K.id+')"></a><a class="report-list-icon-tableview" href="/mobile/reportshop/report/read_detail_info.php" style="display: none"></a></div>':"");al.obj_detail_dump_row["tab_"+K.id]=[];al.obj_detail_dump_row["tab_"+K.id][0]=""}if(af.canread&&aw.defaultval!=""){at=aw.defaultval}else{at=""}Y+='<div class="hide" cid="'+aw.kid+'" val="'+at+'"/>';if(ab==""){ab='<h6 class="clearfix"><em cid="'+aw.kid+'">'+at+"</em>";ab+="</h6>"}else{R+='<em cid="'+aw.kid+'">'+at+"</em>"}al.obj_detail_dump_row["tab_"+K.id][aw.kid]=this._draw_a_td(false,"","",af,K,aw);if(crsReport.openMode=="write"&&typeof aw.datas_from_template=="object"){if(al.obj_detail_template_datas==undefined){al.obj_detail_template_datas={}}if(al.obj_detail_template_datas["tab_"+K.id]==undefined){al.obj_detail_template_datas["tab_"+K.id]={}}if(al.obj_detail_template_datas["tab_"+K.id][aw.kid]==undefined){al.obj_detail_template_datas["tab_"+K.id][aw.kid]=[]}for(s_k in aw.datas_from_template){if(typeof aw.datas_from_template[s_k]=="function"){break}al.obj_detail_template_datas["tab_"+K.id][aw.kid][s_k]=aw.datas_from_template[s_k]}}}aw=ar.next()}if(al.obj_detail_dump_row["tab_"+K.id]!=undefined){if(crsReport.openMode!="read"&&!crsReport.b_is_query&&K.canwrite!=undefined){al.obj_detail_dump_row["tab_"+K.id][0]+='<div class="clearfix list-item" style="-webkit-transition: -webkit-transform 200ms; transition: -webkit-transform 200ms; -webkit-transform: translate3d(0px, 0px, 0px);">'+ab+R+'</div><div class="read_detail_add"><span class="addItem" onclick="crsReport.crsCommon.crsForm._draw_detail('+K.id+', this, true)"></span></div><div class="read_detail_delete"><span onclick="crsReport.crsCommon.crsForm._delete_row('+K.id+', this)">\u5220\u9664</span></div>'+Y}else{al.obj_detail_dump_row["tab_"+K.id][0]+=ab+R+Y}}if(crsReport.openMode=="write"){for(var w=0;w<K.initcz;w++){J+=al._add_row(K.id,undefined,undefined,true)}}else{var ah=ar.obj_data_cache;if(!ah.isEmpty()){var U=ah.first();var ae=ah.get_nth_by_col_name("kid"),aj=0;while(!ah.EOF()){var X=true;aj++;var au=null,ai={},R="",ab="",Y="";aw=ar.first();while(!ar.EOF()){af=crsReport.crsTableIndex.getAColSchema(aw.kid);if(!af.canwrite&&!af.canread){if(crsReport.crsTableIndex.arr_hidden_rows[K.id]["dat"][U[ae]]==undefined){crsReport.crsTableIndex.arr_hidden_rows[K.id]["dat"][U[ae]]=[]}ad=ah.get_nth_by_col_name("col"+aw.id);at=HandleMemoStr(U[ad],false);crsReport.crsTableIndex.arr_hidden_rows[K.id]["dat"][U[ae]][aw.kid]={val:at,pval:at};if(aw.has_inline_calcu!="y"){var V=af.get_cell_rect(parseInt(U[10]));crsReport.crsCommon.add_action_maps(["set",parseInt(K.sheetindex)-1,V[0].x,V[0].y,at])}}else{if(af.canread){ad=ah.get_nth_by_col_name("col"+aw.id);at=HandleMemoStr(U[ad],false);if(at=="null"){at=""}if((aw.datatype=="\u8d27\u5e01\u578b"||aw.datatype=="\u6570\u503c\u578b")&&parseFloat(at)==0||aw.datatype=="\u65e5\u671f\u578b"&&(at=="0"||at=="0000-00-00 00:00:00"||at=="0000-00-00"||at=="00:00:00")){if(!crsReport.showZeroValue){at=""}}}else{at=""}if(X&&(at!=""&&at!="null"&&at!="0")){X=false}if(aw.datatype=="\u81ea\u589e\u578b"){at=aj}Y+='<div class="hide" cid="'+aw.kid+'" val="'+at+'" '+(ap?('pval="'+at+'"'):"")+"/>";if(aw.has_inline_calcu!="y"){var V=af.get_cell_rect(parseInt(U[10]));crsReport.crsCommon.add_action_maps(["set",parseInt(K.sheetindex)-1,V[0].x,V[0].y,at])}if(at!=""){if(aw.datatype=="\u4ee3\u7801\u578b"){if(aw.codeid=="-10"){if(at.charAt(at.length-1)==","){at=crsReport.crsDeptCache.get_name_list_by_id(at)}else{at+=","}}else{if(aw.codeid=="-11"){if(at.charAt(at.length-1)==","){at=crsReport.crsUserCache.get_name_list_by_id(at)}else{at+=","}}else{if(parseInt(aw.codeid)>0){at=crsReport.crsCodeIndex.get_display_text_by_value(aw.codeid,at)}}}}else{if(aw.datatype=="\u81ea\u589e\u578b"){}else{if(aw.datatype=="\u9644\u4ef6\u578b"){var ac=at.indexOf("_");var W=at.substr(ac+1);at="<a href='/attachment/reportshop/attachment/"+at+"' target='_blank' title='\u5355\u51fb\u6253\u5f00\u9644\u4ef6'>"+W+"</a>"}else{if(aw.datatype=="\u56fe\u7247\u578b"){var an=at.split(" ");var aa=parseInt(an[4])-parseInt(an[2]),ag=parseInt(an[5])-parseInt(an[3]);at="<img src='/attachment/reportshop/images/"+an[0]+"' title='\u53cc\u51fb\u653e\u5927\u9884\u89c8' width='50' height='30'/>"}else{at=format_text(aw.kid,at)}}}}}if(at==""){at="-"}if(ab==""){ab='<h6 class="clearfix"><em cid="'+aw.kid+'">'+at+"</em>";ab+="</h6>"}else{R+='<em cid="'+aw.kid+'">'+aw.columnlabel+"\uff1a"+at+"</em>"}}aw=ar.next()}if(K.canwrite!=undefined||K.canread!=undefined){J+='<div class="read_detail clearfix tag-RListField'+(X?" hide":"")+'" rid="'+U[ae]+'"'+(crsReport.openMode!="read"&&!crsReport.b_is_query&&K.canwrite!=undefined?'onclick="crsReport.crsCommon.crsForm._draw_detail('+K.id+', this)"':"")+">";if(crsReport.openMode!="read"&&!crsReport.b_is_query&&K.canwrite!=undefined){J+='<div class="clearfix list-item" style="-webkit-transition: -webkit-transform 200ms; transition: -webkit-transform 200ms; -webkit-transform: translate3d(0px, 0px, 0px);">'}}if(K.canwrite!=undefined||K.canread!=undefined){J+=ab+R;if(K.canwrite!=undefined&&crsReport.openMode!="read"&&!crsReport.b_is_query){J+='</div><div class="read_detail_add"><span class="addItem" onclick="crsReport.crsCommon.crsForm._draw_detail('+K.id+', this, true)"></span></div><div class="read_detail_delete"><span onclick="crsReport.crsCommon.crsForm._delete_row('+K.id+', this)">\u5220\u9664</span></div>'}J+=Y;J+="</div>"}var U=ah.next()}}}if(J!=""){J+="</div>";$(J).appendTo($("body:first form:last > div"));if(crsReport.openMode=="write"){var Z=$("#page1 #detail_tab_"+K.id+" div.tag-RListField");for(var w=0;w<K.initcz;w++){if(al.obj_detail_template_datas!=undefined&&al.obj_detail_template_datas["tab_"+K.id]!=undefined){for(s_k in al.obj_detail_template_datas["tab_"+K.id]){if(typeof al.obj_detail_template_datas["tab_"+K.id][s_k]=="function"){break}if(w>=al.obj_detail_template_datas["tab_"+K.id][s_k].length){continue}var s=$(Z).eq(w);s.find("em[cid='"+s_k+"']").text(format_text(s_k,al.obj_detail_template_datas["tab_"+K.id][s_k][w]));s.find("div[cid='"+s_k+"']").attr("val",al.obj_detail_template_datas["tab_"+K.id][s_k][w])}}}}}}}}K=crsReport.crsTableIndex.next()}}$("textarea,input.InputField").bind("click",function(){enlarge_it(this)});this.set_coord_to_kid_map();if(!crsReport.crsChartCache.isEmpty()){J="";var aq=crsReport.crsChartCache.first();while(!crsReport.crsChartCache.EOF()){var F=getColPlatKId(aq.label);aq.label=F;aq.category_name=HandleMemoStr(aq.category_name,false);aq.series_name=HandleMemoStr(aq.series_name,false);J+='<div class="reportBlock report-block-header clearfix"><h3>'+aq.title+'</h3><div  id="'+F+'" style="text-align: center;margin-bottom: 0px;border-bottom: 0px;min-width:450px;min-height:350px;"></div></div>';aq=crsReport.crsChartCache.next()}if(!crsReport.crsChartCache.isEmpty()){if($("div[id^='detail_tab_']").length>0){$("div[id^='detail_tab_']:eq(0)").before(J)}else{$(J).appendTo($("#content"))}}var aq=crsReport.crsChartCache.first();while(!crsReport.crsChartCache.EOF()){crsReport.crsChartCache.draw_chart(aq);aq=crsReport.crsChartCache.next()}}$('<div style="text-align: center;" id="tool_page"><div class="reportBlock" style="text-align: center;margin-bottom: 0px;border-bottom: 0px;">'+(crsReport.openMode!="read"&&!crsReport.b_is_query?'<button id="save" type="button" class="reportbtn" onclick="crsReport.crsCommon.crsForm._fill_report();">\u4fdd\u5b58</button>':"")+"</div></div>").appendTo($("body:first form:last"));if(crsReport.openMode!="read"&&!crsReport.b_is_query){arr_opts.r.push({title:"\u4fdd\u5b58",event:"crsReport.crsCommon.crsForm._fill_report()"});if(crsReport.s_cur_task!=""&&crsReport.s_can_roll_back=="y"){arr_opts.r.push({title:"\u64a4\u56de",event:"crsReport.crsCommon.crsForm._rollback_report()"});$('<button id="rollback" type="button" class="reportbtn" onclick="crsReport.crsCommon.crsForm._rollback_report();">\u64a4\u56de</button>').appendTo($("#tool_page > div.reportBlock"))}}$('<div id="page2" class="page">            <div class="container1"></div>            <div class="reportBlock" style="text-align: center;margin-bottom: 0px;border-bottom: 0px;">            <button type="button" class="reportbtn saveturn" onclick="javascript:crsReport.crsCommon.crsForm._save();" >\u786e\u5b9a</button>            <button type="button" class="reportbtn closeturn" onclick="javascript:crsReport.crsCommon.crsForm._back();" >\u8fd4\u56de</button>            </div></div>').appendTo($("body:first"));$('<div id="select_page" class="page"><div class="container"></div>            <div class="reportBlock" style="text-align: center;margin-bottom: 0px;border-bottom: 0px;">            <button type="button" class="reportbtn closeturn" onclick="javascript:crsReport.crsCommon.crsForm._back();" >\u8fd4\u56de</button></div></div>').appendTo("body:first");$('<div id="_all_map" style="top:0px;left:0px;width:100%;height:80%;background-color: #ffffff;overflow:auto;z-index: 1999;position: absolute;display:none;"></div>').appendTo("body:first");$('<div id="close_map" class="close_map" style="display: none">x</div>').appendTo("body:first");if(crsReport.openMode!="read"&&!crsReport.b_is_query){Swiped.init({query:"#content .list-item",list:true,right:120});$('<div id="page3" class="page"><div class="containerA"></div><div class="reportBlock" style="text-align: center;margin-bottom: 2px;border-bottom: 0px;">            <button type="button" class="reportbtn" onclick="javascript:crsReport.crsCommon.crsForm.save_data();" id="btn_save">\u4fdd\u5b58</button>'+(crsReport.has_workflow()?'<button type="button" class="reportbtn" onclick="javascript:crsReport.crsCommon.crsForm.submit_it();" id="btn_submit">\u63d0\u4ea4</button>':"")+(crsReport.s_cur_task!=""&&crsReport.s_can_roll_back=="y"?'<button type="button" class="reportbtn" onclick="javascript:crsReport.crsCommon.crsForm.roll_it();" id="btn_rollback">\u64a4\u56de</button>':"")+'<button type="button" class="reportbtn closeturn" onclick="javascript:crsReport.crsCommon.crsForm._back();" >\u8fd4\u56de</button>            </div>'+(crsReport.has_workflow()?'<div id="next_container"></div>':"")+"</div>").appendTo($("body:first"));$('<div class="reportBlock report-block-header clearfix">  <h3>\u5236\u8868\u4fe1\u606f</h3><div class="read_detail clearfix tag-RTextField field-editable"><em>\u6807\u9898:</em>  <div class="field"> <input value="'+crsReport.s_title+'" id="title" name="title" type="text"></div></div><div class="read_detail clearfix tag-RDeptField"> <em>\u5236\u8868\u90e8\u95e8:</em><div class="field"><span id="organid">'+crsReport.crsDeptCache.get_name_by_id(crsReport.organId)+'</span><input value="'+crsReport.organId+'" name="organid" type="hidden" id="organidvalue"></div></div><div class="read_detail clearfix tag-RUserField"><em>\u5236\u8868\u4eba:</em><div class="field"><span id="userid">'+crsReport.crsUserCache.get_name_by_id(crsReport.userId)+'</span><input value="'+crsReport.userId+'" name="userid" type="hidden" id="useridvalue">    </div></div><div class="read_detail clearfix tag-RDateField">  <em>\u5236\u8868\u65f6\u95f4:</em>  <div class="field"><span>'+crsReport.writeTime+'</span><input value="'+crsReport.writeTime+'" name="writetime" type="hidden" readonly=""></div></div><div class="read_detail clearfix tag-RRichtextField field-editable">  <em>\u5907\u6ce8:</em>  <div class="field" style="height:auto;"><div class="clearfix"></div><textarea id="memo" name="memo">'+crsReport.s_memo+"</textarea></div></div></div>").appendTo($("#page3 > div.containerA"));if(crsReport.has_workflow()){$('<link rel="stylesheet" type="text/css" href="/general/workflow/list/turn/turn_style.css">').append("body:first")}if(!crsReport.b_usepda){$('button[action="selectuser"]').bind("click",function(){var a=$(this).siblings(":eq(0)").attr("id");if(crsReport.mobilestyle==1){document.location="selectuser:"+a}else{window.Android.selectAddress("selectuser",a)}});$('button[action="selectdept"]').bind("click",function(){var a=$(this).siblings(":eq(0)").attr("id");if(crsReport.mobilestyle==1){document.location="selectdept:"+a}else{window.Android.selectDept("selectdept",a)}});$('button[action="addfile"]').bind("click",function(){crsReport.crsCommon._id($(this).siblings(":eq(0)"));var b=$(this).siblings(":eq(0)").attr("id");var a=$(this).parent("div").parent("div").attr("rid");a=a+$(this).parent("div").attr("cid");a=getColPlatKId(a);if(crsReport.mobilestyle==1){document.location="addfile:"+b+":"+a}else{window.Android.selectfile("addfile",b,a)}});$('button[action="addimg"]').bind("click",function(){crsReport.crsCommon._id($(this).siblings(":eq(0)"));var b=$(this).siblings(":eq(0)").attr("id");var a=$(this).parent("div").parent("div").attr("rid");a=a+$(this).parent("div").attr("cid");a=getColPlatKId(a);if(crsReport.mobilestyle==1){document.location="addimg:"+b+":"+a}else{window.Android.selectimg("addimg",b,a)}})}}},show_hint:function(b){var a=$("#select_page");a.children("div.container").html(b);a.attr("page",$("div.in").attr("id"));$("div.page").removeClass("in");a.addClass("in")},_fill_report:function(){crsReport.handle_before_save();if(!crsReport.save_data(false)){return}if($("#title").val()==""||$("#title").val()=="undefined"){$("#title").val(crsReport.crsTableIndex.get_auto_code())}var d="";this.obj_next=crsReport.crsWorkflow.get_next_task(false);if(this.obj_next!=null&&typeof this.obj_next=="object"){d='<div class="reportWrapper">';for(i in this.obj_next){if(typeof(this.obj_next[i])=="function"){break}if(this.obj_next[i].b_only_redirect){continue}var b=i.substr(1,i.length-1);d+='<div class="reportBlock"><div class="read_detail clearfix "><em><input type="checkbox" style="display:;" id="PRCS_CHECK_'+b+'" name="PRCS_CHECK_'+b+'"'+(Object.keys(this.obj_next).length==1?" checked":"")+'/>\u4e0b\u4e00\u6b65\u9aa4\uff1a</em><div class="field"><span class="turn-title">'+this.obj_next[i].n+'</span></div></div><div class="read_detail clearfix "><em>\u529e\u7406\u4eba\uff1a</em><div class="field userlist">';var a="";if(this.obj_next[i].u!=undefined){for(j in this.obj_next[i].u){if(typeof(this.obj_next[i].u[j])=="function"){break}var c=j;if(c.substr(0,4).toLowerCase()=="key_"){c=c.substr(4)}if(this.obj_next[i].autoassign=="\u662f"&&this.obj_next[i].excluded_user.indexOf(c)==-1){d+='<em userid="'+c+'">'+this.obj_next[i].u[j]+'<span class="delicon"></span></em>'}a+="<li "+(this.obj_next[i].autoassign=="\u662f"&&this.obj_next[i].excluded_user.indexOf(c)==-1?'class="active" ':"")+'q_name="'+this.obj_next[i].u[j]+'" q_user_id="'+c+'" ><h3>'+this.obj_next[i].u[j]+'</h3><p class="grapc">\u90e8\u95e8\uff1a'+crsReport.crsUserCache.get_long_dept_name(c)+'</p><i class="checkicon"></i></li>'}}d+='</div></div><div class="read_detail userarea clearfix "><div class="search_box"><div class="input_box"><input type="text" class="search" name="USER_NAME" value=""></div></div><ul class="comm-list comm-pic-list USER_PLIST">'+a+'</ul><div class="nousertip" class="nousertip">\u6ca1\u6709\u7b26\u5408\u6761\u4ef6\u7684\u4eba\u5458</div></div></div>'}if(d!='<div class="reportWrapper">'){d+='<div class="read_detail clearfix "><em><input class="smsremind" id="sms" name="sms" type="checkbox" checked />\u4e8b\u52a1\u63d0\u9192\u4e0a\u8ff0\u6267\u884c\u4eba</em></div>'}d+="</div>"}$("#page3 > #next_container").html(d);$("#page1").removeClass("in");$("#page3").addClass("in");$("#page3 #btn_rollback").hide();$("#page3 #btn_submit").show();$("#page3 #btn_save").show();if(d!=""){$(".USER_PLIST li").on("click",function(){var g=$(this),f=g.parents(".reportBlock");$userlist=f.find(".userlist");g.toggleClass("active");var e=g.attr("q_user_id"),h=g.attr("q_name");if(g.hasClass("active")){if($userlist.children("em[userid='"+e+"']").length>0){}else{$('<em userid="'+e+'" class="">'+h+'<span class="delicon"></span></em>').appendTo($userlist)}}else{$userlist.find("em[userid='"+e+"']").remove()}});$(".userlist").delegate("em","touchstart",function(){$(this).toggleClass("active")});$(".userlist").delegate(".delicon","touchstart",function(){var e=$(this).parent("em").attr("userid"),f=$(this).parents(".reportBlock");$(this).parent("em").remove();f.find(".USER_PLIST").find('li[q_user_id="'+e+'"]').removeClass("active")});$(".search").on("keyup",function(){var k=$(this),h=k.parents(".reportBlock"),e=h.find(".USER_PLIST");var g=$(this).val();if(g!=""){var f=false;e.find("li").each(function(){var m=$(this).attr("q_name"),l=$(this).attr("q_user_id");if(m.indexOf(g)!=-1||l.indexOf(g)!=-1){$(this).removeClass("hide");f=true}else{$(this).addClass("hide")}});if(f){h.find(".nousertip").hide()}else{h.find(".nousertip").show()}}else{e.find("li").removeClass("hide");h.find(".nousertip").hide()}})}},_rollback_report:function(){crsReport.handle_before_save();if(!crsReport.save_data(false)){return}if($("#title").val()==""||$("#title").val()=="undefined"){$("#title").val(crsReport.crsTableIndex.get_auto_code())}var b='<div class="reportWrapper"></div>';$("#page3 > #next_container").html(b);var a=$("#page3 > #next_container > div.reportWrapper");crsReport.crsReportState.get_prev_tasks(a);$("#page1").removeClass("in");$("#page3").addClass("in");$("#page3 #btn_rollback").show();$("#page3 #btn_submit").hide();$("#page3 #btn_save").hide()},roll_it:function(){var c=$("#page3").find("input:checked").parent();var b=$(c).text();if(b.indexOf("<\u521d\u59cb\u586b\u62a5>")!=-1){b=b.replace("<\u521d\u59cb\u586b\u62a5>","");crsReport.s_next_task=b+"["+crsReport.crsReportState.get_write_list("")+"]"}else{crsReport.s_next_task=b+"["+crsReport.crsReportState.get_write_list(b)+"]"}if(crsReport.s_next_task==""){crsReport.show_hint("\u672a\u9009\u62e9\u4e0a\u4e00\u6b65\u9aa4\uff0c\u4e0d\u5141\u8bb8\u64a4\u56de\uff01");return}if($("#sms").length>0){crsReport.i_remind_type=$("#sms")[0].checked?1:0}else{crsReport.i_remind_type=1}crsReport.b_submit=true;this.save_data();if(!crsReport.b_saved){return}var a=crsReport.free();crsReport.free=undefined;submit_it()},save_data:function(){crsReport.s_title=$("#title").val();crsReport.s_memo=$("#memo").val();crsReport.save_data()},submit_it:function(){if(this.obj_next!=null&&typeof this.obj_next=="object"){var d="";for(c in this.obj_next){if(typeof this.obj_next[c]=="function"){continue}var b=c.substr(1,c.length-1);if(this.obj_next[c].b_only_redirect){page.crsReport.s_only_redirect_task+=";"+this.obj_next[c].n+"["+get_delimiter_key(this.obj_next[c].u,",")+"]"}else{if($("#PRCS_CHECK_"+b)[0].checked){var g="";$("#PRCS_CHECK_"+b).parents("div.reportBlock").find("em[userid]").each(function(){if(!$(this).hasClass("active")){g+=$(this).attr("userid")+","}});if(g==""){crsReport.show_hint("\u8bf7\u6307\u5b9a "+this.obj_next[c].n+" \u529e\u7406\u4eba\uff01");return}d+=this.obj_next[c].n+"["+g+"];"}}}crsReport.s_next_task=d}if(crsReport.s_next_task==""&&!crsReport.b_is_endtask&&crsReport.crsWorkflow.must_submit()){crsReport.show_hint("\u6ca1\u6709\u4e0b\u4e00\u6b65\u6b65\u9aa4\uff0c\u4e0d\u5141\u8bb8\u63d0\u4ea4\uff01");return}if($("#sms").length>0){crsReport.i_remind_type=$("#sms")[0].checked?1:0}else{crsReport.i_remind_type=1}crsReport.b_submit=true;this.save_data();if(!crsReport.b_saved){return}var h=crsReport.free();if(h!=""){var a=screen.availWidth;var k=screen.availHeight;var e=h.split("|");for(var c=0,f=e.length/6;c<f;c++){if(e[c*6+3]==""){window.open("./index.php?repid="+e[c*6]+"&openmode=write&userid="+page.crsReport.s_writer,"_blank","status=1,resizable=1,left=0,top=0,width="+a+",height="+k)}else{window.open("./index.php?repid="+e[c*6]+"&openmode=edit&userid="+e[c*6+3]+"&writetime="+e[c*6+4]+"&writer="+page.crsReport.s_writer+"&curtask="+e[c*6+5],"_blank","status=1,resizable=1,left=0,top=0,width="+a+",height="+k)}}}crsReport.free=undefined;submit_it()},_save:function(){var e=$("#page2 > div > div");var b=e.attr("id").replace("detail_tab_","");var o=e.attr("to_insert")!=undefined;if(o){e.removeAttr("to_insert")}var l=e.children("div:eq(0)");var c=$(l).attr("rid");if(1||!o&&c!=undefined&&c!=""){var m=$("#page1 #detail_tab_"+b+" > div[rid='"+c+"']");var a=""}else{var f=crsReport.crsTableIndex.search("id",b);var p=crsReport.crsTableIndex.getAColSchema($(l).find("div.field").eq(0).attr("cid"));if(o){var n=$("#page1 #detail_tab_"+b+" > div[rid='"+c+"']");this._insert_row(b,n,true);var m=$(n).prev()}else{m=e.children("div.hide:eq(0)");if(m.length>0){m.removeClass("hide")}else{this.append_record(f,p,1,true);var m=$("#page1 #detail_tab_"+b+" > div").last()}}}if(m.hasClass("hide")){m.removeClass("hide")}var d="",h="",k="";var g=this;var a=g._get_row_seq(m);$("#page2 div.field").each(function(){var u=$(this).attr("cid");var x=crsReport.crsTableIndex.getAColSchema(u);var t=x.col.rows[x.col_idx];if(t.datatype=="\u81ea\u589e\u578b"){var y=a}else{if($(this).find("select").length>0){var r=$(this).find("select")[0];var y=r.options[r.selectedIndex].text}else{var w=$(this).children(":eq(0)");if($(w).attr("type")=="radio"){var y=$(w)[0].checked?"on":""}else{var y=$(this).children(":eq(0)").val()}}}var s=$(this).children(":eq(1)");if(s.length>0){var q=$(s)[0].tagName;if(q!=undefined&&q.toLowerCase()=="span"){y=$(s).text()}else{y=s.val()}}if(y=="on"){y="\u221a"}var v=x.get_cell_point(a);if(x.col.rows[x.col_idx].has_inline_calcu!="y"){crsReport.crsCommon.add_action_maps(["set",parseInt(crsReport.crsTableIndex.rows[x.row_idx].sheetindex)-1,v.x,v.y,$(this).attr("val")])}if(h==""){h='<h6 class="clearfix"><em cid="'+x.kid+'">'+y+"</em></h6>"}else{if(t.datatype=="\u56fe\u7247\u578b"){d+='<em cid="'+x.kid+'"><img src="'+$(this).find("img").attr("src")+'" width="50" height="30"/></em>'}else{if(t.datatype=="\u9644\u4ef6\u578b"){d+='<em cid="'+x.kid+'"><a href="'+$(this).find("a").attr("href")+'" target="_blank">'+$(this).find("a").text()+"</a></em>"}else{d+='<em cid="'+x.kid+'">'+t.columnlabel+"\uff1a"+y+"</em>"}}}k+='<div class="hide" cid="'+x.kid+'" val="'+$(this).attr("val")+'" '+($(this).attr("pval")!=undefined?('pval="'+$(this).attr("pval")+'"'):"")+">"+$(this).html()+"</div>"});if(false&&$(m).children("div.report-block-header-op").length>0){$(m).html(h+d+k+'<div class="report-block-header-op hide">'+$(m).children("div.report-block-header-op").html()+"</div>")}else{$(m).html('<div class="clearfix list-item" style="-webkit-transition: -webkit-transform 200ms; transition: -webkit-transform 200ms; -webkit-transform: translate3d(0px, 0px, 0px);">'+h+d+'</div><div class="read_detail_add"><span class="addItem" onclick="crsReport.crsCommon.crsForm._draw_detail('+b+', this, true)"></span></div><div class="read_detail_delete"><span onclick="crsReport.crsCommon.crsForm._delete_row('+b+', this)">\u5220\u9664</span></div>'+k)}setTimeout(function(){Swiped.init({query:"#content .list-item",list:true,right:120})},500);this._back()},_back:function(){var h=$("div.in");if(h.attr("id")=="page2"){var g=h.attr("page")!=undefined?h.attr("page"):"page1";h.removeClass("in").removeAttr("page");$("#"+g).addClass("in");var b=$(h).find("div[to_insert]");if($(b).length>0){var e=crsReport.crsTableIndex.search("id",$(b).attr("id").replace("detail_tab_",""));var c=$("#page1 #"+$(b).attr("id")+" > div[rid='"+$(b).children("div[rid]:eq(0)").attr("rid")+"']");var l=this._get_row_seq(c);var k=$(c).children("div.hide:eq(0)").attr("cid");crsReport.crsTableIndex.delete_row_kid($(c).attr("rid"));this._update_cell_refer(k,l,"del");$(c).remove();e.initcz=parseInt(e.initcz)-1;this.set_coord_to_kid_map()}else{var b=$("#page2 > div > div");var c=$("#page1 #"+$(b).attr("id")+" > div[rid='"+$(b).children("div[rid]:eq(0)").attr("rid")+"']");$(c).children("div[cid]").each(function(){$(this).attr("val",$(this).attr("_val"));$(this).removeAttr("_val")})}}else{var g=h.attr("page")!=undefined?h.attr("page"):"page1";h.removeClass("in").removeAttr("page");$("#"+g).addClass("in")}if(this.arr_div_position["#"+g]!=undefined){window.scrollTo(0,this.arr_div_position["#"+g])}if(crsReport.crsCommon.obj_cur_editor!=null){$(crsReport.crsCommon.obj_cur_editor)[0].focus()}},_draw_detail:function(s,g,r){window.event.stopPropagation();if(r==undefined){r=false}var o=crsReport.crsTableIndex.search("id",s);if(g==undefined||r){var l=undefined;if(g!=undefined){if(r){g=$(g).parent().parent().attr("rid")}else{g=$(g).attr("rid")}}else{l=$("#page1 #detail_tab_"+s+" > div.hide").first()}if(l==undefined||l.length<=0){var u=$("#page1 #detail_tab_"+s+" > div[rid]:eq(0)");var w=$(u).find("div.hide:eq(0)");var h=crsReport.crsTableIndex.getAColSchema($(w).attr("cid"));if(r){var b=$("#page1 #detail_tab_"+s+" > div[rid='"+g+"']");this._insert_row(s,b,false);l=$(b).prev()}else{this.append_record(o,h,1,false);l=$("#page1 #detail_tab_"+s+" > div").last();r=true}}g=$(l).attr("rid")}else{g=$(g).attr("rid")}var e='<div id="detail_tab_'+o.id+'" class="reportBlock report-block-header clearfix"'+(r?" to_insert":"")+"><h3>"+o.label+"</h3></div>";$("#page2 > div.container1").html(e);for(s_key in this.obj_detail_dump_row["tab_"+s]){if(s_key!=0&&typeof(this.obj_detail_dump_row["tab_"+s][s_key])!="function"){var n=$("#page1 #detail_tab_"+o.id+" > div[rid='"+g+"']");var k=n.children("div[cid='"+s_key+"']");$(this.obj_detail_dump_row["tab_"+s][s_key]).appendTo("#page2 > div.container1 > div");var d=$("#page2 > div.container1 > div > div").last();if($(k).children().length>0){$(d).children("div.field").html($(k).html())}if(g!=undefined){$(d).attr("rid",g)}if(!r){var v="";var c=$(k).attr("val");$(k).attr("_val",c);c=c=="-"?"":c;var q=$(d).children("div.field");q.attr("val",c);var v=n.find("em[cid='"+s_key+"']").text();v=v=="-"?"":v;var t=v.indexOf("\uff1a");if(t!=-1){v=v.substr(t+1)}var a=$(q).find("select");if($(a).length>0){var m=0;$(a).children().each(function(){if($(this).text()==v){$(a)[0].selectedIndex=m;return false}m++})}else{var h=crsReport.crsTableIndex.getAColSchema(s_key);if(h.datatype=="\u903b\u8f91\u578b"){if(c=="\u221a"){$(q).children("input[type='checkbox']").attr("checked",true)}}else{if(h.datatype=="\u4ee3\u7801\u578b"){if(h.codeid=="-10"||h.codeid=="-11"){$(q).children().eq(0).val(c);$(q).children().eq(1).text(v)}else{if(h.codeid=="-11"){$(q).children().eq(0).val(c);$(q).children().eq(1).text(v)}else{}}}else{$(q).children().val(v)}}}}e+=d}}$('#page2 button[action="selectuser"]').bind("click",function(){var f=$(this).siblings(":eq(0)").attr("id");var p=$("#"+f).val();p=p.split(",");p=$.map(p,function(x){if(x.length){return x}});tMobileSDK.selectUser({users:p||[],onSuccess:function(x){var z="";var A="";$.each(x,function(D,C){var B=C.uid,E=C.userName;if(B==""||E==""){return false}z+=B+",";A+=E+","});A=A.substring(0,A.length-1);$("#"+f+"_text").html(A);var y=$("#"+f);$(y).val(z);crsReport.crsCommon._do_editor_deactive(y)},onFail:function(){alert("error")}})});$('#page2 button[action="selectdept"]').bind("click",function(){var f=$(this).siblings(":eq(0)").attr("id");var p=$("#"+f).val();if(p!=""){p=p.split(",");p=$.map(p,function(x){if(x.length){return x}})}else{p=[]}tMobileSDK.selectDept({depts:p||[],onSuccess:function(x){var A="";var y="";$.each(x,function(B,D){var C=D.deptId,E=D.deptName;if(C==""||E==""){return false}A+=C+",";y+=E+","});y=y.substring(0,y.length-1);$("#"+f+"_text").html(y);var z=$("#"+f);$(z).val(A);crsReport.crsCommon._do_editor_deactive($("#"+f))}})});$('button[action="addfile"]').bind("click",function(){var p=$(this).siblings(":eq(0)").attr("id");var f=$(this).parent("div").parent("div").attr("rid");f=f+$(this).parent("div").attr("cid");f=getColPlatKId(f);if(tMobileSDK.platForm=="wx"||tMobileSDK.platForm=="qywx"){tMobileSDK.selectFile({max:1,hasCallback:true,upSuccessCb:function(x){try{$.each(x,function(z,A){move_file(p,f,A.id,A.name)})}catch(y){alert(y)}},onFail:function(){}})}else{tMobileSDK.selectFile({max:1,hasCallback:true,onSuccess:function(x){try{$.each(x,function(z,A){move_file(p,f,A.id,A.name)})}catch(y){alert(y)}},onFail:function(){}})}});$('button[action="addimg"]').bind("click",function(){var x=$(this);var p=$(this).siblings(":eq(0)").attr("id");var f=$(this).parent("div").parent("div").attr("rid");f=f+$(this).parent("div").attr("cid");f=getColPlatKId(f);if(tMobileSDK.platForm=="wx"||tMobileSDK.platForm=="qywx"){tMobileSDK.uploadImage({max:1,qyappName:"apps",hasCallback:true,upSuccessCb:function(y){try{$.each(y,function(A,B){move_image(p,f,B.id,B.name)})}catch(z){alert(z)}},onFail:function(){}})}else{tMobileSDK.chooseImage({max:1,hasCallback:true,onSuccess:function(y){try{$.each(y,function(A,B){move_image(p,f,B.id,B.name)})}catch(z){alert(z)}},onFail:function(){}})}});this.arr_div_position["#page1"]=$(document).scrollTop();$("#page1").removeClass("in");$("#page2").addClass("in")},_open_href:function(a){var b='<iframe src="'+a+'"/>';this.show_hint(b)},begin_update:function(){},end_update:function(){this.calculate();crsReport.crsChartCache.refresh()},resize:function(){}};function TCRSTableView(){this.i_step=5;this.arr_cell_editor=[];this.crsCellControler=new TCRSCellControler();this.op='<i align=\'right\'><img title="\u6dfb\u52a0" onclick="crsReport.crsCommon.crsTable.append_record(this)" src="/static/modules/reportshop/images/green_plus.gif" border="0" style="cursor:pointer"><img title="\u63d2\u5165" onclick="crsReport.crsCommon.crsTable.insert_record(this)" src="/static/modules/reportshop/images/green_arrow.gif" border="0" style="cursor:pointer"><img title="\u5220\u9664" onclick="crsReport.crsCommon.crsTable.delete_record(this)" src="/static/modules/reportshop/images/green_minus.gif" border="0" style="cursor:pointer"></i>'}TCRSTableView.prototype={constructor:TCRSTableView,get_op:function(a){var b="";if(crsReport.crsTableIndex.can_append(a)){b='<img title="\u6dfb\u52a0" onclick="crsReport.crsCommon.crsTable.append_record(this)" src="/static/modules/reportshop/images/green_plus.gif" border="0" style="cursor:pointer">'}if(crsReport.crsTableIndex.can_insert(a)){b+='<img title="\u63d2\u5165" onclick="crsReport.crsCommon.crsTable.insert_record(this)" src="/static/modules/reportshop/images/green_arrow.gif" border="0" style="cursor:pointer">'}if(crsReport.crsTableIndex.can_delete(a)){b+='<img title="\u5220\u9664" onclick="crsReport.crsCommon.crsTable.delete_record(this)" src="/static/modules/reportshop/images/green_minus.gif" border="0" style="cursor:pointer">'}if(b!=""){b='<i align="right">'+b+"</i>"}return b},loadData:function(L){var V=crsReport.crsTableIndex.get_sheet_sz();for(var aa=0;aa<V;aa++){this.crsCellControler.cache_td(aa)}crsReport.crsHyperlink.load_link();if(L){var ao=crsReport.crsTableIndex.getFirstTable();while(ao!=null){var af=ao[1]-1;var ai=rectNameToIndex(ao[5]);if(ao[3]<1){ao[3]=1}if(ao[0]=="\u660e\u7ec6\u8868"){if(ao[2]=="\u6309\u884c\u5411\u4e0b"){if(ao[4]>ao[3]){crsReport.crsTableIndex.update_cell_refer(parseInt(af)+1,ao[2],ai,ao[4]-ao[3],true);var R=ai[1].y-ai[0].y+1;ai[0].y+=R*(ao[3]-1);ai[1].y+=R*(ao[3]-1);this.crsCellControler.insert_row2(this.crsCellControler.get_cell(af,ai[0].x,ai[0].y),af,ai[0].y,(ao[4]-ao[3]));this.crsCellControler.cache_td(af)}}else{if(ao[2]=="\u6309\u5217\u5411\u53f3"){if(ao[4]>ao[3]){crsReport.crsTableIndex.update_cell_refer(parseInt(af)+1,ao[2],ai,ao[4]-ao[3],true);var R=ai[1].x-ai[0].x+1;ai[0].x+=R*(ao[3]-1);ai[1].x+=R*(ao[3]-1);this.crsCellControler.insert_column(this.crsCellControler.get_cell(af,ai[0].x,ai[0].y),af,ai[0].x,(ao[4]-ao[3]));this.crsCellControler.cache_td(af)}}}}ao=crsReport.crsTableIndex.getNextTable()}}if(crsReport.openMode=="write"&&crsReport.s_dataflow!=""){crsReport.openMode="edit"}if(crsReport.openMode=="edit"||crsReport.openMode=="read"||crsReport.openMode=="copynew"){if(crsReport.openMode=="read"){me2=crsReport;if(!crsReport.b_is_query){crsReport.b_is_query=true}}var Z=14;var ah=0;var ae=crsReport.crsTableIndex.getFirstTable();while(ae!=null){var af=ae[1]-1;var K=crsReport.crsTableIndex.get_first_data_item();var ab=null;var y=1;while(K!=null){ah++;if(ab==null){ab=K.schema;K=K.data}for(var aa=0,W=ab.length/Z;aa<W;aa++){if(crsReport.openMode=="copynew"&&aa==0){K[ab[aa*Z+8]]=crsReport.crsTableIndex.create_row_kid(ab[aa*Z+6])}var X=ab[aa*Z+1],ac=ab[aa*Z+2];var ai=rectNameToIndex(ab[aa*Z+10]);if(y>1){if(ae[2]=="\u6309\u884c\u5411\u4e0b"||ae[2]=="\u4e0d\u6269\u5c55"){ac+=(ai[1].y-ai[0].y+1)*(y-1)}else{X+=(ai[1].x-ai[0].x+1)*(y-1)}}var U="row"+ac+"column"+X;var Q=$(crsReport.obj_cell_maps[af][U]);if(ae[2]=="\u6309\u884c\u5411\u4e0b"||ae[2]=="\u4e0d\u6269\u5c55"){Q.parent("#row"+ac).attr("rid",K[ab[aa*Z+8]])}else{Q.attr("rid",K[ab[aa*Z+8]])}Q.attr("cid",ab[aa*Z+6]);if((crsReport.openMode=="copynew"&&(crsReport.writeColList==null||crsReport.writeColList.indexOf(ab[aa*Z+6])!=-1)||crsReport.openMode!="copynew"&&(crsReport.readColList==null||crsReport.readColList.indexOf(ab[aa*Z+6])!=-1))&&(ab[aa*Z+12]!="\u662f"||Q.html()==""||Q.html()==undefined)){var al="";if(K[ab[aa*Z+7]]=="null"){al=""}else{al=HandleMemoStr(K[ab[aa*Z+7]],false)}Q.attr("pval",al);if(ab[aa*Z+12]=="\u662f"){var T={val:al};var Y=crsReport.crsTableIndex.getAColSchema(ab[aa*Z+6]);crsReport.crsCommon._get_editor(K[ab[aa*Z+8]],Y,T,Y.col.obj_data_cache,Y.col.obj_data_cache.rows[y-1]);Q.attr("val2",T.val);Q.attr("pval",T.val);this.crsCellControler.set_cell_value(af,X,ac,T.val)}else{if(ab[aa*Z+4]=="\u65e5\u671f\u578b"||ab[aa*Z+4]=="\u8d27\u5e01\u578b"||ab[aa*Z+4]=="\u6570\u503c\u578b"){if((ab[aa*Z+4]=="\u8d27\u5e01\u578b"||ab[aa*Z+4]=="\u6570\u503c\u578b")&&parseFloat(al)==0||al=="0"||al=="0000-00-00 00:00:00"||al=="0000-00-00"||al=="00:00:00"){if(!crsReport.showZeroValue){al=""}Q.attr("pval",al)}}else{if(ab[aa*Z+4]=="\u81ea\u589e\u578b"){al=y;Q.attr("pval",al)}else{if(ab[aa*Z+4]=="\u4ee3\u7801\u578b"){}else{if(ab[aa*Z+4]=="\u56fe\u7247\u578b"){if(al!=""){var ao=al.split(" ");Q.attr("val2",ao[0])}}else{if(ab[aa*Z+4]=="\u9644\u4ef6\u578b"){if(al){Q.attr("val2",al)}}}}}}var T={val:al};var Y=crsReport.crsTableIndex.getAColSchema(ab[aa*Z+6]);var ap=crsReport.crsCommon._get_editor(K[ab[aa*Z+8]],Y,T,Y.col.obj_data_cache,Y.col.obj_data_cache.rows[y-1]);if(crsReport.openMode!="read"&&!crsReport.b_is_query&&aa==W-1&&(ae[2]=="\u6309\u884c\u5411\u4e0b"||ae[2]=="\u6309\u5217\u5411\u53f3")){if(ah<=this.i_step){Q[0].innerHTML=ap+this.get_op(crsReport.crsTableIndex.curColumn.i_tab_id)}else{this.arr_cell_editor.push({cell:Q,op:this.get_op(crsReport.crsTableIndex.curColumn.i_tab_id),a1:K[ab[aa*Z+8]],a2:Y,a3:T,a4:Y.col.obj_data_cache,a5:Y.col.obj_data_cache.rows[y-1],dt:ab[aa*Z+4],editor:ap,seq:y,cid:ab[aa*Z+6]})}}else{if(ah<=this.i_step){Q[0].innerHTML=ap}else{this.arr_cell_editor.push({cell:Q,a1:K[ab[aa*Z+8]],a2:Y,a3:T,a4:Y.col.obj_data_cache,a5:Y.col.obj_data_cache.rows[y-1],dt:ab[aa*Z+4],editor:ap,seq:y,cid:ab[aa*Z+6]})}}if(ab[aa*Z+4]=="\u4ee3\u7801\u578b"||ab[aa*Z+4]=="\u9644\u4ef6\u578b"||ab[aa*Z+4]=="\u56fe\u7247\u578b"||ab[aa*Z+4]=="\u624b\u5199\u7b7e\u7ae0"){Q.children("input").width(Q.width()-32)}else{Q.children("input").width(Q.width()-6)}if(crsReport.openMode!="read"&&!crsReport.b_is_query&&aa==W-1&&(ae[2]=="\u6309\u884c\u5411\u4e0b"||ae[2]=="\u6309\u5217\u5411\u53f3")){var S=Q.children("input").width()-50;if(S>10){Q.children("input").width(S)}}if(ab[aa*Z+4]!="\u56fe\u7247\u578b"&&ab[aa*Z+4]!="\u9644\u4ef6\u578b"){this.crsCellControler.set_cell_value(af,X,ac,al)}if(ab[aa*Z+5]!=""&&ab[aa*Z+5]!="0"&&Q.html()!=""){Q.html('<a onclick="crsReport.on_dblclick(event); return false;" href="#">'+Q.html()+"</a>")}if(T.val!=al){if(Q.attr("val")!=null&&Q.attr("val")==al){Q.attr("val",T.val)}if(Q.attr("pval")!=null&&Q.attr("pval")==al){Q.attr("pval",T.val)}if(Q.attr("val2")!=null&&Q.attr("val2")==al){Q.attr("val2",T.val)}}}}else{var al="";if(K[ab[aa*Z+7]]=="null"){al=""}else{al=HandleMemoStr(K[ab[aa*Z+7]],false)}var T={val:al};var Y=crsReport.crsTableIndex.getAColSchema(ab[aa*Z+6]);crsReport.crsCommon._get_editor(K[ab[aa*Z+8]],Y,T,Y.col.obj_data_cache,Y.col.obj_data_cache.rows[y-1]);if(Q.html()!=""&&Q.html()!=undefined){Q.attr("pval",T.val);this.crsCellControler.set_cell_value(af,X,ac,T.val)}}}if(typeof plugin_action=="function"){if(ah<=this.i_step){for(var aa=0,W=ab.length/Z;aa<W;aa++){var al="";if(K[ab[aa*Z+7]]=="null"){al=""}else{al=HandleMemoStr(K[ab[aa*Z+7]],false)}plugin_action(crsReport.openMode,getColPlatKId(ab[aa*Z+6]),y,al)}}}K=crsReport.crsTableIndex.get_next_data_item();y++}ae=crsReport.crsTableIndex.getNextTable()}}if(crsReport.openMode!="read"){K=crsReport.crsTableIndex.GetFirstWritableCellList(crsReport.writeColList);var ag=15;var ah=0;while(K!=null&&K.length>0){var P=K[5];var an=K[4];var af=K[2]-1;if(af>0){this.crsCellControler.cache_td(af)}for(var N=0;N<P;N++){ah++;var R=0;if(P>1){if(an=="\u6309\u5217\u5411\u53f3"||an=="\u4e0d\u6269\u5c55\uff08\u6309\u5217\u5411\u53f3\uff09"){var R=K[0].arr_cell_rect[1].x-K[0].arr_cell_rect[0].x+1}else{var R=K[0].arr_cell_rect[1].y-K[0].arr_cell_rect[0].y+1}}var O="";var aa=0,am=K.length/ag;for(;aa<am;aa++){var M=K[aa*ag].arr_cell_rect;var ak=M[0].x,aj=M[0].y;if(N>0){if(an=="\u6309\u5217\u5411\u53f3"||an=="\u4e0d\u6269\u5c55\uff08\u6309\u5217\u5411\u53f3\uff09"){ak+=R*N}else{aj+=R*N}}var U="row"+aj+"column"+ak;var Q=$(crsReport.obj_cell_maps[af][U]);if(Q.attr("cid")!=undefined){break}if(Q.attr("cid")==undefined){Q.attr("cid",K[aa*ag+13])}if(an=="\u6309\u884c\u5411\u4e0b"||an=="\u4e0d\u6269\u5c55"){if(Q.parent("#row"+aj).attr("rid")==undefined){if(O==""){O=crsReport.crsTableIndex.create_row_kid(K[aa*ag+13])}Q.parent("#row"+aj).attr("rid",O)}}else{if(O==""){O=crsReport.crsTableIndex.create_row_kid(K[aa*ag+13])}if(Q.attr("rid")==undefined){Q.attr("rid",O)}}var al=this.crsCellControler.get_cell_value(af,ak,aj);if(K[aa*ag+6]=="\u81ea\u589e\u578b"){K[aa*ag+7]=N+1}var ad=crsReport.get_val_from_para(K[aa*ag+13]);if(ad!=""){K[aa*ag+7]=ad}if(al==""){al=Q.html();if(al==undefined){al=""}al=al.trim();if(al!=""){al=al.decodeHtml();this.crsCellControler.set_cell_value(af,ak,aj,al)}}if(al==""&&K[aa*ag+7]!=""){al=K[aa*ag+7];if(K[aa*ag+8]!="\u662f"){this.crsCellControler.set_cell_value(af,ak,aj,K[aa*ag+7])}else{Q.attr("val2",K[aa*ag+7])}}var T={val:al};var Y=crsReport.crsTableIndex.getAColSchema(K[aa*ag+13]);var ap=crsReport.crsCommon._get_editor(O,Y,T);if(!crsReport.b_is_query&&aa==am-1&&(an=="\u6309\u884c\u5411\u4e0b"||an=="\u6309\u5217\u5411\u53f3")){if(ah<=this.i_step){Q[0].innerHTML=ap+this.get_op(Y.col.i_tab_id)}else{this.arr_cell_editor.push({cell:Q,op:this.get_op(Y.col.i_tab_id),a1:O,a2:Y,a3:T,dt:K[aa*ag+6],editor:ap,seq:N+1,cid:K[aa*ag+13]})}}else{if(ah<=this.i_step){Q[0].innerHTML=ap}else{this.arr_cell_editor.push({cell:Q,a1:O,a2:Y,a3:T,dt:K[aa*ag+6],editor:ap,seq:N+1,cid:K[aa*ag+13]})}}if(T.val!=al){Q.attr("val",T.val);if(Q.attr("pval")!=null&&Q.attr("pval")==al){Q.attr("pval",T.val)}if(Q.attr("val2")!=null&&Q.attr("val2")==al){Q.attr("val2",T.val)}}if(K[aa*ag+6]=="\u4ee3\u7801\u578b"||K[aa*ag+6]=="\u9644\u4ef6\u578b"||K[aa*ag+6]=="\u56fe\u7247\u578b"||K[aa*ag+6]=="\u624b\u5199\u7b7e\u7ae0"){Q.children("input").width(Q.width()-32)}else{var x=Q.width();Q.children("input").width(x-6)}if(!crsReport.b_is_query&&aa==am-1&&(an=="\u6309\u884c\u5411\u4e0b"||an=="\u6309\u5217\u5411\u53f3")){if(Q.children("textarea").length>0){var S=Q.children("textarea").width()-50;if(S>10){Q.children("textarea").width(S)}}else{var S=Q.children("input").width()-50;if(S>10){Q.children("input").width(S)}}}}if(typeof plugin_action=="function"){if(ah<=this.i_step){for(aa=0;aa<am;aa++){var M=K[aa*ag].arr_cell_rect;var ak=M[0].x,aj=M[0].y;if(N>0){if(an=="\u6309\u5217\u5411\u53f3"||an=="\u4e0d\u6269\u5c55\uff08\u6309\u5217\u5411\u53f3\uff09"){ak+=R*N}else{aj+=R*N}}plugin_action(crsReport.openMode,getColPlatKId(K[aa*ag+13]),N+1,this.crsCellControler.get_cell_value(af,ak,aj))}}}}K=crsReport.crsTableIndex.GetNextWritableCellList(crsReport.writeColList)}}if(crsReport.openMode=="edit"&&crsReport.s_data_flow!=""){crsReport.openMode="write"}window.setTimeout("crsReport.crsCommon.crsTable.show_editor()",500)},append_record:function(z){if($(z)[0].tagName.toLowerCase()=="td"){var v=z}else{var v=$(z).parent().parent("td")}if(crsReport.crsTableIndex!=null){var w=crsReport.crsTableIndex.can_append2(v,true);if(w.b_can_append){var x="";crsReport.crsCommon.blur_handler();if(w.expandtype=="\u6309\u884c\u5411\u4e0b"){var u=rectNameToIndex(w.def_rect);var D=this.crsCellControler.get_sheet_index_by_cell(v);x=$(v).attr("cid");crsReport.crsTableIndex.update_cell_refer(parseInt(D)+1,w.expandtype,u,1,true);var t=u[1].y-u[0].y+1;var E=u[0].y+t*(w.initcz-1);this.crsCellControler.insert_row(v,D,E,1);this.crsCellControler.cache_td(D);var H=u[0].y+t*w.initcz;var G="row"+H+"column"+u[0].x;var s=$(crsReport.obj_cell_maps[D][G]).parent("#row"+H);var r=$(s).attr("rid");var q=crsReport.crsTableIndex.create_row_kid(x);$(s).attr("rid",q);$(s).find("input[type='radio']").each(function(){var a=$(this).attr("name");a=a.replace(r,q);$(this).attr("name",a)});s=$(crsReport.obj_cell_maps[D]["row"+E+"column"+u[0].x]).parent("#row"+E);$(s).find("input[type='radio']").each(function(){var a=$(this).parent().attr("val");if(a!=undefined&&a!=""){$(this)[0].checked=true}});if(w.arr_noclear!=undefined){for(var B=0,y=w.arr_noclear.length;B<y;B++){var I=rectNameToIndex(w.arr_noclear[B]);var C=crsReport.crsCommon.get_cell_value(D,I[0].x,E);crsReport.crsCommon.set_cell_value(D,I[0].x,H,C)}}if(w.arr_defaultval!=undefined){for(var B=0,y=w.arr_defaultval.length/2;B<y;B++){var I=rectNameToIndex(w.arr_defaultval[B*2]);crsReport.crsCommon.set_cell_value(D,I[0].x,H,w.arr_defaultval[B*2+1])}}if(typeof plugin_is_disable=="function"){$(crsReport.obj_cell_maps[D][G]).parent("#row"+H).children("td[cid]").each(function(){var b=getColPlatKId($(this).attr("cid"));var a=plugin_is_disable(b,undefined,undefined,parseInt(w.initcz)+1);if(a!=undefined){crsReport.crsCommon.set_cell_disable(b,parseInt(w.initcz)+1,a)}})}if(typeof plugin_action=="function"){$(crsReport.obj_cell_maps[D][G]).parent("#row"+H).children("td[cid]").each(function(){var a=getColPlatKId($(this).attr("cid"));plugin_action(crsReport.openMode,a,parseInt(w.initcz)+1,crsReport.crsCommon.get_cell_value(a,parseInt(w.initcz)+1))})}}else{if(w.expandtype=="\u6309\u5217\u5411\u53f3"){var u=rectNameToIndex(w.def_rect);var D=this.crsCellControler.get_sheet_index_by_cell(v);x=$(v).attr("cid");crsReport.crsTableIndex.update_cell_refer(parseInt(D)+1,w.expandtype,u,1,true);var t=u[1].x-u[0].x+1;this.crsCellControler.insert_column(D,u[0].x+t*(w.initcz-1),1);this.crsCellControler.cache_td(D);var H=u[0].x+t*w.initcz;var F=crsReport.crsTableIndex.create_row_kid(x);for(var B=u[0].y;B<=u[1].y;){var G="row"+B+"column"+H;var A=$(crsReport.obj_cell_maps[D][G]);A.attr("rid",F);if(A.attr("rowspan")!=undefined){B+=parseInt(A.attr("rowspan"))}else{B+=1}}if(w.arr_noclear!=undefined){for(var B=0,y=w.arr_noclear.length;B<y;B++){var I=rectNameToIndex(w.arr_noclear[B]);var C=this.crsCellControler.get_cell_value(D,u[0].x,I[0].y);this.crsCellControler.set_cell_value(D,u[0].x+t,I[0].y,C)}}if(w.arr_defaultval!=undefined){for(var B=0,y=w.arr_defaultval/2;B<y;B++){var I=rectNameToIndex(w.arr_defaultval[B*2]);this.crsCellControler.set_cell_value(D,u[0].x+t,I[0].y,w.arr_defaultval[B*2+1])}}}}if(x!=""){crsReport.crsTableIndex.auto_increment(x)}}}crsReport.crsCommon.refresh()},insert_record:function(A){var u=$(A).parent().parent("td");if(crsReport.crsTableIndex!=null){var w=crsReport.crsTableIndex.can_append2(u,true);if(w.b_can_append){var x="";crsReport.crsCommon.blur_handler();if(w.expandtype=="\u6309\u884c\u5411\u4e0b"){var t=rectNameToIndex(w.def_rect);var y=t[1].y-t[0].y+1;var F=this.crsCellControler.get_sheet_index_by_cell(u);x=$(u).attr("cid");var v=this.crsCellControler.get_cell_point(u);crsReport.crsTableIndex.update_cell_refer(parseInt(F)+1,w.expandtype,t,1,true);this.crsCellControler.insert_row(u,F,v.y,1,true);this.crsCellControler.cache_td(F);var H="row"+v.y+"column"+v.x;var r=$(crsReport.obj_cell_maps[F][H]).parent("#row"+v.y);var q=$(r).attr("rid");var p=crsReport.crsTableIndex.create_row_kid(x);$(r).attr("rid",p);$(r).find("input[type='radio']").each(function(){var a=$(this).attr("name");a=a.replace(q,p);$(this).attr("name",a)});var E=y+parseInt(v.y);r=$(crsReport.obj_cell_maps[F]["row"+E+"column"+ +v.x]).parent("#row"+E);$(r).find("input[type='radio']").each(function(){var a=$(this).parent().attr("val");if(a!=undefined&&a!=""){$(this)[0].checked=true}});if(w.arr_noclear!=undefined){for(var C=0,z=w.arr_noclear.length;C<z;C++){var I=rectNameToIndex(w.arr_noclear[C]);var D=crsReport.crsCommon.get_cell_value(F,I[0].x,E);crsReport.crsCommon.set_cell_value(F,I[0].x,v.y,D)}}if(w.arr_defaultval!=undefined){for(var C=0,z=w.arr_defaultval.length/2;C<z;C++){var I=rectNameToIndex(w.arr_defaultval[C*2]);crsReport.crsCommon.set_cell_value(F,I[0].x,v.y,w.arr_defaultval[C*2+1])}}if(typeof plugin_is_disable=="function"){var s=0;$(crsReport.obj_cell_maps[F][H]).parent("#row"+v.y).children("td[cid]").each(function(){var c=getColPlatKId($(this).attr("cid"));if(s==0){var b=crsReport.crsTableIndex.getAColSchema(c);s=b.get_display_seq(v.x,v.y)}var a=plugin_is_disable(c,undefined,undefined,s);if(a!=undefined){crsReport.crsCommon.set_cell_disable(c,s,a)}})}if(typeof plugin_action=="function"){var s=0;$(crsReport.obj_cell_maps[F][H]).parent("#row"+v.y).children("td[cid]").each(function(){var b=getColPlatKId($(this).attr("cid"));if(s==0){var a=crsReport.crsTableIndex.getAColSchema(b);s=a.get_display_seq(v.x,v.y)}plugin_action(crsReport.openMode,b,s,crsReport.crsCommon.get_cell_value(b,s))})}}else{if(w.expandtype=="\u6309\u5217\u5411\u53f3"){var t=rectNameToIndex(w.def_rect);var F=this.crsCellControler.get_sheet_index_by_cell(u);var v=this.crsCellControler.get_cell_point(u);x=$(u).attr("cid");crsReport.crsTableIndex.update_cell_refer(parseInt(F)+1,w.expandtype,t,1,true);this.crsCellControler.insert_column(F,v.x,1,true);this.crsCellControler.cache_td(F);var G=crsReport.crsTableIndex.create_row_kid(x);for(var C=t[0].y;C<=t[1].y;){var H="row"+C+"column"+v.x;var B=$(crsReport.obj_cell_maps[F][H]);B.attr("rid",G);if(B.attr("rowspan")!=undefined){C+=parseInt(B.attr("rowspan"))}else{C+=1}}if(w.arr_noclear!=undefined){for(var C=0,z=w.arr_noclear.length;C<z;C++){var I=rectNameToIndex(w.arr_noclear[C]);var D=this.crsCellControler.get_cell_value(F,I[0].x,t[0].y);this.crsCellControler.set_cell_value(F,I[0].x+y,t[0].y,D)}}if(w.arr_defaultval!=undefined){for(var C=0,z=w.arr_defaultval.length/2;C<z;C++){var I=rectNameToIndex(w.arr_defaultval[C*2]);this.crsCellControler.set_cell_value(F,I[0].x+y,t[0].y,w.arr_defaultval[C*2+1])}}}}if(x!=""){crsReport.crsTableIndex.auto_increment(x)}}}crsReport.crsCommon.refresh()},delete_record:function(o,l){if(l==undefined){l=$(o).parent().parent("td")}if(crsReport.crsTableIndex!=null){var p=crsReport.crsTableIndex.can_delete2(l,true);if(p.b_can_delete){if(p.b_all){crsReport.show_hint("\u660e\u7ec6\u8868\u6700\u540e\u4e00\u6761\u8bb0\u5f55\u4e0d\u80fd\u5220\u9664\uff01");return}var m="";crsReport.blur_handler();if(p.expandtype=="\u6309\u884c\u5411\u4e0b"){var q=rectNameToIndex(p.def_rect);var r=this.crsCellControler.get_sheet_index_by_cell(l);m=$(l).attr("cid");var k=this.crsCellControler.get_cell_point(l);crsReport.crsTableIndex.update_cell_refer(parseInt(r)+1,p.expandtype,q,1,false);crsReport.crsTableIndex.delete_row_kid($(l).parent("#row"+k.y).attr("rid"));this.crsCellControler.delete_row(l,r,k.y,1);this.crsCellControler.cache_td(r);var n=k.y-1;l=crsReport.obj_cell_maps[r]["row"+n+"column"+k.x]}else{if(p.expandtype=="\u6309\u5217\u5411\u53f3"){var q=rectNameToIndex(p.def_rect);var r=this.crsCellControler.get_sheet_index_by_cell(l);var k=this.crsCellControler.get_cell_point(l);crsReport.crsTableIndex.update_cell_refer(parseInt(r)+1,p.expandtype,q,1,false);crsReport.crsTableIndex.delete_row_kid($(l).attr("rid"));this.crsCellControler.delete_column(r,k.x,1);this.crsCellControler.cache_td(r);var n=k.x-1;l=crsReport.obj_cell_maps[r]["row"+k.y+"column"+n]}}if(m!=""){crsReport.crsTableIndex.auto_increment(m)}}}crsReport.crsCommon.refresh()},show_editor:function(){if(this.arr_cell_editor==null){return}var f=500;var h=this.arr_cell_editor.length;if(h>f){h=f}for(var g=0;g<h;g++){if(typeof this.arr_cell_editor[g]=="function"){break}this.arr_cell_editor[g].cell[0].innerHTML=this.arr_cell_editor[g]["editor"]+(this.arr_cell_editor[g].op!=undefined?this.arr_cell_editor[g].op:"");if(this.arr_cell_editor[g].dt=="\u4ee3\u7801\u578b"||this.arr_cell_editor[g].dt=="\u9644\u4ef6\u578b"||this.arr_cell_editor[g].dt=="\u56fe\u7247\u578b"||this.arr_cell_editor[g].dt=="\u624b\u5199\u7b7e\u7ae0"){this.arr_cell_editor[g].cell.children("input").width(this.arr_cell_editor[g].cell.width()-32)}else{var e=this.arr_cell_editor[g].cell.width();this.arr_cell_editor[g].cell.children("input").width(e-6)}if(this.arr_cell_editor[g].op!=undefined){var k=this.arr_cell_editor[g].cell.children("input").width()-50;if(k>10){this.arr_cell_editor[g].cell.children("input").width(k)}}}if(typeof plugin_action=="function"){for(var g=0;g<h;g++){plugin_action(crsReport.openMode,getColPlatKId(this.arr_cell_editor[g].cid),this.arr_cell_editor[g].seq,this.arr_cell_editor[g].a3.val)}}if(h<this.arr_cell_editor.length){this.arr_cell_editor.splice(0,h);window.setTimeout("crsReport.crsCommon.crsTable.show_editor()",100)}else{this.arr_cell_editor=null;if(crsReport.arr_schema["#fetch_res"]!=undefined){crsReport.crsFormulasCache.loadData("#tablecrs_formulas");crsReport.crsFormulasCache.init_formulas();if(crsReport.b_crs_gz){crsReport.arr_schema["#fetch_res"]=crs_decode(crsReport.arr_schema["#fetch_res"])}crsReport.fill_values(crsReport.arr_schema["#fetch_res"],crsReport,crsReport.arr_schema["#fetch_idx"])}if(crsReport.b_has_sign_seal&&navigator.appName=="Microsoft Internet Explorer"){for(s_k in this.obj_sign_seals){crsReport.DWebSignSeal.SetStoreData(this.obj_sign_seals[s_k]["v"])}crsReport.DWebSignSeal.ShowWebSeals();var l=crsReport.DWebSignSeal.FindSeal("",0);while(l!=""){var a="";if(l.indexOf("_hw")>0){a=l.substring(0,l.indexOf("_hw"))}else{if(l.indexOf("_seal")>0){a=l.substring(0,l.indexOf("_seal"))}}if(a!=""){var m=GetDataStr(a);crsReport.DWebSignSeal.SetSealSignData(l,m);if($("#SIGN_POS_"+a).find("input[type='button']").length==0){crsReport.DWebSignSeal.SetMenuItem(l,4)}else{crsReport.DWebSignSeal.SetMenuItem(l,261)}}l=crsReport.DWebSignSeal.FindSeal(l,0)}}if(crsReport.b_autoheight){$("textarea").each(function(){crsReport.crsCommon._textarea_auto_height(this)})}}}};function TCRSCellControler(){}TCRSCellControler.prototype={constructor:TCRSCellControler,insert_row2:function(z,e,w,y,g){var t=1;w=parseInt(w),y=parseInt(y);if($(z).attr("rowspan")!=undefined){t=parseInt($(z).attr("rowspan"))}if(g==undefined||!g){crsReport.crsCommon.add_action_maps(["app",e,w,y*t,t]);crsReport.crsChartCache.update_ref(e,w,y*t,"app",false)}else{crsReport.crsCommon.add_action_maps(["ins",e,w,y*t,t]);crsReport.crsChartCache.update_ref(e,w,y*t,"ins",false)}var b=$("#sheet"+e+" tr").last();var s=parseInt(b.attr("id").replace("row",""));var u=(g==undefined||!g)?w+t:w;var E=parseInt(y)*t;do{$(b).attr("id","row"+(E+s));b=$(b).prev();s--}while(s>=u);var v=this;var C=$("#sheet"+e+" tr:eq("+w+")");var A=$(C)[0].outerHTML;var x="";for(var B=1;B<=y;B++){var D=w+B*t+0;A=$(A).attr("id","row"+D);x+=$(A)[0].outerHTML}C.after($(x))},insert_row:function(B,s,y,z,t){var v=1;y=parseInt(y),z=parseInt(z);if($(B).attr("rowspan")!=undefined){v=parseInt($(B).attr("rowspan"))}if(t==undefined||!t){crsReport.crsCommon.add_action_maps(["app",s,y,z*v,v]);crsReport.crsChartCache.update_ref(s,y,z*v,"app",false)}else{crsReport.crsCommon.add_action_maps(["ins",s,y,z*v,v]);crsReport.crsChartCache.update_ref(s,y,z*v,"ins",false)}var e=$("#sheet"+s+" tr").last();var u=parseInt(e.attr("id").replace("row",""));var w=(t==undefined||!t)?y+v:y;for(var D=u;D>=w;D--){var F=parseInt(D)+parseInt(z)*v;$("#sheet"+s+" tr:eq("+D+")").attr("id","row"+F)}var x=this;for(var D=z;D>0;D--){for(var E=0;E<v;E++){var A=$("#sheet"+s+" tr:eq("+(y+E)+")");if(t==undefined||!t){var F=y+D*v+E}else{var F=w+(z-D)*v+E}$(A).children().each(function(){var b=1,c=1;if($(this).attr("rowspan")!=undefined){b=parseInt($(this).attr("rowspan"))}if($(this).attr("colspan")!=undefined){c=parseInt($(this).attr("colspan"))}if(b>1||c>1){var a=$(this).attr("class").indexOf(" ");if(a==-1){a=$(this).attr("class").length}var d=$(this).attr("class").substr(0,a);var d=parseInt(d.replace("column",""));crsReport.crsCommon.add_action_maps(["merge",s,d,F,(d+c-1),(F+b-1)])}});var C=$(A).clone(true,true).attr("id","row"+F);this.clear_tr(C);if(t==undefined||!t){$("#sheet"+s+" tr:eq("+(y+v-1+E)+")").after($(C))}else{$("#sheet"+s+" tr:eq("+y+")").before($(C));y++}}}},delete_row:function(s,n,q,r){var p=1;if($(s).attr("rowspan")!=undefined){p=parseInt($(s).attr("rowspan"))}q=parseInt(q),r=parseInt(r);for(var t=0;t<r;t++){for(var u=0;u<p;u++){var v=q+t*p+u;$("#sheet"+n+" tr[id='row"+v+"']").remove()}}var m=$("#sheet"+n+" tr").last();var o=m.attr("id").replace("row","");p=r*p;for(var t=q+p;t<=o;t++){var v=t-p;$("#sheet"+n+" tr[id='row"+t+"']").attr("id","row"+v);$("#sheet"+n+" tr:eq("+v+")").find("td").each(function(){var e=$(this).attr("func");if(false&&e!=undefined){if(e.substr(0,1)=="="){var k=e.substring(1)}var f=crsReport.crsCalculation._parseFormula(k);var d=e;for(var b=0;b<f.length;b++){var a=f[b].value;var g=f[b].stype;if(g=="Cell Reference"&&a.length>1&&a.indexOf("$")==-1){var h=cellNameToIndex(a);if(q<h.y){h.y-=parseInt(r)*p;var c=cellIndexToName(h);d=d.replace(a,c);$(this).attr("func",d)}}}}})}crsReport.crsCommon.add_action_maps(["del",n,q,r*p,p]);crsReport.crsChartCache.update_ref(n,q,r*p,"del",false)},insert_column:function(q,l,n,r,m){var o=1;n=parseInt(n),r=parseInt(r);if($(q).attr("colspan")!=undefined){o=parseInt($(q).attr("colspan"))}if(m==undefined||!m){crsReport.crsCommon.add_action_maps(["app",l,n+o,r*o]);crsReport.crsChartCache.update_ref(l,n,r*o,"app",true)}else{crsReport.crsCommon.add_action_maps(["ins",l,n,r*o]);crsReport.crsChartCache.update_ref(l,n,r*o,"ins",true)}var k=(m==undefined||!m)?n+o:n;var s=$("#sheet"+l+" tr:eq(0)").find("td:last").index();$("#sheet"+l+" tr").each(function(){if($(this).attr("rid")){for(var b=s;b>=k;b--){var a=parseInt(b)+parseInt(r)*o;var d=$(this).find("td:eq("+b+")");var c=d.attr("class").replace("column"+b,"column"+a);d.attr("class",c)}if(r>1){$("#sheet"+l).css("width","")}}});var p;$("#sheet"+l+" tr").each(function(){if($(this).attr("rid")){for(var g=r;g>0;g--){if(r>1){p=n+r-g}else{p=n}var e=$(this).find("td:eq("+p+")");if(m==undefined||!m){var a=p+o}else{var a=k}var f=$(e).attr("class").indexOf(" ");if(f==-1){f=$(e).attr("class").length}var b=$(e).attr("class").substr(0,f);var c=$(e).clone(false);var d=$(c).attr("class").replace(b,"column"+a);$(c).attr("class",d);$(c).text("");if($(c).attr("val")!=undefined){$(c).attr("val","")}if($(c).attr("val2")!=undefined){$(c).attr("val2","")}if($(c).attr("pval")!=undefined){$(c).attr("pval","")}if(m==undefined||!m){$(this).find("td:eq("+(p)+")").after($(c))}else{$(this).find("td:eq("+(p)+")").before($(c))}}}});$("#sheet"+l+" tr").find("td").each(function(){var f=$(this).attr("func");if(false&&f!=undefined){if(f.substr(0,1)=="="){var a=f.substring(1)}var g=crsReport.crsCalculation._parseFormula(a);var e=f;for(var c=0;c<g.length;c++){var b=g[c].value;var h=g[c].stype;if(h=="Cell Reference"&&b.length>1&&b.indexOf("$")==-1){var t=cellNameToIndex(b);if(n<=t.x){t.x+=parseInt(r)*o;var d=cellIndexToName(t);e=e.replace(b,d);$(this).attr("func",e)}}}}})},delete_column:function(o,l,m,r){var n=1;if($(o).attr("colspan")!=undefined){n=parseInt($(o).attr("colspan"))}m=parseInt(m),r=parseInt(r);var s=$("#sheet"+l+" tr").children("td:last").index();for(var p=0;p<r;p++){for(var q=0;q<n;q++){var t=m+p*n+q;$("#sheet"+l+" tr").find("td:eq("+t+")").remove()}}n=r*n;$("#sheet"+l+" tr").each(function(){for(var z=m;z<s;z++){var C=$(this).find("td:eq("+z+")");var e=C.attr("class").indexOf(" ");if(e==-1){e=C.attr("class").length}var a=C.attr("class").substr(0,e);var g=C.attr("class").replace(a,"column"+z);C.attr("class",g);var c=C.attr("func");if(false&&c!=undefined){if(c.substr(0,1)=="="){var k=c.substring(1)}var d=crsReport.crsCalculation._parseFormula(k);var b=c;for(var B=0;B<d.length;B++){var A=d[B].value;var f=d[B].stype;if(f=="Cell Reference"&&A.length>1&&A.indexOf("$")==-1){var h=cellNameToIndex(A);if(m<h.x){h.x-=parseInt(r)*n;var D=cellIndexToName(h);b=b.replace(A,D);C.attr("func",b)}}}}}});crsReport.crsCommon.add_action_maps(["del",l,m,r*n,n]);crsReport.crsChartCache.update_ref(l,m,r*n,"del",false)},clear_tr:function(b){$(b).children("td").each(function(){var g=$(this).children(":eq(0)");if(g.length>0){var e=g[0].tagName.toLowerCase();if(e=="img"||e=="a"){var f=crsReport.crsTableIndex.getAColSchema($(this).attr("cid"));var a=$(this).children("i").length>0?"<i align='right'>"+$(this).children("i").html()+"</i>":"";$(this).html(crsReport.crsCommon._get_editor($(this).parent().attr("rid"),f)+a)}else{$(this).children().val("")}}if($(this).attr("val")!=undefined){$(this).attr("val","")}if($(this).attr("val2")!=undefined){$(this).attr("val2","")}if($(this).attr("pval")!=undefined){$(this).attr("pval","")}})},cache_td:function(g){var f=this;var l=crsReport;if(l.obj_cell_maps.length<1){l.obj_cell_maps=null;l.obj_cell_maps={}}var h=false;var k=l.obj_cell_maps[g]==undefined;l.obj_cell_maps[g]=[];$("#sheet"+g+" td").each(function(){var a=$(this).attr("class").indexOf(" ");if(a==-1){a=$(this).attr("class").length}var c=$(this).attr("class").substr(0,a);if(k){var b=$(this).text();if(b!=""&&b.charAt(0)=="="){$(this).attr("func",b);$(this).text("");if(!h){h=true}}}l.obj_cell_maps[g][$(this).parent("tr").attr("id")+c]=this});if(!this.b_has_excel_func&&h){this.b_has_excel_func=true}},set_cell_value:function(r,n,k,o,l){var q;if(k!=undefined){var p="row"+k+"column"+n;q=crsReport.obj_cell_maps[r][p]}else{o=n;q=r;r=this.get_sheet_index_by_cell(q);var m=this.get_cell_point(q);n=m.x;k=m.y}if(l==undefined){l=format_text($(q).attr("cid"),o)}if($(q).attr("val")!=o){$(q).attr("val",o);if($(q).attr("func")==undefined){crsReport.crsCommon.add_action_maps(["set",r,n,k,o])}}},set_cell_value2:function(h,m,k,n){var p;if(k!=undefined){var o="row"+k+"column"+m;var p=crsReport.obj_cell_maps[h][o]}else{n=m;p=h;h=this.get_sheet_index_by_cell(p);var l=this.get_cell_point(p);m=l.x;k=l.y}if($(p).attr("val2")!=n){$(p).attr("val2",n);if($(p).attr("func")==undefined){crsReport.crsCommon.add_action_maps(["set",h,m,k,n])}}},get_cell:function(f,g,h){var k="row"+h+"column"+g;var l=crsReport.obj_cell_maps[f][k];return l},get_cell_point:function(h){var g=$(h).attr("class").indexOf(" ");if(g==-1){g=$(h).attr("class").length}var f=$(h).attr("class").substr(0,g);var e={x:f.replace("column",""),y:$(h).parent().attr("id").replace("row","")};return e},get_cell_rect:function(k){var h=$(k).attr("class").indexOf(" ");if(h==-1){h=$(k).attr("class").length}var g=$(k).attr("class").substr(0,h);var f={x:g.replace("column",""),y:$(k).parent().attr("id").replace("row","")};var l={x:f.x,y:f.y};if($(k).attr("rowspan")!=undefined){l.y=parseInt(l.y)+$(k).attr("rowspan")-1}if($(k).attr("colspan")!=undefined){l.x=parseInt(l.x)+$(k).attr("colspan")-1}return new Array(f,l)},get_sheet_index_by_cell:function(d){var f=$(d).parent();f=$(f).parent();f=$(f).parent();var e=$(f).attr("id");return e.replace("sheet","")},get_cell_value:function(g,h,k){var l="row"+k+"column"+h;var n=crsReport.obj_cell_maps[g][l];var m=$(n).attr("val");if(m==undefined){m=$(n).attr("val2")}return m!=undefined?m:""},get_cell_attr:function(h,k,m,l){var n="row"+m+"column"+k;var p=crsReport.obj_cell_maps[h][n];var o=$(p).attr(l);return o!=undefined?o:""},set_cell_backgroud_color:function(h,k,m,l,p){var n="row"+m+"column"+k;var o=crsReport.obj_cell_maps[h][n];if(l==undefined&&$(o).attr("prev-background-color")!=undefined){l=$(o).attr("prev-background-color")}if(l!=undefined){if(p&&$(o).attr("prev-background-color")==undefined){$(o).attr("prev-background-color",$(o).css("background-color"))}$(o).css("background-color",l)}},set_cell_pvalue:function(g,k,h,l){var m="row"+h+"column"+k;var n=crsReport.obj_cell_maps[g][m];$(n).attr("pval",l)},clear_cell:function(r,k,n){var o="row"+n+"column"+k;var p=crsReport.obj_cell_maps[r][o];$(p).attr("val2","");$(p).attr("val","");var q=crsReport.crsTableIndex.getAColSchema($(p).attr("cid"));var l=crsReport.crsTableIndex.rows[q.row_idx];if($(p).html().indexOf("</select>")!=-1){$($(p).html()).attr("selectedIndex",0)}else{if($(p).html().indexOf("green_plus.gif")!=-1){var m=$(p).children("input").width();$(p).html(crsReport.crsCommon._get_editor($(p).parent("tr").attr("rid"),q)+crsReport.crsCommon.crsTable.op);$(p).children("input").width(m)}else{$(p).html(crsReport.crsCommon._get_editor($(p).parent("tr").attr("rid"),q))}}if($(p).attr("func")==undefined){crsReport.crsCommon.add_action_maps(["set",r,k,n,""])}}};function TCRSFormView(b){this.obj_detail_dump_row={};this.arr_action_maps=null;this.obj_coord_to_kid_map=null;this.obj_cur_editor=null;this.i_default_height=200}TCRSFormView.prototype={constructor:TCRSFormView,set_coord_to_kid_map:function(){this.obj_coord_to_kid_map={};if(!crsReport.crsTableIndex.isEmpty()){var l=crsReport.crsTableIndex.first();while(!crsReport.crsTableIndex.EOF()){if(this.obj_coord_to_kid_map[l.sheetindex-1]==undefined){this.obj_coord_to_kid_map[l.sheetindex-1]={}}var o=crsReport.crsTableIndex.getColumn(l.id);if(l.tabletype=="\u4e3b\u8868"){if(this.obj_coord_to_kid_map[l.sheetindex-1]["m"]==undefined){this.obj_coord_to_kid_map[l.sheetindex-1]["m"]={}}if(!o.isEmpty()){var k=o.first();while(!o.EOF()){var p=crsReport.crsTableIndex.getAColSchema(k.kid);var m=p.display_rect;this.obj_coord_to_kid_map[l.sheetindex-1]["m"][m[0].x+"_"+m[0].y]=p;k=o.next()}}}else{if(l.tabletype=="\u660e\u7ec6\u8868"){if(this.obj_coord_to_kid_map[l.sheetindex-1]["d"]==undefined){this.obj_coord_to_kid_map[l.sheetindex-1]["d"]=[]}if(!o.isEmpty()){var k=o.first();while(!o.EOF()){var p=crsReport.crsTableIndex.getAColSchema(k.kid);var m=p.display_rect;var h={};if(l.expandtype=="\u6309\u884c\u5411\u4e0b"||l.expandtype=="\u4e0d\u6269\u5c55"){var n=m[1].y-m[0].y+1;h={x1:m[0].x,y1:m[0].y,x2:m[1].x,y2:m[1].y+(l.initcz-1)*n,col:p}}this.obj_coord_to_kid_map[l.sheetindex-1]["d"].push(h);k=o.next()}}this.auto_increment(l,o)}}l=crsReport.crsTableIndex.next()}}},_get_td_by_coord:function(u,q,r,x){var p=null,s=null;if(x==undefined){x=false}if(this.obj_coord_to_kid_map!=undefined){if(this.obj_coord_to_kid_map[u]!=undefined){if(this.obj_coord_to_kid_map[u]["m"]!=undefined){s=this.obj_coord_to_kid_map[u]["m"][q+"_"+r];if(s!=undefined){if(x){return s}var t=crsReport.crsTableIndex.rows[s.row_idx];p=$("#main_tab_"+t.id+" td[cid='"+s.kid+"']")}}if(p==null){if(this.obj_coord_to_kid_map[u]["d"]!=undefined){for(var w=0,v=this.obj_coord_to_kid_map[u]["d"].length;w<v;w++){var y=this.obj_coord_to_kid_map[u]["d"][w];if(y.x1<=q&&y.x2>=q&&y.y1<=r&&y.y2>=r){s=y.col;if(x){return s}var A=s.get_display_seq(q,r);var t=crsReport.crsTableIndex.rows[s.row_idx];var z=$("#detail_tab_"+t.id).children().eq(0).children("tr").eq(A);var o="detail_tab_"+t.id+"_"+s.kid;p=$(z).children("td[aria-describedby='"+o+"']");break}}}}}}return p},_get_td_and_schema_by_coord:function(s,o,p){var m={};if(this.obj_coord_to_kid_map!=undefined){if(this.obj_coord_to_kid_map[s]!=undefined){if(this.obj_coord_to_kid_map[s]["m"]!=undefined){m.schema=this.obj_coord_to_kid_map[s]["m"][o+"_"+p];if(m.schema!=undefined){var r=crsReport.crsTableIndex.rows[m.schema.row_idx];m.td=$("#main_tab_"+r.id+" td[cid='"+m.schema.kid+"']")}}if(m.schema==undefined){if(this.obj_coord_to_kid_map[s]["d"]!=undefined){for(var t=0,q=this.obj_coord_to_kid_map[s]["d"].length;t<q;t++){var u=this.obj_coord_to_kid_map[s]["d"][t];if(u.x1<=o&&u.x2>=o&&u.y1<=p&&u.y2>=p){m.schema=u.col;var w=m.schema.get_display_seq(o,p);var r=crsReport.crsTableIndex.rows[m.schema.row_idx];var v=$("#detail_tab_"+r.id).children().eq(0).children("tr").eq(w);var n="detail_tab_"+r.id+"_"+m.schema.kid;m.td=$(v).children("td[aria-describedby='"+n+"']");break}}}}}}if(m.td!=undefined&&m.td.length<1){m.td=undefined}return m},_add_action_maps:function(b){if(!crsReport.b_has_inline_calcu){return}if(this.arr_action_maps==null){this.arr_action_maps=b}else{this.arr_action_maps=this.arr_action_maps.concat(b)}},calculate:function(d,c){if(d==undefined){d=false}if(this.arr_action_maps==null){return}d=!d;crsReport.crsDataSet.calculate(this.arr_action_maps,crsReport.crsTableIndex.get_incalcu_cell(),this._fill_calculate_val,this,d,c);this.arr_action_maps=null},_fill_calculate_val:function(d,f,e){f.arr_action_maps=null;if(e!=undefined&&e){crsReport.crsDataSet.save_as_excel(crsReport.s_repname)}$.each(d,function(b,a){if(a!=undefined){f._set_cell_value(a.pg,a.x,a.y,a.val,true)}})},_set_cell_value:function(q,l,n,o,p){var s=this._get_td_and_schema_by_coord(q,l,n);var k=s.td;if($(k).length>0){if(o!=""&&s.schema.datatype=="\u4ee3\u7801\u578b"){if(s.schema.codeid==-11){var r=crsReport.crsUserCache.get_id_by_name(o);$(k).children().eq(1).val(o);o=r}}var m=s.schema.col.rows[s.schema.col_idx].refrepid;if(o!=""&&m!=""&&m!="0"){$(k).html("<a href='javascript:' target='_blank' onclick='crsReport.on_dblclick(event); return false;' style='text-decoration: underline'>"+format_text(s.schema.kid,o)+"</a>")}else{$(k).children().eq(0).val(format_text(s.schema.kid,o))}this.set_cell_value(q,l,n,o,k,s.schema.kid,p)}},set_cell_pvalue:function(l,h,f,k){var g=this._get_td_by_coord(l,h,f);if($(g).length>0){$(g).attr("pval",k)}},get_cell:function(d,e,f){return this._get_td_by_coord(d,e,f)},get_cell_attr:function(k,l,n,m){var o=this._get_td_and_schema_by_coord(k,l,n);var r=o.td;var q="";if(r!=undefined){q=$(r).attr(m);if(q==undefined&&m=="cid"){q=$(r).attr("aria-describedby");if(q!=undefined){var p=q.indexOf("{");if(p==-1){}q=q.substr(p)}}}else{if(m=="cid"){q=o.schema.kid}}return q!=undefined?q:""},get_cell_value:function(q,n,r){if(r!=undefined){var p=this._get_td_and_schema_by_coord(q,n,r);var l=p.td}else{if(n!=undefined){var m=crsReport.crsTableIndex.getAColSchema(q);var k=m.get_cell_point(n);return this.get_cell_value(0,k.x,k.y)}else{var l=q}}if(l!=undefined){var o=$(l).attr("val");if(o==undefined){o=$(l).attr("val2")}}else{if(n!=undefined){var s=p.schema.get_display_seq(n,r);o=crsReport.crsTableIndex.get_hidden_cell_value(p.schema.kid,s)}}return o!=undefined?o:""},set_cell_value:function(p,m,h,n,o,l,k){if(o==undefined){o=this._get_td_by_coord(p,m,h)}if(k==undefined){k=false}if($(o).attr("val")!=n){$(o).attr("val",n);if(!k){crsReport.crsCommon.add_action_maps(["set",p,m,h,n])}}},set_cell_value2:function(p,m,h,n,o,l,k){if(o==undefined){o=this._get_td_by_coord(p,m,h)}if(k==undefined){k=false}if($(o).attr("val2")!=n){$(o).attr("val2",n);if(!k){crsReport.crsCommon.add_action_maps(["set",p,m,h,n])}}},set_hidden_cell_value:function(g,k,h,l){var m=this._get_td_by_coord(g,k,h,true);var n=m.get_display_seq(k,h);return crsReport.crsTableIndex.set_hidden_cell_value(m.kid,n,l)},set_hidden_cell_pvalue:function(g,k,h,l){var m=this._get_td_by_coord(g,k,h,true);var n=m.get_display_seq(k,h);crsReport.crsTableIndex.set_hidden_cell_value(m.kid,n,l,true)},_get_cid:function(b){return $(b).attr("id")},_get_rid:function(b){var c=$(b).parent().parent();if($(c).attr("rid")!=undefined){return $(c).attr("rid")}else{return $(c).attr("id")}return""},_get_cid_by_td:function(e){var f=$(e).attr("cid");if(f==undefined){f=$(e).attr("aria-describedby");var d=f.indexOf("{");if(d==-1){return""}f=f.substr(d)}return f},_get_rid_by_td:function(b){var c=$(b).parent();if($(c).attr("rid")!=undefined){return $(c).attr("rid")}else{return $(c).attr("id")}return""},_get_row_seq:function(m){var n=$(m).parent().children();var g=$(m).attr("id");var l=1;for(var h=n.length;l<=h;l++){var k=$(n[l]).attr("id");if(k==g){break}}return l},_add_row:function(e,m){var n=this;if(e.data!=undefined){e.stopPropagation();n=e.data.me;e=e.data.tabid}var f=crsReport.crsTableIndex.getColumn(e);var h=crsReport.crsTableIndex.create_row_kid(f.rows[0].kid);var g=crsReport.crsTableIndex.search("id",e);if(crsReport.crsTableIndex.arr_hidden_rows!=null&&crsReport.crsTableIndex.arr_hidden_rows[g.id]!=undefined){if(crsReport.crsTableIndex.arr_hidden_rows[g.id]["dat"][h]==undefined){crsReport.crsTableIndex.arr_hidden_rows[g.id]["dat"][h]=[]}}if(g.canwrite==undefined&&g.canread==undefined){return""}if(n.obj_detail_dump_row["tab_"+e]!=undefined){var l={};l.kid=h;for(key in n.obj_detail_dump_row["tab_"+e]){if(key=="kid"||typeof l[key]=="function"){continue}l[key]=n.obj_detail_dump_row["tab_"+e][key].replace("undefined",h)}if(m!=undefined){$("#detail_tab_"+e).jqGrid("addRowData",h,l,"before",m)}else{$("#detail_tab_"+e).jqGrid("addRowData",h,l,"last")}}if(n.obj_default_val!=undefined&&n.obj_default_val["tab_"+e]!=undefined){var k=0;$("table[id='detail_tab_"+e+"'] tr[id='"+h+"'] td").each(function(){if(k==0){k=crsReport.crsCommon.crsForm._get_row_seq($(this).parent())}var d=$(this).attr("aria-describedby");var c=d.indexOf("{");if(c!==-1){d=d.substr(c);if(n.obj_default_val["tab_"+e][d]!=undefined){$(this).attr("val",n.obj_default_val["tab_"+e][d]);var b=crsReport.crsTableIndex.getAColSchema(d);var a=b.get_cell_point(k);crsReport.crsCommon.add_action_maps(["set",0,a.x,a.y,n.obj_default_val["tab_"+e][d]])}}})}},_delete_row:function(h,l){var k=crsReport.crsTableIndex.search("id",h);if(k.initcz==1){crsReport.show_hint("\u660e\u7ec6\u8868\u6700\u540e\u4e00\u6761\u8bb0\u5f55\u4e0d\u80fd\u5220\u9664\uff01");return}var o=this._get_row_seq($(l).parent().parent());var m=$(l).parent().siblings().eq(1).attr("aria-describedby");var n=m.indexOf("{");m=m.substr(n);this._update_cell_refer(m,o,"del");crsReport.crsTableIndex.delete_row_kid($(l).parent().parent().attr("id"));var p=$(l).parent().siblings().eq(0);p=$(p).text();$("#detail_tab_"+h).jqGrid("delRowData",p);k.initcz=parseInt(k.initcz)-1;this.set_coord_to_kid_map();crsReport.crsCommon.refresh()},_insert_row:function(h,l){var p=$(l).parent().siblings().eq(0);p=$(p).text();var o=this._get_row_seq($(l).parent().parent());var m=$(l).parent().siblings().eq(1).attr("aria-describedby");var n=m.indexOf("{");m=m.substr(n);var k=crsReport.crsTableIndex.search("id",h);this._update_cell_refer(m,o,"ins");this._add_row(h,p);k.initcz=parseInt(k.initcz)+1;this.set_coord_to_kid_map();crsReport.crsCommon.refresh()},_get_position:function(e,f){var h=crsReport.crsTableIndex.getAColSchema(e);var g=h.get_cell_rect(f);return g},_update_cell_refer:function(l,r,k,o){if(o==undefined){o=1}var n=crsReport.crsTableIndex.getAColSchema(l);var q=crsReport.crsTableIndex.rows[n.row_idx];var p=n.col.rows[n.col_idx];var s=n.get_cell_rect(r);var m=s[1].y-s[0].y+1;crsReport.crsChartCache.update_ref(parseInt(q.sheetindex),s[0].y,o*m,k,false);crsReport.crsTableIndex.update_cell_refer(parseInt(q.sheetindex),q.expandtype,s,o,k=="ins"||k=="app");if(k=="ins"||k=="app"){crsReport.crsCommon.add_action_maps([k,parseInt(q.sheetindex)-1,s[0].y,o*m,m])}else{crsReport.crsCommon.add_action_maps([k,parseInt(q.sheetindex)-1,s[0].y,o*m,m])}},auto_increment:function(l,n){if(l.tabletype=="\u660e\u7ec6\u8868"){var o=parseInt(l.sheetindex)-1;if(!n.isEmpty()){var m=n.first();while(!n.EOF()){if(m.datatype=="\u81ea\u589e\u578b"){var k=rectNameToIndex(m.cellspan);if(l.expandtype=="\u6309\u884c\u5411\u4e0b"||l.expandtype=="\u4e0d\u6269\u5c55"){var p=k[1].y-k[0].y+1;for(var h=0;h<l.initcz;h++){this._set_cell_value(o,k[0].x,k[1].y+h*p,h+1)}}}m=n.next()}}}},append_record:function(h,k,c){var l=this;if(h.data!=undefined){h.stopPropagation();l=h.data.me;k=h.data.obj_col;h=h.data.obj_tab}if(c==undefined){c=1}if(h.expandtype=="\u6309\u884c\u5411\u4e0b"){l._update_cell_refer(k.kid,h.initcz,"app",c);for(var f=0;f<c;f++){l._add_row(h.id)}h.initcz=parseInt(h.initcz)+c;l.set_coord_to_kid_map();crsReport.crsCommon.refresh()}},clear_cell:function(q,o,r){var p=this._get_td_and_schema_by_coord(q,o,r);var m=p.td;if(m!=undefined){$(m).attr("val2","");$(m).attr("val","");$(m).empty();var l=this._get_cid_by_td(m);var k=p.schema;var n=crsReport.crsTableIndex.rows[k.row_idx];if($(m).html().indexOf("</select>")!=-1){$($(m).html()).attr("selectedIndex",0)}else{$(m).html(crsReport.crsCommon._get_editor(this._get_rid_by_td(m),k))}}else{var s=p.schema.get_display_seq(o,r);crsReport.crsTableIndex.clear_hidden_cell_value(p.schema.kid,s)}crsReport.crsCommon.add_action_maps(["set",q,o,r,""])},delete_record:function(p,r,o,s){var q=this._get_td_and_schema_by_coord(r,o,s);var m=q.td,n=q.schema.kid,t;var k="";if(m!=undefined){t=this._get_row_seq($(m).parent("tr"));k=$(m).parent("tr").attr("id");var l=$(m).siblings().eq(0);l=$(l).text();$("#detail_tab_"+p.id).jqGrid("delRowData",l)}else{t=q.schema.get_display_seq(o,s);crsReport.crsTableIndex.delete_hidden_row(n,t)}this._update_cell_refer(n,t,"del");crsReport.crsTableIndex.delete_row_kid(k);p.initcz=parseInt(p.initcz)-1;this.set_coord_to_kid_map()},set_cell_backgroud_color:function(l,f,k,h){var g=this._get_td_by_coord(l,f,k);$(g).children("input").each(function(){if(h!=undefined){$(this).css("background-color",h)}else{$(this).css("background-color","")}})},_draw_a_td:function(v,s,w,o,r,q,y){if(o.ismust&&crsReport.openMode!="read"){var u="Red"}else{var u=""}var t="";if(v){var x=o.col.obj_data_cache.get_nth_by_col_name("col"+q.id);t=HandleMemoStr(y[x],false);if(t=="null"){t=""}if((q.datatype=="\u8d27\u5e01\u578b"||q.datatype=="\u6570\u503c\u578b")&&parseFloat(t)==0||q.datatype=="\u65e5\u671f\u578b"&&(t=="0"||t=="0000-00-00 00:00:00"||t=="0000-00-00"||t=="00:00:00")){if(!crsReport.showZeroValue){t=""}}}else{t=crsReport.get_val_from_para(o.kid);if(t==""&&typeof q.datas_from_template=="object"){t=q.datas_from_template[0]}if(t==""){t=q.defaultval}}var p={val:""};if(o.canread){p.val=t}var n=crsReport.crsCommon._get_editor(w,o,p,o.col.obj_data_cache,y);if(p.val!=t){t=p.val}if(q.has_inline_calcu!="y"){var m=rectNameToIndex(q.cellspan);crsReport.crsCommon.add_action_maps(["set",parseInt(r.sheetindex)-1,m[0].x,m[0].y,t])}s+='<td width="150" class="TableLabel" nowrap=""><span title="" class="TableContent '+u+'">'+q.columnlabel+'</span></td><td class="TableData Width40" cid="'+q.kid+'"'+((v)?(' pval="'+t+'"'):"")+' val="'+t+'">'+n+"</td>";return s},get_col_width:function(c){var b=c.columnlabel.length*10,a;switch(c.datatype){case"\u5b57\u7b26\u578b":a=120;break;case"\u6570\u503c\u578b":case"\u8d27\u5e01\u578b":a=80;break;case"\u65e5\u671f\u578b":if(HandleMemoStr(c.displaystyle,false)=="m/d/yy h:mm"){a=100}else{a=80}break;case"\u4ee3\u7801\u578b":a=80;break;case"\u81ea\u52a8\u7f16\u53f7":a=80;break;case"\u81ea\u589e\u578b":case"\u903b\u8f91\u578b":a=40;break;case"\u56fe\u7247\u578b":case"\u9644\u4ef6\u578b":a=160;break;default:a=120}return b>a?b:a},draw_form:function(ap){if(ap){var ak=crsReport.crsTableIndex.getFirstTable();while(ak!=null){var av=ak[1]-1;var ao=rectNameToIndex(ak[5]);if(ak[3]<1){ak[3]=1}if(ak[0]=="\u660e\u7ec6\u8868"){if(ak[2]=="\u6309\u884c\u5411\u4e0b"){if(ak[4]>ak[3]){crsReport.crsTableIndex.update_cell_refer(parseInt(av)+1,ak[2],ao,ak[4]-ak[3],true);crsReport.crsChartCache.update_ref(parseInt(av)+1,ao[0].y,ak[4]-ak[3],"app",false);crsReport.crsCommon.add_action_maps(["app",av,ao[0].y,(ak[4]-ak[3])*(ao[1].y-ao[0].y+1),(ao[1].y-ao[0].y+1)])}}else{if(ak[2]=="\u6309\u5217\u5411\u53f3"){if(ak[4]>ak[3]){crsReport.crsTableIndex.update_cell_refer(parseInt(av)+1,ak[2],ao,ak[4]-ak[3],true);crsReport.crsChartCache.update_ref(parseInt(av)+1,ao[0].x,ak[4]-ak[3],"app",true);crsReport.crsCommon.add_action_maps(["app",av,ao[0].x,(ak[4]-ak[3])*(ao[1].x-ao[0].x+1),(ao[1].x-ao[0].x+1)])}}}}ak=crsReport.crsTableIndex.getNextTable()}}$('<form name="my_form" method="post" enctype="multipart/form-data" action="" target=""/>').appendTo($("body"));$('<div id="id_select" style="width: 250px;height:250px;background-color: #ffffff;overflow:auto;z-index: 1999;position: absolute;display:none;"></div>').appendTo($("body"));$('<div id="_all_map" style="top:0px;left:0px;width:100%;height:80%;background-color: #ffffff;overflow:auto;z-index: 1999;position: absolute;display:none;"><span style="font-size: 12px;float: right;cursor: pointer;" onclick=""><b>\u5173\u95ed</b></span></div>').appendTo($("body"));var al=this;if(!crsReport.crsTableIndex.isEmpty()){var U=3;var af,aw;var X=crsReport.crsTableIndex.first();while(!crsReport.crsTableIndex.EOF()){var ar=crsReport.crsTableIndex.getColumn(X.id);var ad,at,ab;if(X.tabletype=="\u4e3b\u8868"&&ar.length()>0){var r="";var aa=0,Y=0;var ax="",an=ar.arr_output_cols.length,s=0;if(ap){ab=ar.obj_data_cache.rows[0];ad=ar.obj_data_cache.get_nth_by_col_name("kid");if(crsReport.openMode=="copynew"){ab[ad]=crsReport.crsTableIndex.create_row_kid(ar.rows[0].kid)}ax=ab[ad]}else{ax=crsReport.crsTableIndex.create_row_kid(ar.rows[0].kid)}if(ar.arr_hidden_cols!=null){if(crsReport.crsTableIndex.arr_hidden_rows[X.id]["dat"][ax]==undefined){crsReport.crsTableIndex.arr_hidden_rows[X.id]["dat"][ax]=[]}for(var G=0,aj=ar.arr_hidden_cols.length;G<aj;G++){if(ap){aw=ar.rows[ar.arr_hidden_cols[G]];ad=ar.obj_data_cache.get_nth_by_col_name("col"+aw.id);at=HandleMemoStr(ab[ad],false);if(aw.has_inline_calcu!="y"){var ay=crsReport.crsTableIndex.getAColSchema(aw.kid);var ac=ay.get_cell_rect(1);crsReport.crsCommon.add_action_maps(["set",parseInt(X.sheetindex)-1,ac[0].x,ac[0].y,at])}crsReport.crsTableIndex.arr_hidden_rows[X.id]["dat"][ax][aw.kid]={val:at,pval:at}}else{aw=ar.rows[ar.arr_hidden_cols[G]];at=crsReport.get_val_from_para(aw.kid);if(aw.has_inline_calcu!="y"){var ay=crsReport.crsTableIndex.getAColSchema(aw.kid);var ac=ay.get_cell_rect(1);crsReport.crsCommon.add_action_maps(["set",parseInt(X.sheetindex)-1,ac[0].x,ac[0].y,at])}crsReport.crsTableIndex.arr_hidden_rows[X.id]["dat"][ax][aw.kid]={val:at,pval:at}}}}if(ar.arr_picture_cols!=null){if(r==""){r='<div id="main_tab_'+X.id+'"><ul><li><a href="#m_tab_'+X.id+'">'+X.label+'</a></li></ul><div id="m_tab_'+X.id+'"><table width="100%" id="main_tab_'+X.id+'" align="center" class="App_TableBlock" border="0" cellspacing="0"><tbody>'}aa=ar.arr_picture_cols.length;if(aa*U<=an){for(var S=0;S<aa;S++){for(var T=0;T<U;T++){aw=ar.rows[ar.arr_output_cols[s++]];af=crsReport.crsTableIndex.getAColSchema(aw.kid);r+="<tr rid='"+ax+"'>";r=this._draw_a_td(ap,r,ax,af,X,aw,ab);if(T==0){af=crsReport.crsTableIndex.getAColSchema(ar.arr_picture_cols[S]);aw=af.col.rows[af.col_idx];if(af.ismust){var ag=" Red"}else{var ag=""}if(ap){ad=ar.obj_data_cache.get_nth_by_col_name("col"+aw.id);at=HandleMemoStr(ab[ad],false);if(at=="null"){at=""}}else{at=crsReport.get_val_from_para(aw.kid);if(at==""&&typeof aw.datas_from_template=="object"){at=aw.datas_from_template[0]}if(at==""){at=aw.defaultval}}var am={val:at};var W=crsReport.crsCommon._get_editor(ax,af,am,ar.obj_data_cache,ab);at=am.val;if(aw.has_inline_calcu!="y"){var ac=rectNameToIndex(aw.cellspan);crsReport.crsCommon.add_action_maps(["set",parseInt(X.sheetindex)-1,ac[0].x,ac[0].y,at])}r+='<td width="150" class="TableLabel" rowspan='+U+' nowrap="" style="vertical-align: middle;"><span title="" class="TableContent'+ag+'">'+aw.columnlabel+'</span></td><td class="TableData Width40" rowspan='+U+' cid="'+aw.kid+'"'+((ap)?(' pval="'+at+'"'):"")+' val="'+((ap)?at:"")+'" style="vertical-align: middle;">'+W+"</td>"}r+="</tr>"}}}else{for(var S=0;S<aa;S++){for(var T=0;T<U;T++){r+="<tr rid='"+ax+"'>";if(T==0){af=crsReport.crsTableIndex.getAColSchema(ar.arr_picture_cols[S]);aw=af.col.rows[af.col_idx];if(af.ismust){var ag=" Red"}else{var ag=""}if(ap){ad=ar.obj_data_cache.get_nth_by_col_name("col"+aw.id);at=HandleMemoStr(ab[ad],false);if(at=="null"){at=""}}else{at=crsReport.get_val_from_para(aw.kid);if(at==""&&typeof aw.datas_from_template=="object"){at=aw.datas_from_template[0]}if(at==""){at=aw.defaultval}}var am={val:at};var W=crsReport.crsCommon._get_editor(ax,af,am,ar.obj_data_cache,ab);at=am.val;if(aw.has_inline_calcu!="y"){var ac=rectNameToIndex(aw.cellspan);crsReport.crsCommon.add_action_maps(["set",parseInt(X.sheetindex)-1,ac[0].x,ac[0].y,at])}r+='<td width="150" class="TableLabel" rowspan='+U+' nowrap="" style="vertical-align: middle;"><span title="" class="TableContent'+ag+'">'+aw.columnlabel+'</span></td><td class="TableData Width40" rowspan='+U+' cid="'+aw.kid+'"'+((ap)?(' pval="'+at+'"'):"")+' val="'+((ap)?at:"")+'" style="vertical-align: middle;">'+W+"</td>"}if(s<an){aw=ar.rows[ar.arr_output_cols[s++]];af=crsReport.crsTableIndex.getAColSchema(aw.kid);r=this._draw_a_td(ap,r,ax,af,X,aw,ab)}else{r+='<td class="TableLabel" colspan=2>&nbsp;</td>'}r+="</tr>"}}}if(s>=an){r+="</tbody></table></div></div>"}}while(s<an){if(r==""){r='<div id="main_tab_'+X.id+'"><ul><li><a href="#m_tab_'+X.id+'">'+X.label+'</a></li></ul><div id="m_tab_'+X.id+'"><table width="100%" id="main_tab_'+X.id+'" align="center" class="App_TableBlock" border="0" cellspacing="0"><tbody>'}aw=ar.rows[ar.arr_output_cols[s++]];af=crsReport.crsTableIndex.getAColSchema(aw.kid);if(Y%2==0){r+="<tr rid='"+ax+"'>"}r=this._draw_a_td(ap,r,ax,af,X,aw,ab);if(Y%2==1){r+="</tr>"}Y++}if(Y>0){if(Y%2==1){r+='<td class="TableLabel" colspan=2>&nbsp;</td></tr>'}r+="</tbody></table></div></div>"}if(r!=""){$(r).appendTo($("body > form"))}try{if($("div[id='main_tab_"+X.id+"']").length>0){$("div[id='main_tab_"+X.id+"']").tabs()}}catch(e){}ar.arr_picture_cols=null;ar.arr_output_cols=null;ar.arr_hidden_cols=null}else{if(X.tabletype=="\u660e\u7ec6\u8868"){if(!ar.isEmpty()){var k,k,V="",Z="";aw=ar.first();while(!ar.EOF()){af=crsReport.crsTableIndex.getAColSchema(aw.kid);if(!af.canwrite&&!af.canread){}else{if(V==""){if(crsReport.openMode=="read"){k=["kid"],obj_col_model=[{name:"kid",index:"kid",hidden:true}]}else{k=["kid","\u64cd\u4f5c"],obj_col_model=[{name:"kid",index:"kid",hidden:true},{name:"ope",index:"ope",width:35,sortable:false,fixed:true}]}V='<li><a href="#tab_'+X.id+'">'+X.label+"</a></li>";Z='<div id="tab_'+X.id+'" align="center"><table id="detail_tab_'+X.id+'"><tr><td></td></tr></table><div id="pager_detail_tab_'+X.id+'"></div></div>';if(crsReport.openMode=="read"){}else{al.obj_detail_dump_row["tab_"+X.id]={kid:"",ope:(crsReport.crsTableIndex.can_insert(X.id)?'<img title="\u63d2\u5165" onclick="crsReport.crsCommon.crsForm._insert_row('+X.id+', this)" src="/static/modules/reportshop/images/Update.ico" border="0" style="cursor:pointer">':"")+(crsReport.crsTableIndex.can_delete(X.id)?'<img title="\u5220\u9664" onclick="crsReport.crsCommon.crsForm._delete_row('+X.id+', this)" src="/static/modules/reportshop/images/delete.gif" border="0" style="cursor:pointer">':"")}}}k.push(aw.columnlabel);obj_col_model.push({name:aw.kid,index:aw.kid,sortable:false,width:this.get_col_width(aw)});if(crsReport.openMode=="read"){}else{if(af.canread&&aw.defaultval!=""){var am={val:aw.defaultval};al.obj_detail_dump_row["tab_"+X.id][aw.kid]=crsReport.crsCommon._get_editor(undefined,af,am)}else{var am={val:""};al.obj_detail_dump_row["tab_"+X.id][aw.kid]=crsReport.crsCommon._get_editor(undefined,af,am)}if(crsReport.openMode!="read"&&aw.defaultval!=""){if(al.obj_default_val==undefined){al.obj_default_val={}}if(al.obj_default_val["tab_"+X.id]==undefined){al.obj_default_val["tab_"+X.id]={}}al.obj_default_val["tab_"+X.id][aw.kid]=aw.defaultval}if(crsReport.openMode=="write"&&typeof aw.datas_from_template=="object"){if(al.obj_detail_template_datas==undefined){al.obj_detail_template_datas={}}if(al.obj_detail_template_datas["tab_"+X.id]==undefined){al.obj_detail_template_datas["tab_"+X.id]={}}if(al.obj_detail_template_datas["tab_"+X.id][aw.kid]==undefined){al.obj_detail_template_datas["tab_"+X.id][aw.kid]=[];al.obj_detail_template_datas["tab_"+X.id][aw.kid][0]=""}for(s_k in aw.datas_from_template){if(typeof aw.datas_from_template[s_k]=="function"){break}var am={val:aw.datas_from_template[s_k]};al.obj_detail_template_datas["tab_"+X.id][aw.kid][parseInt(s_k)+1]={editor:crsReport.crsCommon._get_editor(ax,af,am),val:am.val}}}}}aw=ar.next()}if(X.canwrite!=undefined||X.canread!=undefined){if($("#detail_tabs").length<=0){$('<div id="detail_tabs"><ul>'+V+"</ul>"+Z+"</div>").appendTo($("body > form"))}else{$(V).appendTo($("#detail_tabs ul"));$(Z).appendTo($("#detail_tabs"))}$("#detail_tab_"+X.id).jqGrid({datatype:"local",height:this.i_default_height,width:"100%",colNames:k,colModel:obj_col_model,pager:"#pager_detail_tab_"+X.id,sortname:"id",viewrecords:true,sortorder:"desc",autowidth:false})}if(crsReport.openMode=="write"){if(al.obj_detail_template_datas!=undefined&&al.obj_detail_template_datas["tab_"+X.id]!=undefined){for(s_k in al.obj_detail_template_datas["tab_"+X.id]){if(typeof al.obj_detail_template_datas["tab_"+X.id][s_k]=="function"){break}al.obj_detail_template_datas["tab_"+X.id][s_k][0]=al.obj_detail_dump_row["tab_"+X.id][s_k]}}for(var G=0;G<X.initcz;G++){if(al.obj_detail_template_datas!=undefined&&al.obj_detail_template_datas["tab_"+X.id]!=undefined){for(s_k in al.obj_detail_template_datas["tab_"+X.id]){if(typeof al.obj_detail_template_datas["tab_"+X.id][s_k]=="function"){break}if(G<al.obj_detail_template_datas["tab_"+X.id][s_k].length-1){al.obj_detail_dump_row["tab_"+X.id][s_k]=al.obj_detail_template_datas["tab_"+X.id][s_k][G+1]["editor"]}else{al.obj_detail_dump_row["tab_"+X.id][s_k]=al.obj_detail_template_datas["tab_"+X.id][s_k][0]}}}al._add_row(X.id);if(al.obj_detail_template_datas!=undefined&&al.obj_detail_template_datas["tab_"+X.id]!=undefined){$("table[id='detail_tab_"+X.id+"'] tr[id='"+al.obj_detail_dump_row["tab_"+X.id]["kid"]+"'] td").each(function(){var b=$(this).attr("aria-describedby");var a=b.indexOf("{");if(a!==-1){b=b.substr(a);if(al.obj_detail_template_datas["tab_"+X.id][b]!=undefined&&G<al.obj_detail_template_datas["tab_"+X.id][b].length-1){$(this).attr("val",al.obj_detail_template_datas["tab_"+X.id][b][G+1]["val"])}}})}}if(al.obj_detail_template_datas!=undefined&&al.obj_detail_template_datas["tab_"+X.id]!=undefined){for(s_k in al.obj_detail_template_datas["tab_"+X.id]){if(typeof al.obj_detail_template_datas["tab_"+X.id][s_k]=="function"){break}al.obj_detail_dump_row["tab_"+X.id][s_k]=al.obj_detail_template_datas["tab_"+X.id][s_k][0]}}}else{var ah=ar.obj_data_cache;if(!ah.isEmpty()){var ab=ah.first();var ae=ah.get_nth_by_col_name("kid");while(!ah.EOF()){if(crsReport.openMode=="copynew"){ab[ae]=crsReport.crsTableIndex.create_row_kid(ar.rows[0].kid)}var au=null,ai={};if(X.canwrite!=undefined||X.canread!=undefined){if(crsReport.openMode=="read"){au={kid:ab[ae]}}else{au={kid:ab[ae],ope:(crsReport.crsTableIndex.can_insert(X.id)?'<img title="\u63d2\u5165" onclick="crsReport.crsCommon.crsForm._insert_row('+X.id+', this)" src="/static/modules/reportshop/images/Update.ico" border="0" style="cursor:pointer">':"")+(crsReport.crsTableIndex.can_delete(X.id)?'<img title="\u5220\u9664" onclick="crsReport.crsCommon.crsForm._delete_row('+X.id+', this)" src="/static/modules/reportshop/images/delete.gif" border="0" style="cursor:pointer">':"")}}}aw=ar.first();while(!ar.EOF()){af=crsReport.crsTableIndex.getAColSchema(aw.kid);if(!af.canwrite&&!af.canread){if(crsReport.crsTableIndex.arr_hidden_rows[X.id]["dat"][ab[ae]]==undefined){crsReport.crsTableIndex.arr_hidden_rows[X.id]["dat"][ab[ae]]=[]}ad=ah.get_nth_by_col_name("col"+aw.id);at=HandleMemoStr(ab[ad],false);crsReport.crsTableIndex.arr_hidden_rows[X.id]["dat"][ab[ae]][aw.kid]={val:at,pval:at}}else{if(af.canread){ad=ah.get_nth_by_col_name("col"+aw.id);at=HandleMemoStr(ab[ad],false);if(at=="null"){at=""}if((aw.datatype=="\u8d27\u5e01\u578b"||aw.datatype=="\u6570\u503c\u578b")&&parseFloat(at)==0||aw.datatype=="\u65e5\u671f\u578b"&&(at=="0"||at=="0000-00-00 00:00:00"||at=="0000-00-00"||at=="00:00:00")){if(!crsReport.showZeroValue){at=""}}}else{at=""}var am={val:at};au[aw.kid]=crsReport.crsCommon._get_editor(ab[ae],af,am,ah,ab)+"</td>";ai[aw.kid]=am.val;at=am.val}if(aw.has_inline_calcu!="y"){var ac=af.get_cell_rect(parseInt(ab[10]));crsReport.crsCommon.add_action_maps(["set",parseInt(X.sheetindex)-1,ac[0].x,ac[0].y,at])}aw=ar.next()}if(X.canwrite!=undefined||X.canread!=undefined){$("#detail_tab_"+X.id).jqGrid("addRowData",au.kid,au,"last");$("table[id='detail_tab_"+X.id+"'] tr[id='"+au.kid+"'] td").each(function(){var b=$(this).attr("aria-describedby");var a=b.indexOf("{");if(a!==-1){b=b.substr(a);$(this).attr("val",ai[b]);$(this).attr("pval",ai[b])}})}var ab=ah.next()}}}if((X.canwrite!=undefined||X.canread!=undefined)&&crsReport.crsTableIndex.can_append(X.id)){$("#detail_tab_"+X.id).jqGrid("navGrid","#pager_detail_tab_"+X.id,{add:false,edit:false,del:false,search:false,refresh:false}).jqGrid("navButtonAdd","#pager_detail_tab_"+X.id,{caption:"",title:"\u6dfb\u52a0\u8bb0\u5f55",buttonicon:"ui-icon-plus",position:"last"});$("#pager_detail_tab_"+X.id+"_left span.ui-icon-plus").bind("click",{obj_tab:X,obj_col:af,tabid:X.id,me:al},al.append_record)}}}}X=crsReport.crsTableIndex.next()}}try{if($("#detail_tabs").length>0){$("#detail_tabs").tabs()}}catch(e){}this.set_coord_to_kid_map();if(!crsReport.crsChartCache.isEmpty()){V="",Z="";var aq=crsReport.crsChartCache.first();while(!crsReport.crsChartCache.EOF()){var R=getColPlatKId(aq.label);aq.label=R;aq.category_name=HandleMemoStr(aq.category_name,false);aq.series_name=HandleMemoStr(aq.series_name,false);V+='<li><a href="#'+R+'">'+aq.title+"</a></li>";Z+='<div id="'+R+'" style="min-width:450px;min-height:350px;"></div>';aq=crsReport.crsChartCache.next()}if(!crsReport.crsChartCache.isEmpty()){if($("#detail_tabs").length>0){$("#detail_tabs").before($('<div id="chart_tabs" align="center"><ul>'+V+"</ul>"+Z+"</div>"))}else{$('<div id="chart_tabs" align="center"><ul>'+V+"</ul>"+Z+"</div>").appendTo($("body > form"))}try{if($("#chart_tabs").length>0){$("#chart_tabs").tabs()}}catch(e){}}else{if($("#detail_tabs").length>0){$("#detail_tabs").before($('<div id="chart_tabs" align="center">'+Z+"</div>"))}else{$('<div id="chart_tabs" align="center">'+Z+"</div>").appendTo($("body > form"))}}var aq=crsReport.crsChartCache.first();while(!crsReport.crsChartCache.EOF()){crsReport.crsChartCache.draw_chart(aq);aq=crsReport.crsChartCache.next()}}this.resize()},begin_update:function(){},end_update:function(){this.calculate();crsReport.crsChartCache.refresh()},resize:function(){var d=0;$("div[id^='main_tab_']").each(function(){d+=$(this).height()});var e=$(window).width()-40;var f=$(window).height()-d-125;if(e>this.i_default_height){$("table[id^='detail_tab_']").each(function(){var a=$(this).jqGrid("getGridParam","colNames").length;if(a<14){$(this).jqGrid("setGridWidth",e)}});$("#chart_tabs > div").width(e)}if(f>this.i_default_height){if($("#chart_tabs").length>0){if($("#detail_tabs").length>0){f-=$("#detail_tabs").height()}if(f>this.i_default_height){$("#chart_tabs > div").height(f)}}else{$("table[id^='detail_tab_']").jqGrid("setGridHeight",f)}}}};function TCRSHyperlink(c,d){this.i_repid=d;this.crsDataSet=c;TCRSDataRecord.call(this,this.crsDataSet,"crscell.crs_chart","*","repid='"+d+"'","")}TCRSHyperlink.prototype=new TCRSDataRecord();TCRSHyperlink.prototype.load_link=function(){this.loadData("#tablecrs_hyperlink");if(!this.isEmpty()){var a=this.first();while(!this.EOF()){var b=crsReport.crsCommon.crsTable.crsCellControler.get_cell(a.sheetindex,a.col,a.row);$(b).html("<a href='"+HandleMemoStr(a.hyperlink,false)+"' title='"+HandleMemoStr(a.info,false)+"' target='_blank'>"+$(b).html()+"</a>");a=this.next()}}};
